[{"id":"e9bcdddb.5dd08","type":"tab","label":"TestFlow","disabled":false,"info":""},{"id":"eb66deb5.bea27","type":"tab","label":"Heating","disabled":false,"info":""},{"id":"26d1fc02.f4deb4","type":"tab","label":"InitDatabases","disabled":false,"info":""},{"id":"50191f06.dc99e","type":"tab","label":"API","disabled":false,"info":""},{"id":"20513146.91ed4e","type":"tab","label":"companion","disabled":false,"info":""},{"id":"a26281bc.ae89f","type":"tab","label":"UI","disabled":false,"info":""},{"id":"c61d9d5f.52591","type":"tab","label":"ModelUpload","disabled":false,"info":""},{"id":"99d538c.efbabc8","type":"tab","label":"MusicBrainz","disabled":false,"info":""},{"id":"dd11dd22.8a11a","type":"tab","label":"MOPOP Command Injection","disabled":false,"info":""},{"id":"2e447439.f12bdc","type":"tab","label":"MOPOP","disabled":false,"info":""},{"id":"615cd8c9.e4e9f8","type":"tab","label":"Mopop 2.0","disabled":false,"info":""},{"id":"923bd7d5.f34fa8","type":"tab","label":"Mopop cnr (hololens)","disabled":false,"info":""},{"id":"a3b70a95.71cd58","type":"tab","label":"all temperatures","disabled":true,"info":""},{"id":"f3784d00.40ef8","type":"tab","label":"clientside","disabled":true,"info":""},{"id":"3d91de7c.8d0e42","type":"tab","label":"clientside2-server","disabled":false,"info":""},{"id":"6f1bb07c.9a108","type":"tab","label":"partcnr","disabled":true,"info":""},{"id":"ece826b8.56d178","type":"tab","label":"clientside2","disabled":true,"info":""},{"id":"89ca6e54.b8f36","type":"tab","label":"midiclient","disabled":true,"info":""},{"id":"73e9a24f.21590c","type":"mqtt-broker","name":"","broker":"ragrug-mqtt","port":"1883","clientid":"nodered","usetls":false,"compatmode":false,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"fddc60d3.519f5","type":"influxdb","hostname":"ragrug-influxdb","port":"8086","protocol":"http","database":"test","name":"","usetls":false,"tls":"","influxdbVersion":"1.x","url":"http://ragrug-influxdb:8086","rejectUnauthorized":false},{"id":"370a75d7.b3a34a","type":"influxdb","hostname":"ragrug-influxdb","port":"8086","protocol":"http","database":"inffeld","name":"","usetls":false,"tls":"","influxdbVersion":"1.x","url":"","rejectUnauthorized":false},{"id":"c1ab96d7.e27428","type":"ui_tab","name":"Home","icon":"dashboard","disabled":false,"hidden":false},{"id":"3bff8420.f2174c","type":"ui_group","name":"Model Upload","tab":"c1ab96d7.e27428","order":1,"disp":true,"width":"7","collapse":false},{"id":"a5909571.d68878","type":"ui_base","theme":{"name":"theme-custom","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","reset":false},"themeState":{"base-color":{"default":"#4B7930","value":"#4B7930","edited":false},"page-titlebar-backgroundColor":{"value":"#4B7930","edited":false},"page-backgroundColor":{"value":"#111111","edited":false},"page-sidebar-backgroundColor":{"value":"#333333","edited":false},"group-textColor":{"value":"#6db046","edited":false},"group-borderColor":{"value":"#555555","edited":false},"group-backgroundColor":{"value":"#333333","edited":false},"widget-textColor":{"value":"#eeeeee","edited":false},"widget-backgroundColor":{"value":"#4b7930","edited":false},"widget-borderColor":{"value":"#333333","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","lockMenu":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"497401a9.52275","type":"cloudantplus","host":"http://ragrug-couchdb:5984","name":"couchdb"},{"id":"b71a6d4e.5661b","type":"ui_group","name":"Default","tab":"b8bb0c3a.a8dea","order":1,"disp":true,"width":20,"collapse":false},{"id":"5b775fa5.03f08","type":"ui_group","name":"Telemetry Mqtt","tab":"c1ab96d7.e27428","order":2,"disp":true,"width":"12","collapse":false},{"id":"20ba6cdb.ae7474","type":"postgresdb","hostname":"ragrug-postgres","port":"5432","db":"mopop","ssl":false},{"id":"52d8d00e.63087","type":"tls-config","name":"","cert":"","key":"","ca":"","certname":"","keyname":"","caname":"","servername":"","verifyservercert":false},{"id":"cc2d9bed.0074e8","type":"ui_group","name":"Data Export","tab":"946bcae7.97e758","order":1,"disp":true,"width":"12"},{"id":"946bcae7.97e758","type":"ui_tab","name":"Dashboard","icon":"dashboard","order":1,"disabled":false,"hidden":false},{"id":"f55697f1.dab3f8","type":"influxdb","hostname":"influxdb","port":"8086","protocol":"http","database":"vzcollector","name":"","usetls":false,"tls":"52d8d00e.63087","influxdbVersion":"1.x"},{"id":"b8bb0c3a.a8dea","type":"ui_tab","name":"VZSC","icon":"dashboard","disabled":true,"hidden":false},{"id":"8a5dfa6b.024cc8","type":"ui_group","name":"MOPOP","tab":"c1ab96d7.e27428","order":3,"disp":true,"width":"12","collapse":false},{"id":"59737da4.8acc34","type":"ui_tab","name":"Master","icon":"dashboard","disabled":false,"hidden":false},{"id":"b94d6635.f9dd08","type":"ui_group","name":"Control","tab":"59737da4.8acc34","order":1,"disp":true,"width":"6","collapse":false},{"id":"2396ab21.3b7d44","type":"ui_group","name":"Score","tab":"4adc957f.33fcec","order":4,"disp":true,"width":18,"collapse":false},{"id":"f05d58a6.98fe08","type":"ui_tab","name":"Score","icon":"dashboard","disabled":false,"hidden":false},{"id":"65ad83dc.a2cefc","type":"ui_tab","name":"Events","icon":"dashboard","disabled":false,"hidden":false},{"id":"335e1fc0.afce7","type":"ui_group","name":"Events","tab":"65ad83dc.a2cefc","order":1,"disp":true,"width":"6","collapse":false},{"id":"c2a0cf6d.1d551","type":"ui_group","name":"Year","tab":"b925c9ea.cefa28","order":4,"disp":true,"width":"6","collapse":false},{"id":"b925c9ea.cefa28","type":"ui_tab","name":"Distributions","icon":"dashboard","disabled":false,"hidden":false},{"id":"cf72946b.93d7a8","type":"ui_tab","name":"Selection","icon":"dashboard","disabled":false,"hidden":false},{"id":"f5b93663.dcdb98","type":"ui_group","name":"Record","tab":"cf72946b.93d7a8","order":1,"disp":true,"width":"6","collapse":false},{"id":"68cad0fd.621c2","type":"ui_group","name":"MIDI","tab":"b4c44ec4.a2c56","order":1,"disp":true,"width":"6","collapse":false},{"id":"b4c44ec4.a2c56","type":"ui_tab","name":"MIDI","icon":"dashboard","disabled":false,"hidden":false},{"id":"efe01547.5b7098","type":"ui_group","name":"Occupied","tab":"4adc957f.33fcec","order":1,"disp":true,"width":"6","collapse":false},{"id":"4adc957f.33fcec","type":"ui_tab","name":"Mopop 2.0","icon":"dashboard","order":10,"disabled":false,"hidden":false},{"id":"5639fe60.0e244","type":"ui_group","name":"Records","tab":"4adc957f.33fcec","order":2,"disp":true,"width":"6","collapse":false},{"id":"616933a4.93a86c","type":"ui_group","name":"Record","tab":"4adc957f.33fcec","order":3,"disp":true,"width":"6","collapse":false},{"id":"e2d706f9.a551d8","type":"ui_tab","name":"Mopop 2.0 Simulator","icon":"dashboard","order":11,"disabled":false,"hidden":false},{"id":"ceea8389.aebd9","type":"ui_group","name":"Simulator","tab":"4adc957f.33fcec","order":6,"disp":true,"width":18,"collapse":false},{"id":"69a80b71.7ae5b4","type":"ui_spacer","name":"spacer","group":"616933a4.93a86c","order":1,"width":1,"height":1},{"id":"31ac545d.41e92c","type":"ui_spacer","name":"spacer","group":"616933a4.93a86c","order":3,"width":1,"height":1},{"id":"c41a3d38.7881f","type":"ui_spacer","name":"spacer","group":"616933a4.93a86c","order":4,"width":1,"height":1},{"id":"444e7364.ac735c","type":"ui_spacer","name":"spacer","group":"616933a4.93a86c","order":5,"width":1,"height":1},{"id":"e6bdb6cd.ecb398","type":"ui_spacer","name":"spacer","group":"616933a4.93a86c","order":6,"width":1,"height":1},{"id":"518501e7.9ba51","type":"ui_spacer","name":"spacer","group":"616933a4.93a86c","order":7,"width":1,"height":1},{"id":"4f3bc9f0.b70ed8","type":"ui_spacer","name":"spacer","group":"616933a4.93a86c","order":8,"width":1,"height":1},{"id":"499818af.0427c8","type":"ui_spacer","name":"spacer","group":"616933a4.93a86c","order":9,"width":1,"height":1},{"id":"69a8acde.ad54d4","type":"ui_spacer","name":"spacer","group":"ceea8389.aebd9","order":2,"width":11,"height":1},{"id":"3668c47.a8e9d3c","type":"ui_spacer","name":"spacer","group":"ceea8389.aebd9","order":12,"width":1,"height":1},{"id":"c7a0ad5b.15d09","type":"ui_spacer","name":"spacer","group":"ceea8389.aebd9","order":13,"width":1,"height":1},{"id":"299f95db.8a0d8a","type":"ui_spacer","name":"spacer","group":"ceea8389.aebd9","order":14,"width":1,"height":1},{"id":"a62ef4ec.051668","type":"mqtt in","z":"e9bcdddb.5dd08","name":"","topic":"rr/midi/#","qos":"2","datatype":"auto","broker":"73e9a24f.21590c","x":200,"y":200,"wires":[["c3416e89.bc74b"]]},{"id":"80047e5e.d9e4b","type":"inject","z":"e9bcdddb.5dd08","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":180,"y":100,"wires":[["7d012111.ea6d1","6b5ec69.f5d9a38"]]},{"id":"7d012111.ea6d1","type":"mqtt out","z":"e9bcdddb.5dd08","name":"","topic":"test","qos":"","retain":"","broker":"73e9a24f.21590c","x":530,"y":60,"wires":[]},{"id":"c3416e89.bc74b","type":"debug","z":"e9bcdddb.5dd08","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":550,"y":200,"wires":[]},{"id":"6b5ec69.f5d9a38","type":"influxdb out","z":"e9bcdddb.5dd08","influxdb":"fddc60d3.519f5","name":"","measurement":"test","precision":"","retentionPolicy":"","x":860,"y":140,"wires":[]},{"id":"e2060975.991e38","type":"inject","z":"26d1fc02.f4deb4","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":140,"y":140,"wires":[["61f38b20.2944f4"]]},{"id":"61f38b20.2944f4","type":"influxdb in","z":"26d1fc02.f4deb4","influxdb":"fddc60d3.519f5","name":"test","query":"create database test","rawOutput":false,"precision":"","retentionPolicy":"","x":350,"y":140,"wires":[["c8afde96.eb8a5"]]},{"id":"c8afde96.eb8a5","type":"debug","z":"26d1fc02.f4deb4","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":610,"y":140,"wires":[]},{"id":"c7c53edd.6aba5","type":"influxdb in","z":"26d1fc02.f4deb4","influxdb":"fddc60d3.519f5","name":"heating","query":"create database heating","rawOutput":false,"precision":"","retentionPolicy":"","org":"","x":360,"y":180,"wires":[["7a0fe133.d445d"]]},{"id":"a3056fbe.038ac","type":"inject","z":"26d1fc02.f4deb4","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":140,"y":180,"wires":[["c7c53edd.6aba5"]]},{"id":"7a0fe133.d445d","type":"debug","z":"26d1fc02.f4deb4","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":610,"y":180,"wires":[]},{"id":"c792ee41.16bdf","type":"inject","z":"eb66deb5.bea27","name":"","props":[{"p":"payload","v":"","vt":"date"},{"p":"topic","v":"","vt":"string"}],"repeat":"30","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":150,"y":80,"wires":[["4c27dc79.2244c4"]]},{"id":"4c27dc79.2244c4","type":"function","z":"eb66deb5.bea27","name":"Sensor1","func":"var sensor = {};\nsensor.temperature = Math.random() * 250;\nsensor.humidity = Math.random() * 100;\nsensor.preasure = Math.random() * 4000;\nsensor.type = \"heatsensor\",\nsensor.name = \"sensor1\",\nsensor.ts = msg.payload;\nmsg.payload=[\n    sensor, \n    {\n    \"tag1\":\"sensor1\",\n    \"tag2\":\"location1\",\n    \"tag3\":\"building1\"\n}];\nmsg.topic = \"heating\";\nreturn msg;","outputs":1,"noerr":0,"x":360,"y":80,"wires":[["c5b8fb2d.10e868","13890fc6.c1daa","6a67bc07.270024"]]},{"id":"573ec676.171d68","type":"ui_gauge","z":"eb66deb5.bea27","d":true,"name":"","group":"3bff8420.f2174c","order":1,"width":0,"height":0,"gtype":"gage","title":"{{msg.payload[1].tag1}}","label":"C","format":"{{msg.payload[0].temperature}}","min":0,"max":"400","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":710,"y":120,"wires":[]},{"id":"c5b8fb2d.10e868","type":"function","z":"eb66deb5.bea27","name":"","func":"var temp = msg.payload[0].temperature;\ntemp = temp.toFixed(2);\nmsg.payload[0].temperature = temp;\n\nreturn msg;","outputs":1,"noerr":0,"x":550,"y":80,"wires":[["573ec676.171d68","467b690b.8ced78"]]},{"id":"467b690b.8ced78","type":"debug","z":"eb66deb5.bea27","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":730,"y":80,"wires":[]},{"id":"a753ec8e.3611b","type":"inject","z":"eb66deb5.bea27","name":"","repeat":"45","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":150,"y":180,"wires":[["ce7cd7db.42d1f8"]]},{"id":"ce7cd7db.42d1f8","type":"function","z":"eb66deb5.bea27","name":"Sensor2","func":"var sensor = {};\nsensor.temperature = Math.random()*Math.random() * 250;\nsensor.humidity = Math.random() * 100;\nsensor.preasure = Math.random() * 4000;\nsensor.type = \"heatsensor\",\nsensor.name = \"sensor2\",\nsensor.ts = msg.payload;\nmsg.payload=[\n    sensor, \n    {\n    \"tag1\":\"sensor2\",\n    \"tag2\":\"location2\",\n    \"tag3\":\"building1\"\n}];\nmsg.topic = \"heating\";\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":180,"wires":[["6a67bc07.270024","2aaf3ec.2c0d4c2","13890fc6.c1daa"]]},{"id":"6a67bc07.270024","type":"influxdb out","z":"eb66deb5.bea27","d":true,"influxdb":"370a75d7.b3a34a","name":"","measurement":"heating","precision":"","retentionPolicy":"","x":1120,"y":580,"wires":[]},{"id":"9d5a6872.e54908","type":"ui_gauge","z":"eb66deb5.bea27","d":true,"name":"","group":"3bff8420.f2174c","order":2,"width":0,"height":0,"gtype":"gage","title":"{{msg.payload[1].tag1}}","label":"C","format":"{{msg.payload[0].temperature}}","min":0,"max":"400","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":710,"y":180,"wires":[]},{"id":"2aaf3ec.2c0d4c2","type":"function","z":"eb66deb5.bea27","name":"","func":"var temp = msg.payload[0].temperature;\ntemp = temp.toFixed(2);\nmsg.payload[0].temperature = temp;\n\nreturn msg;","outputs":1,"noerr":0,"x":540,"y":180,"wires":[["9d5a6872.e54908","733b5fda.23dc1"]]},{"id":"733b5fda.23dc1","type":"debug","z":"eb66deb5.bea27","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":730,"y":220,"wires":[]},{"id":"13890fc6.c1daa","type":"mqtt out","z":"eb66deb5.bea27","d":true,"name":"","topic":"","qos":"","retain":"","broker":"73e9a24f.21590c","x":950,"y":680,"wires":[]},{"id":"539db634.022ae8","type":"inject","z":"eb66deb5.bea27","name":"","repeat":"7","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":150,"y":280,"wires":[["44f734f1.d45c2c"]]},{"id":"44f734f1.d45c2c","type":"function","z":"eb66deb5.bea27","name":"Sensor3","func":"var sensor = {};\nsensor.temperature = Math.random()*Math.random() * 250;\nsensor.humidity = Math.random() * 100;\nsensor.preasure = Math.random() * 4000;\nsensor.type = \"heatsensor\",\nsensor.name = \"sensor3\",\nsensor.ts = msg.payload;\nmsg.payload=[\n    sensor, \n    {\n    \"tag1\":\"sensor3\",\n    \"tag2\":\"location2\",\n    \"tag3\":\"building1\"\n}];\nmsg.topic = \"heating\";\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":280,"wires":[["4a42008a.690be","13890fc6.c1daa","6a67bc07.270024"]]},{"id":"d1e09a95.07cf68","type":"ui_gauge","z":"eb66deb5.bea27","d":true,"name":"","group":"3bff8420.f2174c","order":3,"width":0,"height":0,"gtype":"gage","title":"{{msg.payload[1].tag1}}","label":"C","format":"{{msg.payload[0].temperature}}","min":0,"max":"400","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":710,"y":280,"wires":[]},{"id":"4a42008a.690be","type":"function","z":"eb66deb5.bea27","name":"","func":"var temp = msg.payload[0].temperature;\ntemp = temp.toFixed(2);\nmsg.payload[0].temperature = temp;\n\nreturn msg;","outputs":1,"noerr":0,"x":540,"y":280,"wires":[["d1e09a95.07cf68","d63c1e9b.67566"]]},{"id":"d63c1e9b.67566","type":"debug","z":"eb66deb5.bea27","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":730,"y":320,"wires":[]},{"id":"57307e50.93834","type":"inject","z":"eb66deb5.bea27","name":"","repeat":"4","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":150,"y":380,"wires":[["c1add14e.5bb75"]]},{"id":"c1add14e.5bb75","type":"function","z":"eb66deb5.bea27","name":"Sensor4","func":"var sensor = {};\nsensor.temperature = Math.random()*Math.random() * 150;\nsensor.humidity = Math.random() * 100;\nsensor.preasure = Math.random() * 4000;\nsensor.type = \"heatsensor\",\nsensor.name = \"sensor4\",\nsensor.ts = msg.payload;\nmsg.payload=[\n    sensor, \n    {\n    \"tag1\":\"sensor4\",\n    \"tag2\":\"location3\",\n    \"tag3\":\"building1\"\n}];\nmsg.topic = \"heating\";\nreturn msg;","outputs":1,"noerr":0,"x":380,"y":380,"wires":[["1e0aef16.17ef31","13890fc6.c1daa","6a67bc07.270024"]]},{"id":"7e0b72aa.fd2dfc","type":"ui_gauge","z":"eb66deb5.bea27","d":true,"name":"","group":"3bff8420.f2174c","order":4,"width":0,"height":0,"gtype":"gage","title":"{{msg.payload[1].tag1}}","label":"C","format":"{{msg.payload[0].temperature}}","min":0,"max":"400","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":700,"y":380,"wires":[]},{"id":"1e0aef16.17ef31","type":"function","z":"eb66deb5.bea27","name":"","func":"var temp = msg.payload[0].temperature;\ntemp = temp.toFixed(2);\nmsg.payload[0].temperature = temp;\n\nreturn msg;","outputs":1,"noerr":0,"x":530,"y":380,"wires":[["7e0b72aa.fd2dfc","98b27ff1.cef21"]]},{"id":"98b27ff1.cef21","type":"debug","z":"eb66deb5.bea27","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":720,"y":420,"wires":[]},{"id":"910edaa2.69c518","type":"comment","z":"26d1fc02.f4deb4","name":"InfluxDB","info":"","x":120,"y":80,"wires":[]},{"id":"d0ff1f95.c4c0c","type":"debug","z":"50191f06.dc99e","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":870,"y":60,"wires":[]},{"id":"af68fa28.e20158","type":"inject","z":"50191f06.dc99e","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":140,"y":40,"wires":[["38af788f.389628"]]},{"id":"38af788f.389628","type":"function","z":"50191f06.dc99e","name":"GetAllWorldAnchors","func":"//msg.id = \"worldanchors\";\nmsg.query = msg.payload;\nmsg.payload = \"worldanchors\";\nreturn msg;","outputs":1,"noerr":0,"x":420,"y":100,"wires":[["20dde36f.13765c"]]},{"id":"20dde36f.13765c","type":"cloudantplus in","z":"50191f06.dc99e","name":"couchdd:id","cloudant":"497401a9.52275","database":"world","service":"_ext_","search":"_id_","design":"","index":"","x":670,"y":100,"wires":[["d0ff1f95.c4c0c","91bb15e9.d992d8","929f4901.504bd8"]]},{"id":"9a11d705.2c6fc8","type":"http in","z":"50191f06.dc99e","name":"[get]/worldanchors","url":"/worldanchors","method":"get","upload":false,"swaggerDoc":"","x":150,"y":100,"wires":[["38af788f.389628","b51bf3dc.54ec7"]]},{"id":"91bb15e9.d992d8","type":"http response","z":"50191f06.dc99e","name":"","statusCode":"","headers":{"content-type":"application/json"},"x":850,"y":100,"wires":[]},{"id":"66ae4462.58b55c","type":"http request","z":"50191f06.dc99e","name":"worldanchors?ssid=wlan","method":"GET","ret":"txt","paytoqs":"ignore","url":"http://localhost:1880/worldanchors?ssid=wlan","tls":"","persist":false,"proxy":"","authType":"","x":550,"y":1180,"wires":[["416c87e4.d02ea8"]]},{"id":"22332aff.bf1146","type":"inject","z":"50191f06.dc99e","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":110,"y":1180,"wires":[["66ae4462.58b55c"]]},{"id":"be1cb370.96754","type":"debug","z":"50191f06.dc99e","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":990,"y":1180,"wires":[]},{"id":"5e4ad202.3f00ac","type":"debug","z":"50191f06.dc99e","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1090,"y":260,"wires":[]},{"id":"50499ee9.39d75","type":"join","z":"50191f06.dc99e","name":"","mode":"custom","build":"object","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":true,"timeout":"","count":"2","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":930,"y":180,"wires":[["5e4ad202.3f00ac"]]},{"id":"b51bf3dc.54ec7","type":"function","z":"50191f06.dc99e","name":"QueryParamPass","func":"msg.topic= \"query\";\nreturn msg;","outputs":1,"noerr":0,"x":690,"y":220,"wires":[["50499ee9.39d75"]]},{"id":"929f4901.504bd8","type":"function","z":"50191f06.dc99e","name":"QueryParamPass","func":"msg.topic= \"result\";\nreturn msg;","outputs":1,"noerr":0,"x":690,"y":180,"wires":[["50499ee9.39d75"]]},{"id":"456bd626.743ed8","type":"http in","z":"50191f06.dc99e","name":"[GET] /locationinfo","url":"/locationinfo","method":"get","upload":false,"swaggerDoc":"","x":150,"y":520,"wires":[["75259bfd.4519c4"]]},{"id":"ab977ca9.ecfbb","type":"cloudantplus in","z":"50191f06.dc99e","name":"couchdd:id","cloudant":"497401a9.52275","database":"world","service":"_ext_","search":"_id_","design":"","index":"","x":690,"y":580,"wires":[["471a36e4.ac5708"]]},{"id":"75259bfd.4519c4","type":"function","z":"50191f06.dc99e","name":"","func":"msg.query = msg.payload;\nmsg.payload = msg.payload.name;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":390,"y":520,"wires":[["ab977ca9.ecfbb"]]},{"id":"18cc906a.d57c9","type":"http request","z":"50191f06.dc99e","name":"locationinfo?name=NETGEAR81-5G","method":"GET","ret":"txt","paytoqs":false,"url":"http://localhost:1880/locationinfo?name=NETGEAR81-5G","tls":"","persist":false,"proxy":"","authType":"","x":510,"y":1240,"wires":[["416c87e4.d02ea8"]]},{"id":"e41345b0.ef93a8","type":"inject","z":"50191f06.dc99e","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":110,"y":1240,"wires":[["18cc906a.d57c9"]]},{"id":"471a36e4.ac5708","type":"http response","z":"50191f06.dc99e","name":"","statusCode":"","headers":{"content-type":"application/json"},"x":910,"y":580,"wires":[]},{"id":"1ad3982f.2ddff8","type":"comment","z":"50191f06.dc99e","name":"Testing","info":"","x":60,"y":1140,"wires":[]},{"id":"a842aa0a.107388","type":"comment","z":"50191f06.dc99e","name":"API calls","info":"","x":100,"y":460,"wires":[]},{"id":"44ccb426.5b304c","type":"http request","z":"50191f06.dc99e","name":"locationinfo?name=NETGEAR81-5G-MarkUpsRoot-WA-0","method":"GET","ret":"txt","paytoqs":false,"url":"http://localhost:1880/locationinfo?name=NETGEAR81-5G-MarkUpsRoot-WA-0","tls":"","persist":false,"proxy":"","authType":"","x":450,"y":1300,"wires":[["416c87e4.d02ea8"]]},{"id":"2f8e93e4.19be1c","type":"inject","z":"50191f06.dc99e","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":110,"y":1300,"wires":[["44ccb426.5b304c"]]},{"id":"416c87e4.d02ea8","type":"json","z":"50191f06.dc99e","name":"","property":"payload","action":"","pretty":false,"x":810,"y":1180,"wires":[["be1cb370.96754"]]},{"id":"a1bf6a0e.f0a9b8","type":"inject","z":"eb66deb5.bea27","name":"","repeat":"30","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":150,"y":540,"wires":[["8c6db72b.5ae1a8"]]},{"id":"8c6db72b.5ae1a8","type":"function","z":"eb66deb5.bea27","name":"s000","func":"var sensor = {};\nsensor.temperature = Math.random() * 250;\nsensor.humidity = Math.random() * 100;\nsensor.preasure = Math.random() * 4000;\nsensor.type = \"heatsensor\";\nsensor.ts = msg.payload;\n\nvar t = [];\nt[0] = sensor.building = \"inffeld16\";\nt[1] = sensor.floor = \"2nd\";\nt[2] = sensor.room = \"id02068\";\nt[3] = sensor.device = \"d1\";\nt[4] = sensor.name = \"s000\";\n\nvar topic = \"\";\nfor(var i = 0; i < t.length-1;i++) {\n    topic += t[i] + \"/\";\n}\ntopic += t[t.length-1];\n\nmsg.topic = topic;\nmsg.payload=[\n    sensor, \n    {\n    \"tag1\":t[0],\n    \"tag2\":t[1],\n    \"tag3\":t[2],\n    \"tag4\":t[3],\n    \"tag5\":t[4]\n}];\nreturn msg;","outputs":1,"noerr":0,"x":350,"y":540,"wires":[["13890fc6.c1daa","6a67bc07.270024"]]},{"id":"fb3395ad.c788e8","type":"inject","z":"eb66deb5.bea27","name":"","repeat":"45","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":150,"y":580,"wires":[["a37d1cbc.b062f"]]},{"id":"833c95f2.da3a98","type":"inject","z":"eb66deb5.bea27","name":"","repeat":"7","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":150,"y":620,"wires":[["ee33e4a9.236868"]]},{"id":"d30d5931.1dd598","type":"inject","z":"eb66deb5.bea27","name":"","repeat":"4","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":150,"y":660,"wires":[["a5542dac.cf085"]]},{"id":"a37d1cbc.b062f","type":"function","z":"eb66deb5.bea27","name":"s001","func":"var sensor = {};\nsensor.temperature = Math.random() * 250;\nsensor.humidity = Math.random() * 100;\nsensor.preasure = Math.random() * 4000;\nsensor.type = \"heatsensor\";\nsensor.ts = msg.payload;\n\nvar t = [];\nt[0] = sensor.building = \"inffeld16\";\nt[1] = sensor.floor = \"2nd\";\nt[2] = sensor.room = \"id02068\";\nt[3] = sensor.device = \"d1\";\nt[4] = sensor.name = \"s001\";\n\nvar topic = \"\";\nfor(var i = 0; i < t.length-1;i++) {\n    topic += t[i] + \"/\";\n}\ntopic += t[t.length-1];\n\nmsg.topic = topic;\nmsg.payload=[\n    sensor, \n    {\n    \"tag1\":t[0],\n    \"tag2\":t[1],\n    \"tag3\":t[2],\n    \"tag4\":t[3],\n    \"tag5\":t[4]\n}];\nreturn msg;","outputs":1,"noerr":0,"x":350,"y":580,"wires":[["13890fc6.c1daa","6a67bc07.270024"]]},{"id":"ee33e4a9.236868","type":"function","z":"eb66deb5.bea27","name":"s002","func":"var sensor = {};\nsensor.temperature = Math.random() * 250;\nsensor.humidity = Math.random() * 100;\nsensor.preasure = Math.random() * 4000;\nsensor.type = \"heatsensor\";\nsensor.ts = msg.payload;\n\nvar t = [];\nt[0] = sensor.building = \"inffeld16\";\nt[1] = sensor.floor = \"2nd\";\nt[2] = sensor.room = \"id02068\";\nt[3] = sensor.device = \"d2\";\nt[4] = sensor.name = \"s002\";\n\nvar topic = \"\";\nfor(var i = 0; i < t.length-1;i++) {\n    topic += t[i] + \"/\";\n}\ntopic += t[t.length-1];\n\nmsg.topic = topic;\nmsg.payload=[\n    sensor, \n    {\n    \"tag1\":t[0],\n    \"tag2\":t[1],\n    \"tag3\":t[2],\n    \"tag4\":t[3],\n    \"tag5\":t[4]\n}];\nreturn msg;","outputs":1,"noerr":0,"x":350,"y":620,"wires":[["13890fc6.c1daa","6a67bc07.270024"]]},{"id":"a5542dac.cf085","type":"function","z":"eb66deb5.bea27","name":"s003","func":"var sensor = {};\nsensor.temperature = Math.random() * 250;\nsensor.humidity = Math.random() * 100;\nsensor.preasure = Math.random() * 4000;\nsensor.type = \"heatsensor\";\nsensor.ts = msg.payload;\n\nvar t = [];\nt[0] = sensor.building = \"inffeld16\";\nt[1] = sensor.floor = \"2nd\";\nt[2] = sensor.room = \"id02068\";\nt[3] = sensor.device = \"d2\";\nt[4] = sensor.name = \"s003\";\n\nvar topic = \"\";\nfor(var i = 0; i < t.length-1;i++) {\n    topic += t[i] + \"/\";\n}\ntopic += t[t.length-1];\n\nmsg.topic = topic;\nmsg.payload=[\n    sensor, \n    {\n    \"tag1\":t[0],\n    \"tag2\":t[1],\n    \"tag3\":t[2],\n    \"tag4\":t[3],\n    \"tag5\":t[4]\n}];\nreturn msg;","outputs":1,"noerr":0,"x":350,"y":660,"wires":[["13890fc6.c1daa","6a67bc07.270024"]]},{"id":"e3136552.85d748","type":"mqtt in","z":"eb66deb5.bea27","name":"","topic":"telemetry/#","qos":"0","datatype":"auto","broker":"73e9a24f.21590c","x":100,"y":1080,"wires":[["a008542d.781db8"]]},{"id":"b9cb3198.02e66","type":"debug","z":"eb66deb5.bea27","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":810,"y":1120,"wires":[]},{"id":"197cf2a0.747b3d","type":"http in","z":"50191f06.dc99e","name":"[GET] /data","url":"/data","method":"get","upload":false,"swaggerDoc":"","x":130,"y":580,"wires":[["9aeadfa.6a59f2"]]},{"id":"9aeadfa.6a59f2","type":"function","z":"50191f06.dc99e","name":"","func":"msg.query = msg.payload;\nmsg.payload = msg.payload.name;\nreturn msg;","outputs":1,"noerr":0,"x":390,"y":580,"wires":[["ab977ca9.ecfbb","798aedc3.f5a484"]]},{"id":"a5feea88.19b9f8","type":"http request","z":"50191f06.dc99e","name":"locationinfo?name=NETGEAR81-5G-MarkUpsRoot-WA-0","method":"GET","ret":"txt","paytoqs":false,"url":"http://localhost:1880/data?name=NETGEAR81-5G-MarkUpsRoot-WA-0","tls":"","persist":false,"proxy":"","authType":"","x":450,"y":1360,"wires":[["416c87e4.d02ea8"]]},{"id":"ed9667d2.70e738","type":"inject","z":"50191f06.dc99e","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":110,"y":1360,"wires":[["a5feea88.19b9f8"]]},{"id":"4589da3b.f43e54","type":"http in","z":"50191f06.dc99e","name":"[POST] /data","url":"/data","method":"post","upload":false,"swaggerDoc":"","x":130,"y":680,"wires":[["3500cac.f624e36","6e49bcd4.065c84"]]},{"id":"3500cac.f624e36","type":"function","z":"50191f06.dc99e","name":"","func":"/*\n{\"name\":\"testlocation\",\n\"type\":\"location\",\n\"numwabatches\":2,\n\"waprefix\":\"testlocation-WA-\"}\n*/\n\nif(!msg.payload.hasOwnProperty(\"_id\")) {\n    var n = msg.payload.name;\n    msg.payload._id = n;\n}\n\n//if(msg.payload.hasOwnProperty(\"_rev\")) {\n//    msg.payload._rev = msg.payload._rev;    \n//}\n\n//msg.query = msg.payload;\n//msg.payload = msg.payload.name;\n//msg.payload._id = msg.payload.name;\nreturn msg;","outputs":1,"noerr":0,"x":390,"y":680,"wires":[["d3e5a29f.fa676","c34b5002.ef518"]]},{"id":"c34b5002.ef518","type":"cloudantplus out","z":"50191f06.dc99e","name":"","cloudant":"497401a9.52275","database":"world","service":"_ext_","payonly":true,"operation":"insert","x":670,"y":680,"wires":[["471a36e4.ac5708","6ac65e50.2bbad"]]},{"id":"fec3c5d4.9dc378","type":"http request","z":"50191f06.dc99e","name":"[GET] data?name=NETGEAR81-5G","method":"GET","ret":"txt","paytoqs":false,"url":"http://localhost:1880/data?name=NETGEAR81-5G","tls":"","persist":false,"proxy":"","authType":"","x":510,"y":1440,"wires":[["416c87e4.d02ea8"]]},{"id":"5af2cbe7.7a6bd4","type":"inject","z":"50191f06.dc99e","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":110,"y":1440,"wires":[["fec3c5d4.9dc378"]]},{"id":"d3e5a29f.fa676","type":"debug","z":"50191f06.dc99e","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":910,"y":740,"wires":[]},{"id":"63089ad5.60cf14","type":"http request","z":"50191f06.dc99e","name":"[POST] data?name=testlocation","method":"POST","ret":"txt","paytoqs":false,"url":"http://localhost:1880/data?name=testlocation","tls":"","persist":false,"proxy":"","authType":"","x":490,"y":1500,"wires":[["416c87e4.d02ea8"]]},{"id":"db0377b.acfe788","type":"inject","z":"50191f06.dc99e","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":110,"y":1500,"wires":[["beadccb.98a193"]]},{"id":"beadccb.98a193","type":"function","z":"50191f06.dc99e","name":"","func":"var location = \n{\n    name: \"testlocation\",\n  //\"_id\": \"NETGEAR81-5G\",\n  //\"_rev\": \"1-48f10fc5a23a85b566cabf6558da225f\",\n  type: \"location\",\n  numwabatches: 2,\n  waprefix: \"testlocation-WA-\"\n}\n\nmsg.payload = location;\nreturn msg;","outputs":1,"noerr":0,"x":270,"y":1500,"wires":[["63089ad5.60cf14"]]},{"id":"6e49bcd4.065c84","type":"debug","z":"50191f06.dc99e","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":910,"y":780,"wires":[]},{"id":"6ac65e50.2bbad","type":"debug","z":"50191f06.dc99e","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":910,"y":680,"wires":[]},{"id":"fdb5381c.bd4138","type":"inject","z":"50191f06.dc99e","name":"init location-devices","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":150,"y":280,"wires":[["cd84fbef.c1b928"]]},{"id":"cd84fbef.c1b928","type":"function","z":"50191f06.dc99e","name":"","func":"var devices = {};\ndevices.name = \"zrga2-devices\"\ndevices.present = [\"zrga2-d1\", \"zrga2-d2\"];\n\n\nmsg.payload = devices;\nmsg.payload._id = devices.name;\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":280,"wires":[["3f13f665.4272da"]]},{"id":"d63402a3.1dd0c","type":"inject","z":"50191f06.dc99e","name":"add dummy device","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":150,"y":320,"wires":[["96c103b5.fb80a","4b134a00.e21614"]]},{"id":"96c103b5.fb80a","type":"function","z":"50191f06.dc99e","name":"","func":"var part1 = {};\npart1.name = \"s000\";\npart1.position = [0,1,0];\npart1.mqttTopic = \"inffeld16/2nd/id02068/d1/s000\"\npart1.visurl = \"http://192.168.1.168:3000/render/d-solo/H6CTNOUZz/heating?orgId=1&refresh=30s&from=1585542623524&to=1585564223524&panelId=2&width=1000&height=500&tz=Europe%2FVienna\"\n\nvar part2 = {};\npart2.name = \"s001\";\npart2.position = [0.5,0.5,0.5];\npart2.mqttTopic = \"inffeld16/2nd/id02068/d1/s001\"\n\nvar device = {};\ndevice.name = \"d1\";\ndevice.id = \"zrga2\" + \"-\" + device.name;\ndevice.registered = false;\ndevice.parts = [part1, part2];\n\n\nmsg.payload = device;\nmsg.payload._id = device.id;\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":320,"wires":[["3f13f665.4272da"]]},{"id":"3f13f665.4272da","type":"cloudantplus out","z":"50191f06.dc99e","name":"","cloudant":"497401a9.52275","database":"world","service":"_ext_","payonly":true,"operation":"insert","x":660,"y":320,"wires":[["d63c7d42.fb157"]]},{"id":"d63c7d42.fb157","type":"debug","z":"50191f06.dc99e","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":850,"y":320,"wires":[]},{"id":"4b134a00.e21614","type":"function","z":"50191f06.dc99e","name":"","func":"var part1 = {};\npart1.name = \"s003\";\npart1.position = [0,1,0];\npart1.mqttTopic = \"inffeld16/2nd/id02068/d2/s003\"\npart1.visurl = \"http://192.168.1.168:3000/render/d-solo/H6CTNOUZz/heating?orgId=1&refresh=30s&from=1585542623524&to=1585564223524&panelId=2&width=1000&height=500&tz=Europe%2FVienna\"\n\nvar part2 = {};\npart2.name = \"s004\";\npart2.position = [0.5,0.5,0.5];\npart2.mqttTopic = \"inffeld16/2nd/id02068/d2/s004\"\n\nvar device = {};\ndevice.name = \"d2\";\ndevice.id = \"zrga2\" + \"-\" + device.name;\ndevice.registered = false;\ndevice.parts = [part1, part2];\n\n\nmsg.payload = device;\nmsg.payload._id = device.id;\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":360,"wires":[["3f13f665.4272da"]]},{"id":"4ac14984.9ef5f8","type":"inject","z":"20513146.91ed4e","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":180,"y":140,"wires":[["b1a4e15c.44caf"]]},{"id":"3703829d.51594e","type":"mqtt out","z":"20513146.91ed4e","name":"","topic":"companion/env","qos":"0","retain":"false","broker":"73e9a24f.21590c","x":560,"y":140,"wires":[]},{"id":"b1a4e15c.44caf","type":"function","z":"20513146.91ed4e","name":"","func":"var data = {};\ndata.type = \"position\";\ndata.head = {};\ndata.head.transform = {};\ndata.head.transform.T = [0,0,0];\ndata.head.transform.R = [0.1,0.1,0,1];\ndata.head.transform.S = [1,1,1];\n\nvar obj = {};\nobj.transform = {};\nobj.transform.T = [2,0.5,2];\nobj.transform.R = [0,0,0,1];\nobj.transform.S = [1,1,1];\nobj.name = \"test\";\n\ndata.objs = [];\ndata.objs[0] = obj;\n\nmsg.payload = data;\n\nreturn msg;","outputs":1,"noerr":0,"x":350,"y":140,"wires":[["3703829d.51594e"]]},{"id":"c6f83e0.962b7c","type":"mqtt in","z":"20513146.91ed4e","name":"","topic":"companion/#","qos":"0","datatype":"auto","broker":"73e9a24f.21590c","x":150,"y":440,"wires":[["245c92a6.0b676e"]]},{"id":"245c92a6.0b676e","type":"debug","z":"20513146.91ed4e","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":490,"y":440,"wires":[]},{"id":"12e913c2.7551cc","type":"function","z":"20513146.91ed4e","name":"","func":"msg.payload = {\"objs\":[{\"transform\":{\"T\":[1.6614948511123657,0.6668059825897217,2.6362521648406982],\"R\":[0,0.9990877509117126,0,-0.042705290019512177],\"S\":[1,0.9999999403953552,0.9999999403953552]},\"name\":\"zrga2-d1\"},{\"transform\":{\"T\":[0.5026125907897949,0.16198022663593292,-0.16431841254234314],\"R\":[0,0.03009813092648983,0,0.999547004699707],\"S\":[1.000000238418579,1,1.0000001192092896]},\"name\":\"zrga2-d2\"},{\"transform\":{\"T\":[0.8867282867431641,0.32989227771759033,-0.2469164878129959],\"R\":[0,-0.590607762336731,0,0.8069588541984558],\"S\":[1.0000005960464478,0.9999999403953552,1.0000005960464478]},\"name\":\"zrga2-lamp\"},{\"transform\":{\"T\":[1.7817398309707642,-0.27939853072166443,-0.7603951692581177],\"R\":[0,-0.9983522891998291,0,0.05738326907157898],\"S\":[0.9999999403953552,0.9999999403953552,1.0000001192092896]},\"name\":\"zrga2-r0\"}],\"head\":{\"transform\":{\"T\":[-0.40476858615875244,0,-3.4080209732055664],\"R\":[0,0,0,1],\"S\":[1,1,1]}}};\nreturn msg;","outputs":1,"noerr":0,"x":360,"y":200,"wires":[["3703829d.51594e"]]},{"id":"4d7f58e9.7deff8","type":"inject","z":"20513146.91ed4e","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":180,"y":200,"wires":[["12e913c2.7551cc"]]},{"id":"67ced0ab.6bbe5","type":"function","z":"20513146.91ed4e","name":"","func":"msg.payload = \"http://192.168.1.168:3000/d/H6CTNOUZz/heating?orgId=1&refresh=30s&from=1588313360026&to=1588334960026&panelId=2&fullscreen\"\nreturn msg;","outputs":1,"noerr":0,"x":350,"y":280,"wires":[["2ce838ce.a91628"]]},{"id":"652452af.72a78c","type":"inject","z":"20513146.91ed4e","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":170,"y":280,"wires":[["67ced0ab.6bbe5"]]},{"id":"2ce838ce.a91628","type":"mqtt out","z":"20513146.91ed4e","name":"","topic":"companion/url","qos":"0","retain":"false","broker":"73e9a24f.21590c","x":560,"y":280,"wires":[]},{"id":"f320d1c1.368ac","type":"inject","z":"eb66deb5.bea27","name":"","repeat":"10","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":110,"y":820,"wires":[["e13e075.16412f8"]]},{"id":"e13e075.16412f8","type":"function","z":"eb66deb5.bea27","name":"r0/inflow","func":"var sensor = {};\nvar max = 0;\nvar min = 0;\n\nmax = 60;\nmin = 25;\nvar mtemp = Math.random() * (max - min) + min;\n\nmax = 2;\nmin = 0.1;\nvar mflow = Math.random() * (max - min) + min;\n\nsensor.temperature = mtemp;\nsensor.flowrate = mflow;\nsensor.type = \"radiator\";\nsensor.ts = msg.payload;\n\n//home/2nd/office/r0/inflow\nvar t = [];\nt[0] = sensor.building = \"home\";\nt[1] = sensor.floor = \"2nd\";\nt[2] = sensor.room = \"office\";\nt[3] = sensor.device = \"r0\";\nt[4] = sensor.name = \"inflow\";\n\nvar topic = \"\";\nfor(var i = 0; i < t.length-1;i++) {\n    topic += t[i] + \"/\";\n}\ntopic += t[t.length-1];\n\nmsg.topic = topic;\nmsg.payload=[\n    sensor, \n    {\n    \"tag1\":t[0],\n    \"tag2\":t[1],\n    \"tag3\":t[2],\n    \"tag4\":t[3],\n    \"tag5\":t[4]\n}];\nreturn msg;","outputs":1,"noerr":0,"x":320,"y":820,"wires":[["ce4eb73e.2ce108"]]},{"id":"123ec8b5.df36b7","type":"comment","z":"eb66deb5.bea27","name":"office/radiator [r0]","info":"","x":120,"y":760,"wires":[]},{"id":"ce4eb73e.2ce108","type":"function","z":"eb66deb5.bea27","name":"","func":"\nreturn msg;","outputs":1,"noerr":0,"x":530,"y":800,"wires":[["13890fc6.c1daa","6a67bc07.270024"]]},{"id":"5c8751f6.7fa7","type":"inject","z":"eb66deb5.bea27","name":"","repeat":"10","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":110,"y":860,"wires":[["52b19725.3f1c18"]]},{"id":"52b19725.3f1c18","type":"function","z":"eb66deb5.bea27","name":"r0/backflow","func":"var sensor = {};\nvar max = 0;\nvar min = 0;\n\nmax = 30;\nmin = 10;\nvar mtemp = Math.random() * (max - min) + min;\n\nmax = 2;\nmin = 0.1;\nvar mflow = Math.random() * (max - min) + min;\n\nsensor.temperature = mtemp;\nsensor.flowrate = mflow;\nsensor.type = \"radiator\";\nsensor.ts = msg.payload;\n\nvar t = [];\nt[0] = sensor.building = \"home\";\nt[1] = sensor.floor = \"2nd\";\nt[2] = sensor.room = \"office\";\nt[3] = sensor.device = \"r0\";\nt[4] = sensor.name = \"backflow\";\n\nvar topic = \"\";\nfor(var i = 0; i < t.length-1;i++) {\n    topic += t[i] + \"/\";\n}\ntopic += t[t.length-1];\n\nmsg.topic = topic;\nmsg.payload=[\n    sensor, \n    {\n    \"tag1\":t[0],\n    \"tag2\":t[1],\n    \"tag3\":t[2],\n    \"tag4\":t[3],\n    \"tag5\":t[4]\n}];\nreturn msg;","outputs":1,"noerr":0,"x":330,"y":860,"wires":[["ce4eb73e.2ce108"]]},{"id":"32db2d5e.779462","type":"function","z":"e9bcdddb.5dd08","name":"","func":"var testDashboard = {\n  \"annotations\": {\n    \"list\": [\n      {\n        \"builtIn\": 1,\n        \"datasource\": \"-- Grafana --\",\n        \"enable\": true,\n        \"hide\": true,\n        \"iconColor\": \"rgba(0, 211, 255, 1)\",\n        \"name\": \"Annotations & Alerts\",\n        \"type\": \"dashboard\"\n      }\n    ]\n  },\n  \"editable\": true,\n  \"gnetId\": null,\n  \"graphTooltip\": 0,\n  \"id\": 1,\n  \"links\": [],\n  \"panels\": [\n    {\n      \"alert\": {\n        \"alertRuleTags\": {},\n        \"conditions\": [\n          {\n            \"evaluator\": {\n              \"params\": [\n                50\n              ],\n              \"type\": \"gt\"\n            },\n            \"operator\": {\n              \"type\": \"and\"\n            },\n            \"query\": {\n              \"params\": [\n                \"A\",\n                \"5m\",\n                \"now\"\n              ]\n            },\n            \"reducer\": {\n              \"params\": [],\n              \"type\": \"avg\"\n            },\n            \"type\": \"query\"\n          }\n        ],\n        \"executionErrorState\": \"alerting\",\n        \"for\": \"5m\",\n        \"frequency\": \"1m\",\n        \"handler\": 1,\n        \"name\": \"r0/inflow alert\",\n        \"noDataState\": \"no_data\",\n        \"notifications\": []\n      },\n      \"aliasColors\": {\n        \"Temperature\": \"semi-dark-red\"\n      },\n      \"bars\": false,\n      \"dashLength\": 10,\n      \"dashes\": false,\n      \"datasource\": \"Heating\",\n      \"fill\": 4,\n      \"fillGradient\": 7,\n      \"gridPos\": {\n        \"h\": 8,\n        \"w\": 12,\n        \"x\": 0,\n        \"y\": 0\n      },\n      \"hiddenSeries\": false,\n      \"hideTimeOverride\": false,\n      \"id\": 16,\n      \"interval\": \"\",\n      \"legend\": {\n        \"alignAsTable\": false,\n        \"avg\": false,\n        \"current\": false,\n        \"max\": false,\n        \"min\": false,\n        \"show\": true,\n        \"total\": false,\n        \"values\": false\n      },\n      \"lines\": true,\n      \"linewidth\": 3,\n      \"nullPointMode\": \"null\",\n      \"options\": {\n        \"dataLinks\": []\n      },\n      \"percentage\": false,\n      \"pluginVersion\": \"6.7.2\",\n      \"pointradius\": 2,\n      \"points\": false,\n      \"renderer\": \"flot\",\n      \"repeat\": null,\n      \"seriesOverrides\": [\n        {},\n        {\n          \"alias\": \"heating.mean\",\n          \"yaxis\": 2\n        },\n        {\n          \"alias\": \"Flowrate\",\n          \"yaxis\": 2\n        }\n      ],\n      \"spaceLength\": 10,\n      \"stack\": false,\n      \"steppedLine\": false,\n      \"targets\": [\n        {\n          \"alias\": \"Temperature\",\n          \"groupBy\": [\n            {\n              \"params\": [\n                \"10s\"\n              ],\n              \"type\": \"time\"\n            },\n            {\n              \"params\": [\n                \"null\"\n              ],\n              \"type\": \"fill\"\n            }\n          ],\n          \"measurement\": \"heating\",\n          \"orderByTime\": \"ASC\",\n          \"policy\": \"data30d\",\n          \"query\": \"SELECT moving_average(mean(\\\"temperature\\\"), 10) FROM \\\"data30d\\\".\\\"heating\\\" WHERE (\\\"tag4\\\" = 'r0' AND \\\"tag5\\\" = 'inflow') AND time > now() - 15m GROUP BY time(10s) fill(previous)\",\n          \"rawQuery\": false,\n          \"refId\": \"A\",\n          \"resultFormat\": \"time_series\",\n          \"select\": [\n            [\n              {\n                \"params\": [\n                  \"temperature\"\n                ],\n                \"type\": \"field\"\n              },\n              {\n                \"params\": [],\n                \"type\": \"mean\"\n              },\n              {\n                \"params\": [\n                  10\n                ],\n                \"type\": \"moving_average\"\n              }\n            ]\n          ],\n          \"tags\": [\n            {\n              \"key\": \"tag4\",\n              \"operator\": \"=\",\n              \"value\": \"r0\"\n            },\n            {\n              \"condition\": \"AND\",\n              \"key\": \"tag5\",\n              \"operator\": \"=\",\n              \"value\": \"inflow\"\n            }\n          ],\n          \"tz\": \"\"\n        },\n        {\n          \"alias\": \"Flowrate\",\n          \"groupBy\": [\n            {\n              \"params\": [\n                \"10s\"\n              ],\n              \"type\": \"time\"\n            },\n            {\n              \"params\": [\n                \"previous\"\n              ],\n              \"type\": \"fill\"\n            }\n          ],\n          \"measurement\": \"heating\",\n          \"orderByTime\": \"ASC\",\n          \"policy\": \"data30d\",\n          \"refId\": \"B\",\n          \"resultFormat\": \"time_series\",\n          \"select\": [\n            [\n              {\n                \"params\": [\n                  \"flowrate\"\n                ],\n                \"type\": \"field\"\n              },\n              {\n                \"params\": [],\n                \"type\": \"mean\"\n              },\n              {\n                \"params\": [\n                  10\n                ],\n                \"type\": \"moving_average\"\n              }\n            ]\n          ],\n          \"tags\": [\n            {\n              \"key\": \"tag4\",\n              \"operator\": \"=\",\n              \"value\": \"r0\"\n            },\n            {\n              \"condition\": \"AND\",\n              \"key\": \"tag5\",\n              \"operator\": \"=\",\n              \"value\": \"inflow\"\n            }\n          ]\n        }\n      ],\n      \"thresholds\": [\n        {\n          \"colorMode\": \"critical\",\n          \"fill\": true,\n          \"line\": true,\n          \"op\": \"gt\",\n          \"value\": 50\n        }\n      ],\n      \"timeFrom\": \"10m\",\n      \"timeRegions\": [],\n      \"timeShift\": null,\n      \"title\": \"r0/inflow\",\n      \"tooltip\": {\n        \"shared\": true,\n        \"sort\": 0,\n        \"value_type\": \"individual\"\n      },\n      \"type\": \"graph\",\n      \"xaxis\": {\n        \"buckets\": null,\n        \"mode\": \"time\",\n        \"name\": null,\n        \"show\": true,\n        \"values\": []\n      },\n      \"yaxes\": [\n        {\n          \"decimals\": null,\n          \"format\": \"celsius\",\n          \"label\": \"Temperature\",\n          \"logBase\": 1,\n          \"max\": null,\n          \"min\": null,\n          \"show\": true\n        },\n        {\n          \"decimals\": null,\n          \"format\": \"flowlpm\",\n          \"label\": \"Flow\",\n          \"logBase\": 1,\n          \"max\": null,\n          \"min\": null,\n          \"show\": true\n        }\n      ],\n      \"yaxis\": {\n        \"align\": false,\n        \"alignLevel\": 0\n      }\n    },\n    {\n      \"dashboardFilter\": \"\",\n      \"dashboardTags\": [],\n      \"datasource\": null,\n      \"folderId\": null,\n      \"gridPos\": {\n        \"h\": 8,\n        \"w\": 12,\n        \"x\": 12,\n        \"y\": 0\n      },\n      \"id\": 13,\n      \"limit\": 10,\n      \"nameFilter\": \"\",\n      \"onlyAlertsOnDashboard\": false,\n      \"show\": \"current\",\n      \"sortOrder\": 1,\n      \"stateFilter\": [],\n      \"timeFrom\": null,\n      \"timeShift\": null,\n      \"title\": \"Alerts\",\n      \"type\": \"alertlist\"\n    },\n    {\n      \"alert\": {\n        \"alertRuleTags\": {},\n        \"conditions\": [\n          {\n            \"evaluator\": {\n              \"params\": [\n                22\n              ],\n              \"type\": \"gt\"\n            },\n            \"operator\": {\n              \"type\": \"and\"\n            },\n            \"query\": {\n              \"params\": [\n                \"A\",\n                \"5m\",\n                \"now\"\n              ]\n            },\n            \"reducer\": {\n              \"params\": [],\n              \"type\": \"avg\"\n            },\n            \"type\": \"query\"\n          }\n        ],\n        \"executionErrorState\": \"alerting\",\n        \"for\": \"5m\",\n        \"frequency\": \"1m\",\n        \"handler\": 1,\n        \"name\": \"r0/backflow alert\",\n        \"noDataState\": \"no_data\",\n        \"notifications\": []\n      },\n      \"aliasColors\": {\n        \"Temperature\": \"semi-dark-blue\"\n      },\n      \"bars\": false,\n      \"dashLength\": 10,\n      \"dashes\": false,\n      \"datasource\": \"Heating\",\n      \"fill\": 4,\n      \"fillGradient\": 7,\n      \"gridPos\": {\n        \"h\": 8,\n        \"w\": 12,\n        \"x\": 0,\n        \"y\": 8\n      },\n      \"hiddenSeries\": false,\n      \"hideTimeOverride\": false,\n      \"id\": 17,\n      \"interval\": \"\",\n      \"legend\": {\n        \"alignAsTable\": false,\n        \"avg\": false,\n        \"current\": false,\n        \"max\": false,\n        \"min\": false,\n        \"show\": true,\n        \"total\": false,\n        \"values\": false\n      },\n      \"lines\": true,\n      \"linewidth\": 3,\n      \"nullPointMode\": \"null\",\n      \"options\": {\n        \"dataLinks\": []\n      },\n      \"percentage\": false,\n      \"pluginVersion\": \"6.7.2\",\n      \"pointradius\": 2,\n      \"points\": false,\n      \"renderer\": \"flot\",\n      \"seriesOverrides\": [\n        {},\n        {\n          \"alias\": \"Flowrate\",\n          \"yaxis\": 2\n        }\n      ],\n      \"spaceLength\": 10,\n      \"stack\": false,\n      \"steppedLine\": false,\n      \"targets\": [\n        {\n          \"alias\": \"Temperature\",\n          \"groupBy\": [\n            {\n              \"params\": [\n                \"10s\"\n              ],\n              \"type\": \"time\"\n            },\n            {\n              \"params\": [\n                \"previous\"\n              ],\n              \"type\": \"fill\"\n            }\n          ],\n          \"measurement\": \"heating\",\n          \"orderByTime\": \"ASC\",\n          \"policy\": \"data30d\",\n          \"query\": \"SELECT moving_average(mean(\\\"temperature\\\"), 10) FROM \\\"data30d\\\".\\\"heating\\\" WHERE (\\\"tag4\\\" = 'r0' AND \\\"tag5\\\" = 'inflow') AND time > now() - 15m GROUP BY time(10s) fill(previous)\",\n          \"rawQuery\": false,\n          \"refId\": \"A\",\n          \"resultFormat\": \"time_series\",\n          \"select\": [\n            [\n              {\n                \"params\": [\n                  \"temperature\"\n                ],\n                \"type\": \"field\"\n              },\n              {\n                \"params\": [],\n                \"type\": \"mean\"\n              },\n              {\n                \"params\": [\n                  10\n                ],\n                \"type\": \"moving_average\"\n              }\n            ]\n          ],\n          \"tags\": [\n            {\n              \"key\": \"tag4\",\n              \"operator\": \"=\",\n              \"value\": \"r0\"\n            },\n            {\n              \"condition\": \"AND\",\n              \"key\": \"tag5\",\n              \"operator\": \"=\",\n              \"value\": \"backflow\"\n            }\n          ],\n          \"tz\": \"\"\n        },\n        {\n          \"alias\": \"Flowrate\",\n          \"groupBy\": [\n            {\n              \"params\": [\n                \"10s\"\n              ],\n              \"type\": \"time\"\n            },\n            {\n              \"params\": [\n                \"previous\"\n              ],\n              \"type\": \"fill\"\n            }\n          ],\n          \"measurement\": \"heating\",\n          \"orderByTime\": \"ASC\",\n          \"policy\": \"data30d\",\n          \"refId\": \"B\",\n          \"resultFormat\": \"time_series\",\n          \"select\": [\n            [\n              {\n                \"params\": [\n                  \"flowrate\"\n                ],\n                \"type\": \"field\"\n              },\n              {\n                \"params\": [],\n                \"type\": \"mean\"\n              },\n              {\n                \"params\": [\n                  10\n                ],\n                \"type\": \"moving_average\"\n              }\n            ]\n          ],\n          \"tags\": [\n            {\n              \"key\": \"tag4\",\n              \"operator\": \"=\",\n              \"value\": \"r0\"\n            },\n            {\n              \"condition\": \"AND\",\n              \"key\": \"tag5\",\n              \"operator\": \"=\",\n              \"value\": \"backflow\"\n            }\n          ]\n        }\n      ],\n      \"thresholds\": [\n        {\n          \"colorMode\": \"critical\",\n          \"fill\": true,\n          \"line\": true,\n          \"op\": \"gt\",\n          \"value\": 22,\n          \"yaxis\": \"left\"\n        }\n      ],\n      \"timeFrom\": \"10m\",\n      \"timeRegions\": [],\n      \"timeShift\": null,\n      \"title\": \"r0/backflow\",\n      \"tooltip\": {\n        \"shared\": true,\n        \"sort\": 0,\n        \"value_type\": \"individual\"\n      },\n      \"type\": \"graph\",\n      \"xaxis\": {\n        \"buckets\": null,\n        \"mode\": \"time\",\n        \"name\": null,\n        \"show\": true,\n        \"values\": []\n      },\n      \"yaxes\": [\n        {\n          \"decimals\": null,\n          \"format\": \"celsius\",\n          \"label\": \"Temperature\",\n          \"logBase\": 1,\n          \"max\": null,\n          \"min\": null,\n          \"show\": true\n        },\n        {\n          \"decimals\": null,\n          \"format\": \"flowlpm\",\n          \"label\": \"Flow\",\n          \"logBase\": 1,\n          \"max\": null,\n          \"min\": null,\n          \"show\": true\n        }\n      ],\n      \"yaxis\": {\n        \"align\": false,\n        \"alignLevel\": 0\n      }\n    },\n    {\n      \"datasource\": \"Heating\",\n      \"gridPos\": {\n        \"h\": 8,\n        \"w\": 6,\n        \"x\": 12,\n        \"y\": 8\n      },\n      \"id\": 4,\n      \"options\": {\n        \"colorMode\": \"value\",\n        \"fieldOptions\": {\n          \"calcs\": [\n            \"last\"\n          ],\n          \"defaults\": {\n            \"mappings\": [],\n            \"thresholds\": {\n              \"mode\": \"absolute\",\n              \"steps\": [\n                {\n                  \"color\": \"green\",\n                  \"value\": null\n                },\n                {\n                  \"color\": \"red\",\n                  \"value\": 2000\n                }\n              ]\n            },\n            \"title\": \"\",\n            \"unit\": \"pressurehpa\"\n          },\n          \"overrides\": [],\n          \"values\": false\n        },\n        \"graphMode\": \"area\",\n        \"justifyMode\": \"auto\",\n        \"orientation\": \"auto\"\n      },\n      \"pluginVersion\": \"6.7.2\",\n      \"targets\": [\n        {\n          \"alias\": \"\",\n          \"groupBy\": [\n            {\n              \"params\": [\n                \"1m\"\n              ],\n              \"type\": \"time\"\n            },\n            {\n              \"params\": [\n                \"tag1\"\n              ],\n              \"type\": \"tag\"\n            },\n            {\n              \"params\": [\n                \"previous\"\n              ],\n              \"type\": \"fill\"\n            }\n          ],\n          \"measurement\": \"heating\",\n          \"orderByTime\": \"ASC\",\n          \"policy\": \"default\",\n          \"query\": \"SELECT mean(\\\"humidity\\\") FROM \\\"heating\\\" WHERE $timeFilter GROUP BY time(1m), \\\"tag1\\\" fill(none)\",\n          \"rawQuery\": false,\n          \"refId\": \"A\",\n          \"resultFormat\": \"time_series\",\n          \"select\": [\n            [\n              {\n                \"params\": [\n                  \"preasure\"\n                ],\n                \"type\": \"field\"\n              },\n              {\n                \"params\": [],\n                \"type\": \"last\"\n              },\n              {\n                \"params\": [\n                  \"40\"\n                ],\n                \"type\": \"moving_average\"\n              }\n            ]\n          ],\n          \"tags\": []\n        }\n      ],\n      \"timeFrom\": null,\n      \"timeShift\": null,\n      \"title\": \"Pressure\",\n      \"type\": \"stat\"\n    },\n    {\n      \"cards\": {\n        \"cardPadding\": null,\n        \"cardRound\": null\n      },\n      \"color\": {\n        \"cardColor\": \"#b4ff00\",\n        \"colorScale\": \"sqrt\",\n        \"colorScheme\": \"interpolateReds\",\n        \"exponent\": 0.5,\n        \"mode\": \"spectrum\"\n      },\n      \"dataFormat\": \"timeseries\",\n      \"datasource\": null,\n      \"gridPos\": {\n        \"h\": 8,\n        \"w\": 6,\n        \"x\": 18,\n        \"y\": 8\n      },\n      \"heatmap\": {},\n      \"hideZeroBuckets\": false,\n      \"highlightCards\": true,\n      \"id\": 7,\n      \"legend\": {\n        \"show\": true\n      },\n      \"reverseYBuckets\": false,\n      \"targets\": [\n        {\n          \"groupBy\": [\n            {\n              \"params\": [\n                \"$__interval\"\n              ],\n              \"type\": \"time\"\n            },\n            {\n              \"params\": [\n                \"linear\"\n              ],\n              \"type\": \"fill\"\n            }\n          ],\n          \"measurement\": \"heating\",\n          \"orderByTime\": \"ASC\",\n          \"policy\": \"default\",\n          \"refId\": \"A\",\n          \"resultFormat\": \"time_series\",\n          \"select\": [\n            [\n              {\n                \"params\": [\n                  \"temperature\"\n                ],\n                \"type\": \"field\"\n              },\n              {\n                \"params\": [],\n                \"type\": \"mean\"\n              }\n            ]\n          ],\n          \"tags\": []\n        }\n      ],\n      \"timeFrom\": null,\n      \"timeShift\": null,\n      \"title\": \"Heat distribution\",\n      \"tooltip\": {\n        \"show\": true,\n        \"showHistogram\": false\n      },\n      \"type\": \"heatmap\",\n      \"xAxis\": {\n        \"show\": true\n      },\n      \"xBucketNumber\": null,\n      \"xBucketSize\": null,\n      \"yAxis\": {\n        \"decimals\": null,\n        \"format\": \"celsius\",\n        \"logBase\": 1,\n        \"max\": null,\n        \"min\": null,\n        \"show\": true,\n        \"splitFactor\": null\n      },\n      \"yBucketBound\": \"auto\",\n      \"yBucketNumber\": null,\n      \"yBucketSize\": null\n    },\n    {\n      \"alert\": {\n        \"alertRuleTags\": {},\n        \"conditions\": [\n          {\n            \"evaluator\": {\n              \"params\": [\n                130\n              ],\n              \"type\": \"gt\"\n            },\n            \"operator\": {\n              \"type\": \"and\"\n            },\n            \"query\": {\n              \"params\": [\n                \"A\",\n                \"5m\",\n                \"now\"\n              ]\n            },\n            \"reducer\": {\n              \"params\": [],\n              \"type\": \"avg\"\n            },\n            \"type\": \"query\"\n          }\n        ],\n        \"executionErrorState\": \"alerting\",\n        \"for\": \"5m\",\n        \"frequency\": \"1m\",\n        \"handler\": 1,\n        \"name\": \"S003 alert\",\n        \"noDataState\": \"no_data\",\n        \"notifications\": []\n      },\n      \"aliasColors\": {},\n      \"bars\": true,\n      \"dashLength\": 10,\n      \"dashes\": false,\n      \"datasource\": \"Heating\",\n      \"fill\": 4,\n      \"fillGradient\": 7,\n      \"gridPos\": {\n        \"h\": 8,\n        \"w\": 12,\n        \"x\": 12,\n        \"y\": 16\n      },\n      \"hiddenSeries\": false,\n      \"hideTimeOverride\": false,\n      \"id\": 15,\n      \"interval\": \"\",\n      \"legend\": {\n        \"alignAsTable\": false,\n        \"avg\": false,\n        \"current\": false,\n        \"max\": false,\n        \"min\": false,\n        \"show\": false,\n        \"total\": false,\n        \"values\": false\n      },\n      \"lines\": true,\n      \"linewidth\": 3,\n      \"nullPointMode\": \"null\",\n      \"options\": {\n        \"dataLinks\": []\n      },\n      \"percentage\": false,\n      \"pluginVersion\": \"6.7.2\",\n      \"pointradius\": 2,\n      \"points\": false,\n      \"renderer\": \"flot\",\n      \"seriesOverrides\": [],\n      \"spaceLength\": 10,\n      \"stack\": false,\n      \"steppedLine\": false,\n      \"targets\": [\n        {\n          \"groupBy\": [\n            {\n              \"params\": [\n                \"10s\"\n              ],\n              \"type\": \"time\"\n            },\n            {\n              \"params\": [\n                \"previous\"\n              ],\n              \"type\": \"fill\"\n            }\n          ],\n          \"measurement\": \"heating\",\n          \"orderByTime\": \"ASC\",\n          \"policy\": \"data30d\",\n          \"query\": \"SELECT moving_average(mean(\\\"temperature\\\"), 10) FROM \\\"data30d\\\".\\\"heating\\\" WHERE (\\\"tag5\\\" = 's003') AND time > now() - 15m GROUP BY time($__interval) fill(previous)\",\n          \"rawQuery\": false,\n          \"refId\": \"A\",\n          \"resultFormat\": \"time_series\",\n          \"select\": [\n            [\n              {\n                \"params\": [\n                  \"temperature\"\n                ],\n                \"type\": \"field\"\n              },\n              {\n                \"params\": [],\n                \"type\": \"mean\"\n              },\n              {\n                \"params\": [\n                  10\n                ],\n                \"type\": \"moving_average\"\n              }\n            ]\n          ],\n          \"tags\": [\n            {\n              \"key\": \"tag5\",\n              \"operator\": \"=\",\n              \"value\": \"s003\"\n            }\n          ]\n        }\n      ],\n      \"thresholds\": [\n        {\n          \"colorMode\": \"critical\",\n          \"fill\": true,\n          \"line\": true,\n          \"op\": \"gt\",\n          \"value\": 130,\n          \"yaxis\": \"left\"\n        }\n      ],\n      \"timeFrom\": \"10m\",\n      \"timeRegions\": [],\n      \"timeShift\": null,\n      \"title\": \"S003\",\n      \"tooltip\": {\n        \"shared\": true,\n        \"sort\": 0,\n        \"value_type\": \"individual\"\n      },\n      \"type\": \"graph\",\n      \"xaxis\": {\n        \"buckets\": null,\n        \"mode\": \"time\",\n        \"name\": null,\n        \"show\": true,\n        \"values\": []\n      },\n      \"yaxes\": [\n        {\n          \"format\": \"celsius\",\n          \"label\": null,\n          \"logBase\": 1,\n          \"max\": null,\n          \"min\": null,\n          \"show\": true\n        },\n        {\n          \"format\": \"short\",\n          \"label\": null,\n          \"logBase\": 1,\n          \"max\": null,\n          \"min\": null,\n          \"show\": true\n        }\n      ],\n      \"yaxis\": {\n        \"align\": false,\n        \"alignLevel\": null\n      }\n    },\n    {\n      \"aliasColors\": {},\n      \"bars\": false,\n      \"dashLength\": 10,\n      \"dashes\": false,\n      \"datasource\": \"Heating\",\n      \"fill\": 1,\n      \"fillGradient\": 6,\n      \"gridPos\": {\n        \"h\": 11,\n        \"w\": 12,\n        \"x\": 12,\n        \"y\": 24\n      },\n      \"hiddenSeries\": false,\n      \"id\": 3,\n      \"legend\": {\n        \"alignAsTable\": true,\n        \"avg\": true,\n        \"current\": true,\n        \"hideEmpty\": false,\n        \"max\": true,\n        \"min\": true,\n        \"rightSide\": false,\n        \"show\": true,\n        \"total\": false,\n        \"values\": true\n      },\n      \"lines\": true,\n      \"linewidth\": 2,\n      \"nullPointMode\": \"null\",\n      \"options\": {\n        \"dataLinks\": []\n      },\n      \"percentage\": false,\n      \"pointradius\": 2,\n      \"points\": false,\n      \"renderer\": \"flot\",\n      \"seriesOverrides\": [],\n      \"spaceLength\": 10,\n      \"stack\": false,\n      \"steppedLine\": false,\n      \"targets\": [\n        {\n          \"groupBy\": [\n            {\n              \"params\": [\n                \"1m\"\n              ],\n              \"type\": \"time\"\n            },\n            {\n              \"params\": [\n                \"tag1\"\n              ],\n              \"type\": \"tag\"\n            },\n            {\n              \"params\": [\n                \"none\"\n              ],\n              \"type\": \"fill\"\n            }\n          ],\n          \"measurement\": \"heating\",\n          \"orderByTime\": \"ASC\",\n          \"policy\": \"default\",\n          \"query\": \"SELECT mean(\\\"humidity\\\") FROM \\\"heating\\\" WHERE $timeFilter GROUP BY time(1m), \\\"tag1\\\" fill(none)\",\n          \"rawQuery\": false,\n          \"refId\": \"A\",\n          \"resultFormat\": \"time_series\",\n          \"select\": [\n            [\n              {\n                \"params\": [\n                  \"humidity\"\n                ],\n                \"type\": \"field\"\n              },\n              {\n                \"params\": [],\n                \"type\": \"mean\"\n              },\n              {\n                \"params\": [\n                  \"40\"\n                ],\n                \"type\": \"moving_average\"\n              }\n            ]\n          ],\n          \"tags\": []\n        }\n      ],\n      \"thresholds\": [],\n      \"timeFrom\": null,\n      \"timeRegions\": [],\n      \"timeShift\": null,\n      \"title\": \"Humidity\",\n      \"tooltip\": {\n        \"shared\": true,\n        \"sort\": 0,\n        \"value_type\": \"individual\"\n      },\n      \"type\": \"graph\",\n      \"xaxis\": {\n        \"buckets\": null,\n        \"mode\": \"time\",\n        \"name\": null,\n        \"show\": true,\n        \"values\": []\n      },\n      \"yaxes\": [\n        {\n          \"format\": \"short\",\n          \"label\": null,\n          \"logBase\": 1,\n          \"max\": null,\n          \"min\": null,\n          \"show\": true\n        },\n        {\n          \"format\": \"short\",\n          \"label\": null,\n          \"logBase\": 1,\n          \"max\": null,\n          \"min\": null,\n          \"show\": true\n        }\n      ],\n      \"yaxis\": {\n        \"align\": false,\n        \"alignLevel\": null\n      }\n    },\n    {\n      \"datasource\": null,\n      \"gridPos\": {\n        \"h\": 8,\n        \"w\": 12,\n        \"x\": 12,\n        \"y\": 35\n      },\n      \"id\": 11,\n      \"options\": {\n        \"feedUrl\": \"https://rss.orf.at/news.xml\"\n      },\n      \"timeFrom\": null,\n      \"timeShift\": null,\n      \"title\": \"News\",\n      \"type\": \"news\"\n    },\n    {\n      \"cacheTimeout\": null,\n      \"datasource\": \"Heating\",\n      \"gridPos\": {\n        \"h\": 8,\n        \"w\": 5,\n        \"x\": 12,\n        \"y\": 43\n      },\n      \"id\": 5,\n      \"links\": [],\n      \"options\": {\n        \"displayMode\": \"lcd\",\n        \"fieldOptions\": {\n          \"calcs\": [\n            \"mean\"\n          ],\n          \"defaults\": {\n            \"decimals\": 2,\n            \"mappings\": [],\n            \"max\": 250,\n            \"min\": 0,\n            \"thresholds\": {\n              \"mode\": \"absolute\",\n              \"steps\": [\n                {\n                  \"color\": \"green\",\n                  \"value\": null\n                },\n                {\n                  \"color\": \"#EAB839\",\n                  \"value\": 80\n                },\n                {\n                  \"color\": \"red\",\n                  \"value\": 150\n                }\n              ]\n            },\n            \"unit\": \"celsius\"\n          },\n          \"overrides\": [],\n          \"values\": false\n        },\n        \"orientation\": \"horizontal\",\n        \"showUnfilled\": true\n      },\n      \"pluginVersion\": \"6.7.2\",\n      \"targets\": [\n        {\n          \"groupBy\": [\n            {\n              \"params\": [\n                \"$__interval\"\n              ],\n              \"type\": \"time\"\n            },\n            {\n              \"params\": [\n                \"tag1\"\n              ],\n              \"type\": \"tag\"\n            },\n            {\n              \"params\": [\n                \"linear\"\n              ],\n              \"type\": \"fill\"\n            }\n          ],\n          \"measurement\": \"heating\",\n          \"orderByTime\": \"ASC\",\n          \"policy\": \"default\",\n          \"query\": \"SELECT moving_average(mean(\\\"temperature\\\"), 40) FROM \\\"heating\\\" WHERE $timeFilter GROUP BY time(1m), \\\"tag1\\\" fill(none)\",\n          \"rawQuery\": false,\n          \"refId\": \"A\",\n          \"resultFormat\": \"time_series\",\n          \"select\": [\n            [\n              {\n                \"params\": [\n                  \"temperature\"\n                ],\n                \"type\": \"field\"\n              },\n              {\n                \"params\": [],\n                \"type\": \"last\"\n              },\n              {\n                \"params\": [\n                  \"5\"\n                ],\n                \"type\": \"moving_average\"\n              }\n            ]\n          ],\n          \"tags\": []\n        }\n      ],\n      \"timeFrom\": null,\n      \"timeShift\": null,\n      \"title\": \"Current Temperature\",\n      \"type\": \"bargauge\"\n    },\n    {\n      \"cacheTimeout\": null,\n      \"columns\": [],\n      \"datasource\": null,\n      \"fontSize\": \"100%\",\n      \"gridPos\": {\n        \"h\": 8,\n        \"w\": 7,\n        \"x\": 17,\n        \"y\": 43\n      },\n      \"id\": 9,\n      \"interval\": \"\",\n      \"links\": [],\n      \"pageSize\": null,\n      \"pluginVersion\": \"6.6.0\",\n      \"showHeader\": true,\n      \"sort\": {\n        \"col\": 0,\n        \"desc\": false\n      },\n      \"styles\": [\n        {\n          \"alias\": \"Time\",\n          \"align\": \"auto\",\n          \"dateFormat\": \"YYYY-MM-DD HH:mm:ss\",\n          \"pattern\": \"Time\",\n          \"type\": \"date\"\n        },\n        {\n          \"alias\": \"\",\n          \"align\": \"right\",\n          \"colorMode\": null,\n          \"colors\": [\n            \"rgba(245, 54, 54, 0.9)\",\n            \"rgba(237, 129, 40, 0.89)\",\n            \"rgba(50, 172, 45, 0.97)\"\n          ],\n          \"decimals\": 2,\n          \"pattern\": \"/.*/\",\n          \"thresholds\": [],\n          \"type\": \"number\",\n          \"unit\": \"short\"\n        }\n      ],\n      \"targets\": [\n        {\n          \"groupBy\": [\n            {\n              \"params\": [\n                \"tag1\"\n              ],\n              \"type\": \"tag\"\n            },\n            {\n              \"params\": [\n                \"tag2\"\n              ],\n              \"type\": \"tag\"\n            },\n            {\n              \"params\": [\n                \"tag3\"\n              ],\n              \"type\": \"tag\"\n            }\n          ],\n          \"measurement\": \"heating\",\n          \"orderByTime\": \"ASC\",\n          \"policy\": \"data30d\",\n          \"query\": \"SELECT count(\\\"ts\\\") FROM \\\"data30d\\\".\\\"heating\\\" GROUP BY \\\"tag1\\\", \\\"tag2\\\", \\\"tag3\\\"\",\n          \"rawQuery\": true,\n          \"refId\": \"A\",\n          \"resultFormat\": \"table\",\n          \"select\": [\n            [\n              {\n                \"params\": [\n                  \"ts\"\n                ],\n                \"type\": \"field\"\n              },\n              {\n                \"params\": [],\n                \"type\": \"count\"\n              }\n            ]\n          ],\n          \"tags\": []\n        }\n      ],\n      \"timeFrom\": null,\n      \"timeShift\": null,\n      \"title\": \"All Time Data\",\n      \"transform\": \"table\",\n      \"type\": \"table\"\n    },\n    {\n      \"alert\": {\n        \"alertRuleTags\": {},\n        \"conditions\": [\n          {\n            \"evaluator\": {\n              \"params\": [\n                100\n              ],\n              \"type\": \"gt\"\n            },\n            \"operator\": {\n              \"type\": \"and\"\n            },\n            \"query\": {\n              \"params\": [\n                \"A\",\n                \"5m\",\n                \"now\"\n              ]\n            },\n            \"reducer\": {\n              \"params\": [],\n              \"type\": \"avg\"\n            },\n            \"type\": \"query\"\n          }\n        ],\n        \"executionErrorState\": \"alerting\",\n        \"for\": \"5m\",\n        \"frequency\": \"1m\",\n        \"handler\": 1,\n        \"name\": \"Temperature alert\",\n        \"noDataState\": \"no_data\",\n        \"notifications\": []\n      },\n      \"aliasColors\": {},\n      \"bars\": false,\n      \"cacheTimeout\": null,\n      \"dashLength\": 10,\n      \"dashes\": false,\n      \"datasource\": \"Heating\",\n      \"fill\": 2,\n      \"fillGradient\": 9,\n      \"gridPos\": {\n        \"h\": 11,\n        \"w\": 12,\n        \"x\": 12,\n        \"y\": 51\n      },\n      \"hiddenSeries\": false,\n      \"id\": 2,\n      \"legend\": {\n        \"alignAsTable\": false,\n        \"avg\": false,\n        \"current\": false,\n        \"hideEmpty\": false,\n        \"max\": false,\n        \"min\": false,\n        \"show\": true,\n        \"total\": false,\n        \"values\": false\n      },\n      \"lines\": true,\n      \"linewidth\": 2,\n      \"links\": [\n        {\n          \"targetBlank\": false,\n          \"title\": \"\",\n          \"url\": \"\"\n        }\n      ],\n      \"nullPointMode\": \"null\",\n      \"options\": {\n        \"dataLinks\": []\n      },\n      \"percentage\": false,\n      \"pluginVersion\": \"6.7.2\",\n      \"pointradius\": 2,\n      \"points\": false,\n      \"renderer\": \"flot\",\n      \"seriesOverrides\": [],\n      \"spaceLength\": 10,\n      \"stack\": false,\n      \"steppedLine\": false,\n      \"targets\": [\n        {\n          \"groupBy\": [\n            {\n              \"params\": [\n                \"1m\"\n              ],\n              \"type\": \"time\"\n            },\n            {\n              \"params\": [\n                \"tag1\"\n              ],\n              \"type\": \"tag\"\n            },\n            {\n              \"params\": [\n                \"none\"\n              ],\n              \"type\": \"fill\"\n            }\n          ],\n          \"measurement\": \"heating\",\n          \"orderByTime\": \"ASC\",\n          \"policy\": \"default\",\n          \"query\": \"SELECT moving_average(mean(\\\"temperature\\\"), 40) FROM \\\"heating\\\" WHERE $timeFilter GROUP BY time(1m), \\\"tag1\\\" fill(none)\",\n          \"rawQuery\": false,\n          \"refId\": \"A\",\n          \"resultFormat\": \"time_series\",\n          \"select\": [\n            [\n              {\n                \"params\": [\n                  \"temperature\"\n                ],\n                \"type\": \"field\"\n              },\n              {\n                \"params\": [],\n                \"type\": \"mean\"\n              },\n              {\n                \"params\": [\n                  \"40\"\n                ],\n                \"type\": \"moving_average\"\n              }\n            ]\n          ],\n          \"tags\": []\n        }\n      ],\n      \"thresholds\": [\n        {\n          \"colorMode\": \"critical\",\n          \"fill\": true,\n          \"line\": true,\n          \"op\": \"gt\",\n          \"value\": 100,\n          \"yaxis\": \"left\"\n        }\n      ],\n      \"timeFrom\": null,\n      \"timeRegions\": [],\n      \"timeShift\": null,\n      \"title\": \"Temperature\",\n      \"tooltip\": {\n        \"shared\": true,\n        \"sort\": 0,\n        \"value_type\": \"individual\"\n      },\n      \"type\": \"graph\",\n      \"xaxis\": {\n        \"buckets\": null,\n        \"mode\": \"time\",\n        \"name\": null,\n        \"show\": true,\n        \"values\": []\n      },\n      \"yaxes\": [\n        {\n          \"decimals\": null,\n          \"format\": \"celsius\",\n          \"label\": null,\n          \"logBase\": 1,\n          \"max\": null,\n          \"min\": null,\n          \"show\": true\n        },\n        {\n          \"format\": \"short\",\n          \"label\": null,\n          \"logBase\": 1,\n          \"max\": null,\n          \"min\": null,\n          \"show\": false\n        }\n      ],\n      \"yaxis\": {\n        \"align\": false,\n        \"alignLevel\": null\n      }\n    }\n  ],\n  \"refresh\": \"30s\",\n  \"schemaVersion\": 22,\n  \"style\": \"dark\",\n  \"tags\": [],\n  \"templating\": {\n    \"list\": []\n  },\n  \"time\": {\n    \"from\": \"now-6h\",\n    \"to\": \"now\"\n  },\n  \"timepicker\": {\n    \"hidden\": false,\n    \"refresh_intervals\": [\n      \"5s\",\n      \"10s\",\n      \"30s\",\n      \"1m\",\n      \"5m\",\n      \"15m\",\n      \"30m\",\n      \"1h\",\n      \"2h\",\n      \"1d\"\n    ]\n  },\n  \"timezone\": \"\",\n  \"title\": \"Heating\",\n  \"uid\": \"H6CTNOUZz\",\n  \"variables\": {\n    \"list\": []\n  },\n  \"version\": 75\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":620,"y":400,"wires":[[]]},{"id":"25c5f17.124740e","type":"function","z":"eb66deb5.bea27","name":"empty collector","func":"\nreturn msg;","outputs":1,"noerr":0,"x":880,"y":1400,"wires":[["48399cfc.3dd054"]]},{"id":"fdfc8a72.c0d3c8","type":"comment","z":"eb66deb5.bea27","name":"DynamicPart - Simulated sensors","info":"","x":150,"y":1160,"wires":[]},{"id":"59417ddd.ded8b4","type":"inject","z":"eb66deb5.bea27","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"4","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":130,"y":1220,"wires":[["6d18de9.b458b2"]]},{"id":"6d18de9.b458b2","type":"function","z":"eb66deb5.bea27","name":"telemetry/inffeld16/2nd/hallway/refrigirator/compressor/temperature","func":"var sensor = {};\nvar max = 0;\nvar min = 0;\n\nmax = 70;\nmin = 69;\nvar v1 = Math.random() * (max - min) + min;\n\nsensor.temperature = v1;\n\n\nvar topic = \"telemetry/inffeld16/2nd/hallway/refrigirator/compressor/temperature\";\nmsg.topic = topic;\nmsg.payload = sensor;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":480,"y":1220,"wires":[["25c5f17.124740e"]]},{"id":"ac79f6e6.ccc1f8","type":"inject","z":"eb66deb5.bea27","name":"","repeat":"10","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":130,"y":1300,"wires":[["c415c632.c395e8"]]},{"id":"c415c632.c395e8","type":"function","z":"eb66deb5.bea27","name":"telemetry/inffeld16/2nd/hallway/refrigirator/chamber","func":"var sensor = {};\nvar max = 0;\nvar min = 0;\n\nmax = 30;\nmin = 29;\nvar v1 = Math.random() * (max - min) + min;\n\nsensor.temperature = v1;\n\nvar topic = \"telemetry/inffeld16/2nd/hallway/refrigirator/chamber\";\nmsg.topic = topic;\nmsg.payload=sensor;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":430,"y":1300,"wires":[["25c5f17.124740e"]]},{"id":"e55fe67.a050618","type":"comment","z":"eb66deb5.bea27","name":"DB-Passthrough","info":"","x":120,"y":1040,"wires":[]},{"id":"6d4dac80.5614e4","type":"mqtt out","z":"eb66deb5.bea27","name":"","topic":"","qos":"0","retain":"false","broker":"73e9a24f.21590c","x":1170,"y":1660,"wires":[]},{"id":"c98868ac.38c248","type":"influxdb in","z":"26d1fc02.f4deb4","influxdb":"fddc60d3.519f5","name":"create inffeld","query":"create database inffeld","rawOutput":false,"precision":"","retentionPolicy":"","org":"","x":350,"y":320,"wires":[["821c5c87.49db3"]]},{"id":"8f1af59.5f82008","type":"inject","z":"26d1fc02.f4deb4","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":120,"y":320,"wires":[["c98868ac.38c248"]]},{"id":"821c5c87.49db3","type":"debug","z":"26d1fc02.f4deb4","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":590,"y":320,"wires":[]},{"id":"a008542d.781db8","type":"function","z":"eb66deb5.bea27","name":"Data preparation","func":"try {\nvar flatten = global.get(\"flatten\");\n\nvar topic = msg.topic;\nvar retain = msg.retain;\nvar data = JSON.parse(msg.payload);\n\n//var flatData = flatten(data);\nvar data = flatten(data);\n\ntags = topic.split('/');\nvar roomName = tags[0]+\"/\"+tags[1]+\"/\"+tags[2] + \"/\" + tags[3];\nvar measName =  roomName + \"/\" + tags[4];\nvar partName = measName + \"/\" + tags[5]\n\n//var valueName = partName + \"/\" + \"main\";\nvar valueName = partName;\nif(tags.length >= 7) {\n valueName = partName + \"/\" + tags[6]\n}\n\ntags.push(roomName);\ntags.push(measName);\ntags.push(partName);\ntags.push(valueName);\n\nif(\n    tags[6] == \"INFO1\" ||\n    tags[6] == \"INFO2\" ||\n    tags[6] == \"INFO3\" ||\n    tags[6] == \"STATE\") {\n        return null;\n    }\n\nmsg.payload = [data, tags];\nmsg.measurement = measName;\nreturn msg;\n\n} catch(err) {\n    return null;\n}\n\n/*\nif(tags[0] == \"telemetry\") {\n    tags.shift();    \n    \n    var o =0;\n    var roomName = tags[o+0]+\"/\"+tags[o+1]+\"/\"+tags[o+2];\n    var measName =  roomName + \"/\" + tags[o+3];\n    var partName = measName + \"/\" + tags[o+4]\n    tags.push(roomName);\n    tags.push(measName);\n    tags.push(partName);\n    \n    msg.payload = [data, tags];\n    msg.measurement = measName;\n    return msg;\n}\n\nreturn null;\n*/","outputs":1,"noerr":0,"initialize":"","finalize":"","x":370,"y":1080,"wires":[["b9cb3198.02e66","3e0613e4.b8843c"]]},{"id":"3e0613e4.b8843c","type":"influxdb out","z":"eb66deb5.bea27","influxdb":"370a75d7.b3a34a","name":"","measurement":"","precision":"","retentionPolicy":"","database":"inffeld","retentionPolicyV18Flux":"","org":"","bucket":"","x":870,"y":1080,"wires":[]},{"id":"a46995dd.971958","type":"inject","z":"eb66deb5.bea27","name":"","repeat":"10","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":130,"y":1480,"wires":[["76523ff5.d7891"]]},{"id":"76523ff5.d7891","type":"function","z":"eb66deb5.bea27","name":"telemetry/inffeld16/2nd/hallway/light0/main/brightness","func":"var sensor = {};\nvar max = 0;\nvar min = 0;\n\nmax = 100;\nmin = 0;\nvar v1 = Math.random() * (max - min) + min;\n\nsensor.brightness = v1;\n\nvar topic = \"telemetry/inffeld16/2nd/hallway/light0/main/brightness\";\nmsg.topic = topic;\nmsg.payload = sensor;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":440,"y":1480,"wires":[["eb7738a4.47ef88"]]},{"id":"59775fc0.e3bcb","type":"inject","z":"eb66deb5.bea27","name":"","repeat":"10","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":130,"y":1260,"wires":[["9ed4c116.51ce3"]]},{"id":"9ed4c116.51ce3","type":"function","z":"eb66deb5.bea27","name":"telemetry/inffeld16/2nd/hallway/refrigirator/compressor/powerconsumption","func":"var sensor = {};\nvar max = 0;\nvar min = 0;\n\nmax = 150;\nmin = 0;\nvar v1 = Math.random() * (max - min) + min;\n\nsensor.powerconsumption = v1;\n\nvar topic = \"telemetry/inffeld16/2nd/hallway/refrigirator/compressor/powerconsumption\";\nmsg.topic = topic;\nmsg.payload = sensor;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":500,"y":1260,"wires":[["25c5f17.124740e"]]},{"id":"e626a59b.391388","type":"influxdb in","z":"26d1fc02.f4deb4","influxdb":"fddc60d3.519f5","name":"drop inffeld","query":"drop database inffeld","rawOutput":false,"precision":"","retentionPolicy":"","org":"","x":350,"y":360,"wires":[["4a3cc628.abc1b8"]]},{"id":"bfe0b031.d2fad","type":"inject","z":"26d1fc02.f4deb4","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":120,"y":360,"wires":[["e626a59b.391388"]]},{"id":"4a3cc628.abc1b8","type":"debug","z":"26d1fc02.f4deb4","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":590,"y":360,"wires":[]},{"id":"77f80ae8.913ba4","type":"inject","z":"eb66deb5.bea27","name":"","repeat":"10","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":130,"y":1520,"wires":[["71d7301f.534b4"]]},{"id":"71d7301f.534b4","type":"function","z":"eb66deb5.bea27","name":"telemetry/inffeld16/1st/hallway/light0/main/brightness","func":"var sensor = {};\nvar max = 0;\nvar min = 0;\n\nmax = 100;\nmin = 0;\nvar v1 = Math.random() * (max - min) + min;\n\nsensor.brightness = v1;\n\nvar topic = \"telemetry/inffeld16/1st/hallway/light0/main/brightness\";\nmsg.topic = topic;\nmsg.payload = sensor;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":440,"y":1520,"wires":[["eb7738a4.47ef88"]]},{"id":"eb7738a4.47ef88","type":"function","z":"eb66deb5.bea27","name":"empty collector","func":"\nreturn msg;","outputs":1,"noerr":0,"x":880,"y":1480,"wires":[["48399cfc.3dd054"]]},{"id":"10919f27.d80f61","type":"inject","z":"eb66deb5.bea27","name":"","repeat":"10","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":130,"y":1560,"wires":[["d82cca85.0531d8"]]},{"id":"d82cca85.0531d8","type":"function","z":"eb66deb5.bea27","name":"telemetry/inffeld16/1st/hallway/light1/main/brightness","func":"var sensor = {};\nvar max = 0;\nvar min = 0;\n\nmax = 100;\nmin = 0;\nvar v1 = Math.random() * (max - min) + min;\n\nsensor.brightness = v1;\n\nvar topic = \"telemetry/inffeld16/1st/hallway/light1/main/brightness\";\nmsg.topic = topic;\nmsg.payload = sensor;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":440,"y":1560,"wires":[["eb7738a4.47ef88"]]},{"id":"736995ee.c7415c","type":"inject","z":"eb66deb5.bea27","name":"","repeat":"10","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":130,"y":1340,"wires":[["b8074c3e.a8dac"]]},{"id":"b8074c3e.a8dac","type":"function","z":"eb66deb5.bea27","name":"telemetry/inffeld16/2nd/hallway/outlet/main/powerconsumption","func":"var sensor = {};\nvar max = 0;\nvar min = 0;\n\nmax = 3550;\nmin = 0;\nvar v1 = Math.random() * (max - min) + min;\n\nsensor.powerconsumption = v1;\n\nvar topic = \"telemetry/inffeld16/2nd/hallway/outlet/main/powerconsumption\";\nmsg.topic = topic;\nmsg.payload = sensor;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":470,"y":1340,"wires":[["25c5f17.124740e"]]},{"id":"555fb15.d4a2e5","type":"inject","z":"eb66deb5.bea27","name":"","repeat":"10","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":130,"y":1380,"wires":[["6650189f.fec428"]]},{"id":"6650189f.fec428","type":"function","z":"eb66deb5.bea27","name":"telemetry/inffeld16/2nd/hallway/outlet1/main/powerconsumption","func":"var sensor = {};\nvar max = 0;\nvar min = 0;\n\nmax = 3550;\nmin = 0;\nvar v1 = Math.random() * (max - min) + min;\n\nsensor.powerconsumption = v1;\n\n\nvar topic = \"telemetry/inffeld16/2nd/hallway/outlet1/main/powerconsumption\";\nmsg.topic = topic;\nmsg.payload = sensor;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":470,"y":1380,"wires":[["25c5f17.124740e"]]},{"id":"8e557f22.fa621","type":"debug","z":"a26281bc.ae89f","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":730,"y":80,"wires":[]},{"id":"9a0e3d82.40bfc","type":"function","z":"a26281bc.ae89f","name":"","func":"var prefix = \"/ragrug_mnt/uploads\"\nvar filename = msg.file.name;\nvar filetype = msg.file.type;\nvar filesize = msg.file.size;\n\nmsg.filename = prefix + \"/\" + filename;\n\nreturn msg;","outputs":1,"noerr":0,"x":530,"y":120,"wires":[["8e557f22.fa621","97250090.c0167"]]},{"id":"97250090.c0167","type":"file","z":"a26281bc.ae89f","name":"","filename":"","appendNewline":false,"createDir":true,"overwriteFile":"false","encoding":"binary","x":730,"y":120,"wires":[["489997e4.4c8598"]]},{"id":"489997e4.4c8598","type":"debug","z":"a26281bc.ae89f","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":910,"y":120,"wires":[]},{"id":"448d6a85.5446a4","type":"debug","z":"a26281bc.ae89f","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":910,"y":180,"wires":[]},{"id":"4f3838b9.487ce8","type":"http in","z":"c61d9d5f.52591","name":"","url":"/simple","method":"get","upload":false,"swaggerDoc":"","x":210,"y":120,"wires":[["80255e12.81598"]]},{"id":"80255e12.81598","type":"template","z":"c61d9d5f.52591","name":"html","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<h1>Upload a file here:</h1>\n\n<form action=\"/upload\" method=\"POST\" enctype=\"multipart/form-data\">\n    <span>Name</span>\n    <input type=\"text\" name=\"myName\"/>\n    </br>\n    <span>Scale</span>\n    <input type=\"number\" name=\"myScale\" step=\"0.00000001\"/>\n    </br>\n    <input type=\"file\" name=\"myFile\" />\n    </br>\n    <input type=\"submit\" value=\"Submit\">\n</form>","output":"str","x":550,"y":120,"wires":[["dc178e26.3906b"]]},{"id":"dc178e26.3906b","type":"http response","z":"c61d9d5f.52591","name":"","statusCode":"","headers":{},"x":690,"y":120,"wires":[]},{"id":"d5e83913.dfa5d8","type":"http response","z":"c61d9d5f.52591","name":"","statusCode":"","headers":{},"x":630,"y":700,"wires":[]},{"id":"92c1c336.ea1fd","type":"comment","z":"c61d9d5f.52591","name":"Simple","info":"","x":190,"y":80,"wires":[]},{"id":"ec6c3356.9f695","type":"template","z":"c61d9d5f.52591","name":"dropzone.js","field":"dropzonejs","fieldType":"msg","format":"javascript","syntax":"mustache","template":"\n/*\n *\n * More info at [www.dropzonejs.com](http://www.dropzonejs.com)\n *\n * Copyright (c) 2012, Matias Meno\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n *\n */\n\n(function() {\n  var Dropzone, Emitter, camelize, contentLoaded, detectVerticalSquash, drawImageIOSFix, noop, without,\n    __slice = [].slice,\n    __hasProp = {}.hasOwnProperty,\n    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\n  noop = function() {};\n\n  Emitter = (function() {\n    function Emitter() {}\n\n    Emitter.prototype.addEventListener = Emitter.prototype.on;\n\n    Emitter.prototype.on = function(event, fn) {\n      this._callbacks = this._callbacks || {};\n      if (!this._callbacks[event]) {\n        this._callbacks[event] = [];\n      }\n      this._callbacks[event].push(fn);\n      return this;\n    };\n\n    Emitter.prototype.emit = function() {\n      var args, callback, callbacks, event, _i, _len;\n      event = arguments[0], args = 2 <= arguments.length ? __slice.call(arguments, 1) : [];\n      this._callbacks = this._callbacks || {};\n      callbacks = this._callbacks[event];\n      if (callbacks) {\n        for (_i = 0, _len = callbacks.length; _i < _len; _i++) {\n          callback = callbacks[_i];\n          callback.apply(this, args);\n        }\n      }\n      return this;\n    };\n\n    Emitter.prototype.removeListener = Emitter.prototype.off;\n\n    Emitter.prototype.removeAllListeners = Emitter.prototype.off;\n\n    Emitter.prototype.removeEventListener = Emitter.prototype.off;\n\n    Emitter.prototype.off = function(event, fn) {\n      var callback, callbacks, i, _i, _len;\n      if (!this._callbacks || arguments.length === 0) {\n        this._callbacks = {};\n        return this;\n      }\n      callbacks = this._callbacks[event];\n      if (!callbacks) {\n        return this;\n      }\n      if (arguments.length === 1) {\n        delete this._callbacks[event];\n        return this;\n      }\n      for (i = _i = 0, _len = callbacks.length; _i < _len; i = ++_i) {\n        callback = callbacks[i];\n        if (callback === fn) {\n          callbacks.splice(i, 1);\n          break;\n        }\n      }\n      return this;\n    };\n\n    return Emitter;\n\n  })();\n\n  Dropzone = (function(_super) {\n    var extend, resolveOption;\n\n    __extends(Dropzone, _super);\n\n    Dropzone.prototype.Emitter = Emitter;\n\n\n    /*\n    This is a list of all available events you can register on a dropzone object.\n    \n    You can register an event handler like this:\n    \n        dropzone.on(\"dragEnter\", function() { });\n     */\n\n    Dropzone.prototype.events = [\"drop\", \"dragstart\", \"dragend\", \"dragenter\", \"dragover\", \"dragleave\", \"addedfile\", \"addedfiles\", \"removedfile\", \"thumbnail\", \"error\", \"errormultiple\", \"processing\", \"processingmultiple\", \"uploadprogress\", \"totaluploadprogress\", \"sending\", \"sendingmultiple\", \"success\", \"successmultiple\", \"canceled\", \"canceledmultiple\", \"complete\", \"completemultiple\", \"reset\", \"maxfilesexceeded\", \"maxfilesreached\", \"queuecomplete\"];\n\n    Dropzone.prototype.defaultOptions = {\n      url: null,\n      method: \"post\",\n      withCredentials: false,\n      parallelUploads: 2,\n      uploadMultiple: false,\n      maxFilesize: 256,\n      paramName: \"file\",\n      createImageThumbnails: true,\n      maxThumbnailFilesize: 10,\n      thumbnailWidth: 120,\n      thumbnailHeight: 120,\n      filesizeBase: 1000,\n      maxFiles: null,\n      params: {},\n      clickable: true,\n      ignoreHiddenFiles: true,\n      acceptedFiles: null,\n      acceptedMimeTypes: null,\n      autoProcessQueue: true,\n      autoQueue: true,\n      addRemoveLinks: false,\n      previewsContainer: null,\n      hiddenInputContainer: \"body\",\n      capture: null,\n      renameFilename: null,\n      dictDefaultMessage: \"Drop files here to upload\",\n      dictFallbackMessage: \"Your browser does not support drag'n'drop file uploads.\",\n      dictFallbackText: \"Please use the fallback form below to upload your files like in the olden days.\",\n      dictFileTooBig: \"File is too big ({{filesize}}MiB). Max filesize: {{maxFilesize}}MiB.\",\n      dictInvalidFileType: \"You can't upload files of this type.\",\n      dictResponseError: \"Server responded with {{statusCode}} code.\",\n      dictCancelUpload: \"Cancel upload\",\n      dictCancelUploadConfirmation: \"Are you sure you want to cancel this upload?\",\n      dictRemoveFile: \"Remove file\",\n      dictRemoveFileConfirmation: null,\n      dictMaxFilesExceeded: \"You can not upload any more files.\",\n      accept: function(file, done) {\n        return done();\n      },\n      init: function() {\n        return noop;\n      },\n      forceFallback: false,\n      fallback: function() {\n        var child, messageElement, span, _i, _len, _ref;\n        this.element.className = \"\" + this.element.className + \" dz-browser-not-supported\";\n        _ref = this.element.getElementsByTagName(\"div\");\n        for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n          child = _ref[_i];\n          if (/(^| )dz-message($| )/.test(child.className)) {\n            messageElement = child;\n            child.className = \"dz-message\";\n            continue;\n          }\n        }\n        if (!messageElement) {\n          messageElement = Dropzone.createElement(\"<div class=\\\"dz-message\\\"><span></span></div>\");\n          this.element.appendChild(messageElement);\n        }\n        span = messageElement.getElementsByTagName(\"span\")[0];\n        if (span) {\n          if (span.textContent != null) {\n            span.textContent = this.options.dictFallbackMessage;\n          } else if (span.innerText != null) {\n            span.innerText = this.options.dictFallbackMessage;\n          }\n        }\n        return this.element.appendChild(this.getFallbackForm());\n      },\n      resize: function(file) {\n        var info, srcRatio, trgRatio;\n        info = {\n          srcX: 0,\n          srcY: 0,\n          srcWidth: file.width,\n          srcHeight: file.height\n        };\n        srcRatio = file.width / file.height;\n        info.optWidth = this.options.thumbnailWidth;\n        info.optHeight = this.options.thumbnailHeight;\n        if ((info.optWidth == null) && (info.optHeight == null)) {\n          info.optWidth = info.srcWidth;\n          info.optHeight = info.srcHeight;\n        } else if (info.optWidth == null) {\n          info.optWidth = srcRatio * info.optHeight;\n        } else if (info.optHeight == null) {\n          info.optHeight = (1 / srcRatio) * info.optWidth;\n        }\n        trgRatio = info.optWidth / info.optHeight;\n        if (file.height < info.optHeight || file.width < info.optWidth) {\n          info.trgHeight = info.srcHeight;\n          info.trgWidth = info.srcWidth;\n        } else {\n          if (srcRatio > trgRatio) {\n            info.srcHeight = file.height;\n            info.srcWidth = info.srcHeight * trgRatio;\n          } else {\n            info.srcWidth = file.width;\n            info.srcHeight = info.srcWidth / trgRatio;\n          }\n        }\n        info.srcX = (file.width - info.srcWidth) / 2;\n        info.srcY = (file.height - info.srcHeight) / 2;\n        return info;\n      },\n\n      /*\n      Those functions register themselves to the events on init and handle all\n      the user interface specific stuff. Overwriting them won't break the upload\n      but can break the way it's displayed.\n      You can overwrite them if you don't like the default behavior. If you just\n      want to add an additional event handler, register it on the dropzone object\n      and don't overwrite those options.\n       */\n      drop: function(e) {\n        return this.element.classList.remove(\"dz-drag-hover\");\n      },\n      dragstart: noop,\n      dragend: function(e) {\n        return this.element.classList.remove(\"dz-drag-hover\");\n      },\n      dragenter: function(e) {\n        return this.element.classList.add(\"dz-drag-hover\");\n      },\n      dragover: function(e) {\n        return this.element.classList.add(\"dz-drag-hover\");\n      },\n      dragleave: function(e) {\n        return this.element.classList.remove(\"dz-drag-hover\");\n      },\n      paste: noop,\n      reset: function() {\n        return this.element.classList.remove(\"dz-started\");\n      },\n      addedfile: function(file) {\n        var node, removeFileEvent, removeLink, _i, _j, _k, _len, _len1, _len2, _ref, _ref1, _ref2, _results;\n        if (this.element === this.previewsContainer) {\n          this.element.classList.add(\"dz-started\");\n        }\n        if (this.previewsContainer) {\n          file.previewElement = Dropzone.createElement(this.options.previewTemplate.trim());\n          file.previewTemplate = file.previewElement;\n          this.previewsContainer.appendChild(file.previewElement);\n          _ref = file.previewElement.querySelectorAll(\"[data-dz-name]\");\n          for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n            node = _ref[_i];\n            node.textContent = this._renameFilename(file.name);\n          }\n          _ref1 = file.previewElement.querySelectorAll(\"[data-dz-size]\");\n          for (_j = 0, _len1 = _ref1.length; _j < _len1; _j++) {\n            node = _ref1[_j];\n            node.innerHTML = this.filesize(file.size);\n          }\n          if (this.options.addRemoveLinks) {\n            file._removeLink = Dropzone.createElement(\"<a class=\\\"dz-remove\\\" href=\\\"javascript:undefined;\\\" data-dz-remove>\" + this.options.dictRemoveFile + \"</a>\");\n            file.previewElement.appendChild(file._removeLink);\n          }\n          removeFileEvent = (function(_this) {\n            return function(e) {\n              e.preventDefault();\n              e.stopPropagation();\n              if (file.status === Dropzone.UPLOADING) {\n                return Dropzone.confirm(_this.options.dictCancelUploadConfirmation, function() {\n                  return _this.removeFile(file);\n                });\n              } else {\n                if (_this.options.dictRemoveFileConfirmation) {\n                  return Dropzone.confirm(_this.options.dictRemoveFileConfirmation, function() {\n                    return _this.removeFile(file);\n                  });\n                } else {\n                  return _this.removeFile(file);\n                }\n              }\n            };\n          })(this);\n          _ref2 = file.previewElement.querySelectorAll(\"[data-dz-remove]\");\n          _results = [];\n          for (_k = 0, _len2 = _ref2.length; _k < _len2; _k++) {\n            removeLink = _ref2[_k];\n            _results.push(removeLink.addEventListener(\"click\", removeFileEvent));\n          }\n          return _results;\n        }\n      },\n      removedfile: function(file) {\n        var _ref;\n        if (file.previewElement) {\n          if ((_ref = file.previewElement) != null) {\n            _ref.parentNode.removeChild(file.previewElement);\n          }\n        }\n        return this._updateMaxFilesReachedClass();\n      },\n      thumbnail: function(file, dataUrl) {\n        var thumbnailElement, _i, _len, _ref;\n        if (file.previewElement) {\n          file.previewElement.classList.remove(\"dz-file-preview\");\n          _ref = file.previewElement.querySelectorAll(\"[data-dz-thumbnail]\");\n          for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n            thumbnailElement = _ref[_i];\n            thumbnailElement.alt = file.name;\n            thumbnailElement.src = dataUrl;\n          }\n          return setTimeout(((function(_this) {\n            return function() {\n              return file.previewElement.classList.add(\"dz-image-preview\");\n            };\n          })(this)), 1);\n        }\n      },\n      error: function(file, message) {\n        var node, _i, _len, _ref, _results;\n        if (file.previewElement) {\n          file.previewElement.classList.add(\"dz-error\");\n          if (typeof message !== \"String\" && message.error) {\n            message = message.error;\n          }\n          _ref = file.previewElement.querySelectorAll(\"[data-dz-errormessage]\");\n          _results = [];\n          for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n            node = _ref[_i];\n            _results.push(node.textContent = message);\n          }\n          return _results;\n        }\n      },\n      errormultiple: noop,\n      processing: function(file) {\n        if (file.previewElement) {\n          file.previewElement.classList.add(\"dz-processing\");\n          if (file._removeLink) {\n            return file._removeLink.textContent = this.options.dictCancelUpload;\n          }\n        }\n      },\n      processingmultiple: noop,\n      uploadprogress: function(file, progress, bytesSent) {\n        var node, _i, _len, _ref, _results;\n        if (file.previewElement) {\n          _ref = file.previewElement.querySelectorAll(\"[data-dz-uploadprogress]\");\n          _results = [];\n          for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n            node = _ref[_i];\n            if (node.nodeName === 'PROGRESS') {\n              _results.push(node.value = progress);\n            } else {\n              _results.push(node.style.width = \"\" + progress + \"%\");\n            }\n          }\n          return _results;\n        }\n      },\n      totaluploadprogress: noop,\n      sending: noop,\n      sendingmultiple: noop,\n      success: function(file) {\n        if (file.previewElement) {\n          return file.previewElement.classList.add(\"dz-success\");\n        }\n      },\n      successmultiple: noop,\n      canceled: function(file) {\n        return this.emit(\"error\", file, \"Upload canceled.\");\n      },\n      canceledmultiple: noop,\n      complete: function(file) {\n        if (file._removeLink) {\n          file._removeLink.textContent = this.options.dictRemoveFile;\n        }\n        if (file.previewElement) {\n          return file.previewElement.classList.add(\"dz-complete\");\n        }\n      },\n      completemultiple: noop,\n      maxfilesexceeded: noop,\n      maxfilesreached: noop,\n      queuecomplete: noop,\n      addedfiles: noop,\n      previewTemplate: \"<div class=\\\"dz-preview dz-file-preview\\\">\\n  <div class=\\\"dz-image\\\"><img data-dz-thumbnail /></div>\\n  <div class=\\\"dz-details\\\">\\n    <div class=\\\"dz-size\\\"><span data-dz-size></span></div>\\n    <div class=\\\"dz-filename\\\"><span data-dz-name></span></div>\\n  </div>\\n  <div class=\\\"dz-progress\\\"><span class=\\\"dz-upload\\\" data-dz-uploadprogress></span></div>\\n  <div class=\\\"dz-error-message\\\"><span data-dz-errormessage></span></div>\\n  <div class=\\\"dz-success-mark\\\">\\n    <svg width=\\\"54px\\\" height=\\\"54px\\\" viewBox=\\\"0 0 54 54\\\" version=\\\"1.1\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" xmlns:xlink=\\\"http://www.w3.org/1999/xlink\\\" xmlns:sketch=\\\"http://www.bohemiancoding.com/sketch/ns\\\">\\n      <title>Check</title>\\n      <defs></defs>\\n      <g id=\\\"Page-1\\\" stroke=\\\"none\\\" stroke-width=\\\"1\\\" fill=\\\"none\\\" fill-rule=\\\"evenodd\\\" sketch:type=\\\"MSPage\\\">\\n        <path d=\\\"M23.5,31.8431458 L17.5852419,25.9283877 C16.0248253,24.3679711 13.4910294,24.366835 11.9289322,25.9289322 C10.3700136,27.4878508 10.3665912,30.0234455 11.9283877,31.5852419 L20.4147581,40.0716123 C20.5133999,40.1702541 20.6159315,40.2626649 20.7218615,40.3488435 C22.2835669,41.8725651 24.794234,41.8626202 26.3461564,40.3106978 L43.3106978,23.3461564 C44.8771021,21.7797521 44.8758057,19.2483887 43.3137085,17.6862915 C41.7547899,16.1273729 39.2176035,16.1255422 37.6538436,17.6893022 L23.5,31.8431458 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z\\\" id=\\\"Oval-2\\\" stroke-opacity=\\\"0.198794158\\\" stroke=\\\"#747474\\\" fill-opacity=\\\"0.816519475\\\" fill=\\\"#FFFFFF\\\" sketch:type=\\\"MSShapeGroup\\\"></path>\\n      </g>\\n    </svg>\\n  </div>\\n  <div class=\\\"dz-error-mark\\\">\\n    <svg width=\\\"54px\\\" height=\\\"54px\\\" viewBox=\\\"0 0 54 54\\\" version=\\\"1.1\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" xmlns:xlink=\\\"http://www.w3.org/1999/xlink\\\" xmlns:sketch=\\\"http://www.bohemiancoding.com/sketch/ns\\\">\\n      <title>Error</title>\\n      <defs></defs>\\n      <g id=\\\"Page-1\\\" stroke=\\\"none\\\" stroke-width=\\\"1\\\" fill=\\\"none\\\" fill-rule=\\\"evenodd\\\" sketch:type=\\\"MSPage\\\">\\n        <g id=\\\"Check-+-Oval-2\\\" sketch:type=\\\"MSLayerGroup\\\" stroke=\\\"#747474\\\" stroke-opacity=\\\"0.198794158\\\" fill=\\\"#FFFFFF\\\" fill-opacity=\\\"0.816519475\\\">\\n          <path d=\\\"M32.6568542,29 L38.3106978,23.3461564 C39.8771021,21.7797521 39.8758057,19.2483887 38.3137085,17.6862915 C36.7547899,16.1273729 34.2176035,16.1255422 32.6538436,17.6893022 L27,23.3431458 L21.3461564,17.6893022 C19.7823965,16.1255422 17.2452101,16.1273729 15.6862915,17.6862915 C14.1241943,19.2483887 14.1228979,21.7797521 15.6893022,23.3461564 L21.3431458,29 L15.6893022,34.6538436 C14.1228979,36.2202479 14.1241943,38.7516113 15.6862915,40.3137085 C17.2452101,41.8726271 19.7823965,41.8744578 21.3461564,40.3106978 L27,34.6568542 L32.6538436,40.3106978 C34.2176035,41.8744578 36.7547899,41.8726271 38.3137085,40.3137085 C39.8758057,38.7516113 39.8771021,36.2202479 38.3106978,34.6538436 L32.6568542,29 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z\\\" id=\\\"Oval-2\\\" sketch:type=\\\"MSShapeGroup\\\"></path>\\n        </g>\\n      </g>\\n    </svg>\\n  </div>\\n</div>\"\n    };\n\n    extend = function() {\n      var key, object, objects, target, val, _i, _len;\n      target = arguments[0], objects = 2 <= arguments.length ? __slice.call(arguments, 1) : [];\n      for (_i = 0, _len = objects.length; _i < _len; _i++) {\n        object = objects[_i];\n        for (key in object) {\n          val = object[key];\n          target[key] = val;\n        }\n      }\n      return target;\n    };\n\n    function Dropzone(element, options) {\n      var elementOptions, fallback, _ref;\n      this.element = element;\n      this.version = Dropzone.version;\n      this.defaultOptions.previewTemplate = this.defaultOptions.previewTemplate.replace(/\\n*/g, \"\");\n      this.clickableElements = [];\n      this.listeners = [];\n      this.files = [];\n      if (typeof this.element === \"string\") {\n        this.element = document.querySelector(this.element);\n      }\n      if (!(this.element && (this.element.nodeType != null))) {\n        throw new Error(\"Invalid dropzone element.\");\n      }\n      if (this.element.dropzone) {\n        throw new Error(\"Dropzone already attached.\");\n      }\n      Dropzone.instances.push(this);\n      this.element.dropzone = this;\n      elementOptions = (_ref = Dropzone.optionsForElement(this.element)) != null ? _ref : {};\n      this.options = extend({}, this.defaultOptions, elementOptions, options != null ? options : {});\n      if (this.options.forceFallback || !Dropzone.isBrowserSupported()) {\n        return this.options.fallback.call(this);\n      }\n      if (this.options.url == null) {\n        this.options.url = this.element.getAttribute(\"action\");\n      }\n      if (!this.options.url) {\n        throw new Error(\"No URL provided.\");\n      }\n      if (this.options.acceptedFiles && this.options.acceptedMimeTypes) {\n        throw new Error(\"You can't provide both 'acceptedFiles' and 'acceptedMimeTypes'. 'acceptedMimeTypes' is deprecated.\");\n      }\n      if (this.options.acceptedMimeTypes) {\n        this.options.acceptedFiles = this.options.acceptedMimeTypes;\n        delete this.options.acceptedMimeTypes;\n      }\n      this.options.method = this.options.method.toUpperCase();\n      if ((fallback = this.getExistingFallback()) && fallback.parentNode) {\n        fallback.parentNode.removeChild(fallback);\n      }\n      if (this.options.previewsContainer !== false) {\n        if (this.options.previewsContainer) {\n          this.previewsContainer = Dropzone.getElement(this.options.previewsContainer, \"previewsContainer\");\n        } else {\n          this.previewsContainer = this.element;\n        }\n      }\n      if (this.options.clickable) {\n        if (this.options.clickable === true) {\n          this.clickableElements = [this.element];\n        } else {\n          this.clickableElements = Dropzone.getElements(this.options.clickable, \"clickable\");\n        }\n      }\n      this.init();\n    }\n\n    Dropzone.prototype.getAcceptedFiles = function() {\n      var file, _i, _len, _ref, _results;\n      _ref = this.files;\n      _results = [];\n      for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n        file = _ref[_i];\n        if (file.accepted) {\n          _results.push(file);\n        }\n      }\n      return _results;\n    };\n\n    Dropzone.prototype.getRejectedFiles = function() {\n      var file, _i, _len, _ref, _results;\n      _ref = this.files;\n      _results = [];\n      for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n        file = _ref[_i];\n        if (!file.accepted) {\n          _results.push(file);\n        }\n      }\n      return _results;\n    };\n\n    Dropzone.prototype.getFilesWithStatus = function(status) {\n      var file, _i, _len, _ref, _results;\n      _ref = this.files;\n      _results = [];\n      for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n        file = _ref[_i];\n        if (file.status === status) {\n          _results.push(file);\n        }\n      }\n      return _results;\n    };\n\n    Dropzone.prototype.getQueuedFiles = function() {\n      return this.getFilesWithStatus(Dropzone.QUEUED);\n    };\n\n    Dropzone.prototype.getUploadingFiles = function() {\n      return this.getFilesWithStatus(Dropzone.UPLOADING);\n    };\n\n    Dropzone.prototype.getAddedFiles = function() {\n      return this.getFilesWithStatus(Dropzone.ADDED);\n    };\n\n    Dropzone.prototype.getActiveFiles = function() {\n      var file, _i, _len, _ref, _results;\n      _ref = this.files;\n      _results = [];\n      for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n        file = _ref[_i];\n        if (file.status === Dropzone.UPLOADING || file.status === Dropzone.QUEUED) {\n          _results.push(file);\n        }\n      }\n      return _results;\n    };\n\n    Dropzone.prototype.init = function() {\n      var eventName, noPropagation, setupHiddenFileInput, _i, _len, _ref, _ref1;\n      if (this.element.tagName === \"form\") {\n        this.element.setAttribute(\"enctype\", \"multipart/form-data\");\n      }\n      if (this.element.classList.contains(\"dropzone\") && !this.element.querySelector(\".dz-message\")) {\n        this.element.appendChild(Dropzone.createElement(\"<div class=\\\"dz-default dz-message\\\"><span>\" + this.options.dictDefaultMessage + \"</span></div>\"));\n      }\n      if (this.clickableElements.length) {\n        setupHiddenFileInput = (function(_this) {\n          return function() {\n            if (_this.hiddenFileInput) {\n              _this.hiddenFileInput.parentNode.removeChild(_this.hiddenFileInput);\n            }\n            _this.hiddenFileInput = document.createElement(\"input\");\n            _this.hiddenFileInput.setAttribute(\"type\", \"file\");\n            if ((_this.options.maxFiles == null) || _this.options.maxFiles > 1) {\n              _this.hiddenFileInput.setAttribute(\"multiple\", \"multiple\");\n            }\n            _this.hiddenFileInput.className = \"dz-hidden-input\";\n            if (_this.options.acceptedFiles != null) {\n              _this.hiddenFileInput.setAttribute(\"accept\", _this.options.acceptedFiles);\n            }\n            if (_this.options.capture != null) {\n              _this.hiddenFileInput.setAttribute(\"capture\", _this.options.capture);\n            }\n            _this.hiddenFileInput.style.visibility = \"hidden\";\n            _this.hiddenFileInput.style.position = \"absolute\";\n            _this.hiddenFileInput.style.top = \"0\";\n            _this.hiddenFileInput.style.left = \"0\";\n            _this.hiddenFileInput.style.height = \"0\";\n            _this.hiddenFileInput.style.width = \"0\";\n            document.querySelector(_this.options.hiddenInputContainer).appendChild(_this.hiddenFileInput);\n            return _this.hiddenFileInput.addEventListener(\"change\", function() {\n              var file, files, _i, _len;\n              files = _this.hiddenFileInput.files;\n              if (files.length) {\n                for (_i = 0, _len = files.length; _i < _len; _i++) {\n                  file = files[_i];\n                  _this.addFile(file);\n                }\n              }\n              _this.emit(\"addedfiles\", files);\n              return setupHiddenFileInput();\n            });\n          };\n        })(this);\n        setupHiddenFileInput();\n      }\n      this.URL = (_ref = window.URL) != null ? _ref : window.webkitURL;\n      _ref1 = this.events;\n      for (_i = 0, _len = _ref1.length; _i < _len; _i++) {\n        eventName = _ref1[_i];\n        this.on(eventName, this.options[eventName]);\n      }\n      this.on(\"uploadprogress\", (function(_this) {\n        return function() {\n          return _this.updateTotalUploadProgress();\n        };\n      })(this));\n      this.on(\"removedfile\", (function(_this) {\n        return function() {\n          return _this.updateTotalUploadProgress();\n        };\n      })(this));\n      this.on(\"canceled\", (function(_this) {\n        return function(file) {\n          return _this.emit(\"complete\", file);\n        };\n      })(this));\n      this.on(\"complete\", (function(_this) {\n        return function(file) {\n          if (_this.getAddedFiles().length === 0 && _this.getUploadingFiles().length === 0 && _this.getQueuedFiles().length === 0) {\n            return setTimeout((function() {\n              return _this.emit(\"queuecomplete\");\n            }), 0);\n          }\n        };\n      })(this));\n      noPropagation = function(e) {\n        e.stopPropagation();\n        if (e.preventDefault) {\n          return e.preventDefault();\n        } else {\n          return e.returnValue = false;\n        }\n      };\n      this.listeners = [\n        {\n          element: this.element,\n          events: {\n            \"dragstart\": (function(_this) {\n              return function(e) {\n                return _this.emit(\"dragstart\", e);\n              };\n            })(this),\n            \"dragenter\": (function(_this) {\n              return function(e) {\n                noPropagation(e);\n                return _this.emit(\"dragenter\", e);\n              };\n            })(this),\n            \"dragover\": (function(_this) {\n              return function(e) {\n                var efct;\n                try {\n                  efct = e.dataTransfer.effectAllowed;\n                } catch (_error) {}\n                e.dataTransfer.dropEffect = 'move' === efct || 'linkMove' === efct ? 'move' : 'copy';\n                noPropagation(e);\n                return _this.emit(\"dragover\", e);\n              };\n            })(this),\n            \"dragleave\": (function(_this) {\n              return function(e) {\n                return _this.emit(\"dragleave\", e);\n              };\n            })(this),\n            \"drop\": (function(_this) {\n              return function(e) {\n                noPropagation(e);\n                return _this.drop(e);\n              };\n            })(this),\n            \"dragend\": (function(_this) {\n              return function(e) {\n                return _this.emit(\"dragend\", e);\n              };\n            })(this)\n          }\n        }\n      ];\n      this.clickableElements.forEach((function(_this) {\n        return function(clickableElement) {\n          return _this.listeners.push({\n            element: clickableElement,\n            events: {\n              \"click\": function(evt) {\n                if ((clickableElement !== _this.element) || (evt.target === _this.element || Dropzone.elementInside(evt.target, _this.element.querySelector(\".dz-message\")))) {\n                  _this.hiddenFileInput.click();\n                }\n                return true;\n              }\n            }\n          });\n        };\n      })(this));\n      this.enable();\n      return this.options.init.call(this);\n    };\n\n    Dropzone.prototype.destroy = function() {\n      var _ref;\n      this.disable();\n      this.removeAllFiles(true);\n      if ((_ref = this.hiddenFileInput) != null ? _ref.parentNode : void 0) {\n        this.hiddenFileInput.parentNode.removeChild(this.hiddenFileInput);\n        this.hiddenFileInput = null;\n      }\n      delete this.element.dropzone;\n      return Dropzone.instances.splice(Dropzone.instances.indexOf(this), 1);\n    };\n\n    Dropzone.prototype.updateTotalUploadProgress = function() {\n      var activeFiles, file, totalBytes, totalBytesSent, totalUploadProgress, _i, _len, _ref;\n      totalBytesSent = 0;\n      totalBytes = 0;\n      activeFiles = this.getActiveFiles();\n      if (activeFiles.length) {\n        _ref = this.getActiveFiles();\n        for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n          file = _ref[_i];\n          totalBytesSent += file.upload.bytesSent;\n          totalBytes += file.upload.total;\n        }\n        totalUploadProgress = 100 * totalBytesSent / totalBytes;\n      } else {\n        totalUploadProgress = 100;\n      }\n      return this.emit(\"totaluploadprogress\", totalUploadProgress, totalBytes, totalBytesSent);\n    };\n\n    Dropzone.prototype._getParamName = function(n) {\n      if (typeof this.options.paramName === \"function\") {\n        return this.options.paramName(n);\n      } else {\n        return \"\" + this.options.paramName + (this.options.uploadMultiple ? \"[\" + n + \"]\" : \"\");\n      }\n    };\n\n    Dropzone.prototype._renameFilename = function(name) {\n      if (typeof this.options.renameFilename !== \"function\") {\n        return name;\n      }\n      return this.options.renameFilename(name);\n    };\n\n    Dropzone.prototype.getFallbackForm = function() {\n      var existingFallback, fields, fieldsString, form;\n      if (existingFallback = this.getExistingFallback()) {\n        return existingFallback;\n      }\n      fieldsString = \"<div class=\\\"dz-fallback\\\">\";\n      if (this.options.dictFallbackText) {\n        fieldsString += \"<p>\" + this.options.dictFallbackText + \"</p>\";\n      }\n      fieldsString += \"<input type=\\\"file\\\" name=\\\"\" + (this._getParamName(0)) + \"\\\" \" + (this.options.uploadMultiple ? 'multiple=\"multiple\"' : void 0) + \" /><input type=\\\"submit\\\" value=\\\"Upload!\\\"></div>\";\n      fields = Dropzone.createElement(fieldsString);\n      if (this.element.tagName !== \"FORM\") {\n        form = Dropzone.createElement(\"<form action=\\\"\" + this.options.url + \"\\\" enctype=\\\"multipart/form-data\\\" method=\\\"\" + this.options.method + \"\\\"></form>\");\n        form.appendChild(fields);\n      } else {\n        this.element.setAttribute(\"enctype\", \"multipart/form-data\");\n        this.element.setAttribute(\"method\", this.options.method);\n      }\n      return form != null ? form : fields;\n    };\n\n    Dropzone.prototype.getExistingFallback = function() {\n      var fallback, getFallback, tagName, _i, _len, _ref;\n      getFallback = function(elements) {\n        var el, _i, _len;\n        for (_i = 0, _len = elements.length; _i < _len; _i++) {\n          el = elements[_i];\n          if (/(^| )fallback($| )/.test(el.className)) {\n            return el;\n          }\n        }\n      };\n      _ref = [\"div\", \"form\"];\n      for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n        tagName = _ref[_i];\n        if (fallback = getFallback(this.element.getElementsByTagName(tagName))) {\n          return fallback;\n        }\n      }\n    };\n\n    Dropzone.prototype.setupEventListeners = function() {\n      var elementListeners, event, listener, _i, _len, _ref, _results;\n      _ref = this.listeners;\n      _results = [];\n      for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n        elementListeners = _ref[_i];\n        _results.push((function() {\n          var _ref1, _results1;\n          _ref1 = elementListeners.events;\n          _results1 = [];\n          for (event in _ref1) {\n            listener = _ref1[event];\n            _results1.push(elementListeners.element.addEventListener(event, listener, false));\n          }\n          return _results1;\n        })());\n      }\n      return _results;\n    };\n\n    Dropzone.prototype.removeEventListeners = function() {\n      var elementListeners, event, listener, _i, _len, _ref, _results;\n      _ref = this.listeners;\n      _results = [];\n      for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n        elementListeners = _ref[_i];\n        _results.push((function() {\n          var _ref1, _results1;\n          _ref1 = elementListeners.events;\n          _results1 = [];\n          for (event in _ref1) {\n            listener = _ref1[event];\n            _results1.push(elementListeners.element.removeEventListener(event, listener, false));\n          }\n          return _results1;\n        })());\n      }\n      return _results;\n    };\n\n    Dropzone.prototype.disable = function() {\n      var file, _i, _len, _ref, _results;\n      this.clickableElements.forEach(function(element) {\n        return element.classList.remove(\"dz-clickable\");\n      });\n      this.removeEventListeners();\n      _ref = this.files;\n      _results = [];\n      for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n        file = _ref[_i];\n        _results.push(this.cancelUpload(file));\n      }\n      return _results;\n    };\n\n    Dropzone.prototype.enable = function() {\n      this.clickableElements.forEach(function(element) {\n        return element.classList.add(\"dz-clickable\");\n      });\n      return this.setupEventListeners();\n    };\n\n    Dropzone.prototype.filesize = function(size) {\n      var cutoff, i, selectedSize, selectedUnit, unit, units, _i, _len;\n      selectedSize = 0;\n      selectedUnit = \"b\";\n      if (size > 0) {\n        units = ['TB', 'GB', 'MB', 'KB', 'b'];\n        for (i = _i = 0, _len = units.length; _i < _len; i = ++_i) {\n          unit = units[i];\n          cutoff = Math.pow(this.options.filesizeBase, 4 - i) / 10;\n          if (size >= cutoff) {\n            selectedSize = size / Math.pow(this.options.filesizeBase, 4 - i);\n            selectedUnit = unit;\n            break;\n          }\n        }\n        selectedSize = Math.round(10 * selectedSize) / 10;\n      }\n      return \"<strong>\" + selectedSize + \"</strong> \" + selectedUnit;\n    };\n\n    Dropzone.prototype._updateMaxFilesReachedClass = function() {\n      if ((this.options.maxFiles != null) && this.getAcceptedFiles().length >= this.options.maxFiles) {\n        if (this.getAcceptedFiles().length === this.options.maxFiles) {\n          this.emit('maxfilesreached', this.files);\n        }\n        return this.element.classList.add(\"dz-max-files-reached\");\n      } else {\n        return this.element.classList.remove(\"dz-max-files-reached\");\n      }\n    };\n\n    Dropzone.prototype.drop = function(e) {\n      var files, items;\n      if (!e.dataTransfer) {\n        return;\n      }\n      this.emit(\"drop\", e);\n      files = e.dataTransfer.files;\n      this.emit(\"addedfiles\", files);\n      if (files.length) {\n        items = e.dataTransfer.items;\n        if (items && items.length && (items[0].webkitGetAsEntry != null)) {\n          this._addFilesFromItems(items);\n        } else {\n          this.handleFiles(files);\n        }\n      }\n    };\n\n    Dropzone.prototype.paste = function(e) {\n      var items, _ref;\n      if ((e != null ? (_ref = e.clipboardData) != null ? _ref.items : void 0 : void 0) == null) {\n        return;\n      }\n      this.emit(\"paste\", e);\n      items = e.clipboardData.items;\n      if (items.length) {\n        return this._addFilesFromItems(items);\n      }\n    };\n\n    Dropzone.prototype.handleFiles = function(files) {\n      var file, _i, _len, _results;\n      _results = [];\n      for (_i = 0, _len = files.length; _i < _len; _i++) {\n        file = files[_i];\n        _results.push(this.addFile(file));\n      }\n      return _results;\n    };\n\n    Dropzone.prototype._addFilesFromItems = function(items) {\n      var entry, item, _i, _len, _results;\n      _results = [];\n      for (_i = 0, _len = items.length; _i < _len; _i++) {\n        item = items[_i];\n        if ((item.webkitGetAsEntry != null) && (entry = item.webkitGetAsEntry())) {\n          if (entry.isFile) {\n            _results.push(this.addFile(item.getAsFile()));\n          } else if (entry.isDirectory) {\n            _results.push(this._addFilesFromDirectory(entry, entry.name));\n          } else {\n            _results.push(void 0);\n          }\n        } else if (item.getAsFile != null) {\n          if ((item.kind == null) || item.kind === \"file\") {\n            _results.push(this.addFile(item.getAsFile()));\n          } else {\n            _results.push(void 0);\n          }\n        } else {\n          _results.push(void 0);\n        }\n      }\n      return _results;\n    };\n\n    Dropzone.prototype._addFilesFromDirectory = function(directory, path) {\n      var dirReader, errorHandler, readEntries;\n      dirReader = directory.createReader();\n      errorHandler = function(error) {\n        return typeof console !== \"undefined\" && console !== null ? typeof console.log === \"function\" ? console.log(error) : void 0 : void 0;\n      };\n      readEntries = (function(_this) {\n        return function() {\n          return dirReader.readEntries(function(entries) {\n            var entry, _i, _len;\n            if (entries.length > 0) {\n              for (_i = 0, _len = entries.length; _i < _len; _i++) {\n                entry = entries[_i];\n                if (entry.isFile) {\n                  entry.file(function(file) {\n                    if (_this.options.ignoreHiddenFiles && file.name.substring(0, 1) === '.') {\n                      return;\n                    }\n                    file.fullPath = \"\" + path + \"/\" + file.name;\n                    return _this.addFile(file);\n                  });\n                } else if (entry.isDirectory) {\n                  _this._addFilesFromDirectory(entry, \"\" + path + \"/\" + entry.name);\n                }\n              }\n              readEntries();\n            }\n            return null;\n          }, errorHandler);\n        };\n      })(this);\n      return readEntries();\n    };\n\n    Dropzone.prototype.accept = function(file, done) {\n      if (file.size > this.options.maxFilesize * 1024 * 1024) {\n        return done(this.options.dictFileTooBig.replace(\"{{filesize}}\", Math.round(file.size / 1024 / 10.24) / 100).replace(\"{{maxFilesize}}\", this.options.maxFilesize));\n      } else if (!Dropzone.isValidFile(file, this.options.acceptedFiles)) {\n        return done(this.options.dictInvalidFileType);\n      } else if ((this.options.maxFiles != null) && this.getAcceptedFiles().length >= this.options.maxFiles) {\n        done(this.options.dictMaxFilesExceeded.replace(\"{{maxFiles}}\", this.options.maxFiles));\n        return this.emit(\"maxfilesexceeded\", file);\n      } else {\n        return this.options.accept.call(this, file, done);\n      }\n    };\n\n    Dropzone.prototype.addFile = function(file) {\n      file.upload = {\n        progress: 0,\n        total: file.size,\n        bytesSent: 0\n      };\n      this.files.push(file);\n      file.status = Dropzone.ADDED;\n      this.emit(\"addedfile\", file);\n      this._enqueueThumbnail(file);\n      return this.accept(file, (function(_this) {\n        return function(error) {\n          if (error) {\n            file.accepted = false;\n            _this._errorProcessing([file], error);\n          } else {\n            file.accepted = true;\n            if (_this.options.autoQueue) {\n              _this.enqueueFile(file);\n            }\n          }\n          return _this._updateMaxFilesReachedClass();\n        };\n      })(this));\n    };\n\n    Dropzone.prototype.enqueueFiles = function(files) {\n      var file, _i, _len;\n      for (_i = 0, _len = files.length; _i < _len; _i++) {\n        file = files[_i];\n        this.enqueueFile(file);\n      }\n      return null;\n    };\n\n    Dropzone.prototype.enqueueFile = function(file) {\n      if (file.status === Dropzone.ADDED && file.accepted === true) {\n        file.status = Dropzone.QUEUED;\n        if (this.options.autoProcessQueue) {\n          return setTimeout(((function(_this) {\n            return function() {\n              return _this.processQueue();\n            };\n          })(this)), 0);\n        }\n      } else {\n        throw new Error(\"This file can't be queued because it has already been processed or was rejected.\");\n      }\n    };\n\n    Dropzone.prototype._thumbnailQueue = [];\n\n    Dropzone.prototype._processingThumbnail = false;\n\n    Dropzone.prototype._enqueueThumbnail = function(file) {\n      if (this.options.createImageThumbnails && file.type.match(/image.*/) && file.size <= this.options.maxThumbnailFilesize * 1024 * 1024) {\n        this._thumbnailQueue.push(file);\n        return setTimeout(((function(_this) {\n          return function() {\n            return _this._processThumbnailQueue();\n          };\n        })(this)), 0);\n      }\n    };\n\n    Dropzone.prototype._processThumbnailQueue = function() {\n      if (this._processingThumbnail || this._thumbnailQueue.length === 0) {\n        return;\n      }\n      this._processingThumbnail = true;\n      return this.createThumbnail(this._thumbnailQueue.shift(), (function(_this) {\n        return function() {\n          _this._processingThumbnail = false;\n          return _this._processThumbnailQueue();\n        };\n      })(this));\n    };\n\n    Dropzone.prototype.removeFile = function(file) {\n      if (file.status === Dropzone.UPLOADING) {\n        this.cancelUpload(file);\n      }\n      this.files = without(this.files, file);\n      this.emit(\"removedfile\", file);\n      if (this.files.length === 0) {\n        return this.emit(\"reset\");\n      }\n    };\n\n    Dropzone.prototype.removeAllFiles = function(cancelIfNecessary) {\n      var file, _i, _len, _ref;\n      if (cancelIfNecessary == null) {\n        cancelIfNecessary = false;\n      }\n      _ref = this.files.slice();\n      for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n        file = _ref[_i];\n        if (file.status !== Dropzone.UPLOADING || cancelIfNecessary) {\n          this.removeFile(file);\n        }\n      }\n      return null;\n    };\n\n    Dropzone.prototype.createThumbnail = function(file, callback) {\n      var fileReader;\n      fileReader = new FileReader;\n      fileReader.onload = (function(_this) {\n        return function() {\n          if (file.type === \"image/svg+xml\") {\n            _this.emit(\"thumbnail\", file, fileReader.result);\n            if (callback != null) {\n              callback();\n            }\n            return;\n          }\n          return _this.createThumbnailFromUrl(file, fileReader.result, callback);\n        };\n      })(this);\n      return fileReader.readAsDataURL(file);\n    };\n\n    Dropzone.prototype.createThumbnailFromUrl = function(file, imageUrl, callback, crossOrigin) {\n      var img;\n      img = document.createElement(\"img\");\n      if (crossOrigin) {\n        img.crossOrigin = crossOrigin;\n      }\n      img.onload = (function(_this) {\n        return function() {\n          var canvas, ctx, resizeInfo, thumbnail, _ref, _ref1, _ref2, _ref3;\n          file.width = img.width;\n          file.height = img.height;\n          resizeInfo = _this.options.resize.call(_this, file);\n          if (resizeInfo.trgWidth == null) {\n            resizeInfo.trgWidth = resizeInfo.optWidth;\n          }\n          if (resizeInfo.trgHeight == null) {\n            resizeInfo.trgHeight = resizeInfo.optHeight;\n          }\n          canvas = document.createElement(\"canvas\");\n          ctx = canvas.getContext(\"2d\");\n          canvas.width = resizeInfo.trgWidth;\n          canvas.height = resizeInfo.trgHeight;\n          drawImageIOSFix(ctx, img, (_ref = resizeInfo.srcX) != null ? _ref : 0, (_ref1 = resizeInfo.srcY) != null ? _ref1 : 0, resizeInfo.srcWidth, resizeInfo.srcHeight, (_ref2 = resizeInfo.trgX) != null ? _ref2 : 0, (_ref3 = resizeInfo.trgY) != null ? _ref3 : 0, resizeInfo.trgWidth, resizeInfo.trgHeight);\n          thumbnail = canvas.toDataURL(\"image/png\");\n          _this.emit(\"thumbnail\", file, thumbnail);\n          if (callback != null) {\n            return callback();\n          }\n        };\n      })(this);\n      if (callback != null) {\n        img.onerror = callback;\n      }\n      return img.src = imageUrl;\n    };\n\n    Dropzone.prototype.processQueue = function() {\n      var i, parallelUploads, processingLength, queuedFiles;\n      parallelUploads = this.options.parallelUploads;\n      processingLength = this.getUploadingFiles().length;\n      i = processingLength;\n      if (processingLength >= parallelUploads) {\n        return;\n      }\n      queuedFiles = this.getQueuedFiles();\n      if (!(queuedFiles.length > 0)) {\n        return;\n      }\n      if (this.options.uploadMultiple) {\n        return this.processFiles(queuedFiles.slice(0, parallelUploads - processingLength));\n      } else {\n        while (i < parallelUploads) {\n          if (!queuedFiles.length) {\n            return;\n          }\n          this.processFile(queuedFiles.shift());\n          i++;\n        }\n      }\n    };\n\n    Dropzone.prototype.processFile = function(file) {\n      return this.processFiles([file]);\n    };\n\n    Dropzone.prototype.processFiles = function(files) {\n      var file, _i, _len;\n      for (_i = 0, _len = files.length; _i < _len; _i++) {\n        file = files[_i];\n        file.processing = true;\n        file.status = Dropzone.UPLOADING;\n        this.emit(\"processing\", file);\n      }\n      if (this.options.uploadMultiple) {\n        this.emit(\"processingmultiple\", files);\n      }\n      return this.uploadFiles(files);\n    };\n\n    Dropzone.prototype._getFilesWithXhr = function(xhr) {\n      var file, files;\n      return files = (function() {\n        var _i, _len, _ref, _results;\n        _ref = this.files;\n        _results = [];\n        for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n          file = _ref[_i];\n          if (file.xhr === xhr) {\n            _results.push(file);\n          }\n        }\n        return _results;\n      }).call(this);\n    };\n\n    Dropzone.prototype.cancelUpload = function(file) {\n      var groupedFile, groupedFiles, _i, _j, _len, _len1, _ref;\n      if (file.status === Dropzone.UPLOADING) {\n        groupedFiles = this._getFilesWithXhr(file.xhr);\n        for (_i = 0, _len = groupedFiles.length; _i < _len; _i++) {\n          groupedFile = groupedFiles[_i];\n          groupedFile.status = Dropzone.CANCELED;\n        }\n        file.xhr.abort();\n        for (_j = 0, _len1 = groupedFiles.length; _j < _len1; _j++) {\n          groupedFile = groupedFiles[_j];\n          this.emit(\"canceled\", groupedFile);\n        }\n        if (this.options.uploadMultiple) {\n          this.emit(\"canceledmultiple\", groupedFiles);\n        }\n      } else if ((_ref = file.status) === Dropzone.ADDED || _ref === Dropzone.QUEUED) {\n        file.status = Dropzone.CANCELED;\n        this.emit(\"canceled\", file);\n        if (this.options.uploadMultiple) {\n          this.emit(\"canceledmultiple\", [file]);\n        }\n      }\n      if (this.options.autoProcessQueue) {\n        return this.processQueue();\n      }\n    };\n\n    resolveOption = function() {\n      var args, option;\n      option = arguments[0], args = 2 <= arguments.length ? __slice.call(arguments, 1) : [];\n      if (typeof option === 'function') {\n        return option.apply(this, args);\n      }\n      return option;\n    };\n\n    Dropzone.prototype.uploadFile = function(file) {\n      return this.uploadFiles([file]);\n    };\n\n    Dropzone.prototype.uploadFiles = function(files) {\n      var file, formData, handleError, headerName, headerValue, headers, i, input, inputName, inputType, key, method, option, progressObj, response, updateProgress, url, value, xhr, _i, _j, _k, _l, _len, _len1, _len2, _len3, _m, _ref, _ref1, _ref2, _ref3, _ref4, _ref5;\n      xhr = new XMLHttpRequest();\n      for (_i = 0, _len = files.length; _i < _len; _i++) {\n        file = files[_i];\n        file.xhr = xhr;\n      }\n      method = resolveOption(this.options.method, files);\n      url = resolveOption(this.options.url, files);\n      xhr.open(method, url, true);\n      xhr.withCredentials = !!this.options.withCredentials;\n      response = null;\n      handleError = (function(_this) {\n        return function() {\n          var _j, _len1, _results;\n          _results = [];\n          for (_j = 0, _len1 = files.length; _j < _len1; _j++) {\n            file = files[_j];\n            _results.push(_this._errorProcessing(files, response || _this.options.dictResponseError.replace(\"{{statusCode}}\", xhr.status), xhr));\n          }\n          return _results;\n        };\n      })(this);\n      updateProgress = (function(_this) {\n        return function(e) {\n          var allFilesFinished, progress, _j, _k, _l, _len1, _len2, _len3, _results;\n          if (e != null) {\n            progress = 100 * e.loaded / e.total;\n            for (_j = 0, _len1 = files.length; _j < _len1; _j++) {\n              file = files[_j];\n              file.upload = {\n                progress: progress,\n                total: e.total,\n                bytesSent: e.loaded\n              };\n            }\n          } else {\n            allFilesFinished = true;\n            progress = 100;\n            for (_k = 0, _len2 = files.length; _k < _len2; _k++) {\n              file = files[_k];\n              if (!(file.upload.progress === 100 && file.upload.bytesSent === file.upload.total)) {\n                allFilesFinished = false;\n              }\n              file.upload.progress = progress;\n              file.upload.bytesSent = file.upload.total;\n            }\n            if (allFilesFinished) {\n              return;\n            }\n          }\n          _results = [];\n          for (_l = 0, _len3 = files.length; _l < _len3; _l++) {\n            file = files[_l];\n            _results.push(_this.emit(\"uploadprogress\", file, progress, file.upload.bytesSent));\n          }\n          return _results;\n        };\n      })(this);\n      xhr.onload = (function(_this) {\n        return function(e) {\n          var _ref;\n          if (files[0].status === Dropzone.CANCELED) {\n            return;\n          }\n          if (xhr.readyState !== 4) {\n            return;\n          }\n          response = xhr.responseText;\n          if (xhr.getResponseHeader(\"content-type\") && ~xhr.getResponseHeader(\"content-type\").indexOf(\"application/json\")) {\n            try {\n              response = JSON.parse(response);\n            } catch (_error) {\n              e = _error;\n              response = \"Invalid JSON response from server.\";\n            }\n          }\n          updateProgress();\n          if (!((200 <= (_ref = xhr.status) && _ref < 300))) {\n            return handleError();\n          } else {\n            return _this._finished(files, response, e);\n          }\n        };\n      })(this);\n      xhr.onerror = (function(_this) {\n        return function() {\n          if (files[0].status === Dropzone.CANCELED) {\n            return;\n          }\n          return handleError();\n        };\n      })(this);\n      progressObj = (_ref = xhr.upload) != null ? _ref : xhr;\n      progressObj.onprogress = updateProgress;\n      headers = {\n        \"Accept\": \"application/json\",\n        \"Cache-Control\": \"no-cache\",\n        \"X-Requested-With\": \"XMLHttpRequest\"\n      };\n      if (this.options.headers) {\n        extend(headers, this.options.headers);\n      }\n      for (headerName in headers) {\n        headerValue = headers[headerName];\n        if (headerValue) {\n          xhr.setRequestHeader(headerName, headerValue);\n        }\n      }\n      formData = new FormData();\n      if (this.options.params) {\n        _ref1 = this.options.params;\n        for (key in _ref1) {\n          value = _ref1[key];\n          formData.append(key, value);\n        }\n      }\n      for (_j = 0, _len1 = files.length; _j < _len1; _j++) {\n        file = files[_j];\n        this.emit(\"sending\", file, xhr, formData);\n      }\n      if (this.options.uploadMultiple) {\n        this.emit(\"sendingmultiple\", files, xhr, formData);\n      }\n      if (this.element.tagName === \"FORM\") {\n        _ref2 = this.element.querySelectorAll(\"input, textarea, select, button\");\n        for (_k = 0, _len2 = _ref2.length; _k < _len2; _k++) {\n          input = _ref2[_k];\n          inputName = input.getAttribute(\"name\");\n          inputType = input.getAttribute(\"type\");\n          if (input.tagName === \"SELECT\" && input.hasAttribute(\"multiple\")) {\n            _ref3 = input.options;\n            for (_l = 0, _len3 = _ref3.length; _l < _len3; _l++) {\n              option = _ref3[_l];\n              if (option.selected) {\n                formData.append(inputName, option.value);\n              }\n            }\n          } else if (!inputType || ((_ref4 = inputType.toLowerCase()) !== \"checkbox\" && _ref4 !== \"radio\") || input.checked) {\n            formData.append(inputName, input.value);\n          }\n        }\n      }\n      for (i = _m = 0, _ref5 = files.length - 1; 0 <= _ref5 ? _m <= _ref5 : _m >= _ref5; i = 0 <= _ref5 ? ++_m : --_m) {\n        formData.append(this._getParamName(i), files[i], this._renameFilename(files[i].name));\n      }\n      return this.submitRequest(xhr, formData, files);\n    };\n\n    Dropzone.prototype.submitRequest = function(xhr, formData, files) {\n      return xhr.send(formData);\n    };\n\n    Dropzone.prototype._finished = function(files, responseText, e) {\n      var file, _i, _len;\n      for (_i = 0, _len = files.length; _i < _len; _i++) {\n        file = files[_i];\n        file.status = Dropzone.SUCCESS;\n        this.emit(\"success\", file, responseText, e);\n        this.emit(\"complete\", file);\n      }\n      if (this.options.uploadMultiple) {\n        this.emit(\"successmultiple\", files, responseText, e);\n        this.emit(\"completemultiple\", files);\n      }\n      if (this.options.autoProcessQueue) {\n        return this.processQueue();\n      }\n    };\n\n    Dropzone.prototype._errorProcessing = function(files, message, xhr) {\n      var file, _i, _len;\n      for (_i = 0, _len = files.length; _i < _len; _i++) {\n        file = files[_i];\n        file.status = Dropzone.ERROR;\n        this.emit(\"error\", file, message, xhr);\n        this.emit(\"complete\", file);\n      }\n      if (this.options.uploadMultiple) {\n        this.emit(\"errormultiple\", files, message, xhr);\n        this.emit(\"completemultiple\", files);\n      }\n      if (this.options.autoProcessQueue) {\n        return this.processQueue();\n      }\n    };\n\n    return Dropzone;\n\n  })(Emitter);\n\n  Dropzone.version = \"4.3.0\";\n\n  Dropzone.options = {};\n\n  Dropzone.optionsForElement = function(element) {\n    if (element.getAttribute(\"id\")) {\n      return Dropzone.options[camelize(element.getAttribute(\"id\"))];\n    } else {\n      return void 0;\n    }\n  };\n\n  Dropzone.instances = [];\n\n  Dropzone.forElement = function(element) {\n    if (typeof element === \"string\") {\n      element = document.querySelector(element);\n    }\n    if ((element != null ? element.dropzone : void 0) == null) {\n      throw new Error(\"No Dropzone found for given element. This is probably because you're trying to access it before Dropzone had the time to initialize. Use the `init` option to setup any additional observers on your Dropzone.\");\n    }\n    return element.dropzone;\n  };\n\n  Dropzone.autoDiscover = true;\n\n  Dropzone.discover = function() {\n    var checkElements, dropzone, dropzones, _i, _len, _results;\n    if (document.querySelectorAll) {\n      dropzones = document.querySelectorAll(\".dropzone\");\n    } else {\n      dropzones = [];\n      checkElements = function(elements) {\n        var el, _i, _len, _results;\n        _results = [];\n        for (_i = 0, _len = elements.length; _i < _len; _i++) {\n          el = elements[_i];\n          if (/(^| )dropzone($| )/.test(el.className)) {\n            _results.push(dropzones.push(el));\n          } else {\n            _results.push(void 0);\n          }\n        }\n        return _results;\n      };\n      checkElements(document.getElementsByTagName(\"div\"));\n      checkElements(document.getElementsByTagName(\"form\"));\n    }\n    _results = [];\n    for (_i = 0, _len = dropzones.length; _i < _len; _i++) {\n      dropzone = dropzones[_i];\n      if (Dropzone.optionsForElement(dropzone) !== false) {\n        _results.push(new Dropzone(dropzone));\n      } else {\n        _results.push(void 0);\n      }\n    }\n    return _results;\n  };\n\n  Dropzone.blacklistedBrowsers = [/opera.*Macintosh.*version\\/12/i];\n\n  Dropzone.isBrowserSupported = function() {\n    var capableBrowser, regex, _i, _len, _ref;\n    capableBrowser = true;\n    if (window.File && window.FileReader && window.FileList && window.Blob && window.FormData && document.querySelector) {\n      if (!(\"classList\" in document.createElement(\"a\"))) {\n        capableBrowser = false;\n      } else {\n        _ref = Dropzone.blacklistedBrowsers;\n        for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n          regex = _ref[_i];\n          if (regex.test(navigator.userAgent)) {\n            capableBrowser = false;\n            continue;\n          }\n        }\n      }\n    } else {\n      capableBrowser = false;\n    }\n    return capableBrowser;\n  };\n\n  without = function(list, rejectedItem) {\n    var item, _i, _len, _results;\n    _results = [];\n    for (_i = 0, _len = list.length; _i < _len; _i++) {\n      item = list[_i];\n      if (item !== rejectedItem) {\n        _results.push(item);\n      }\n    }\n    return _results;\n  };\n\n  camelize = function(str) {\n    return str.replace(/[\\-_](\\w)/g, function(match) {\n      return match.charAt(1).toUpperCase();\n    });\n  };\n\n  Dropzone.createElement = function(string) {\n    var div;\n    div = document.createElement(\"div\");\n    div.innerHTML = string;\n    return div.childNodes[0];\n  };\n\n  Dropzone.elementInside = function(element, container) {\n    if (element === container) {\n      return true;\n    }\n    while (element = element.parentNode) {\n      if (element === container) {\n        return true;\n      }\n    }\n    return false;\n  };\n\n  Dropzone.getElement = function(el, name) {\n    var element;\n    if (typeof el === \"string\") {\n      element = document.querySelector(el);\n    } else if (el.nodeType != null) {\n      element = el;\n    }\n    if (element == null) {\n      throw new Error(\"Invalid `\" + name + \"` option provided. Please provide a CSS selector or a plain HTML element.\");\n    }\n    return element;\n  };\n\n  Dropzone.getElements = function(els, name) {\n    var e, el, elements, _i, _j, _len, _len1, _ref;\n    if (els instanceof Array) {\n      elements = [];\n      try {\n        for (_i = 0, _len = els.length; _i < _len; _i++) {\n          el = els[_i];\n          elements.push(this.getElement(el, name));\n        }\n      } catch (_error) {\n        e = _error;\n        elements = null;\n      }\n    } else if (typeof els === \"string\") {\n      elements = [];\n      _ref = document.querySelectorAll(els);\n      for (_j = 0, _len1 = _ref.length; _j < _len1; _j++) {\n        el = _ref[_j];\n        elements.push(el);\n      }\n    } else if (els.nodeType != null) {\n      elements = [els];\n    }\n    if (!((elements != null) && elements.length)) {\n      throw new Error(\"Invalid `\" + name + \"` option provided. Please provide a CSS selector, a plain HTML element or a list of those.\");\n    }\n    return elements;\n  };\n\n  Dropzone.confirm = function(question, accepted, rejected) {\n    if (window.confirm(question)) {\n      return accepted();\n    } else if (rejected != null) {\n      return rejected();\n    }\n  };\n\n  Dropzone.isValidFile = function(file, acceptedFiles) {\n    var baseMimeType, mimeType, validType, _i, _len;\n    if (!acceptedFiles) {\n      return true;\n    }\n    acceptedFiles = acceptedFiles.split(\",\");\n    mimeType = file.type;\n    baseMimeType = mimeType.replace(/\\/.*$/, \"\");\n    for (_i = 0, _len = acceptedFiles.length; _i < _len; _i++) {\n      validType = acceptedFiles[_i];\n      validType = validType.trim();\n      if (validType.charAt(0) === \".\") {\n        if (file.name.toLowerCase().indexOf(validType.toLowerCase(), file.name.length - validType.length) !== -1) {\n          return true;\n        }\n      } else if (/\\/\\*$/.test(validType)) {\n        if (baseMimeType === validType.replace(/\\/.*$/, \"\")) {\n          return true;\n        }\n      } else {\n        if (mimeType === validType) {\n          return true;\n        }\n      }\n    }\n    return false;\n  };\n\n  if (typeof jQuery !== \"undefined\" && jQuery !== null) {\n    jQuery.fn.dropzone = function(options) {\n      return this.each(function() {\n        return new Dropzone(this, options);\n      });\n    };\n  }\n\n  if (typeof module !== \"undefined\" && module !== null) {\n    module.exports = Dropzone;\n  } else {\n    window.Dropzone = Dropzone;\n  }\n\n  Dropzone.ADDED = \"added\";\n\n  Dropzone.QUEUED = \"queued\";\n\n  Dropzone.ACCEPTED = Dropzone.QUEUED;\n\n  Dropzone.UPLOADING = \"uploading\";\n\n  Dropzone.PROCESSING = Dropzone.UPLOADING;\n\n  Dropzone.CANCELED = \"canceled\";\n\n  Dropzone.ERROR = \"error\";\n\n  Dropzone.SUCCESS = \"success\";\n\n\n  /*\n  \n  Bugfix for iOS 6 and 7\n  Source: http://stackoverflow.com/questions/11929099/html5-canvas-drawimage-ratio-bug-ios\n  based on the work of https://github.com/stomita/ios-imagefile-megapixel\n   */\n\n  detectVerticalSquash = function(img) {\n    var alpha, canvas, ctx, data, ey, ih, iw, py, ratio, sy;\n    iw = img.naturalWidth;\n    ih = img.naturalHeight;\n    canvas = document.createElement(\"canvas\");\n    canvas.width = 1;\n    canvas.height = ih;\n    ctx = canvas.getContext(\"2d\");\n    ctx.drawImage(img, 0, 0);\n    data = ctx.getImageData(0, 0, 1, ih).data;\n    sy = 0;\n    ey = ih;\n    py = ih;\n    while (py > sy) {\n      alpha = data[(py - 1) * 4 + 3];\n      if (alpha === 0) {\n        ey = py;\n      } else {\n        sy = py;\n      }\n      py = (ey + sy) >> 1;\n    }\n    ratio = py / ih;\n    if (ratio === 0) {\n      return 1;\n    } else {\n      return ratio;\n    }\n  };\n\n  drawImageIOSFix = function(ctx, img, sx, sy, sw, sh, dx, dy, dw, dh) {\n    var vertSquashRatio;\n    vertSquashRatio = detectVerticalSquash(img);\n    return ctx.drawImage(img, sx, sy, sw, sh, dx, dy, dw, dh / vertSquashRatio);\n  };\n\n\n  /*\n   * contentloaded.js\n   *\n   * Author: Diego Perini (diego.perini at gmail.com)\n   * Summary: cross-browser wrapper for DOMContentLoaded\n   * Updated: 20101020\n   * License: MIT\n   * Version: 1.2\n   *\n   * URL:\n   * http://javascript.nwbox.com/ContentLoaded/\n   * http://javascript.nwbox.com/ContentLoaded/MIT-LICENSE\n   */\n\n  contentLoaded = function(win, fn) {\n    var add, doc, done, init, poll, pre, rem, root, top;\n    done = false;\n    top = true;\n    doc = win.document;\n    root = doc.documentElement;\n    add = (doc.addEventListener ? \"addEventListener\" : \"attachEvent\");\n    rem = (doc.addEventListener ? \"removeEventListener\" : \"detachEvent\");\n    pre = (doc.addEventListener ? \"\" : \"on\");\n    init = function(e) {\n      if (e.type === \"readystatechange\" && doc.readyState !== \"complete\") {\n        return;\n      }\n      (e.type === \"load\" ? win : doc)[rem](pre + e.type, init, false);\n      if (!done && (done = true)) {\n        return fn.call(win, e.type || e);\n      }\n    };\n    poll = function() {\n      var e;\n      try {\n        root.doScroll(\"left\");\n      } catch (_error) {\n        e = _error;\n        setTimeout(poll, 50);\n        return;\n      }\n      return init(\"poll\");\n    };\n    if (doc.readyState !== \"complete\") {\n      if (doc.createEventObject && root.doScroll) {\n        try {\n          top = !win.frameElement;\n        } catch (_error) {}\n        if (top) {\n          poll();\n        }\n      }\n      doc[add](pre + \"DOMContentLoaded\", init, false);\n      doc[add](pre + \"readystatechange\", init, false);\n      return win[add](pre + \"load\", init, false);\n    }\n  };\n\n  Dropzone._autoDiscoverFunction = function() {\n    if (Dropzone.autoDiscover) {\n      return Dropzone.discover();\n    }\n  };\n\n  contentLoaded(window, Dropzone._autoDiscoverFunction);\n\n}).call(this);","output":"str","x":430,"y":640,"wires":[["bd82dffc.7b793"]]},{"id":"6907902f.ebb6b","type":"http in","z":"c61d9d5f.52591","name":"","url":"/complex","method":"get","upload":false,"swaggerDoc":"","x":190,"y":640,"wires":[["ec6c3356.9f695"]]},{"id":"51c593aa.0b1f5c","type":"template","z":"c61d9d5f.52591","name":"html","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<script>\n    {{{dropzonejs}}}\n</script>\n<style>\n    {{{css}}}\n</style>\n\n<script>\n    // \"myAwesomeDropzone\" is the camelized version of the HTML element's ID\n    Dropzone.options.myDropzone = {\n      paramName: \"myFile\", // The name that will be used to transfer the file\n      maxFilesize: 250, // MB\n      accept: function(file, done) {\n        if (file.name == \"justinbieber.jpg\") {\n          done(\"Naha, you don't.\");\n        }\n        else { done(); }\n      }\n    };\n</script>\n\n<h1>Upload a file here:</h1>\n\n<form action=\"/uploadpretty\" class=\"dropzone\" method=\"post\" enctype=\"multipart/form-data\" id=\"my-dropzone\">\n  <div class=\"fallback\">\n    <input name=\"myFile\" type=\"file\" />\n    <input type=\"submit\" value=\"Submit\">\n  </div>\n</form>","output":"str","x":750,"y":640,"wires":[["3b82bc07.45c524"]]},{"id":"3b82bc07.45c524","type":"http response","z":"c61d9d5f.52591","name":"","x":910,"y":640,"wires":[]},{"id":"781c3c25.3e3104","type":"http response","z":"c61d9d5f.52591","name":"","statusCode":"","headers":{},"x":490,"y":240,"wires":[]},{"id":"bd82dffc.7b793","type":"template","z":"c61d9d5f.52591","name":"css","field":"css","fieldType":"msg","format":"css","syntax":"mustache","template":"/*\n * The MIT License\n * Copyright (c) 2012 Matias Meno <m@tias.me>\n */\n@-webkit-keyframes passing-through {\n  0% {\n    opacity: 0;\n    -webkit-transform: translateY(40px);\n    -moz-transform: translateY(40px);\n    -ms-transform: translateY(40px);\n    -o-transform: translateY(40px);\n    transform: translateY(40px); }\n  30%, 70% {\n    opacity: 1;\n    -webkit-transform: translateY(0px);\n    -moz-transform: translateY(0px);\n    -ms-transform: translateY(0px);\n    -o-transform: translateY(0px);\n    transform: translateY(0px); }\n  100% {\n    opacity: 0;\n    -webkit-transform: translateY(-40px);\n    -moz-transform: translateY(-40px);\n    -ms-transform: translateY(-40px);\n    -o-transform: translateY(-40px);\n    transform: translateY(-40px); } }\n@-moz-keyframes passing-through {\n  0% {\n    opacity: 0;\n    -webkit-transform: translateY(40px);\n    -moz-transform: translateY(40px);\n    -ms-transform: translateY(40px);\n    -o-transform: translateY(40px);\n    transform: translateY(40px); }\n  30%, 70% {\n    opacity: 1;\n    -webkit-transform: translateY(0px);\n    -moz-transform: translateY(0px);\n    -ms-transform: translateY(0px);\n    -o-transform: translateY(0px);\n    transform: translateY(0px); }\n  100% {\n    opacity: 0;\n    -webkit-transform: translateY(-40px);\n    -moz-transform: translateY(-40px);\n    -ms-transform: translateY(-40px);\n    -o-transform: translateY(-40px);\n    transform: translateY(-40px); } }\n@keyframes passing-through {\n  0% {\n    opacity: 0;\n    -webkit-transform: translateY(40px);\n    -moz-transform: translateY(40px);\n    -ms-transform: translateY(40px);\n    -o-transform: translateY(40px);\n    transform: translateY(40px); }\n  30%, 70% {\n    opacity: 1;\n    -webkit-transform: translateY(0px);\n    -moz-transform: translateY(0px);\n    -ms-transform: translateY(0px);\n    -o-transform: translateY(0px);\n    transform: translateY(0px); }\n  100% {\n    opacity: 0;\n    -webkit-transform: translateY(-40px);\n    -moz-transform: translateY(-40px);\n    -ms-transform: translateY(-40px);\n    -o-transform: translateY(-40px);\n    transform: translateY(-40px); } }\n@-webkit-keyframes slide-in {\n  0% {\n    opacity: 0;\n    -webkit-transform: translateY(40px);\n    -moz-transform: translateY(40px);\n    -ms-transform: translateY(40px);\n    -o-transform: translateY(40px);\n    transform: translateY(40px); }\n  30% {\n    opacity: 1;\n    -webkit-transform: translateY(0px);\n    -moz-transform: translateY(0px);\n    -ms-transform: translateY(0px);\n    -o-transform: translateY(0px);\n    transform: translateY(0px); } }\n@-moz-keyframes slide-in {\n  0% {\n    opacity: 0;\n    -webkit-transform: translateY(40px);\n    -moz-transform: translateY(40px);\n    -ms-transform: translateY(40px);\n    -o-transform: translateY(40px);\n    transform: translateY(40px); }\n  30% {\n    opacity: 1;\n    -webkit-transform: translateY(0px);\n    -moz-transform: translateY(0px);\n    -ms-transform: translateY(0px);\n    -o-transform: translateY(0px);\n    transform: translateY(0px); } }\n@keyframes slide-in {\n  0% {\n    opacity: 0;\n    -webkit-transform: translateY(40px);\n    -moz-transform: translateY(40px);\n    -ms-transform: translateY(40px);\n    -o-transform: translateY(40px);\n    transform: translateY(40px); }\n  30% {\n    opacity: 1;\n    -webkit-transform: translateY(0px);\n    -moz-transform: translateY(0px);\n    -ms-transform: translateY(0px);\n    -o-transform: translateY(0px);\n    transform: translateY(0px); } }\n@-webkit-keyframes pulse {\n  0% {\n    -webkit-transform: scale(1);\n    -moz-transform: scale(1);\n    -ms-transform: scale(1);\n    -o-transform: scale(1);\n    transform: scale(1); }\n  10% {\n    -webkit-transform: scale(1.1);\n    -moz-transform: scale(1.1);\n    -ms-transform: scale(1.1);\n    -o-transform: scale(1.1);\n    transform: scale(1.1); }\n  20% {\n    -webkit-transform: scale(1);\n    -moz-transform: scale(1);\n    -ms-transform: scale(1);\n    -o-transform: scale(1);\n    transform: scale(1); } }\n@-moz-keyframes pulse {\n  0% {\n    -webkit-transform: scale(1);\n    -moz-transform: scale(1);\n    -ms-transform: scale(1);\n    -o-transform: scale(1);\n    transform: scale(1); }\n  10% {\n    -webkit-transform: scale(1.1);\n    -moz-transform: scale(1.1);\n    -ms-transform: scale(1.1);\n    -o-transform: scale(1.1);\n    transform: scale(1.1); }\n  20% {\n    -webkit-transform: scale(1);\n    -moz-transform: scale(1);\n    -ms-transform: scale(1);\n    -o-transform: scale(1);\n    transform: scale(1); } }\n@keyframes pulse {\n  0% {\n    -webkit-transform: scale(1);\n    -moz-transform: scale(1);\n    -ms-transform: scale(1);\n    -o-transform: scale(1);\n    transform: scale(1); }\n  10% {\n    -webkit-transform: scale(1.1);\n    -moz-transform: scale(1.1);\n    -ms-transform: scale(1.1);\n    -o-transform: scale(1.1);\n    transform: scale(1.1); }\n  20% {\n    -webkit-transform: scale(1);\n    -moz-transform: scale(1);\n    -ms-transform: scale(1);\n    -o-transform: scale(1);\n    transform: scale(1); } }\n.dropzone, .dropzone * {\n  box-sizing: border-box; }\n\n.dropzone {\n  min-height: 150px;\n  border: 2px solid rgba(0, 0, 0, 0.3);\n  background: white;\n  padding: 20px 20px; }\n  .dropzone.dz-clickable {\n    cursor: pointer; }\n    .dropzone.dz-clickable * {\n      cursor: default; }\n    .dropzone.dz-clickable .dz-message, .dropzone.dz-clickable .dz-message * {\n      cursor: pointer; }\n  .dropzone.dz-started .dz-message {\n    display: none; }\n  .dropzone.dz-drag-hover {\n    border-style: solid; }\n    .dropzone.dz-drag-hover .dz-message {\n      opacity: 0.5; }\n  .dropzone .dz-message {\n    text-align: center;\n    margin: 2em 0; }\n  .dropzone .dz-preview {\n    position: relative;\n    display: inline-block;\n    vertical-align: top;\n    margin: 16px;\n    min-height: 100px; }\n    .dropzone .dz-preview:hover {\n      z-index: 1000; }\n      .dropzone .dz-preview:hover .dz-details {\n        opacity: 1; }\n    .dropzone .dz-preview.dz-file-preview .dz-image {\n      border-radius: 20px;\n      background: #999;\n      background: linear-gradient(to bottom, #eee, #ddd); }\n    .dropzone .dz-preview.dz-file-preview .dz-details {\n      opacity: 1; }\n    .dropzone .dz-preview.dz-image-preview {\n      background: white; }\n      .dropzone .dz-preview.dz-image-preview .dz-details {\n        -webkit-transition: opacity 0.2s linear;\n        -moz-transition: opacity 0.2s linear;\n        -ms-transition: opacity 0.2s linear;\n        -o-transition: opacity 0.2s linear;\n        transition: opacity 0.2s linear; }\n    .dropzone .dz-preview .dz-remove {\n      font-size: 14px;\n      text-align: center;\n      display: block;\n      cursor: pointer;\n      border: none; }\n      .dropzone .dz-preview .dz-remove:hover {\n        text-decoration: underline; }\n    .dropzone .dz-preview:hover .dz-details {\n      opacity: 1; }\n    .dropzone .dz-preview .dz-details {\n      z-index: 20;\n      position: absolute;\n      top: 0;\n      left: 0;\n      opacity: 0;\n      font-size: 13px;\n      min-width: 100%;\n      max-width: 100%;\n      padding: 2em 1em;\n      text-align: center;\n      color: rgba(0, 0, 0, 0.9);\n      line-height: 150%; }\n      .dropzone .dz-preview .dz-details .dz-size {\n        margin-bottom: 1em;\n        font-size: 16px; }\n      .dropzone .dz-preview .dz-details .dz-filename {\n        white-space: nowrap; }\n        .dropzone .dz-preview .dz-details .dz-filename:hover span {\n          border: 1px solid rgba(200, 200, 200, 0.8);\n          background-color: rgba(255, 255, 255, 0.8); }\n        .dropzone .dz-preview .dz-details .dz-filename:not(:hover) {\n          overflow: hidden;\n          text-overflow: ellipsis; }\n          .dropzone .dz-preview .dz-details .dz-filename:not(:hover) span {\n            border: 1px solid transparent; }\n      .dropzone .dz-preview .dz-details .dz-filename span, .dropzone .dz-preview .dz-details .dz-size span {\n        background-color: rgba(255, 255, 255, 0.4);\n        padding: 0 0.4em;\n        border-radius: 3px; }\n    .dropzone .dz-preview:hover .dz-image img {\n      -webkit-transform: scale(1.05, 1.05);\n      -moz-transform: scale(1.05, 1.05);\n      -ms-transform: scale(1.05, 1.05);\n      -o-transform: scale(1.05, 1.05);\n      transform: scale(1.05, 1.05);\n      -webkit-filter: blur(8px);\n      filter: blur(8px); }\n    .dropzone .dz-preview .dz-image {\n      border-radius: 20px;\n      overflow: hidden;\n      width: 120px;\n      height: 120px;\n      position: relative;\n      display: block;\n      z-index: 10; }\n      .dropzone .dz-preview .dz-image img {\n        display: block; }\n    .dropzone .dz-preview.dz-success .dz-success-mark {\n      -webkit-animation: passing-through 3s cubic-bezier(0.77, 0, 0.175, 1);\n      -moz-animation: passing-through 3s cubic-bezier(0.77, 0, 0.175, 1);\n      -ms-animation: passing-through 3s cubic-bezier(0.77, 0, 0.175, 1);\n      -o-animation: passing-through 3s cubic-bezier(0.77, 0, 0.175, 1);\n      animation: passing-through 3s cubic-bezier(0.77, 0, 0.175, 1); }\n    .dropzone .dz-preview.dz-error .dz-error-mark {\n      opacity: 1;\n      -webkit-animation: slide-in 3s cubic-bezier(0.77, 0, 0.175, 1);\n      -moz-animation: slide-in 3s cubic-bezier(0.77, 0, 0.175, 1);\n      -ms-animation: slide-in 3s cubic-bezier(0.77, 0, 0.175, 1);\n      -o-animation: slide-in 3s cubic-bezier(0.77, 0, 0.175, 1);\n      animation: slide-in 3s cubic-bezier(0.77, 0, 0.175, 1); }\n    .dropzone .dz-preview .dz-success-mark, .dropzone .dz-preview .dz-error-mark {\n      pointer-events: none;\n      opacity: 0;\n      z-index: 500;\n      position: absolute;\n      display: block;\n      top: 50%;\n      left: 50%;\n      margin-left: -27px;\n      margin-top: -27px; }\n      .dropzone .dz-preview .dz-success-mark svg, .dropzone .dz-preview .dz-error-mark svg {\n        display: block;\n        width: 54px;\n        height: 54px; }\n    .dropzone .dz-preview.dz-processing .dz-progress {\n      opacity: 1;\n      -webkit-transition: all 0.2s linear;\n      -moz-transition: all 0.2s linear;\n      -ms-transition: all 0.2s linear;\n      -o-transition: all 0.2s linear;\n      transition: all 0.2s linear; }\n    .dropzone .dz-preview.dz-complete .dz-progress {\n      opacity: 0;\n      -webkit-transition: opacity 0.4s ease-in;\n      -moz-transition: opacity 0.4s ease-in;\n      -ms-transition: opacity 0.4s ease-in;\n      -o-transition: opacity 0.4s ease-in;\n      transition: opacity 0.4s ease-in; }\n    .dropzone .dz-preview:not(.dz-processing) .dz-progress {\n      -webkit-animation: pulse 6s ease infinite;\n      -moz-animation: pulse 6s ease infinite;\n      -ms-animation: pulse 6s ease infinite;\n      -o-animation: pulse 6s ease infinite;\n      animation: pulse 6s ease infinite; }\n    .dropzone .dz-preview .dz-progress {\n      opacity: 1;\n      z-index: 1000;\n      pointer-events: none;\n      position: absolute;\n      height: 16px;\n      left: 50%;\n      top: 50%;\n      margin-top: -8px;\n      width: 80px;\n      margin-left: -40px;\n      background: rgba(255, 255, 255, 0.9);\n      -webkit-transform: scale(1);\n      border-radius: 8px;\n      overflow: hidden; }\n      .dropzone .dz-preview .dz-progress .dz-upload {\n        background: #333;\n        background: linear-gradient(to bottom, #666, #444);\n        position: absolute;\n        top: 0;\n        left: 0;\n        bottom: 0;\n        width: 0;\n        -webkit-transition: width 300ms ease-in-out;\n        -moz-transition: width 300ms ease-in-out;\n        -ms-transition: width 300ms ease-in-out;\n        -o-transition: width 300ms ease-in-out;\n        transition: width 300ms ease-in-out; }\n    .dropzone .dz-preview.dz-error .dz-error-message {\n      display: block; }\n    .dropzone .dz-preview.dz-error:hover .dz-error-message {\n      opacity: 1;\n      pointer-events: auto; }\n    .dropzone .dz-preview .dz-error-message {\n      pointer-events: none;\n      z-index: 1000;\n      position: absolute;\n      display: block;\n      display: none;\n      opacity: 0;\n      -webkit-transition: opacity 0.3s ease;\n      -moz-transition: opacity 0.3s ease;\n      -ms-transition: opacity 0.3s ease;\n      -o-transition: opacity 0.3s ease;\n      transition: opacity 0.3s ease;\n      border-radius: 8px;\n      font-size: 13px;\n      top: 130px;\n      left: -10px;\n      width: 140px;\n      background: #be2626;\n      background: linear-gradient(to bottom, #be2626, #a92222);\n      padding: 0.5em 1.2em;\n      color: white; }\n      .dropzone .dz-preview .dz-error-message:after {\n        content: '';\n        position: absolute;\n        top: -6px;\n        left: 64px;\n        width: 0;\n        height: 0;\n        border-left: 6px solid transparent;\n        border-right: 6px solid transparent;\n        border-bottom: 6px solid #be2626; }","output":"str","x":610,"y":640,"wires":[["51c593aa.0b1f5c"]]},{"id":"e7760c45.e9a4e","type":"http in","z":"c61d9d5f.52591","name":"","url":"/uploadpretty","method":"post","upload":true,"swaggerDoc":"","x":210,"y":700,"wires":[["d5e83913.dfa5d8","43fcc7b1.2b8d18","da31655a.f27558","3b0e4f73.6706f"]]},{"id":"13fcb292.fc9c1d","type":"http in","z":"c61d9d5f.52591","name":"","url":"/upload","method":"post","upload":true,"swaggerDoc":"","x":190,"y":300,"wires":[["cc0dac41.c20f3","781c3c25.3e3104"]]},{"id":"d78b3646.2c5a68","type":"template","z":"c61d9d5f.52591","name":"html","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<p></p>File {{name}} uploaded !</p>\n\n<h2>Contents:</h2>\n\n<pre>\n{{{payload}}}\n</pre>","output":"str","x":350,"y":180,"wires":[["781c3c25.3e3104"]]},{"id":"d14f482a.a00e98","type":"function","z":"c61d9d5f.52591","name":"toBase64","func":"msg.name = msg.req.files[0].originalname;\n\nif (msg.req.files[0].mimetype.includes('image')) {\n    msg.payload = `<img src=\"data:image/gif;base64,${msg.req.files[0].buffer.toString('base64')}\">`;\n} else {\n    msg.payload = msg.req.files[0].buffer.toString();\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":200,"y":180,"wires":[["d78b3646.2c5a68"]]},{"id":"4a840699.367338","type":"comment","z":"c61d9d5f.52591","name":"Complex","info":"","x":180,"y":600,"wires":[]},{"id":"43fcc7b1.2b8d18","type":"debug","z":"c61d9d5f.52591","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"req.files","x":430,"y":860,"wires":[]},{"id":"cc0dac41.c20f3","type":"function","z":"c61d9d5f.52591","name":"","func":"var prefix = \"/ragrug_mnt/uploads\"\n\n\n\nvar filename = msg.req.files[0].originalname;\nvar filetype = msg.req.files[0].mimetype;\nvar filesize = msg.req.files[0].size;\n\nvar myName = msg.req.body.myName;\nvar myCommonName = msg.req.body.myCommonName;\nvar myLocationKey = msg.req.body.myLocationKey;\nvar myLocationPath = msg.req.body.myLocationPath;\nvar myScale = msg.req.body.myScale;\n\nvar guid = Date.now();\n\nmsg.filename = prefix + \"/\" + filename;\nmsg.payload = msg.req.files[0].buffer;\n\nvar msg1 = {};\nmsg1.filename = prefix + \"/wpkg_\" + guid + \".wp\";\nmsg1.payload = \"\";\nmsg1.payload += myName + \";\"; \nmsg1.payload += filename + \";\";\nmsg1.payload += myScale + \";\"\nmsg1.payload += myName + \".json\" + \";\";\nmsg1.payload += myCommonName + \";\"; \nmsg1.payload += myLocationKey + \";\"; \nmsg1.payload += myLocationPath + \";\"; \nmsg1.payload += myCommonName + \".ab\" + \";\";\n\nreturn [msg, msg1];\n","outputs":2,"noerr":0,"initialize":"","finalize":"","x":450,"y":300,"wires":[["2b4efb35.bfbae4"],["21902020.19f58"]]},{"id":"2b4efb35.bfbae4","type":"file","z":"c61d9d5f.52591","name":"","filename":"","appendNewline":false,"createDir":true,"overwriteFile":"true","encoding":"none","x":770,"y":260,"wires":[[]]},{"id":"21902020.19f58","type":"file","z":"c61d9d5f.52591","name":"","filename":"","appendNewline":false,"createDir":true,"overwriteFile":"true","encoding":"none","x":770,"y":320,"wires":[[]]},{"id":"770a390c.98b9f8","type":"watch","z":"c61d9d5f.52591","name":"watch outputs","files":"/ragrug_mnt/outputs","recursive":"","x":110,"y":480,"wires":[["7d58dc48.d18754"]]},{"id":"7d58dc48.d18754","type":"function","z":"c61d9d5f.52591","name":"onlyAllowJson","func":"/*\n{\n\"payload\":\"/ragrug_mnt/outputs/transall_c160_3.json\",\n\"topic\":\"/ragrug_mnt/outputs\",\n\"file\":\"transall_c160_3.json\",\n\"filename\":\"/ragrug_mnt/outputs/transall_c160_3.json\",\n\"size\":28639,\"type\":\"file\",\"_msgid\":\"f3c95fe8.caa4f\"}\n*/\nif(msg.filename.includes('.json')) {\n    return msg;\n}\nreturn null;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":310,"y":480,"wires":[["80e61ff5.83f9f","51dfdc51.76faa4"]]},{"id":"80e61ff5.83f9f","type":"debug","z":"c61d9d5f.52591","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":520,"y":440,"wires":[]},{"id":"51dfdc51.76faa4","type":"file in","z":"c61d9d5f.52591","name":"","filename":"","format":"utf8","chunk":false,"sendError":false,"encoding":"none","x":520,"y":480,"wires":[["67932f82.5f8a5","1d239918.f07787"]]},{"id":"67932f82.5f8a5","type":"debug","z":"c61d9d5f.52591","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":690,"y":440,"wires":[]},{"id":"26d6d90a.dbbed6","type":"ui_template","z":"a26281bc.ae89f","group":"3bff8420.f2174c","name":"","order":7,"width":0,"height":0,"format":"<form action=\"/upload\" method=\"POST\" enctype=\"multipart/form-data\">\n    \n    <label>Unique Device Name</label>\n    </br>\n    <input type=\"text\" name=\"myName\"/>\n    \n    </br></br>\n    \n    <label>Common Name</label>\n    </br>\n    <input type=\"text\" name=\"myCommonName\"/>\n    \n    </br></br>\n    \n    <label>Location Key (SSID)</label>\n    </br>\n    <input type=\"text\" name=\"myLocationKey\"/>\n    \n    </br></br>\n    \n    <label>Location path (building/floor/room)</label>\n    </br>\n    <input type=\"text\" name=\"myLocationPath\"/>\n    \n    </br></br>\n    \n    <label>Scale</label>\n    </br>\n    <input type=\"text\" name=\"myScale\"/>\n    \n    </br></br>\n    \n    \n    <label>Modelfile (obj, fbx, blend, 3DS)</label>\n    </br>\n    <input class=\"md-file\" type=\"file\" name=\"myFile\" />\n    \n    </br></br>\n    \n    <input class=\"md-button\" type=\"submit\" value=\"Submit\">\n</form>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":180,"y":360,"wires":[[]]},{"id":"f40be82c.f15808","type":"influxdb in","z":"a26281bc.ae89f","influxdb":"370a75d7.b3a34a","name":"","query":"show tag values with key=\"7\"","rawOutput":false,"precision":"","retentionPolicy":"","x":530,"y":540,"wires":[["a3a3e63e.836288"]]},{"id":"66f600f9.4845e","type":"inject","z":"a26281bc.ae89f","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":160,"y":540,"wires":[["f40be82c.f15808"]]},{"id":"25b3a16f.764e0e","type":"comment","z":"a26281bc.ae89f","name":"InfluxDB Query Testing","info":"","x":200,"y":460,"wires":[]},{"id":"a3a3e63e.836288","type":"debug","z":"a26281bc.ae89f","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":830,"y":540,"wires":[]},{"id":"9a0de93f.5793a8","type":"influxdb in","z":"a26281bc.ae89f","influxdb":"370a75d7.b3a34a","name":"","query":"show tag values with key=\"8\"","rawOutput":false,"precision":"","retentionPolicy":"","x":530,"y":580,"wires":[["a3a3e63e.836288"]]},{"id":"804d3a21.a03718","type":"inject","z":"a26281bc.ae89f","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":160,"y":580,"wires":[["9a0de93f.5793a8"]]},{"id":"cf3ce5e5.6639b8","type":"influxdb in","z":"a26281bc.ae89f","influxdb":"370a75d7.b3a34a","name":"","query":"show tag values with key=\"6\"","rawOutput":false,"precision":"","retentionPolicy":"","org":"","x":530,"y":500,"wires":[["a3a3e63e.836288"]]},{"id":"b38e5d97.39cf4","type":"inject","z":"a26281bc.ae89f","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":160,"y":500,"wires":[["cf3ce5e5.6639b8"]]},{"id":"da7bef29.5d51e","type":"influxdb in","z":"a26281bc.ae89f","influxdb":"370a75d7.b3a34a","name":"","query":"show tag values with key=\"9\"","rawOutput":false,"precision":"","retentionPolicy":"","x":530,"y":620,"wires":[["a3a3e63e.836288"]]},{"id":"1dd3c780.f529f8","type":"inject","z":"a26281bc.ae89f","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":160,"y":620,"wires":[["da7bef29.5d51e"]]},{"id":"a4a6bb5.4ff0348","type":"influxdb in","z":"a26281bc.ae89f","influxdb":"370a75d7.b3a34a","name":"","query":"show tag values with key=\"10\"","rawOutput":false,"precision":"","retentionPolicy":"","org":"","x":530,"y":660,"wires":[["a3a3e63e.836288","2cb31a27.1ac306"]]},{"id":"566defc5.70ae2","type":"inject","z":"a26281bc.ae89f","name":"","repeat":"30","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":170,"y":660,"wires":[["a4a6bb5.4ff0348"]]},{"id":"2cb31a27.1ac306","type":"ui_table","z":"a26281bc.ae89f","group":"5b775fa5.03f08","name":"Telemetry Topics","order":1,"width":12,"height":8,"columns":[{"field":"","title":"","width":"5%","align":"left","formatter":"rownum","formatterParams":{"target":"_blank"}},{"field":"key","title":"Tag","width":"10%","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"value","title":"Topic","width":"","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}}],"outputs":1,"cts":true,"x":870,"y":660,"wires":[["314c8074.0fb9c"]]},{"id":"eba315f8.09cb78","type":"inject","z":"eb66deb5.bea27","name":"","repeat":"10","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":130,"y":1600,"wires":[["1e817d03.c700e3"]]},{"id":"1e817d03.c700e3","type":"function","z":"eb66deb5.bea27","name":"telemetry/inffeld16/1st/hallway/light1/main/brightness","func":"var sensor = {};\nvar max = 0;\nvar min = 0;\n\nmax = 55;\nmin = 45;\nvar v1 = Math.random() * (max - min) + min;\n\nsensor.freq = v1;\n\nvar topic = \"telemetry/inffeld16/1st/hallway/light1/main/freq\";\nmsg.topic = topic;\nmsg.payload = sensor;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":440,"y":1600,"wires":[["eb7738a4.47ef88"]]},{"id":"675d5d46.d92584","type":"comment","z":"a26281bc.ae89f","name":"Upload UI","info":"","x":140,"y":320,"wires":[]},{"id":"1d239918.f07787","type":"json","z":"c61d9d5f.52591","name":"","property":"payload","action":"","pretty":false,"x":690,"y":480,"wires":[["e27d0563.c40b18","1495fcb.2836a03"]]},{"id":"e27d0563.c40b18","type":"debug","z":"c61d9d5f.52591","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":870,"y":440,"wires":[]},{"id":"1495fcb.2836a03","type":"function","z":"c61d9d5f.52591","name":"prepare for check","func":"/*\n{\n    \"payload\": { \n        \"modelname\":\"tt\",\n        \"parts\":[\n            { \"name\":\"default\",\n            \"position\":[0,0,0],\n            \"parent\":\"tt\",\n            \"active\":false}\n            ],\n        \"commonname\":\"rr\",\n        \"locationkey\":\"ee\",\n        \"locationpath\":\"ww\",\n        \"scale\":1},\n        \"topic\":\"/ragrug_mnt/outputs\",\n        \"file\":\"tt.json\",\n        \"filename\":\"/ragrug_mnt/outputs/tt.json\",\n        \"size\":0,\n        \"type\":\"file\",\n        \"_msgid\":\"94dbd577.0b04a8\"}\n*/\nvar id2check = msg.payload.locationkey + \"-\" + msg.payload.modelname;\nmsg._id = id2check;\nmsg.payload._id = id2check;\nmsg.data = msg.payload;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":910,"y":480,"wires":[["bde2d799.546318","10ca2f51.ac9691"]]},{"id":"1dd59569.8fd1eb","type":"comment","z":"c61d9d5f.52591","name":"to DB","info":"check if entry exists\nif yes adapt\nif no add new","x":1210,"y":380,"wires":[]},{"id":"bde2d799.546318","type":"cloudantplus in","z":"c61d9d5f.52591","name":"couchdd:id","cloudant":"497401a9.52275","database":"world","service":"_ext_","search":"_id_","design":"","index":"","x":1230,"y":480,"wires":[["f7a253a7.6dea1","fe9d6a52.20aba8"]]},{"id":"f7a253a7.6dea1","type":"function","z":"c61d9d5f.52591","name":"Id present","func":"\nif(msg.payload == null) {\n    return[msg, null];    \n} else {\n    return[null, msg];\n}\n\nreturn msg;","outputs":2,"noerr":0,"initialize":"","finalize":"","x":1420,"y":480,"wires":[["d039088f.146428","3fa69a6e.8297d6","677e771.b3ac988"],["c478aafe.3caa38","3fa69a6e.8297d6","677e771.b3ac988"]]},{"id":"10ca2f51.ac9691","type":"debug","z":"c61d9d5f.52591","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1210,"y":440,"wires":[]},{"id":"fe9d6a52.20aba8","type":"debug","z":"c61d9d5f.52591","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1430,"y":440,"wires":[]},{"id":"d039088f.146428","type":"debug","z":"c61d9d5f.52591","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1670,"y":440,"wires":[]},{"id":"c478aafe.3caa38","type":"debug","z":"c61d9d5f.52591","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1670,"y":480,"wires":[]},{"id":"5a22d4c6.1eb46c","type":"comment","z":"c61d9d5f.52591","name":"insert new","info":"","x":1810,"y":440,"wires":[]},{"id":"e8b25c54.ccf3","type":"comment","z":"c61d9d5f.52591","name":"update old","info":"","x":1820,"y":480,"wires":[]},{"id":"9518eea1.72e18","type":"postgres","z":"26d1fc02.f4deb4","postgresdb":"20ba6cdb.ae7474","name":"","output":true,"perrow":false,"rowspermsg":"1","outputs":1,"x":1100,"y":640,"wires":[["48c87b54.ce58a4"]]},{"id":"fb7b6f93.c5382","type":"template","z":"26d1fc02.f4deb4","name":"format query","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"select * from table1 where field2 > $param1","x":550,"y":1060,"wires":[["5c56adb5.e18d14"]]},{"id":"6e502e53.8ecdf","type":"function","z":"26d1fc02.f4deb4","name":"setup params","func":"msg.queryParameters = msg.queryParameters || {};\nmsg.queryParameters.param1 = 1;\nreturn msg;","outputs":1,"noerr":0,"x":340,"y":1060,"wires":[["fb7b6f93.c5382"]]},{"id":"121fde98.d9f3f1","type":"inject","z":"26d1fc02.f4deb4","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":140,"y":1060,"wires":[["6e502e53.8ecdf"]]},{"id":"48c87b54.ce58a4","type":"debug","z":"26d1fc02.f4deb4","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1250,"y":640,"wires":[]},{"id":"c3219b56.eb2718","type":"template","z":"26d1fc02.f4deb4","name":"create db rrdevices","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"create schema rrdevices","x":370,"y":520,"wires":[["e6bb976c.f96b58"]]},{"id":"b45b491d.cd6d48","type":"inject","z":"26d1fc02.f4deb4","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":140,"y":520,"wires":[["c3219b56.eb2718"]]},{"id":"cea30a18.7be318","type":"template","z":"26d1fc02.f4deb4","name":"create table device","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"CREATE TABLE rrdevices.device (\n    id           char(10) CONSTRAINT firstkey PRIMARY KEY,\n    name         varchar(40) NOT NULL,\n    description  varchar(40),\n    date_prod   date\n);","x":370,"y":560,"wires":[["e6bb976c.f96b58"]]},{"id":"1badaac3.8ffb65","type":"inject","z":"26d1fc02.f4deb4","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":140,"y":560,"wires":[["cea30a18.7be318"]]},{"id":"25d489d3.dee446","type":"template","z":"26d1fc02.f4deb4","name":"rockpro64 insert sample data device","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"INSERT INTO rrdevices.device(id, name, description, date_prod)\nVALUES ('ROCKPRO64', 'Rock Pro 64', 'RK3399 SoC based Arm computer', now());","x":430,"y":760,"wires":[["48d215a8.cdc23c"]]},{"id":"803d405e.13e4b","type":"inject","z":"26d1fc02.f4deb4","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":140,"y":760,"wires":[["25d489d3.dee446"]]},{"id":"345e039c.73b12c","type":"template","z":"26d1fc02.f4deb4","name":"select part, device, instance","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"SELECT a.id AS instancename, b.id AS devicename, c.id AS partname \nFROM \nrrdevices.deviceinstance a,\nrrdevices.device b,\nrrdevices.parts c\nWHERE\na.deviceid = b.id AND\na.deviceid = c.deviceid\n; ","x":400,"y":940,"wires":[["5c56adb5.e18d14"]]},{"id":"21b4ad85.63cb72","type":"inject","z":"26d1fc02.f4deb4","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":140,"y":940,"wires":[["345e039c.73b12c"]]},{"id":"5100e5cc.8a84cc","type":"ui_template","z":"a26281bc.ae89f","d":true,"group":"5b775fa5.03f08","name":"","order":2,"width":0,"height":0,"format":"<!-- <div ng-bind-html=\"msg.payload\"></div> -->\n<div width=\"320\">\n<canvas id=\"myCanvas\" width=\"320\" height=\"240\"></canvas>\n</div>\n<script>\n(function(scope) {\n        console.log('Position 1');\n        console.dir(scope);\n        scope.$watch('msg.payload', function(data) {\n            //console.log('Position 2');\n            //console.dir(data);\n            SetData(data);\n        });\n    })(scope);\n    \n        function SetData(data) {\n            var canvas = document.getElementById(\"myCanvas\");\n            var ctx = canvas.getContext(\"2d\");\n\n            var w = 320;\n            var h = 240;\n            var imagedata = ctx.createImageData(w, h);\n            \n            //var data = {{msg.payload}};\n            //var data = msg.payload;\n            //node.warn(\"test test test\");\n            var id = 0;\n            for (var x = 0; x < w; x++) {\n                for (var y = 0; y < h; y++) {\n                    var pixelindex = (y * w + x) * 4;\n                    //var r = (20 + Math.random() * 255) % 255;\n                    //var g = (20 + Math.random() * 255) % 255;\n                    //var b = (20 + Math.random() * 255) % 255;\n                    //var a = (50 + Math.random() * 255) % 255;\n                    //var r = data[id] *255 ;\n                    //var g = r * Math.random();\n                    //var b = r * Math.random();\n                    var a = 255;\n                    var f = bytesToFloat([data[id], data[id+1], data[id+2], data[id+3]]);\n                    var myint = Math.round(f);\n                    \n                    if(id % 50 == 0) {\n                        console.log(\"myfloat=\" + f);\n                    }\n                    //console.log(\"myint=\" + myint);\n                    \n                    imagedata.data[pixelindex] = myint;\n                    imagedata.data[pixelindex + 1] = 0;\n                    imagedata.data[pixelindex + 2] = 0;\n                    imagedata.data[pixelindex + 3] = a;\n                    id +=4;\n                }\n            }\n            ctx.putImageData(imagedata, 0, 0);\n        }\nfunction bytesToFloat(bytes) {\n    // JavaScript bitwise operators yield a 32 bits integer, not a float.\n    // Assume LSB (least significant byte first).\n    var bits = bytes[3]<<24 | bytes[2]<<16 | bytes[1]<<8 | bytes[0];\n    var sign = (bits>>>31 === 0) ? 1.0 : -1.0;\n    var e = bits>>>23 & 0xff;\n    var m = (e === 0) ? (bits & 0x7fffff)<<1 : (bits & 0x7fffff) | 0x800000;\n    var f = sign * m * Math.pow(2, e - 150);\n    return f;\n  } \n        //SetData();\n        //setInterval(SetData, 500);\n    </script>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":580,"y":860,"wires":[[]]},{"id":"3111e4a3.ea6d7c","type":"function","z":"a26281bc.ae89f","d":true,"name":"","func":"msg.payload = [];\nvar N = 320*240;\nvar bts = [0x0a, 0xaa, 0xd4, 0x41];\nvar p = 0;\nfor(var i = 0; i < N; i++) {\n    msg.payload[p+0] = bts[0];\n    msg.payload[p+1] = bts[1];\n    msg.payload[p+2] = bts[2];\n    msg.payload[p+3] = bts[3];\n    p+=4;\n}\nreturn msg;","outputs":1,"noerr":0,"x":360,"y":860,"wires":[["c6c57217.b2b97","5100e5cc.8a84cc"]]},{"id":"c8cad367.6677a","type":"inject","z":"a26281bc.ae89f","d":true,"name":"","repeat":"10","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":170,"y":860,"wires":[["3111e4a3.ea6d7c"]]},{"id":"c6c57217.b2b97","type":"debug","z":"a26281bc.ae89f","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":570,"y":800,"wires":[]},{"id":"3fa69a6e.8297d6","type":"function","z":"c61d9d5f.52591","name":"insert or update device","func":"// TODO\n/*\n\nfix id -> location-name\nmodelname -> name\n\nassetname -> once we built an asset out of it\nmodelname (comes from here parsed output)\n\n*/\n\nvar rev = null;\n\nif(msg.hasOwnProperty(\"cloudant\")) {\n    if(msg.cloudant.hasOwnProperty(\"_rev\")) {\n        if(msg.cloudant._rev.length > 0) {\n            rev = msg.cloudant._rev;\n        }\n    }\n}\n\n\nvar dump = msg.data;\nmsg.payload = dump;\nmsg.payload.registered = false;\nmsg.payload.id = msg._id;\n\nif(rev != null) {\n    msg.payload._rev = rev;\n}\n\n//TODO update devce list\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1740,"y":660,"wires":[["25f7b057.74b8"]]},{"id":"25f7b057.74b8","type":"cloudantplus out","z":"c61d9d5f.52591","name":"","cloudant":"497401a9.52275","database":"world","service":"_ext_","payonly":true,"operation":"insert","x":2350,"y":660,"wires":[["400df42.f33d00c"]]},{"id":"400df42.f33d00c","type":"debug","z":"c61d9d5f.52591","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2470,"y":660,"wires":[]},{"id":"677e771.b3ac988","type":"function","z":"c61d9d5f.52591","name":"update devices of location","func":"// TODO update device list\nvar data = msg.data;\nmsg = {};\nmsg.payload = {};\nmsg.payload._id = data.locationkey + \"-devices\";\nmsg._id = data.locationkey + \"-devices\";\nmsg.data = data;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1750,"y":600,"wires":[["65e57dcb.f7d664"]]},{"id":"840b95ca.a6db38","type":"debug","z":"c61d9d5f.52591","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2460,"y":600,"wires":[]},{"id":"65e57dcb.f7d664","type":"cloudantplus in","z":"c61d9d5f.52591","name":"couchdd:id","cloudant":"497401a9.52275","database":"world","service":"_ext_","search":"_id_","design":"","index":"","x":2010,"y":600,"wires":[["fb6e89f6.9865b8"]]},{"id":"fb6e89f6.9865b8","type":"function","z":"c61d9d5f.52591","name":"","func":"msg.payload = msg.cloudant;\nmsg.payload.present.push(msg.data._id);\nreturn msg;","outputs":1,"noerr":0,"x":2190,"y":600,"wires":[["840b95ca.a6db38","25f7b057.74b8"]]},{"id":"30b8240a.768e5c","type":"template","z":"26d1fc02.f4deb4","name":"create table parts","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"CREATE TABLE rrdevices.parts (\n    id           char(20),\n    deviceid     char(20) NOT NULL,\n    name         varchar(50) NOT NULL,\n    description  varchar(250),\n    date_prod   date\n);","x":370,"y":640,"wires":[["e6bb976c.f96b58"]]},{"id":"60738863.af9648","type":"inject","z":"26d1fc02.f4deb4","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":140,"y":640,"wires":[["30b8240a.768e5c"]]},{"id":"e6bb976c.f96b58","type":"function","z":"26d1fc02.f4deb4","name":"","func":"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":790,"y":640,"wires":[["9518eea1.72e18"]]},{"id":"5c56adb5.e18d14","type":"function","z":"26d1fc02.f4deb4","name":"","func":"\nreturn msg;","outputs":1,"noerr":0,"x":790,"y":940,"wires":[["9518eea1.72e18"]]},{"id":"ded12041.e7516","type":"template","z":"26d1fc02.f4deb4","name":"rockpro64 insert sample data","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"INSERT INTO rrdevices.parts(id, deviceid, name, description, date_prod)\nVALUES \n('MAIN-PCBA', 'ROCKPRO64', 'Main PCB', 'Board holding all components. Sandwich design.', NOW()),\n('HDMI_2', 'ROCKPRO64', 'HDMI Connector', 'Full size HDMI connector.', NOW()),\n('DC-BIG', 'ROCKPRO64', '12V DC-IN', '12V Barrelconenctor.', NOW()),\n('RJ45', 'ROCKPRO64', '12V DC-IN', '12V Barrelconenctor.', NOW()),\n('PRT0003', 'ROCKPRO64', 'Common part', 'A common part.', NOW()),\n('USB', 'ROCKPRO64', 'USB Connector', 'The USB connector.', NOW()),\n('TYPC', 'ROCKPRO64', 'TYPE-C Connector', 'The USB-C connector.', NOW()),\n('JACK', 'ROCKPRO64', 'Headphone Jack', '3.5mm Headphone Jack', NOW()),\n('MICRO-SD-HOUSING__1', 'ROCKPRO64', 'Micro SD-Card housing', 'Metal housing for standard micro SD-Card.', NOW()),\n('MICRO-SD-CARD__1', 'ROCKPRO64', 'Mirco SD-Card', 'Mirco SD-Card', NOW()),\n('MINI_SD_ASM_1_ASM', 'ROCKPRO64', 'Mini SD-Card connector', 'Mini SD-Card connector', NOW()),\n('IR', 'ROCKPRO64', 'IR Receiver', 'IR Receiver', NOW()),\n('TYPC001', 'ROCKPRO64', 'TYPE-C Connector 2', 'Secondary USB-C Connector', NOW()),\n('MAIN-PCB_ASM', 'ROCKPRO64', 'PCB Assembly', 'Main PCB for assembly', NOW())\n;","x":400,"y":720,"wires":[["48d215a8.cdc23c"]]},{"id":"c0afd8dd.c1d198","type":"inject","z":"26d1fc02.f4deb4","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":140,"y":720,"wires":[["ded12041.e7516"]]},{"id":"47b08570.a9458c","type":"template","z":"26d1fc02.f4deb4","name":"create table deviceinstance","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"CREATE TABLE rrdevices.deviceinstance (\n    id           CHAR(20) CONSTRAINT firstkey PRIMARY KEY,\n    deviceid     CHAR(20) NOT NULL,\n\t name         varchar(40) NOT NULL,\n    description  varchar(40),\n    date_prod   date\n);","x":400,"y":600,"wires":[["e6bb976c.f96b58"]]},{"id":"5bfbd3cf.30f2ac","type":"inject","z":"26d1fc02.f4deb4","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":140,"y":600,"wires":[["47b08570.a9458c"]]},{"id":"bc403bb6.d008d8","type":"template","z":"26d1fc02.f4deb4","name":"rockpro64 insert sample data deviceinstance","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"INSERT INTO rrdevices.deviceinstance(id, deviceid, name, description, date_prod)\nVALUES ('LITTLESERVER', 'ROCKPRO64', 'Littleserver', 'Handling little in-office tasks', now());","x":450,"y":800,"wires":[["48d215a8.cdc23c"]]},{"id":"399e0474.3930ac","type":"inject","z":"26d1fc02.f4deb4","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":140,"y":800,"wires":[["bc403bb6.d008d8"]]},{"id":"48d215a8.cdc23c","type":"function","z":"26d1fc02.f4deb4","name":"","func":"\nreturn msg;","outputs":1,"noerr":0,"x":790,"y":720,"wires":[["9518eea1.72e18"]]},{"id":"1db4ce41.f26942","type":"inject","z":"eb66deb5.bea27","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"1","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":130,"y":1780,"wires":[["28fac30f.d2f42c"]]},{"id":"28fac30f.d2f42c","type":"function","z":"eb66deb5.bea27","name":"telemetry/inffeld16/2nd/id2068/littleserver/RJ45/inbound","func":"var sensor = {};\nvar max = 0;\nvar min = 0;\n\nmax = 5000;\nmin = 0;\nvar v1 = Math.random() * (max - min) + min;\n\nsensor.inbound_mbps = v1;\n\nvar topic = \"telemetry/inffeld16/2nd/id2068/littleserver/RJ45/inbound\";\nmsg.topic = topic;\nmsg.payload = sensor;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":450,"y":1780,"wires":[["962e4f47.2a82f"]]},{"id":"962e4f47.2a82f","type":"function","z":"eb66deb5.bea27","name":"empty collector","func":"\nreturn msg;","outputs":1,"noerr":0,"x":880,"y":1780,"wires":[["48399cfc.3dd054"]]},{"id":"a1fa7aa9.f48de8","type":"function","z":"eb66deb5.bea27","name":"telemetry/inffeld16/2nd/id2068/littleserver/RJ45/outbound","func":"var sensor = {};\nvar max = 0;\nvar min = 0;\n\nmax = 5000;\nmin = 0;\nvar v1 = Math.random() * (max - min) + min;\n\nsensor.outbound_mbps = v1;\n\nvar topic = \"telemetry/inffeld16/2nd/id2068/littleserver/RJ45/outbound\";\nmsg.topic = topic;\nmsg.payload = sensor;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":450,"y":1820,"wires":[["962e4f47.2a82f"]]},{"id":"7cf562ea.fddc6c","type":"inject","z":"eb66deb5.bea27","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"1","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":130,"y":1820,"wires":[["a1fa7aa9.f48de8"]]},{"id":"88b5a59a.5d7a98","type":"function","z":"eb66deb5.bea27","name":"telemetry/inffeld16/2nd/id2068/littleserver/DC-BIG/dcin","func":"var sensor = {};\nvar max = 0;\nvar min = 0;\n\nmax = 12;\nmin = 0;\nvar v1 = Math.random() * (max - min) + min;\n\nsensor.dcin_v = v1;\n\nvar topic = \"telemetry/inffeld16/2nd/id2068/littleserver/DC-BIG/dcin\";\nmsg.topic = topic;\nmsg.payload = sensor;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":440,"y":1860,"wires":[["962e4f47.2a82f"]]},{"id":"3577c747.032b98","type":"inject","z":"eb66deb5.bea27","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"1","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":130,"y":1860,"wires":[["88b5a59a.5d7a98"]]},{"id":"8d989f30.89049","type":"inject","z":"eb66deb5.bea27","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"1","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":130,"y":1940,"wires":[["f37f386a.b7aee8"]]},{"id":"f37f386a.b7aee8","type":"function","z":"eb66deb5.bea27","name":"telemetry/inffeld16/2nd/id2068/bigserver/RJ45/inbound","func":"var sensor = {};\nvar max = 0;\nvar min = 0;\n\nmax = 5000;\nmin = 0;\nvar v1 = Math.random() * (max - min) + min;\n\nsensor.inbound_mbps = v1;\n\nvar topic = \"telemetry/inffeld16/2nd/id2068/bigserver/RJ45/inbound\";\nmsg.topic = topic;\nmsg.payload = sensor;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":440,"y":1940,"wires":[["962e4f47.2a82f"]]},{"id":"82cfe3f8.ce27f","type":"function","z":"eb66deb5.bea27","name":"telemetry/inffeld16/2nd/id2068/bigserver/RJ45/outbound","func":"var sensor = {};\nvar max = 0;\nvar min = 0;\n\nmax = 5000;\nmin = 0;\nvar v1 = Math.random() * (max - min) + min;\n\nsensor.outbound_mbps = v1;\n\nvar topic = \"telemetry/inffeld16/2nd/id2068/bigserver/RJ45/outbound\";\nmsg.topic = topic;\nmsg.payload = sensor;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":450,"y":1980,"wires":[["962e4f47.2a82f"]]},{"id":"c318e965.8cfb28","type":"inject","z":"eb66deb5.bea27","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"1","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":130,"y":1980,"wires":[["82cfe3f8.ce27f"]]},{"id":"cf9f171c.c0db98","type":"function","z":"eb66deb5.bea27","name":"telemetry/inffeld16/2nd/id2068/bigserver/DC-BIG/dcin","func":"var sensor = {};\nvar max = 0;\nvar min = 0;\n\nmax = 12;\nmin = 0;\nvar v1 = Math.random() * (max - min) + min;\n\nsensor.dcin_v = v1;\n\nvar topic = \"telemetry/inffeld16/2nd/id2068/bigserver/DC-BIG/dcin\";\nmsg.topic = topic;\nmsg.payload = sensor;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":440,"y":2020,"wires":[["962e4f47.2a82f"]]},{"id":"e803efc9.202b9","type":"inject","z":"eb66deb5.bea27","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"1","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":130,"y":2020,"wires":[["cf9f171c.c0db98"]]},{"id":"8157058c.1aeef8","type":"inject","z":"eb66deb5.bea27","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"1","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":130,"y":2120,"wires":[["865d6ea2.627d1"]]},{"id":"865d6ea2.627d1","type":"function","z":"eb66deb5.bea27","name":"telemetry/inffeld16/2nd/id2068/buildserver/RJ45/inbound","func":"var sensor = {};\nvar max = 0;\nvar min = 0;\n\nmax = 5000;\nmin = 0;\nvar v1 = Math.random() * (max - min) + min;\n\nsensor.inbound_mbps = v1;\n\nvar topic = \"telemetry/inffeld16/2nd/id2068/buildserver/RJ45/inbound\";\nmsg.topic = topic;\nmsg.payload = sensor;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":450,"y":2120,"wires":[["964e426d.53168"]]},{"id":"5065a8af.8f1a98","type":"function","z":"eb66deb5.bea27","name":"telemetry/inffeld16/2nd/id2068/buildserver/RJ45/outbound","func":"var sensor = {};\nvar max = 0;\nvar min = 0;\n\nmax = 5000;\nmin = 0;\nvar v1 = Math.random() * (max - min) + min;\n\nsensor.outbound_mbps = v1;\n\nvar topic = \"telemetry/inffeld16/2nd/id2068/buildserver/RJ45/outbound\";\nmsg.topic = topic;\nmsg.payload = sensor;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":450,"y":2160,"wires":[["964e426d.53168"]]},{"id":"80b274ad.9500d8","type":"inject","z":"eb66deb5.bea27","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"1","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":130,"y":2160,"wires":[["5065a8af.8f1a98"]]},{"id":"7cbb7159.5cceb","type":"function","z":"eb66deb5.bea27","name":"telemetry/inffeld16/2nd/id2068/buildserver/DC-BIG/dcin","func":"var sensor = {};\nvar max = 0;\nvar min = 0;\n\nmax = 12;\nmin = 0;\nvar v1 = Math.random() * (max - min) + min;\n\nsensor.dcin_v = v1;\n\nvar topic = \"telemetry/inffeld16/2nd/id2068/buildserver/DC-BIG/dcin\";\nmsg.topic = topic;\nmsg.payload = sensor;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":440,"y":2200,"wires":[["964e426d.53168"]]},{"id":"880d32e8.8084d","type":"inject","z":"eb66deb5.bea27","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"1","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":130,"y":2200,"wires":[["7cbb7159.5cceb"]]},{"id":"964e426d.53168","type":"function","z":"eb66deb5.bea27","name":"empty collector","func":"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":880,"y":2100,"wires":[["48399cfc.3dd054"]]},{"id":"616c6a02.6b5b54","type":"inject","z":"e9bcdddb.5dd08","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":140,"y":540,"wires":[["ba506f0c.0463b"]]},{"id":"4251641b.2b77bc","type":"http request","z":"e9bcdddb.5dd08","name":"","method":"POST","ret":"txt","paytoqs":false,"url":"https://vizario-dev.ddns.net:21880/smartcamera/report","tls":"52d8d00e.63087","persist":false,"proxy":"","authType":"basic","x":870,"y":620,"wires":[["a511510c.b38be"]]},{"id":"a511510c.b38be","type":"debug","z":"e9bcdddb.5dd08","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1090,"y":620,"wires":[]},{"id":"ba506f0c.0463b","type":"function","z":"e9bcdddb.5dd08","name":"prepFileRead","func":"var prefix = \"/ragrug_mnt/uploads\";\nvar fn = \"grafana_local.png\";\n\nmsg.filename = prefix + \"/\" + fn;\n\nreturn [msg];\n","outputs":1,"noerr":0,"x":320,"y":540,"wires":[["45e71722.969198"]]},{"id":"45e71722.969198","type":"file in","z":"e9bcdddb.5dd08","name":"","filename":"","format":"","chunk":false,"sendError":false,"encoding":"none","x":490,"y":540,"wires":[["66871e52.e0b8b"]]},{"id":"66871e52.e0b8b","type":"function","z":"e9bcdddb.5dd08","name":"","func":"//msg.filename\n//msg.payload\n\nvar nFn = msg.filename.split(\"/\");\nnFn = nFn[nFn.length -1];\n\nvar msg2 = {\n    payload : {\n        body :{\n            file : msg.payload,\n            filename : nFn\n        },\n        topic: \"brixlegg TCam1\"\n    }\n};\n\nreturn msg2;","outputs":1,"noerr":0,"x":650,"y":540,"wires":[["a47b3ad6.2d5228","4251641b.2b77bc"]]},{"id":"a47b3ad6.2d5228","type":"debug","z":"e9bcdddb.5dd08","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":930,"y":540,"wires":[]},{"id":"a1c0c22f.868ba","type":"http in","z":"50191f06.dc99e","name":"[GET] /getfile","url":"/getfile","method":"get","upload":false,"swaggerDoc":"","x":130,"y":880,"wires":[["3044146d.2ef9bc"]]},{"id":"3044146d.2ef9bc","type":"function","z":"50191f06.dc99e","name":"","func":"var fsPref = \"/ragrug_mnt/outputs\";\nvar fn = fsPref + \"/\" + msg.payload.name;\nmsg.filename = fn;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":390,"y":880,"wires":[["43057bc9.c433f4","60a4020c.5ac21c"]]},{"id":"45064f7f.b765f","type":"debug","z":"50191f06.dc99e","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":950,"y":840,"wires":[]},{"id":"43057bc9.c433f4","type":"file in","z":"50191f06.dc99e","name":"","filename":"","format":"","chunk":false,"sendError":false,"encoding":"none","x":590,"y":880,"wires":[["45064f7f.b765f","f389be8c.01b5"]]},{"id":"f389be8c.01b5","type":"http response","z":"50191f06.dc99e","name":"","statusCode":"","headers":{"content-type":"application/octet-stream"},"x":950,"y":880,"wires":[]},{"id":"60a4020c.5ac21c","type":"debug","z":"50191f06.dc99e","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":590,"y":840,"wires":[]},{"id":"48399cfc.3dd054","type":"function","z":"eb66deb5.bea27","name":"empty collector","func":"\nreturn msg;","outputs":1,"noerr":0,"x":1120,"y":1580,"wires":[["6d4dac80.5614e4","77de3708.46786"]]},{"id":"8584c49f.4518b8","type":"md5","z":"e9bcdddb.5dd08","name":"","fieldToHash":"_msgid","fieldTypeToHash":"msg","hashField":"md5","hashFieldType":"msg","x":370,"y":740,"wires":[["6f36fa0b.b8b494"]]},{"id":"ef21fe32.02c8a","type":"inject","z":"e9bcdddb.5dd08","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":150,"y":740,"wires":[["8584c49f.4518b8"]]},{"id":"6f36fa0b.b8b494","type":"debug","z":"e9bcdddb.5dd08","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":560,"y":740,"wires":[]},{"id":"32670de2.fbae02","type":"comment","z":"e9bcdddb.5dd08","name":"Cam testing","info":"","x":110,"y":500,"wires":[]},{"id":"88c7c33c.fc728","type":"file","z":"c61d9d5f.52591","name":"","filename":"","appendNewline":false,"createDir":true,"overwriteFile":"true","encoding":"none","x":790,"y":760,"wires":[[]]},{"id":"da31655a.f27558","type":"function","z":"c61d9d5f.52591","name":"","func":"var prefix = \"/ragrug_mnt/uploads\"\nvar flist = msg.req.files;\n\nfor(var i = 0; i < flist.length; i++) {\n    var msg = {};\n    msg.payload = flist[i].buffer;\n    msg.filename = prefix + \"/\" + flist[i].originalname;\n    node.send(msg);\n}\n\n/*\nvar filename = msg.req.files[i].originalname;\n\nvar filename = msg.req.files[0].originalname;\nvar filetype = msg.req.files[0].mimetype;\nvar filesize = msg.req.files[0].size;\n\nvar myName = msg.req.body.myName;\nvar myCommonName = msg.req.body.myCommonName;\nvar myLocationKey = msg.req.body.myLocationKey;\nvar myLocationPath = msg.req.body.myLocationPath;\nvar myScale = msg.req.body.myScale;\n\nvar guid = Date.now();\n\nmsg.filename = prefix + \"/\" + filename;\nmsg.payload = msg.req.files[0].buffer;\n\nvar msg1 = {};\nmsg1.filename = prefix + \"/wpkg_\" + guid + \".wp\";\nmsg1.payload = \"\";\nmsg1.payload += myName + \";\"; \nmsg1.payload += filename + \";\";\nmsg1.payload += myScale + \";\"\nmsg1.payload += myName + \".json\" + \";\";\nmsg1.payload += myCommonName + \";\"; \nmsg1.payload += myLocationKey + \";\"; \nmsg1.payload += myLocationPath + \";\"; \nmsg1.payload += myCommonName + \".ab\" + \";\";\n\nreturn [msg, msg1];\n*/","outputs":1,"noerr":0,"x":590,"y":760,"wires":[["88c7c33c.fc728"]]},{"id":"3b0e4f73.6706f","type":"debug","z":"c61d9d5f.52591","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":590,"y":820,"wires":[]},{"id":"9ec012da.d1fb6","type":"http in","z":"50191f06.dc99e","name":"[GET] /getfile2","url":"/getfile2","method":"get","upload":false,"swaggerDoc":"","x":130,"y":940,"wires":[["ef24a994.90f6d8"]]},{"id":"ef24a994.90f6d8","type":"function","z":"50191f06.dc99e","name":"","func":"var fsPref = \"/ragrug_mnt/uploads\";\nvar fn = fsPref + \"/\" + msg.payload.name;\nmsg.filename = fn;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":390,"y":940,"wires":[["43057bc9.c433f4","60a4020c.5ac21c"]]},{"id":"10acccf8.bc9dd3","type":"debug","z":"a26281bc.ae89f","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1230,"y":660,"wires":[]},{"id":"314c8074.0fb9c","type":"function","z":"a26281bc.ae89f","name":"","func":"var key = msg.payload.key;\nvar value = msg.payload.value;\nvar id = msg.payload.id;\n\nvar mqttTopic = value;\nmsg.payload = {};\nmsg.payload.mqttTopic = mqttTopic;\n//msg.payload = \"test\";\nreturn msg;","outputs":1,"noerr":0,"x":990,"y":780,"wires":[["10acccf8.bc9dd3","749d98cc.b5ba28"]]},{"id":"749d98cc.b5ba28","type":"mqtt out","z":"a26281bc.ae89f","name":"","topic":"NR/linking","qos":"0","retain":"false","broker":"73e9a24f.21590c","x":1210,"y":780,"wires":[]},{"id":"3dbd12ee.3b37fe","type":"mqtt in","z":"a26281bc.ae89f","name":"","topic":"NR/linking","qos":"0","datatype":"auto","broker":"73e9a24f.21590c","x":1000,"y":860,"wires":[["27905a94.af70b6"]]},{"id":"27905a94.af70b6","type":"debug","z":"a26281bc.ae89f","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1230,"y":860,"wires":[]},{"id":"f28e1b7b.87c6e8","type":"function","z":"eb66deb5.bea27","name":"telemetry/inffeld16/2nd/id2068/littleserver/RJ45/bandwidth","func":"var sensor = {};\nvar max = 0;\nvar min = 0;\n\nmax = 1000;\nmin = 450;\nvar v1 = Math.random() * (max - min) + min;\n\nsensor.bandwidth_Mbps = v1;\n\nvar topic = \"telemetry/inffeld16/2nd/id2068/littleserver/RJ45/bandwidth\";\nmsg.topic = topic;\nmsg.payload = sensor;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":450,"y":1740,"wires":[["962e4f47.2a82f"]]},{"id":"9e3480a5.95b7b","type":"inject","z":"eb66deb5.bea27","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"1","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":130,"y":1740,"wires":[["f28e1b7b.87c6e8"]]},{"id":"798aedc3.f5a484","type":"debug","z":"50191f06.dc99e","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":690,"y":500,"wires":[]},{"id":"3cf016d3.4c184a","type":"mqtt in","z":"e9bcdddb.5dd08","name":"","topic":"vis/interaction/selectedfield","qos":"0","datatype":"auto","broker":"73e9a24f.21590c","x":250,"y":280,"wires":[["c3416e89.bc74b"]]},{"id":"5c68cf57.e40f9","type":"mqtt in","z":"e9bcdddb.5dd08","d":true,"name":"","topic":"telemetry/inffeld16/2nd/id2068/littleserver/DC-BIG/#","qos":"0","datatype":"auto","broker":"73e9a24f.21590c","x":310,"y":380,"wires":[["c3416e89.bc74b"]]},{"id":"9f6a5fad.c4e46","type":"mqtt in","z":"e9bcdddb.5dd08","d":true,"name":"","topic":"telemetry/inffeld16/2nd/id2068/littleserver/RJ45/#","qos":"0","datatype":"auto","broker":"73e9a24f.21590c","x":300,"y":440,"wires":[["c3416e89.bc74b"]]},{"id":"4603d05d.7e97c","type":"function","z":"99d538c.efbabc8","name":"Artist list","func":"var dataIn = \n{ \n    \"artists\":[\n        \"Bruno Mars\", \n        \"The Beetles\", \n        \"Pink Floyd\", \n        \"U2\", \n        \"Kiss\", \n        \"Madonna\", \n        \"Michael Jackson\", \n        \"Abba\", \n        \"Red Hot Chilli Peppers\", \n        \"Oasis\", \n        \"Queen\", \n        \"Elton John\", \n        \"Roxette\", \n        \"David Bowie\", \n        \"Foo Fighters\", \n        \"Lady Gaga\",\n        \"Coldplay\",\n        \"Bon Jovi\",\n        \"Guns  N' Roses\",\n        \"Led Zeppelin\",\n        \"Rolling Stones\",\n        \"Nirvana\",\n        \"Dream Theater\",\n        \"Faith no More\",\n        \"Alice Cooper\",\n        \"Celtic Frost\",\n        \"Radiohead\",\n        \"Pearl Jam\",\n        \"The Offspring\",\n        \"Pink Floyd\",\n        \"Rage Against the Machine\",\n        \"Slipknot\",\n        \"Fear Factory\",\n        \"Spice Girls\",\n        \"Britney Spears\",\n        \"Alanis Morisette\",\n        \"Hanson\",\n        \"Prince\",\n        \"David Bowie\",\n        \"Backstreet Boys\",\n        \"The Cardigans\",\n        \"Dido\",\n        \"Ricky Martin\",\n        \"Shakira\",\n        \"Mariah Carey\",\n        \"NSYNC\",\n        \"Aqua\",\n        \"Christina Aguilera\",\n        \"Jenifer Lopez\",\n        \"Haddaway\",\n        \"Bee Gees\"\n    ] \n}\nmsg.payload = dataIn;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":280,"y":60,"wires":[["6fd40a4f.37ab84"]]},{"id":"e1da02a4.f9686","type":"http request","z":"99d538c.efbabc8","name":"","method":"use","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":530,"y":340,"wires":[["cac63bf2.020bd8"]]},{"id":"bf70dc6e.5cead","type":"function","z":"99d538c.efbabc8","name":"test load artist","func":"//http://musicbrainz.org/ws/2/artist/?query=artist:bruno%20AND%20type:group%20AND%20country:US\n//var artistFirst = \"bruno\";\n//var artistLast = \"mars\";\n\nvar artistFirst = \"marilyn\";\nvar artistLast = \"scott\";\n\nvar artistName = msg.payload;\n//msgT.payload.replace(\" \", \"%20\");\nartistName = artistName.split(' ').join('%20AND%20');\n\nvar msg = {};\nmsg.method = \"GET\";\nmsg.url = \"http://musicbrainz.org/ws/2/artist/?query=\";\nmsg.url += \"artist:\" + artistName + \"&fmt=json\";\n//msg.url += \"artist:\" + artistFirst + \"%20AND%20\" + artistLast + \"&fmt=json\";\n//msg.url += \"artist:bruno%20AND%20mars&fmt=json\";\n//msg.url += \"artist:bruno%20AND%20mars%20AND%20type=person&fmt=json\";\n\nmsg.headers = [];\nmsg.headers[\"Content-Type\"] = \"application/json\";\nmsg.headers[\"User-Agent\"] = \"Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.141 Mobile Safari/537.36\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":320,"y":340,"wires":[["e1da02a4.f9686"]]},{"id":"e6697db5.cdcf1","type":"debug","z":"99d538c.efbabc8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1010,"y":340,"wires":[]},{"id":"672446a3.0f5948","type":"function","z":"99d538c.efbabc8","name":"get artist results","func":"var data = msg.payload;\n\nif(data.hasOwnProperty(\"artists\")) {\n    var N = data.artists.length;\n    if(N > 0) {\n        for(var i = 0; i < N; i++) {\n            var artist = data.artists[i];\n            \n            var aId = artist.id;\n            var aScore = artist.score;\n            var aName = artist.name;\n            var aTags = artist.tags;\n            \n            var msgTmp = {\n                \"payload\":artist\n            };\n            node.send(msgTmp);\n        }\n    }\n}\n\nreturn null;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":160,"y":400,"wires":[["4963a1.d5e5bc6","3429ec09.875f74"]]},{"id":"cac63bf2.020bd8","type":"json","z":"99d538c.efbabc8","name":"","property":"payload","action":"","pretty":false,"x":810,"y":340,"wires":[["672446a3.0f5948","e6697db5.cdcf1"]]},{"id":"34de15d3.758f0a","type":"function","z":"99d538c.efbabc8","name":"access releases by artist","func":"//https://musicbrainz.org/ws/2/work?artist=b95ce3ff-3d05-4e87-9e01-c97b66af13d4\nhttps://musicbrainz.org/ws/2/release?artist=23a03e33-a603-404e-bcbf-2c00159d7067&fmt=json\nvar data = msg.payload;\n\nvar msg = {};\nmsg.method = \"GET\";\nmsg.url = \"https://musicbrainz.org/ws/2/release?\";\nmsg.url += \"artist=\" + data.id;\nmsg.url += \"&fmt=json\";\n\n\nmsg.headers = [];\nmsg.headers[\"Content-Type\"] = \"application/json\";\nmsg.headers[\"User-Agent\"] = \"Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.141 Mobile Safari/537.36\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":430,"y":480,"wires":[["61b9c839.057ea8"]]},{"id":"7ca0d28.1f4482c","type":"debug","z":"99d538c.efbabc8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1050,"y":640,"wires":[]},{"id":"61b9c839.057ea8","type":"http request","z":"99d538c.efbabc8","name":"","method":"use","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":630,"y":600,"wires":[["9a949bfa.3446e8","29639aa0.999e46"]]},{"id":"9a949bfa.3446e8","type":"json","z":"99d538c.efbabc8","name":"","property":"payload","action":"","pretty":false,"x":830,"y":640,"wires":[["7ca0d28.1f4482c","372ca893.c0bcc8"]]},{"id":"372ca893.c0bcc8","type":"function","z":"99d538c.efbabc8","name":"get artist results","func":"var data = msg.payload;\n\nif(data.hasOwnProperty(\"releases\")) {\n    var N = data.releases.length;\n    if(N > 0) {\n        for(var i = 0; i < N; i++) {\n            var r = data.releases[i];\n            \n            var rId = r.id;\n            var rTitle = r.title;\n            var rDate = r.date;\n            var aTags = r.tags;\n            \n            var msgTmp = {\n                \"payload\":r\n            };\n            node.send(msgTmp);\n        }\n    }\n}\n\nreturn null;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":600,"y":700,"wires":[["2bdf31fc.45aa1e"]]},{"id":"396ba39c.c6870c","type":"function","z":"99d538c.efbabc8","name":"access song by id","func":"// http://musicbrainz.org/ws/2/release/59211ea4-ffd2-4ad9-9a4e-941d3148024a?inc=artist-credits+labels+discids+recordings\n\nvar data = msg.payload;\n\nvar msg = {};\nmsg.method = \"GET\";\n\n//test with recording\nmsg.url = \"https://musicbrainz.org/ws/2/release\";\nmsg.url += \"/\" + data.id;\nmsg.url += \"?inc=artist-credits+labels+discids+recordings&fmt=json\";\n\n\nmsg.headers = [];\nmsg.headers[\"Content-Type\"] = \"application/json\";\nmsg.headers[\"User-Agent\"] = \"Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.141 Mobile Safari/537.36\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":450,"y":780,"wires":[["dcd1993a.b673a8"]]},{"id":"dcd1993a.b673a8","type":"http request","z":"99d538c.efbabc8","name":"","method":"use","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":690,"y":780,"wires":[["e0f2b912.7e4508"]]},{"id":"bc6351f1.a1793","type":"debug","z":"99d538c.efbabc8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1070,"y":760,"wires":[]},{"id":"e0f2b912.7e4508","type":"json","z":"99d538c.efbabc8","name":"","property":"payload","action":"","pretty":false,"x":850,"y":780,"wires":[["bc6351f1.a1793","e5bfe64.0eef018","c18903.742827"]]},{"id":"a1bf49a6.d9add8","type":"function","z":"99d538c.efbabc8","name":"get image art","func":"//> GET /release/76df3287-6cda-33eb-8e9a-044b5e15ffdd HTTP/1.1\n//> Host: coverartarchive.org\n//> Accept: application/json\n\nvar data = msg.payload;\n\nvar msg = {};\nmsg.method = \"GET\";\nmsg.url = \"https://coverartarchive.org/release\";\nmsg.url += \"/\" + data.id;\n\nmsg.headers = [];\nmsg.headers[\"Accept\"] = \"application/json\";\nmsg.headers[\"Content-Type\"] = \"application/json\";\nmsg.headers[\"User-Agent\"] = \"Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.141 Mobile Safari/537.36\";\nreturn msg;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":410,"y":960,"wires":[["16be859e.264f5a"]]},{"id":"16be859e.264f5a","type":"http request","z":"99d538c.efbabc8","name":"","method":"use","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":610,"y":960,"wires":[["57610053.809c3","91a073d3.598ad"]]},{"id":"68b44448.df508c","type":"debug","z":"99d538c.efbabc8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1050,"y":980,"wires":[]},{"id":"57610053.809c3","type":"json","z":"99d538c.efbabc8","name":"","property":"payload","action":"","pretty":false,"x":830,"y":980,"wires":[["68b44448.df508c","b0fcab79.d7dbf8","1f6ffb72.15db95"]]},{"id":"e5bfe64.0eef018","type":"delay","z":"99d538c.efbabc8","name":"","pauseType":"rate","timeout":"25","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"30","randomLast":"45","randomUnits":"seconds","drop":false,"x":460,"y":880,"wires":[["a1bf49a6.d9add8"]]},{"id":"2bdf31fc.45aa1e","type":"delay","z":"99d538c.efbabc8","name":"","pauseType":"rate","timeout":"25","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"25","randomLast":"45","randomUnits":"seconds","drop":false,"x":860,"y":700,"wires":[["396ba39c.c6870c"]]},{"id":"b0fcab79.d7dbf8","type":"function","z":"99d538c.efbabc8","name":"prepare image download","func":"var prefix = \"/ragrug_mnt/uploads\";\n\nvar headers = [];\nheaders[\"Content-Type\"] = \"application/json\";\nheaders[\"User-Agent\"] = \"Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.141 Mobile Safari/537.36\";\n\nvar data = msg.payload;\nif(data.hasOwnProperty(\"images\")) {\n    var N = data.images.length;\n    if(N > 0) {\n        for(var i = 0; i < N; i++) {\n            var img = data.images[i];\n            if(img.front == true) {\n                var imgUrl = img.image;\n                var imgId = img.id;\n            \n                //prepare download\n                var msgT = {};\n                msgT.headers = headers;\n                msgT.method = \"GET\";\n                msgT.url = imgUrl;\n                msgT.filename = prefix + \"/\" + imgId + \".jpg\";\n                node.send(msgT);\n            }\n        }\n    }\n}\n\nreturn null;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":610,"y":1060,"wires":[["ac29a70.90cbc58"]]},{"id":"ac29a70.90cbc58","type":"http request","z":"99d538c.efbabc8","name":"download file","method":"use","ret":"bin","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":850,"y":1060,"wires":[["5382428a.182d1c"]]},{"id":"5382428a.182d1c","type":"file","z":"99d538c.efbabc8","name":"","filename":"","appendNewline":true,"createDir":true,"overwriteFile":"true","encoding":"none","x":890,"y":1120,"wires":[["a99c5469.b1c248"]]},{"id":"a99c5469.b1c248","type":"debug","z":"99d538c.efbabc8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1090,"y":1120,"wires":[]},{"id":"4963a1.d5e5bc6","type":"function","z":"99d538c.efbabc8","name":"insert artist","func":"var query = \"INSERT INTO mopop.artists \\\n(id, name, score, gender, country, type, disambiguation) \\\nVALUES \\\n(\" +\n\"'\" + msg.payload.id + \"',\" + \n\"'\" + msg.payload.name + \"',\" +  \nmsg.payload.score + \",\" +  \n\"'\" + msg.payload.gender + \"',\" +  \n\"'\" + msg.payload.country + \"',\" +  \n\"'\" + msg.payload.type + \"',\" +\n\"'\" + msg.payload.disambiguation + \"'\" +\n\");\"\n;\n\nmsg.payload = query;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1290,"y":400,"wires":[["e9bb2c18.e99af"]]},{"id":"e9bb2c18.e99af","type":"postgres","z":"99d538c.efbabc8","postgresdb":"20ba6cdb.ae7474","name":"","output":true,"perrow":false,"rowspermsg":"1","outputs":1,"x":1520,"y":840,"wires":[["ba757ca7.541a3"]]},{"id":"ba757ca7.541a3","type":"debug","z":"99d538c.efbabc8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1650,"y":840,"wires":[]},{"id":"c18903.742827","type":"function","z":"99d538c.efbabc8","name":"insert song","func":"//INSERT INTO mopop.works\n//(id, artistid, name, genre, published, coverart)\n//VALUES \n//('S1', 'A1', 'Song Test', 'genre test', NOW(), 'path/to/cover/file.jpg');\n\nnode.error(msg.payload.date);\nvar labelname = \"\";\ntry {\n    if(msg.payload[\"label-info\"][0].hasOwnProperty(\"name\")) {\n        labelname = msg.payload[\"label-info\"][0].label.name;\n    }\n} catch(err) {\n    \n}\n\nvar query = \"INSERT INTO mopop.works \\\n(id, artistid, name, genre, published, coverart, publisher) \\\nVALUES \\\n(\" +\n\"'\" + msg.payload.id + \"',\" + \n\"'\" + msg.payload[\"artist-credit\"][0].artist.id + \"',\" + \n\"'\" + msg.payload.title + \"',\" +  \n\"'\" + \"\" + \"',\" +  \n\"'\" + (new Date(msg.payload.date)).toUTCString() + \"',\" +\n\"'\" + \"\" + \"',\" +\n\"'\" + labelname + \"'\" +\n\");\"\n;\n\n\n\n\nmsg.payload = query;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1310,"y":840,"wires":[["e9bb2c18.e99af"]]},{"id":"1f6ffb72.15db95","type":"function","z":"99d538c.efbabc8","name":"insert coverart","func":"//INSERT INTO mopop.works\n//(id, artistid, name, genre, published, coverart)\n//VALUES \n//('S1', 'A1', 'Song Test', 'genre test', NOW(), 'path/to/cover/file.jpg');\n\n\n//UPDATE table_name\n//SET column1 = value1,\n//    column2 = value2,\n//    ...\n//WHERE condition;\n\nif(msg.payload.hasOwnProperty(\"images\")) {\n    if(msg.payload.images.length > 0) {\n        var mbReleaseUrl = msg.payload.release;\n        var songId = mbReleaseUrl.replace('https://musicbrainz.org/release/', '');\n        \n        var imageId = msg.payload.images[0].id;\n        var imageFile = imageId + \".jpg\";\n        \n        var query = \"UPDATE mopop.works \" +\n        \"SET \" + \n        \"coverart = \" + \"'\" + imageFile + \"',\" + \" \" +\n        \"coverid = \" + \"'\" + imageId + \"'\" + \" \" +\n        \n        \"WHERE id = \" + \"'\" + songId + \"'\";\n        \n        msg.payload = query;\n        return msg;\n    }\n}\nreturn null;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1320,"y":880,"wires":[["e9bb2c18.e99af"]]},{"id":"fae63b60.cb0fd8","type":"inject","z":"99d538c.efbabc8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":100,"y":60,"wires":[["4603d05d.7e97c"]]},{"id":"6fd40a4f.37ab84","type":"function","z":"99d538c.efbabc8","name":"ship entries","func":"var data = msg.payload.artists.reverse();\nfor(var i = 0; i < data.length; i++) {\n    var msgT = {};\n    msgT.payload = data[i];\n    node.send(msgT);\n}\nreturn null;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":290,"y":240,"wires":[["18e758e.9b017a7","21b99bbb.4dcfe4"]]},{"id":"18e758e.9b017a7","type":"debug","z":"99d538c.efbabc8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":770,"y":120,"wires":[]},{"id":"21b99bbb.4dcfe4","type":"delay","z":"99d538c.efbabc8","name":"","pauseType":"rate","timeout":"50","timeoutUnits":"seconds","rate":"1","nbRateUnits":"4","rateUnits":"second","randomFirst":"40","randomLast":"55","randomUnits":"seconds","drop":false,"x":520,"y":260,"wires":[["bf70dc6e.5cead"]]},{"id":"3429ec09.875f74","type":"delay","z":"99d538c.efbabc8","name":"","pauseType":"rate","timeout":"50","timeoutUnits":"seconds","rate":"1","nbRateUnits":"7","rateUnits":"second","randomFirst":"50","randomLast":"120","randomUnits":"seconds","drop":false,"x":440,"y":440,"wires":[["34de15d3.758f0a"]]},{"id":"ae42c0f3.ea53b","type":"mqtt in","z":"2e447439.f12bdc","name":"","topic":"MOPOP/wallscore","qos":"0","datatype":"auto","broker":"73e9a24f.21590c","x":150,"y":140,"wires":[["c8dbfd31.f69aa","7d293a45.58e8f4"]]},{"id":"c79d8fbd.bdebd","type":"function","z":"2e447439.f12bdc","name":"","func":"msg.payload = msg.payload.score;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":500,"y":140,"wires":[["9799e1fc.f59af"]]},{"id":"9799e1fc.f59af","type":"ui_chart","z":"2e447439.f12bdc","d":true,"name":"","group":"8a5dfa6b.024cc8","order":5,"width":"5","height":"4","label":"Current score","chartType":"line","legend":"false","xformat":"auto","interpolate":"linear","nodata":"","dot":true,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"20","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"x":680,"y":140,"wires":[[]]},{"id":"c8dbfd31.f69aa","type":"debug","z":"2e447439.f12bdc","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":350,"y":100,"wires":[]},{"id":"7d293a45.58e8f4","type":"json","z":"2e447439.f12bdc","name":"","property":"payload","action":"","pretty":false,"x":350,"y":140,"wires":[["c79d8fbd.bdebd"]]},{"id":"76ee8ef.9cf557","type":"ui_chart","z":"2e447439.f12bdc","d":true,"name":"","group":"8a5dfa6b.024cc8","order":5,"width":"5","height":"4","label":"Year distribution","chartType":"bar","legend":"true","xformat":"auto","interpolate":"linear","nodata":"","dot":true,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"20","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"x":740,"y":260,"wires":[[]]},{"id":"2a1a915d.db0f3e","type":"mqtt in","z":"2e447439.f12bdc","name":"","topic":"MOPOP/wallyearhist/#","qos":"0","datatype":"auto","broker":"73e9a24f.21590c","x":160,"y":260,"wires":[["bd875b22.28e0e8"]]},{"id":"bd875b22.28e0e8","type":"json","z":"2e447439.f12bdc","name":"","property":"payload","action":"","pretty":false,"x":370,"y":260,"wires":[["26de2d63.607bc2","19a45f06.e12561"]]},{"id":"26de2d63.607bc2","type":"function","z":"2e447439.f12bdc","name":"","func":"var nd = [];\n\nvar data = msg.payload;\nvar labels = [];\nvar vals = [];\nfor(var e in data) {\n    labels.push(e);\n    vals.push(data[e].val);\n}\n\nvar entry = {};\nentry.labels = [];\nentry.data = [[]];\nentry.series = [];\nentry.series[0] = \"\" + labels[0] + \" - \" + labels[labels.length-1];\nfor(var i = 0; i < labels.length; i++) {\n    var l = labels[i];\n    var v = vals[i];\n    entry.labels[i] = l;\n    entry.data[0].push(v);\n}\nnd.push(entry);\n\nmsg.payload = nd;\nreturn msg;\n\n\n\n/*\nvar m = {};\nm.labels = [\"Available Time\"];\nm.data = [[480]];\nm.series = [\"Total Time in 8 hours by Machine\"];\nvar arrayLength = msg.payload.length;\nfor (var i = 0; i < arrayLength; i++) {\n    m.labels.push((msg.payload[i].Machine));\n    m.data[0].push((msg.payload[i].TotalTime/60).toFixed(2));\n}\nreturn {payload:[m],topic:msg.topic};\n*/","outputs":1,"noerr":0,"initialize":"","finalize":"","x":520,"y":260,"wires":[["76ee8ef.9cf557","ab439928.c8a648"]]},{"id":"19a45f06.e12561","type":"debug","z":"2e447439.f12bdc","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":530,"y":220,"wires":[]},{"id":"ab439928.c8a648","type":"debug","z":"2e447439.f12bdc","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":750,"y":220,"wires":[]},{"id":"3142164.e467fea","type":"comment","z":"2e447439.f12bdc","name":"Current User score","info":"","x":150,"y":100,"wires":[]},{"id":"eb74b352.86535","type":"comment","z":"2e447439.f12bdc","name":"Current year distribution","info":"","x":160,"y":220,"wires":[]},{"id":"4eeef3b.dad070c","type":"comment","z":"2e447439.f12bdc","name":"User events","info":"","x":130,"y":340,"wires":[]},{"id":"1c41bd88.f98312","type":"mqtt in","z":"2e447439.f12bdc","name":"","topic":"MOPOP/userevents","qos":"0","datatype":"auto","broker":"73e9a24f.21590c","x":150,"y":380,"wires":[["f7dc12aa.5edda"]]},{"id":"f7dc12aa.5edda","type":"json","z":"2e447439.f12bdc","name":"","property":"payload","action":"","pretty":false,"x":330,"y":380,"wires":[["cedb88bc.fc6638","1a276dec.bdb9a2","542f0d7c.a5a154"]]},{"id":"cedb88bc.fc6638","type":"function","z":"2e447439.f12bdc","name":"","func":"var aRow = msg.payload;\naRow.datastr = JSON.stringify(aRow.data);\nmsg.payload = {};\nmsg.payload.command = \"addRow\";\nmsg.payload.arguments = [aRow];\nmsg.command = \"addRow\";\n\nif(aRow.id == 0) {\n    node.send({\"payload\":[]});\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":500,"y":380,"wires":[["21176231.00b1be"]]},{"id":"21176231.00b1be","type":"ui_table","z":"2e447439.f12bdc","group":"335e1fc0.afce7","name":"User events","order":1,"width":"6","height":"10","columns":[{"field":"time","title":"EventTime","width":"","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"user","title":"User","width":"","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"id","title":"EventId","width":"10%","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"name","title":"EventName","width":"15%","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"datastr","title":"EventData","width":"","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}}],"outputs":1,"cts":true,"x":670,"y":380,"wires":[["360b63c6.9c705c"]]},{"id":"1a276dec.bdb9a2","type":"debug","z":"2e447439.f12bdc","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":510,"y":340,"wires":[]},{"id":"20f4a32.3ab955c","type":"comment","z":"2e447439.f12bdc","name":"score testing","info":"","x":130,"y":540,"wires":[]},{"id":"caac694a.a8cda8","type":"inject","z":"2e447439.f12bdc","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":140,"y":580,"wires":[["92c52c59.89597"]]},{"id":"74e71579.13bdac","type":"mqtt out","z":"2e447439.f12bdc","name":"","topic":"MOPOP/wallscore","qos":"0","retain":"false","broker":"73e9a24f.21590c","x":490,"y":580,"wires":[]},{"id":"92c52c59.89597","type":"function","z":"2e447439.f12bdc","name":"set random","func":"for(var i = 0; i < 1; i++) {\n    var max = 0;\n    var min = 0;\n    \n    max = 100;\n    min = 35;\n    var v1 = Math.random() * (max - min) + min;\n    \n    var d = {\n        \"score\":v1\n    }\n    msg.payload = d;\n    node.send(msg);\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":310,"y":580,"wires":[["74e71579.13bdac"]]},{"id":"306cb7ad.6d8eb8","type":"inject","z":"2e447439.f12bdc","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":140,"y":700,"wires":[["7485da20.e3ae64"]]},{"id":"54c545ed.84593c","type":"mqtt out","z":"2e447439.f12bdc","name":"","topic":"MOPOP/wallyearhist/rockwall","qos":"0","retain":"false","broker":"73e9a24f.21590c","x":710,"y":760,"wires":[]},{"id":"7485da20.e3ae64","type":"function","z":"2e447439.f12bdc","name":"","func":"var max = 0;\nvar min = 0;\n\nmax = 100;\nmin = 35;\nvar v1 = Math.random() * (max - min) + min;\n\n//var d = {\"HW_A\":{\"1956\":2},\"HW_B\":{}};\nvar d = {\n    \"2000\": {\n        \"val\":1,\n        \"id\":0\n    }, \n    \"2004\":{\n        \"val\":2,\n        \"id\":4\n    },\n    \"2005\":{\n        \"val\":3,\n        \"id\":5\n    }\n};\nmsg.payload = d;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":320,"y":700,"wires":[["54c545ed.84593c"]]},{"id":"f677ddac.782cd","type":"inject","z":"2e447439.f12bdc","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":140,"y":740,"wires":[["13528724.2e3149"]]},{"id":"13528724.2e3149","type":"function","z":"2e447439.f12bdc","name":"","func":"var max = 0;\nvar min = 0;\n\nmax = 100;\nmin = 35;\nvar v1 = Math.random() * (max - min) + min;\n\n//var d = {\"HW_A\":{\"1956\":2},\"HW_B\":{}};\nvar d = {\n    \"2000\": {\n        \"val\":2,\n        \"id\":0\n    }, \n    \"2004\":{\n        \"val\":6,\n        \"id\":4\n    },\n    \"2017\":{\n        \"val\":1,\n        \"id\":7\n    },\n    \"2018\":{\n        \"val\":2,\n        \"id\":7\n    }\n};\nmsg.payload = d;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":320,"y":740,"wires":[["54c545ed.84593c"]]},{"id":"bf173bf3.b80038","type":"comment","z":"2e447439.f12bdc","name":"hist testing","info":"","x":120,"y":660,"wires":[]},{"id":"b3ae7265.e7f86","type":"comment","z":"2e447439.f12bdc","name":"event testing","info":"","x":130,"y":460,"wires":[]},{"id":"a97f3c17.ddae7","type":"inject","z":"2e447439.f12bdc","name":"","props":[{"p":"payload","v":"","vt":"date"},{"p":"topic","v":"","vt":"string"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":140,"y":500,"wires":[["97108574.df7548"]]},{"id":"8454ed3d.87072","type":"mqtt out","z":"2e447439.f12bdc","name":"","topic":"MOPOP/userevents","qos":"0","retain":"false","broker":"73e9a24f.21590c","x":800,"y":500,"wires":[]},{"id":"97108574.df7548","type":"function","z":"2e447439.f12bdc","name":"","func":"\nfor(var i= 0; i < 1; i++) {\n    var d = {\n        \"user\":\"user000\",\n        \"name\": \"picked\",\n        \"id\":1,\n        \"data\": \n        {\n            \"id\": 12003249\n        },\n        //\"time\": new Date()\n        \"time\": Date.now()\n    }\n    msg.payload = d;\n    node.send(msg);\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":300,"y":500,"wires":[["c9f5ddbf.b8f84"]]},{"id":"542f0d7c.a5a154","type":"function","z":"2e447439.f12bdc","name":"","func":"var prefix = \"/ragrug_mnt/usereval\";\nvar filename = prefix + \"/\" + msg.payload.user + \".json\"\nmsg.filename = filename;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":500,"y":420,"wires":[["16cb044.b49d6fc"]]},{"id":"16cb044.b49d6fc","type":"file","z":"2e447439.f12bdc","name":"","filename":"","appendNewline":true,"createDir":true,"overwriteFile":"false","encoding":"none","x":650,"y":420,"wires":[["18b92ea5.fb5a71"]]},{"id":"18b92ea5.fb5a71","type":"debug","z":"2e447439.f12bdc","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":810,"y":420,"wires":[]},{"id":"91a073d3.598ad","type":"debug","z":"99d538c.efbabc8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1050,"y":900,"wires":[]},{"id":"eaf36d0e.a73cc","type":"catch","z":"99d538c.efbabc8","name":"","scope":["57610053.809c3"],"uncaught":false,"x":830,"y":900,"wires":[["91a073d3.598ad"]]},{"id":"5c01650f.b0d23c","type":"function","z":"99d538c.efbabc8","name":"The Offspring","func":"var dataIn = \n{ \n    \"artists\":[\n    \"The Offspring\"\n    ] \n}\nmsg.payload = dataIn;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":300,"y":140,"wires":[["6fd40a4f.37ab84"]]},{"id":"39494118.7ec59e","type":"inject","z":"99d538c.efbabc8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":100,"y":140,"wires":[["5c01650f.b0d23c"]]},{"id":"29639aa0.999e46","type":"function","z":"99d538c.efbabc8","name":"get all releases","func":"var baseurl = msg.url;\nvar data = JSON.parse(msg.payload);\nvar releaseCount = data[\"release-count\"];\nvar offset = data[\"release-offset\"];\n\nvar oPos = baseurl.indexOf('&offset=');\nif(oPos > 0) {\n    baseurl = baseurl.substr(0, oPos);\n}\n\noffset += 25;\nif(offset < releaseCount) {\n    var tmsg = {};\n    tmsg.method = \"GET\";\n    tmsg.url = baseurl + \"&offset=\"+offset;\n    tmsg.headers = {};\n    //tmsg.headers[\"Accept\"] = \"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9\";\n    tmsg.headers[\"Content-Type\"] = \"application/json\";\n    //tmsg.headers[\"User-Agent\"] = \"Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.190 Mobile Safari/537.36\";\n    tmsg.headers[\"User-Agent\"] = \"python-musicbrainz/0.7.3\";\n    return tmsg;\n}\nreturn null;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":860,"y":520,"wires":[["ac0ecc00.0d45c8","efdc23ae.9c1a8"]]},{"id":"ac0ecc00.0d45c8","type":"delay","z":"99d538c.efbabc8","name":"","pauseType":"rate","timeout":"3","timeoutUnits":"seconds","rate":"1","nbRateUnits":"3","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":740,"y":440,"wires":[["61b9c839.057ea8"]]},{"id":"efdc23ae.9c1a8","type":"debug","z":"99d538c.efbabc8","name":"release offset debug","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1120,"y":520,"wires":[]},{"id":"2ee1c953.352f06","type":"function","z":"99d538c.efbabc8","name":"Roger Cicero","func":"var dataIn = \n{ \n    \"artists\":[\n    \"Roger Cicero\"\n    ] \n}\nmsg.payload = dataIn;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":290,"y":180,"wires":[["6fd40a4f.37ab84"]]},{"id":"102b9682.d04309","type":"inject","z":"99d538c.efbabc8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":100,"y":180,"wires":[["2ee1c953.352f06"]]},{"id":"89a9061f.adc198","type":"http request","z":"99d538c.efbabc8","name":"","method":"use","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":870,"y":580,"wires":[["9a949bfa.3446e8","727a0e5e.18c6f"]]},{"id":"727a0e5e.18c6f","type":"debug","z":"99d538c.efbabc8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1070,"y":580,"wires":[]},{"id":"42ec75c2.3616cc","type":"function","z":"99d538c.efbabc8","name":"Artist list partial","func":"var dataIn = \n{ \n    \"artists\":[\n        \"Bruno Mars\", \n        \"The Beetles\", \n        \"Pink Floyd\", \n        \"U2\", \n        \"Kiss\", \n        \"Madonna\", \n        \"Michael Jackson\", \n        \"Abba\", \n        \"Red Hot Chilli Peppers\", \n        \"Oasis\", \n        \"Queen\", \n        \"Elton John\", \n        \"Roxette\", \n        \"David Bowie\", \n        \"Foo Fighters\", \n        \"Lady Gaga\",\n        \"Coldplay\",\n        \"Bon Jovi\",\n        \"Guns  N' Roses\",\n        \"Led Zeppelin\",\n        \"Rolling Stones\",\n        \"Nirvana\",\n        \"Dream Theater\",\n        \"Faith no More\",\n        \"Alice Cooper\",\n        \"Celtic Frost\",\n        \"Radiohead\",\n        \"Pearl Jam\"\n    ] \n}\nmsg.payload = dataIn;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":300,"y":100,"wires":[["6fd40a4f.37ab84"]]},{"id":"20197e83.c58682","type":"inject","z":"99d538c.efbabc8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":100,"y":100,"wires":[["42ec75c2.3616cc"]]},{"id":"96a13a78.ecfb68","type":"inject","z":"2e447439.f12bdc","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":120,"y":1140,"wires":[["42cc80e8.8ce6a"]]},{"id":"a78a7bb4.188068","type":"mqtt out","z":"2e447439.f12bdc","name":"","topic":"MOPOP/infocompare/0","qos":"0","retain":"false","broker":"73e9a24f.21590c","x":510,"y":1140,"wires":[]},{"id":"42cc80e8.8ce6a","type":"function","z":"2e447439.f12bdc","name":"","func":"var max = 0;\nvar min = 0;\n\nmax = 100;\nmin = 35;\nvar v1 = Math.random() * (max - min) + min;\n\n//var d = {\"HW_A\":{\"1956\":2},\"HW_B\":{}};\nvar d = {\n    \"0\":{\n        \"val\":60,\n        \"id\": 0\n    },\n    \"1\": {\n        \"val\":v1,\n        \"id\":  1\n    }\n};\nmsg.payload = d;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":280,"y":1140,"wires":[["a78a7bb4.188068"]]},{"id":"95f4bce1.ce754","type":"inject","z":"2e447439.f12bdc","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":120,"y":1180,"wires":[["1426459f.5548da"]]},{"id":"18f2a5ff.a0e08a","type":"comment","z":"2e447439.f12bdc","name":"compare chart testing","info":"","x":140,"y":1100,"wires":[]},{"id":"ded8d133.46c1","type":"mqtt out","z":"2e447439.f12bdc","name":"","topic":"MOPOP/infocompare/1","qos":"0","retain":"false","broker":"73e9a24f.21590c","x":510,"y":1180,"wires":[]},{"id":"1426459f.5548da","type":"function","z":"2e447439.f12bdc","name":"","func":"var max = 0;\nvar min = 0;\n\nmax = 100;\nmin = 35;\nvar v1 = Math.random() * (max - min) + min;\n\n//var d = {\"HW_A\":{\"1956\":2},\"HW_B\":{}};\nvar d = {\n    \"0\":{\n        \"val\":20,\n        \"id\":0\n    },\n    \"1\": {\n        \"val\":30,\n        \"id\":1\n    }\n};\nmsg.payload = d;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":280,"y":1180,"wires":[["ded8d133.46c1"]]},{"id":"c9f5ddbf.b8f84","type":"delay","z":"2e447439.f12bdc","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"120","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":530,"y":500,"wires":[["8454ed3d.87072"]]},{"id":"1da94e12.1c6ef2","type":"inject","z":"2e447439.f12bdc","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":120,"y":1220,"wires":[["30d1362d.2d5a6a"]]},{"id":"3b577e9e.733b62","type":"mqtt out","z":"2e447439.f12bdc","name":"","topic":"MOPOP/infocompare/2","qos":"0","retain":"false","broker":"73e9a24f.21590c","x":510,"y":1220,"wires":[]},{"id":"30d1362d.2d5a6a","type":"function","z":"2e447439.f12bdc","name":"","func":"var max = 0;\nvar min = 0;\n\nmax = 100;\nmin = 35;\nvar v1 = Math.random() * (max - min) + min;\n\n//var d = {\"HW_A\":{\"1956\":2},\"HW_B\":{}};\nvar d = {\n    \"0\":{\n        \"val\":25,\n        \"id\":0\n    },\n    \"1\": {\n        \"val\":5,\n        \"id\":1\n    }\n};\nmsg.payload = d;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":280,"y":1220,"wires":[["3b577e9e.733b62"]]},{"id":"29704e18.3a3702","type":"ui_button","z":"dd11dd22.8a11a","name":"","group":"b94d6635.f9dd08","order":3,"width":0,"height":0,"passthru":false,"label":"Open Menu","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":250,"y":240,"wires":[["16094838.3b88e8"]]},{"id":"16094838.3b88e8","type":"function","z":"dd11dd22.8a11a","name":"","func":"msg.payload = \"PlayClick();MOPOP_MenuShow();\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":480,"y":240,"wires":[["fc2c82b.af2f08"]]},{"id":"7fee0905.a21e88","type":"mqtt out","z":"dd11dd22.8a11a","name":"","topic":"arclient/inject","qos":"0","retain":"false","broker":"73e9a24f.21590c","x":930,"y":200,"wires":[]},{"id":"63e83ab7.44e554","type":"debug","z":"dd11dd22.8a11a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":930,"y":280,"wires":[]},{"id":"57c88a12.0bc484","type":"ui_button","z":"dd11dd22.8a11a","name":"","group":"b94d6635.f9dd08","order":4,"width":0,"height":0,"passthru":false,"label":"Import Assets","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":260,"y":280,"wires":[["d8c0d124.fbbe7"]]},{"id":"d8c0d124.fbbe7","type":"function","z":"dd11dd22.8a11a","name":"","func":"msg.payload = \"PlayClick();MOPOP_ImportAssets();\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":480,"y":280,"wires":[["fc2c82b.af2f08"]]},{"id":"fc2c82b.af2f08","type":"function","z":"dd11dd22.8a11a","name":"","func":"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":720,"y":200,"wires":[["7fee0905.a21e88","63e83ab7.44e554"]]},{"id":"b50688de.a83eb8","type":"ui_text_input","z":"dd11dd22.8a11a","name":"","label":"","tooltip":"","group":"b94d6635.f9dd08","order":1,"width":0,"height":0,"passthru":true,"mode":"text","delay":300,"topic":"","x":240,"y":180,"wires":[["fc2c82b.af2f08"]]},{"id":"776dceb.981ee3","type":"ui_button","z":"dd11dd22.8a11a","name":"","group":"b94d6635.f9dd08","order":5,"width":0,"height":0,"passthru":false,"label":"Init Env","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":240,"y":320,"wires":[["e9c815e0.bc28a8"]]},{"id":"e9c815e0.bc28a8","type":"function","z":"dd11dd22.8a11a","name":"","func":"msg.payload = \"PlayClick();MOPOP_InitEnv();\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":480,"y":320,"wires":[["fc2c82b.af2f08"]]},{"id":"e8e8b43b.d0a9d8","type":"ui_text","z":"dd11dd22.8a11a","d":true,"group":"b94d6635.f9dd08","order":2,"width":0,"height":0,"name":"","label":"Response","format":"{{msg.payload}}","layout":"col-center","x":580,"y":520,"wires":[]},{"id":"4c8a03a3.61c52c","type":"mqtt in","z":"dd11dd22.8a11a","name":"","topic":"arclient/response","qos":"0","datatype":"auto","broker":"73e9a24f.21590c","x":270,"y":520,"wires":[["e8e8b43b.d0a9d8"]]},{"id":"600514a7.660a1c","type":"ui_button","z":"dd11dd22.8a11a","name":"","group":"b94d6635.f9dd08","order":6,"width":0,"height":0,"passthru":false,"label":"Start Tracking","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":260,"y":360,"wires":[["423a6f9a.5f4cf"]]},{"id":"423a6f9a.5f4cf","type":"function","z":"dd11dd22.8a11a","name":"","func":"msg.payload = \"PlayClick();MOPOP_TestDB();\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":480,"y":360,"wires":[["fc2c82b.af2f08"]]},{"id":"2e7729d9.598d86","type":"ui_text","z":"dd11dd22.8a11a","d":true,"group":"b94d6635.f9dd08","order":7,"width":"0","height":"0","name":"","label":"Sample Change color","format":"MAIN.UE.GameObject.Find('UCanvas_0bg').GetComponent(MAIN.UE.Renderer).material.color = MAIN.UE.Color.red;","layout":"col-center","x":540,"y":580,"wires":[]},{"id":"7829f817.cd62f8","type":"ui_button","z":"dd11dd22.8a11a","name":"","group":"b94d6635.f9dd08","order":6,"width":0,"height":0,"passthru":false,"label":"Toggle Manipulation","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":280,"y":400,"wires":[["5dff1ae5.903b14"]]},{"id":"5dff1ae5.903b14","type":"function","z":"dd11dd22.8a11a","name":"","func":"msg.payload = \"PlayClick();MOPOP_ToggleWallManipulation();\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":480,"y":400,"wires":[["fc2c82b.af2f08"]]},{"id":"e4532502.397308","type":"ui_button","z":"dd11dd22.8a11a","name":"","group":"b94d6635.f9dd08","order":6,"width":0,"height":0,"passthru":false,"label":"Save Env","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":240,"y":440,"wires":[["67e96753.79e958"]]},{"id":"67e96753.79e958","type":"function","z":"dd11dd22.8a11a","name":"","func":"msg.payload = \"PlayClick();MOPOP_SaveEnv();\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":480,"y":440,"wires":[["fc2c82b.af2f08"]]},{"id":"99ba1aca.6f95d8","type":"comment","z":"dd11dd22.8a11a","name":"Master control","info":"","x":160,"y":120,"wires":[]},{"id":"e7825d4f.39039","type":"ui_text","z":"dd11dd22.8a11a","group":"2396ab21.3b7d44","order":1,"width":18,"height":1,"name":"","label":"Score","format":"{{msg.payload.toFixed(2)}}","layout":"row-center","x":810,"y":960,"wires":[]},{"id":"40f365cd.558e5c","type":"mqtt in","z":"dd11dd22.8a11a","name":"","topic":"MOPOP/wallscore","qos":"2","datatype":"auto","broker":"73e9a24f.21590c","x":250,"y":900,"wires":[["2554608a.b43a","33e3379c.4e7d58"]]},{"id":"bace8f13.657c2","type":"function","z":"dd11dd22.8a11a","name":"","func":"msg.payload = msg.payload.score;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":600,"y":900,"wires":[["db761842.bba938","e7825d4f.39039","7e8144a3.3e1acc"]]},{"id":"db761842.bba938","type":"ui_chart","z":"dd11dd22.8a11a","name":"","group":"2396ab21.3b7d44","order":3,"width":6,"height":5,"label":"","chartType":"line","legend":"false","xformat":"auto","interpolate":"linear","nodata":"","dot":true,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"20","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"x":810,"y":900,"wires":[[]]},{"id":"2554608a.b43a","type":"debug","z":"dd11dd22.8a11a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":550,"y":840,"wires":[]},{"id":"33e3379c.4e7d58","type":"json","z":"dd11dd22.8a11a","name":"","property":"payload","action":"","pretty":false,"x":450,"y":900,"wires":[["bace8f13.657c2"]]},{"id":"51149c8f.f66cf4","type":"comment","z":"dd11dd22.8a11a","name":"Current User score","info":"","x":240,"y":840,"wires":[]},{"id":"360b63c6.9c705c","type":"ui_text","z":"2e447439.f12bdc","group":"335e1fc0.afce7","order":1,"width":0,"height":0,"name":"","label":"Selection","format":"{{msg.payload}}","layout":"col-center","x":840,"y":380,"wires":[]},{"id":"c5f7100f.996d6","type":"comment","z":"dd11dd22.8a11a","name":"Year distributions","info":"","x":220,"y":1160,"wires":[]},{"id":"55d4a0bf.415f4","type":"ui_chart","z":"dd11dd22.8a11a","name":"","group":"2396ab21.3b7d44","order":2,"width":6,"height":5,"label":"Rock","chartType":"bar","legend":"true","xformat":"auto","interpolate":"linear","nodata":"","dot":true,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"20","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"x":850,"y":1220,"wires":[[]]},{"id":"361ba2de.c16cce","type":"mqtt in","z":"dd11dd22.8a11a","name":"","topic":"MOPOP/wallyearhist/rockwall","qos":"0","datatype":"auto","broker":"73e9a24f.21590c","x":280,"y":1220,"wires":[["40847847.561318"]]},{"id":"40847847.561318","type":"json","z":"dd11dd22.8a11a","name":"","property":"payload","action":"","pretty":false,"x":510,"y":1220,"wires":[["7e2fd011.e233d","8a3f06d.07eaef8"]]},{"id":"7e2fd011.e233d","type":"function","z":"dd11dd22.8a11a","name":"","func":"var nd = [];\n\nvar data = msg.payload;\nvar labels = [];\nvar vals = [];\nfor(var e in data) {\n    labels.push(e);\n    vals.push(data[e].val);\n}\n\nvar entry = {};\nentry.labels = [];\nentry.data = [[]];\nentry.series = [];\nentry.series[0] = \"\" + labels[0] + \" - \" + labels[labels.length-1];\nfor(var i = 0; i < labels.length; i++) {\n    var l = labels[i];\n    var v = vals[i];\n    entry.labels[i] = l;\n    entry.data[0].push(v);\n}\nnd.push(entry);\n\nmsg.payload = nd;\nreturn msg;\n\n\n\n/*\nvar m = {};\nm.labels = [\"Available Time\"];\nm.data = [[480]];\nm.series = [\"Total Time in 8 hours by Machine\"];\nvar arrayLength = msg.payload.length;\nfor (var i = 0; i < arrayLength; i++) {\n    m.labels.push((msg.payload[i].Machine));\n    m.data[0].push((msg.payload[i].TotalTime/60).toFixed(2));\n}\nreturn {payload:[m],topic:msg.topic};\n*/","outputs":1,"noerr":0,"initialize":"","finalize":"","x":660,"y":1220,"wires":[["55d4a0bf.415f4","94651dc6.3da8d"]]},{"id":"8a3f06d.07eaef8","type":"debug","z":"dd11dd22.8a11a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":670,"y":1160,"wires":[]},{"id":"94651dc6.3da8d","type":"debug","z":"dd11dd22.8a11a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":890,"y":1160,"wires":[]},{"id":"9582a8e0.2fe298","type":"ui_chart","z":"dd11dd22.8a11a","name":"","group":"2396ab21.3b7d44","order":4,"width":6,"height":5,"label":"Pop","chartType":"bar","legend":"true","xformat":"auto","interpolate":"linear","nodata":"","dot":true,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"20","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"x":850,"y":1340,"wires":[[]]},{"id":"19cab02f.0a9cf","type":"mqtt in","z":"dd11dd22.8a11a","name":"","topic":"MOPOP/wallyearhist/popwall","qos":"0","datatype":"auto","broker":"73e9a24f.21590c","x":280,"y":1340,"wires":[["2adebd4e.02e872"]]},{"id":"2adebd4e.02e872","type":"json","z":"dd11dd22.8a11a","name":"","property":"payload","action":"","pretty":false,"x":510,"y":1340,"wires":[["c4a82bef.b3d5e8","cc449244.98a34"]]},{"id":"c4a82bef.b3d5e8","type":"function","z":"dd11dd22.8a11a","name":"","func":"var nd = [];\n\nvar data = msg.payload;\nvar labels = [];\nvar vals = [];\nfor(var e in data) {\n    labels.push(e);\n    vals.push(data[e].val);\n}\n\nvar entry = {};\nentry.labels = [];\nentry.data = [[]];\nentry.series = [];\nentry.series[0] = \"\" + labels[0] + \" - \" + labels[labels.length-1];\nfor(var i = 0; i < labels.length; i++) {\n    var l = labels[i];\n    var v = vals[i];\n    entry.labels[i] = l;\n    entry.data[0].push(v);\n}\nnd.push(entry);\n\nmsg.payload = nd;\nreturn msg;\n\n\n\n/*\nvar m = {};\nm.labels = [\"Available Time\"];\nm.data = [[480]];\nm.series = [\"Total Time in 8 hours by Machine\"];\nvar arrayLength = msg.payload.length;\nfor (var i = 0; i < arrayLength; i++) {\n    m.labels.push((msg.payload[i].Machine));\n    m.data[0].push((msg.payload[i].TotalTime/60).toFixed(2));\n}\nreturn {payload:[m],topic:msg.topic};\n*/","outputs":1,"noerr":0,"initialize":"","finalize":"","x":660,"y":1340,"wires":[["9582a8e0.2fe298","61b9d8d3.491098"]]},{"id":"cc449244.98a34","type":"debug","z":"dd11dd22.8a11a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":670,"y":1280,"wires":[]},{"id":"61b9d8d3.491098","type":"debug","z":"dd11dd22.8a11a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":890,"y":1280,"wires":[]},{"id":"3d6e96e1.2cd63a","type":"function","z":"e9bcdddb.5dd08","name":"test select","func":"var clicked = {\n    \"deviceId\":\"NETGEAR81-5G-bigserver\",\n    \"partId\":\"RJ45\",\n    \"fieldname\":\"outbound_mbps\",\n    \"mqtt\":\"telemetry/inffeld16/2nd/id2068/bigserver/RJ45/#\"\n}\nmsg.payload = clicked;\nmsg.topic = \"vis/interaction/selectedfield\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":880,"y":280,"wires":[["a4fc6502.633628"]]},{"id":"a4fc6502.633628","type":"mqtt out","z":"e9bcdddb.5dd08","name":"","topic":"","qos":"","retain":"","broker":"73e9a24f.21590c","x":1090,"y":280,"wires":[]},{"id":"9f81a6f5.f43028","type":"inject","z":"e9bcdddb.5dd08","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":710,"y":280,"wires":[["3d6e96e1.2cd63a"]]},{"id":"28e230f6.f8748","type":"mqtt in","z":"e9bcdddb.5dd08","name":"","topic":"rr/vis/replication/#","qos":"0","datatype":"auto","broker":"73e9a24f.21590c","x":160,"y":980,"wires":[["873eb8c4.553688"]]},{"id":"873eb8c4.553688","type":"debug","z":"e9bcdddb.5dd08","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":470,"y":980,"wires":[]},{"id":"effcd3e9.0a7ff","type":"mqtt in","z":"eb66deb5.bea27","name":"","topic":"rr/vis/replication/+/ds","qos":"0","datatype":"auto","broker":"73e9a24f.21590c","x":390,"y":980,"wires":[["f153aaaa.cda5a8"]]},{"id":"f153aaaa.cda5a8","type":"debug","z":"eb66deb5.bea27","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":730,"y":980,"wires":[]},{"id":"85363fe1.08add","type":"mqtt in","z":"eb66deb5.bea27","name":"","topic":"rr/vis/replication/+/view","qos":"0","datatype":"auto","broker":"73e9a24f.21590c","x":400,"y":940,"wires":[["aa3a07f9.4ba878"]]},{"id":"aa3a07f9.4ba878","type":"debug","z":"eb66deb5.bea27","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":730,"y":940,"wires":[]},{"id":"21cc6aca.100ac6","type":"function","z":"f3784d00.40ef8","name":"F1","func":"//node.warn(\"node warn test\");\nmsg.payload = \"this was set from F1! the time is \" + msg.payload;\n\nvar msg2 = {};\nmsg2.payload = \"testing node.send!\";\nnode.send(msg2);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":370,"y":160,"wires":[["473983f5.2a3cdc","af8aadce.37e6a"]]},{"id":"473983f5.2a3cdc","type":"debug","z":"f3784d00.40ef8","name":"D1","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":600,"y":100,"wires":[]},{"id":"c7c6bdde.ad8b7","type":"inject","z":"f3784d00.40ef8","name":"IN0","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":150,"y":160,"wires":[["21cc6aca.100ac6","2849c99b.34ee76"]]},{"id":"2849c99b.34ee76","type":"debug","z":"f3784d00.40ef8","name":"D0","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":380,"y":100,"wires":[]},{"id":"18c3ac2e.022434","type":"comment","z":"f3784d00.40ef8","name":"Questions","info":"What to do with one time inject?\n- spawn button to control?\n- just inject after start?\n- \n\nTODO\n- cnr call stack decoupling\n- \n\nNote\n- Deactivated node are ingored and run on the clients","x":1040,"y":120,"wires":[]},{"id":"fe9be415.2e8e88","type":"debug","z":"f3784d00.40ef8","name":"D2","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":780,"y":160,"wires":[]},{"id":"af8aadce.37e6a","type":"function","z":"f3784d00.40ef8","name":"F2","func":"//node.warn(\"node warn test\");\nmsg.payload = \"1\";\nmsg.topic = \"mytopic\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":600,"y":160,"wires":[["fe9be415.2e8e88"]]},{"id":"7823ea7e.e41264","type":"mqtt in","z":"f3784d00.40ef8","d":true,"name":"","topic":"telemetry/inffeld16/2nd/hallway/refrigirator/compressor/temperature","qos":"0","datatype":"auto","broker":"73e9a24f.21590c","x":320,"y":280,"wires":[[]]},{"id":"cc5ee639.f19818","type":"function","z":"f3784d00.40ef8","name":"F3","func":"var data = JSON.parse(msg.payload);\nmsg.payload = \"Compressor temp is \" + data.temperature.toFixed(2);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":690,"y":280,"wires":[["94ba970a.9dd648","e8e6b3e4.f69"]]},{"id":"94ba970a.9dd648","type":"debug","z":"f3784d00.40ef8","name":"D3","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":910,"y":240,"wires":[]},{"id":"e8e6b3e4.f69","type":"mqtt out","z":"f3784d00.40ef8","name":"","topic":"cnr/test/temp","qos":"0","retain":"false","broker":"73e9a24f.21590c","x":930,"y":280,"wires":[]},{"id":"adc4fd07.fded6","type":"mqtt in","z":"f3784d00.40ef8","d":true,"name":"","topic":"cnr/test/temp","qos":"0","datatype":"auto","broker":"73e9a24f.21590c","x":150,"y":340,"wires":[[]]},{"id":"f8dbd743.1f31e8","type":"function","z":"f3784d00.40ef8","name":"F4","func":"var str = \"from F4:\" + msg.topic + \" => \" + msg.payload;\nmsg.payload = str;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":690,"y":340,"wires":[["86271e87.4455f"]]},{"id":"86271e87.4455f","type":"debug","z":"f3784d00.40ef8","name":"D4","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":910,"y":340,"wires":[]},{"id":"893df961.a5d8a8","type":"inject","z":"f3784d00.40ef8","name":"IN1","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":"3","topic":"","payload":"","payloadType":"date","x":130,"y":480,"wires":[["b4ae3029.6a44f"]]},{"id":"b4ae3029.6a44f","type":"function","z":"f3784d00.40ef8","name":"init iatk","func":"try {\n    console.log(\"INIT IATK from NR ... 1\");\n    var nextId = Main_GetNextChartId();\n    \n    flow.set(\"mychart\", nextId);\n    \n    console.log(\"INIT IATK from NR ... 2\");\n    var chartObj = RT.VIS.GetNewChartObjectIATK(\n        nextId, \n        MAIN.usercanvas.charts.length,\n        \"IATKChart\", \n        MAIN.usercanvas.canvasSize, \n        MAIN.usercanvas.canvasSpacedSize);\n        \n    console.log(\"INIT IATK from NR ... 3\");\n    MAIN.usercanvas.charts.push(chartObj);\n    \n    console.log(\"INIT IATK from NR ... 4\");\n    MAIN.RR.Runtime.ToggleObjManipulation(chartObj.chartGoName);\n    \n    console.log(\"INIT IATK from NR ... 5\");\n    msg.payload = nextId;\n} catch(err) {\n    var strmsg = \"trying to run client side code ... => \" + err;\n    msg.payload = strmsg;\n    node.warn(strmsg);\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":280,"y":480,"wires":[["39960dab.fd5a12"]]},{"id":"453b0823.4b5c58","type":"debug","z":"f3784d00.40ef8","name":"D5","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":870,"y":480,"wires":[]},{"id":"39960dab.fd5a12","type":"function","z":"f3784d00.40ef8","name":"setup dimensions","func":"//var chartId = flow.get(\"mychart\");\nvar chart = null;\ntry {\n    var chartId = msg.payload;\n    chart = MAIN.usercanvas.charts[chartId];\n    if (chart.rtds != null) {\n        chart.rtds.AddDimension(\"temperature\", 0, 100);\n        for (var i = 0; i < 100; i++) {\n            //chart.rtds.AddDataByStr(\"id\", i);\n            chart.rtds.SetDataStrVal(\"id\", i);\n        }\n    }\n    chart.abstractVisualisation.visualisationReference.yDimension.Attribute = \"temperature\";\n    chart.abstractVisualisation.UpdateVisualisation(chart.PropertyType.Y);\n    \n    chart.abstractVisualisation.visualisationReference.zDimension.Attribute = \"Undefined\";\n    chart.abstractVisualisation.UpdateVisualisation(chart.PropertyType.Z);\n    \n    chart.abstractVisualisation.visualisationReference.sizeDimension = \"Undefined\";\n    chart.abstractVisualisation.UpdateVisualisation(chart.PropertyType.Size);\n    \n    var UE = importNamespace(\"UnityEngine\");\n    var gradient = new UE.Gradient();\n\n    // Populate the color keys at the relative time 0 and 1 (0 and 100%)\n    var colorKey = [new UE.GradientColorKey(), new UE.GradientColorKey()];\n    colorKey[0].color = new UE.Color(1, 0, 0);\n    colorKey[0].time = 0.0;\n    colorKey[1].color = new UE.Color(0, 1, 0)\n    colorKey[1].time = 1.0;\n\n    // Populate the alpha  keys at relative time 0 and 1  (0 and 100%)\n    var alphaKey = [new UE.GradientAlphaKey(), new UE.GradientAlphaKey()];\n    alphaKey[0].alpha = 1.0;\n    alphaKey[0].time = 0.0;\n    alphaKey[1].alpha = 1.0;\n    alphaKey[1].time = 1.0;\n    gradient.SetKeys(colorKey, alphaKey);\n    \n    chart.abstractVisualisation.visualisationReference.colourDimension = \"temperature\";\n    chart.abstractVisualisation.visualisationReference.dimensionColour = gradient;\n    //chart.abstractVisualisation.UpdateVisualisation(chart.PropertyType.Colour);\n    \n    console.log(\"CNR => chart.vis.updateViewProperties => chart.PropertyType.LinkingDimension\");\n    chart.abstractVisualisation.visualisationReference.linkingDimension = \"names\";\n    //chart.abstractVisualisation.UpdateVisualisation(chart.PropertyType.LinkingDimension);\n    //chart.vis.updateViewProperties(chart.PropertyType.LinkingDimension);\n    \n    chart.fctChangeStyle(chart.GeometryType.Lines);\n    \n    \n    chart.fctUpdateChart();\n} catch(err) {\n    node.warn(\"CNR (setup dimensions) ERROR (maybe trying to run client code?) => \" + err);\n    return msg;\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":490,"y":480,"wires":[["31449a29.2ed316"]]},{"id":"3ae2b62d.61d9ea","type":"comment","z":"f3784d00.40ef8","name":"spawn iatk chart","info":"","x":300,"y":440,"wires":[]},{"id":"c40f4b7c.99ee58","type":"comment","z":"f3784d00.40ef8","name":"setup dimensions","info":"","x":480,"y":440,"wires":[]},{"id":"287756b.c1d86aa","type":"mqtt in","z":"f3784d00.40ef8","d":true,"name":"","topic":"telemetry/inffeld16/2nd/hallway/refrigirator/compressor/temperature","qos":"0","datatype":"auto","broker":"73e9a24f.21590c","x":300,"y":540,"wires":[[]]},{"id":"77ddd47e.df9f8c","type":"function","z":"f3784d00.40ef8","name":"iatk data path","func":"var data = JSON.parse(msg.payload);\nvar val = data.temperature;\nvar chartId = flow.get(\"mychart\");\n\ntry {\n    var chart = MAIN.usercanvas.charts[chartId];\n    chart.rtds.SetDataStrVal(\"temperature\", val);\n    chart.fctUpdateChart();\n} catch(err) {\n    node.warn(\"CNR (iatk data path) ERROR (maybe trying to run client code?) => \" + err);\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":660,"y":540,"wires":[["7c51e4b9.ac594c"]]},{"id":"7c51e4b9.ac594c","type":"debug","z":"f3784d00.40ef8","name":"D7","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":870,"y":540,"wires":[]},{"id":"67f75c5e.fb1f94","type":"comment","z":"f3784d00.40ef8","name":"put data into iatk","info":"","x":1040,"y":540,"wires":[]},{"id":"31449a29.2ed316","type":"function","z":"f3784d00.40ef8","name":"move","func":"try {\n    var chartId = msg.payload;\n    var chart = MAIN.usercanvas.charts[chartId];\n    \n    var hT = MAIN.camHookGo.transform.position;\n    var hR = MAIN.camHookGo.transform.rotation;\n    var T = [hT.x, hT.y, hT.z];\n    var R = [hR.x, hR.y, hR.z, hR.w];\n    RT.Unity.SetPose(chart.chartGo, T, R, null);\n} catch (err) {\n    console.log(\"ERROR (maybe trying to run client code?) => \" + err);\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":670,"y":480,"wires":[["453b0823.4b5c58"]]},{"id":"8bf958b3.d07938","type":"comment","z":"f3784d00.40ef8","name":"move to position","info":"","x":700,"y":440,"wires":[]},{"id":"c30893db.7c736","type":"mqtt in","z":"e9bcdddb.5dd08","name":"","topic":" a/local/topic","qos":"0","datatype":"auto","broker":"73e9a24f.21590c","x":150,"y":1100,"wires":[["8e52b0a3.1d462"]]},{"id":"8e52b0a3.1d462","type":"debug","z":"e9bcdddb.5dd08","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":490,"y":1100,"wires":[]},{"id":"f67e2129.17a5a","type":"mqtt in","z":"e9bcdddb.5dd08","name":"","topic":"b/remote/local/topic","qos":"0","datatype":"auto","broker":"73e9a24f.21590c","x":170,"y":1160,"wires":[["8e52b0a3.1d462"]]},{"id":"334ae29d.b25c8e","type":"function","z":"f3784d00.40ef8","name":"B","func":"var visData = \n{\n    \"UID\":\"\",\n    \"VisualisationType\":\"SCATTERPLOT\",\n    \"parallelCoordinatesDimensionsAttributes\":[],\n    \"parallelCoordinatesDimensionsMinFilter\":[],\n    \"parallelCoordinatesDimensionsMaxFilter\":[],\n    \"parallelCoordinatesDimensionsMinScale\":[],\n    \"parallelCoordinatesDimensionsMaxScale\":[],\n    \"Geometry\":4,\n    \"AxiesKeys\":[0,1],\n    \"AxiesValues\":[\"id\",\"temperature\"],\n    \"ColourDimension\":\"temperature\",\n    \"SizeDimension\":\"Undefined\",\n    \"LinkingDimension\":\"names\",\n    \"colourKeys\":\n    {\n        \"serializedVersion\":\"2\",\n        \"key0\":{\"r\":1.0,\"g\":0.0,\"b\":0.0,\"a\":1.0},\n        \"key1\":{\"r\":0.0,\"g\":1.0,\"b\":0.0,\"a\":0.5},\n        \"key2\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key3\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key4\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key5\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key6\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key7\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"ctime0\":0,\"ctime1\":65535,\"ctime2\":0,\"ctime3\":0,\"ctime4\":0,\"ctime5\":0,\"ctime6\":0,\"ctime7\":0,\n        \"atime0\":0,\"atime1\":65535,\"atime2\":0,\"atime3\":0,\"atime4\":0,\"atime5\":0,\"atime6\":0,\"atime7\":0,\n        \"m_Mode\":0,\n        \"m_NumColorKeys\":2,\n        \"m_NumAlphaKeys\":2\n    },\n    \"colour\":{\"r\":0.0,\"g\":0.0,\"b\":1.0,\"a\":0.5},\n    \"Size\":0.2,\n    \"MinSize\":0.04,\n    \"MaxSize\":0.2,\n    \"VisualisationWidth\":0.3,\n    \"VisualisationHeight\":0.3,\n    \"VisualisationDepth\":0.3\n};\nmsg.payload = visData;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":310,"y":700,"wires":[["b912fc76.d9bd7"]]},{"id":"7f0984a6.5f5cfc","type":"inject","z":"f3784d00.40ef8","name":"A","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":"5","topic":"","payload":"","payloadType":"date","x":130,"y":700,"wires":[["334ae29d.b25c8e"]]},{"id":"b912fc76.d9bd7","type":"function","z":"f3784d00.40ef8","name":"C","func":"try {\n    console.log(\"INIT IATK from NR ... 1\");\n    //var nextId = Main_GetNextChartId();\n    var nextId = RT.Help.CreateGuid();\n    \n    flow.set(\"jsonchart\", nextId);\n    \n    console.log(\"INIT IATK from NR ... 2\");\n    var chartObj = RT.VIS.GetNewChartObjectIATK2(\n        nextId, \n        MAIN.usercanvas.charts.length,\n        \"IATKChart\", \n        MAIN.usercanvas.canvasSize, \n        MAIN.usercanvas.canvasSpacedSize,\n        false);\n\n    MAIN.usercanvas.charts2[nextId] = chartObj;\n    MAIN.RR.Runtime.ToggleObjManipulation(chartObj.chartGoName);\n\n    chartObj.rtds.AddDimension(\"temperature\", 0, 15);\n    chartObj.rtds.SetDataStrVal(\"temperature\", 7);\n    chartObj.abstractVisualisation.UpdateVisualisation(chartObj.PropertyType.Y);\n        \n    //apply json here\n    var json = JSON.stringify(msg.payload);\n    chartObj.vis.theVisualizationObject.creationConfiguration.DeserializeJson(json);\n    \n    //update from json\n    importNamespace(\"IATK\").Replicator.SyncVis(chartObj.vis);\n    chart.fctUpdateChart();\n    chart.vis.updateProperties();\n    \n    msg.payload = nextId;\n} catch(err) {\n    var strmsg = \"trying to run client side code ... => \" + err;\n    msg.payload = strmsg;\n    node.warn(\"C => \" + strmsg);\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":570,"y":700,"wires":[[]]},{"id":"d49aaca1.de2cd","type":"mqtt in","z":"f3784d00.40ef8","d":true,"name":"F","topic":"telemetry/inffeld16/2nd/id2068/thermometer/this/SENSOR","qos":"0","datatype":"auto","broker":"73e9a24f.21590c","x":110,"y":760,"wires":[["3e2bb6db.f1bf7a"]]},{"id":"449d1ecb.e8f78","type":"function","z":"f3784d00.40ef8","name":"J","func":"//\"{\"Time\":\"2021-08-17T07:31:36\",\"BME280\":{\"Temperature\":26.1,\"Humidity\":47.2,\"DewPoint\":14.0,\"Pressure\":973.8},\"SR04\":{\"Distance\":59.368},\"PressureUnit\":\"hPa\",\"TempUnit\":\"C\"}\"\n\nvar data = msg.payload;\nvar temperature = data.BME280.Temperature;\nvar humidity = data.BME280.Humidity;\nvar distance = data.SR04.Distance;\nvar chartId = flow.get(\"jsonchart\");\n\ntry {\n    var chart = MAIN.usercanvas.charts2[chartId];\n    //chart.rtds.SetDataStrVal(\"distance\", distance);\n    chart.rtds.SetDataStrVal(\"temperature\", temperature);\n    chart.fctUpdateChart();\n} catch(err) {\n    node.warn(\"CNR J ERROR (maybe trying to run client code?) => \" + err);\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":770,"y":760,"wires":[["3094ed8d.b3a732"]]},{"id":"3094ed8d.b3a732","type":"debug","z":"f3784d00.40ef8","name":"K","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":910,"y":760,"wires":[]},{"id":"953e515f.53791","type":"mqtt in","z":"f3784d00.40ef8","d":true,"name":"G","topic":"telemetry/inffeld16/2nd/id2068/thermometer/this/STATUS8","qos":"0","datatype":"auto","broker":"73e9a24f.21590c","x":110,"y":820,"wires":[["c17f5e52.8026c"]]},{"id":"9aec7015.2c5b2","type":"comment","z":"e9bcdddb.5dd08","name":"thermoter early pusher","info":"","x":160,"y":1300,"wires":[]},{"id":"bb025a96.372a18","type":"inject","z":"e9bcdddb.5dd08","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"1","crontab":"","once":false,"onceDelay":"0","topic":"","payload":"","payloadType":"date","x":150,"y":1360,"wires":[["a57023c6.a9b11"]]},{"id":"438b12c5.86c61c","type":"mqtt out","z":"e9bcdddb.5dd08","name":"","topic":"","qos":"0","retain":"false","broker":"73e9a24f.21590c","x":890,"y":1360,"wires":[]},{"id":"2f9ce9ae.fc1e66","type":"function","z":"e9bcdddb.5dd08","name":"","func":"msg.topic = \"telemetry/inffeld16/2nd/id2068/thermometer/this/cmnd/STATUS\";\nmsg.payload = 8;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":720,"y":1360,"wires":[["438b12c5.86c61c"]]},{"id":"c17f5e52.8026c","type":"function","z":"f3784d00.40ef8","name":"I","func":"var data = JSON.parse(msg.payload);\nmsg.payload = data.StatusSNS;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":570,"y":820,"wires":[["449d1ecb.e8f78"]]},{"id":"3e2bb6db.f1bf7a","type":"function","z":"f3784d00.40ef8","name":"H","func":"var data = JSON.parse(msg.payload);\nmsg.payload = data;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":570,"y":760,"wires":[["449d1ecb.e8f78"]]},{"id":"f95ba810.412d48","type":"function","z":"f3784d00.40ef8","name":"E","func":"\nvar chartId = flow.get(\"jsonchart\");\n\ntry {\n    var chart = MAIN.usercanvas.charts2[chartId];\n    \n    \n    //Move to HUD\n    var hT = MAIN.camHookGo.transform.position;\n    var hR = MAIN.camHookGo.transform.rotation;\n    var T = [hT.x, hT.y, hT.z];\n    var R = [hR.x, hR.y, hR.z, hR.w];\n    RT.Unity.SetPose(chart.chartGo, T, R, null);\n    //RT.Unity.SetParent(chart.chartGo, MAIN.camHookGo);\n    //RT.Unity.SetLocalPose(chart.chartGo, [0,-0.1,0], null, null);\n    \n    var bc = MAIN.RR.Runtime.AddBoxCollider(chart.chartGo);\n    bc.size = new MAIN.UE.Vector3(0.3, 0.3, 0.3);\n    \n    /*\n    //Move to Palm\n    var targetGo = MAIN.UE.GameObject.Find(\"MyRightTip\");\n    //var targetGo = MAIN.palmHandMenuGo;\n    var hT = MAIN.camHookGo.transform.position;\n    var hR = MAIN.camHookGo.transform.rotation;\n    var T = [hT.x, hT.y, hT.z];\n    var R = [hR.x, hR.y, hR.z, hR.w];\n    RT.Unity.SetPose(chart.chartGo, T, R, null);\n    RT.Unity.SetParent(chart.chartGo, targetGo);\n    RT.Unity.SetLocalPose(chart.chartGo, [0,0,0], null, null);\n    */\n} catch(err) {\n    node.warn(\"CNR E ERROR (maybe trying to run client code?) => \" + err);\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":910,"y":700,"wires":[[]]},{"id":"b5998a95.ffe038","type":"inject","z":"f3784d00.40ef8","name":"D","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":"7","topic":"","payload":"","payloadType":"date","x":770,"y":700,"wires":[["f95ba810.412d48"]]},{"id":"a57023c6.a9b11","type":"function","z":"e9bcdddb.5dd08","name":"","func":"for(var i = 0; i < 5; i++) {\n    node.send(msg);\n}\nreturn null;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":320,"y":1360,"wires":[["6581491b.d289e8"]]},{"id":"6581491b.d289e8","type":"delay","z":"e9bcdddb.5dd08","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"6","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":520,"y":1360,"wires":[["2f9ce9ae.fc1e66"]]},{"id":"94441447.141678","type":"function","z":"f3784d00.40ef8","name":"B","func":"var visData = \n{\n    \"UID\":\"\",\n    \"VisualisationType\":\"SCATTERPLOT\",\n    \"parallelCoordinatesDimensionsAttributes\":[],\n    \"parallelCoordinatesDimensionsMinFilter\":[],\n    \"parallelCoordinatesDimensionsMaxFilter\":[],\n    \"parallelCoordinatesDimensionsMinScale\":[],\n    \"parallelCoordinatesDimensionsMaxScale\":[],\n    \"Geometry\":4,\n    \"AxiesKeys\":[0,1],\n    \"AxiesValues\":[\"id\",\"distance\"],\n    \"ColourDimension\":\"distance\",\n    \"SizeDimension\":\"Undefined\",\n    \"LinkingDimension\":\"names\",\n    \"colourKeys\":\n    {\n        \"serializedVersion\":\"2\",\n        \"key0\":{\"r\":1.0,\"g\":0.0,\"b\":0.0,\"a\":1.0},\n        \"key1\":{\"r\":0.0,\"g\":1.0,\"b\":0.0,\"a\":0.5},\n        \"key2\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key3\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key4\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key5\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key6\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key7\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"ctime0\":0,\"ctime1\":65535,\"ctime2\":0,\"ctime3\":0,\"ctime4\":0,\"ctime5\":0,\"ctime6\":0,\"ctime7\":0,\n        \"atime0\":0,\"atime1\":65535,\"atime2\":0,\"atime3\":0,\"atime4\":0,\"atime5\":0,\"atime6\":0,\"atime7\":0,\n        \"m_Mode\":0,\n        \"m_NumColorKeys\":2,\n        \"m_NumAlphaKeys\":2\n    },\n    \"colour\":{\"r\":0.0,\"g\":0.0,\"b\":1.0,\"a\":0.5},\n    \"Size\":0.2,\n    \"MinSize\":0.04,\n    \"MaxSize\":0.2,\n    \"VisualisationWidth\":0.3,\n    \"VisualisationHeight\":0.3,\n    \"VisualisationDepth\":0.3\n};\nmsg.payload = visData;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":310,"y":940,"wires":[["e70543b7.f621b"]]},{"id":"a8afdad3.52bf38","type":"inject","z":"f3784d00.40ef8","name":"A","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":"5","topic":"","payload":"","payloadType":"date","x":130,"y":940,"wires":[["94441447.141678"]]},{"id":"e70543b7.f621b","type":"function","z":"f3784d00.40ef8","name":"C","func":"try {\n    console.log(\"INIT IATK from NR ... 1\");\n    //var nextId = Main_GetNextChartId();\n    var nextId = RT.Help.CreateGuid();\n    \n    flow.set(\"coolchart\", nextId);\n    flow.set(\"fridgealarm\", false);\n    \n    console.log(\"INIT IATK from NR ... 2\");\n    var chartObj = RT.VIS.GetNewChartObjectIATK2(\n        nextId, \n        MAIN.usercanvas.charts.length,\n        \"IATKChart\", \n        MAIN.usercanvas.canvasSize, \n        MAIN.usercanvas.canvasSpacedSize,\n        false);\n\n    MAIN.usercanvas.charts2[nextId] = chartObj;\n    MAIN.RR.Runtime.ToggleObjManipulation(chartObj.chartGoName);\n\n    chartObj.rtds.AddDimension(\"distance\", 0, 300);\n    chartObj.rtds.SetDataStrVal(\"distance\", 250);\n    \n    chartObj.abstractVisualisation.UpdateVisualisation(chartObj.PropertyType.Y);\n        \n    //apply json here\n    var json = JSON.stringify(msg.payload);\n    chartObj.vis.theVisualizationObject.creationConfiguration.DeserializeJson(json);\n    \n    //update from json\n    importNamespace(\"IATK\").Replicator.SyncVis(chartObj.vis);\n    chartObj.fctUpdateChart();\n    chartObj.vis.updateProperties();\n    \n    msg.payload = nextId;\n} catch(err) {\n    var strmsg = \"trying to run client side code ... => \" + err;\n    msg.payload = strmsg;\n    node.warn(\"C => \" + strmsg);\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":570,"y":940,"wires":[[]]},{"id":"7de85065.07f58","type":"mqtt in","z":"f3784d00.40ef8","name":"F","topic":"telemetry/inffeld16/2nd/id2068/thermometer/this/SENSOR","qos":"0","datatype":"auto","broker":"73e9a24f.21590c","x":110,"y":1000,"wires":[["bf82f21c.be593","955bf6c6.ccfe2"]]},{"id":"58ed8784.a8c4e8","type":"function","z":"f3784d00.40ef8","name":"J","func":"//\"{\"Time\":\"2021-08-17T07:31:36\",\"BME280\":{\"Temperature\":26.1,\"Humidity\":47.2,\"DewPoint\":14.0,\"Pressure\":973.8},\"SR04\":{\"Distance\":59.368},\"PressureUnit\":\"hPa\",\"TempUnit\":\"C\"}\"\n\nvar data = msg.payload;\nvar temperature = data.BME280.Temperature;\nvar humidity = data.BME280.Humidity;\nvar distance = data.SR04.Distance;\nvar chartId = flow.get(\"coolchart\");\n\ntry {\n    var chart = MAIN.usercanvas.charts2[chartId];\n    chart.rtds.SetDataStrVal(\"distance\", distance);\n    //chart.rtds.SetDataStrVal(\"temperature\", temperature);\n    chart.fctUpdateChart();\n} catch(err) {\n    node.warn(\"CNR J ERROR (maybe trying to run client code?) => \" + err);\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":770,"y":1000,"wires":[["85055f40.7c2f"]]},{"id":"85055f40.7c2f","type":"debug","z":"f3784d00.40ef8","name":"K","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":910,"y":1000,"wires":[]},{"id":"87569ab5.f502a8","type":"mqtt in","z":"f3784d00.40ef8","name":"G","topic":"telemetry/inffeld16/2nd/id2068/thermometer/this/STATUS8","qos":"0","datatype":"auto","broker":"73e9a24f.21590c","x":110,"y":1060,"wires":[["36eade6a.3b4a42","955bf6c6.ccfe2"]]},{"id":"36eade6a.3b4a42","type":"function","z":"f3784d00.40ef8","name":"I","func":"var data = JSON.parse(msg.payload);\nmsg.payload = data.StatusSNS;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":570,"y":1060,"wires":[["58ed8784.a8c4e8","52433094.679b8"]]},{"id":"bf82f21c.be593","type":"function","z":"f3784d00.40ef8","name":"H","func":"var data = JSON.parse(msg.payload);\nmsg.payload = data;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":570,"y":1000,"wires":[["58ed8784.a8c4e8","52433094.679b8"]]},{"id":"4759b99d.1c4928","type":"function","z":"f3784d00.40ef8","name":"E","func":"\nvar chartId = flow.get(\"coolchart\");\n\ntry {\n    var chart = MAIN.usercanvas.charts2[chartId];\n    \n    \n    //Move to HUD\n    var hT = MAIN.camHookGo.transform.position;\n    var hR = MAIN.camHookGo.transform.rotation;\n    var T = [hT.x, hT.y, hT.z];\n    var R = [hR.x, hR.y, hR.z, hR.w];\n    RT.Unity.SetPose(chart.chartGo, T, R, null);\n    //RT.Unity.SetParent(chart.chartGo, MAIN.camHookGo);\n    //RT.Unity.SetLocalPose(chart.chartGo, [0,-0.1,0], null, null);\n    \n    var bc = MAIN.RR.Runtime.AddBoxCollider(chart.chartGo);\n    bc.size = new MAIN.UE.Vector3(0.3, 0.3, 0.3);\n    \n    /*\n    //Move to Palm\n    var targetGo = MAIN.UE.GameObject.Find(\"MyRightTip\");\n    //var targetGo = MAIN.palmHandMenuGo;\n    var hT = MAIN.camHookGo.transform.position;\n    var hR = MAIN.camHookGo.transform.rotation;\n    var T = [hT.x, hT.y, hT.z];\n    var R = [hR.x, hR.y, hR.z, hR.w];\n    RT.Unity.SetPose(chart.chartGo, T, R, null);\n    RT.Unity.SetParent(chart.chartGo, targetGo);\n    RT.Unity.SetLocalPose(chart.chartGo, [0,0,0], null, null);\n    */\n} catch(err) {\n    node.warn(\"CNR E ERROR (maybe trying to run client code?) => \" + err);\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":910,"y":940,"wires":[[]]},{"id":"a5f6c0ba.b5f7c","type":"inject","z":"f3784d00.40ef8","name":"D","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":"7","topic":"","payload":"","payloadType":"date","x":770,"y":940,"wires":[["4759b99d.1c4928"]]},{"id":"52433094.679b8","type":"function","z":"f3784d00.40ef8","name":"L","func":"var data = msg.payload;\nvar distance = data.SR04.Distance;\nvar falarm_old = flow.get(\"fridgealarm\");\ntry {\n    if(distance > 35) {\n        //PlayClick();\n        PlayNotification();\n        if(falarm_old == false) {\n            flow.set(\"fridgealarm\", true);\n            msg.payload = true;\n            RT.Unity.SpawnAlert(45, \"Alarm!</br> Fridde door open!\");\n            return msg.payload;\n        }\n    } else {\n        if(falarm_old == true) {\n            flow.set(\"fridgealarm\", false);\n            msg.payload = false;\n            var PUI = importNamespace(\"PowerUI\");\n            var wu = PUI.WorldUI.Find(\"WU_ALERT\");\n            if(wu != null) {\n                wu.Expire();\n            }\n            return msg.payload;\n        }\n    }\n} catch(err) {\n    node.warn(\"CNR J ERROR (maybe trying to run client code?) => \" + err);\n}\n\nreturn null;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":770,"y":1060,"wires":[[]]},{"id":"e3035b5.fc768a8","type":"inject","z":"89ca6e54.b8f36","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"1","topic":"","payload":"","payloadType":"date","x":330,"y":160,"wires":[["5923e217.cd4dac"]]},{"id":"5923e217.cd4dac","type":"function","z":"89ca6e54.b8f36","name":"","func":"try {\n    node.warn(\"midiclient before setting body\");\n    document.body.innerHTML = \"\";\n    \n    var borderDiv = '<div style=\"position:absolute;top:1px;left:1px;width:98%;height:98%;border: solid green 8px; border-radius:16px;font-weight:bold;font-size:6vh;\">MK32</div>';\n    var envDiv = '<div style=\"position:absolute;top:0px;left:750px;font-weight:bold;font-size:6vh;\">Envelope</div>';\n    var osziDiv = '<div style=\"position:absolute;top:0px;left:1400px;font-weight:bold;font-size:6vh;\">Oszilator</div>';\n    \n    var attackDiv = '<div style=\"position:absolute;top:250px;left:550px;font-weight:bold;font-size:3vh;\">Attack</div>';\n    var decayDiv = '<div style=\"position:absolute;top:250px;left:750px;font-weight:bold;font-size:3vh;\">Decay</div>';\n    var releaseDiv = '<div style=\"position:absolute;top:250px;left:950px;font-weight:bold;font-size:3vh;\">Release</div>';\n    var sustainDiv = '<div style=\"position:absolute;top:250px;left:1150px;font-weight:bold;font-size:3vh;\">Sustain</div>';\n    \n    var harmDiv = '<div style=\"position:absolute;top:250px;left:1350px;font-weight:bold;font-size:3vh;\">Harmonicity</div>';\n    var partialCountDiv = '<div style=\"position:absolute;top:250px;left:1550px;font-weight:bold;font-size:3vh;\">Partial Count</div>';\n    var partialsDiv = '<div style=\"position:absolute;top:250px;left:1750px;font-weight:bold;font-size:3vh;\">Partials</div>';\n    var phaseDiv = '<div style=\"position:absolute;top:250px;left:1950px;font-weight:bold;font-size:3vh;\">Phase</div>';\n    \n    document.body.innerHTML += borderDiv;\n    document.body.innerHTML += envDiv;\n    document.body.innerHTML += osziDiv;\n    \n    document.body.innerHTML += attackDiv;\n    document.body.innerHTML += decayDiv;\n    document.body.innerHTML += releaseDiv;\n    document.body.innerHTML += sustainDiv;\n    \n    document.body.innerHTML += harmDiv;\n    document.body.innerHTML += partialCountDiv;\n    document.body.innerHTML += partialsDiv;\n    document.body.innerHTML += phaseDiv;\n    \n} catch(err) {\n    var strmsg = \"trying to run client side code ... => \" + err;\n    node.warn(\"midiclient => \" + strmsg);\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":500,"y":160,"wires":[["a94263f9.74a2b"]]},{"id":"9d16bcba.76fdb","type":"debug","z":"89ca6e54.b8f36","name":"CNR midiclient 2","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":870,"y":260,"wires":[]},{"id":"658d2b2c.3d4034","type":"function","z":"89ca6e54.b8f36","name":"envelope json cfg","func":"var visData = \n{\n    \"UID\":\"\",\n    \"VisualisationType\":\"SCATTERPLOT\",\n    \"parallelCoordinatesDimensionsAttributes\":[],\n    \"parallelCoordinatesDimensionsMinFilter\":[],\n    \"parallelCoordinatesDimensionsMaxFilter\":[],\n    \"parallelCoordinatesDimensionsMinScale\":[],\n    \"parallelCoordinatesDimensionsMaxScale\":[],\n    \"Geometry\":4,\n    \"AxiesKeys\":[0,1],\n    \"AxiesValues\":[\"id\",\"val\"],\n    \"ColourDimension\":\"Undefined\",\n    \"SizeDimension\":\"Undefined\",\n    \"LinkingDimension\":\"names\",\n    \"colourKeys\":\n    {\n        \"serializedVersion\":\"2\",\n        \"key0\":{\"r\":1.0,\"g\":0.0,\"b\":0.0,\"a\":1.0},\n        \"key1\":{\"r\":0.0,\"g\":1.0,\"b\":0.0,\"a\":0.5},\n        \"key2\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key3\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key4\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key5\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key6\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key7\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"ctime0\":0,\"ctime1\":65535,\"ctime2\":0,\"ctime3\":0,\"ctime4\":0,\"ctime5\":0,\"ctime6\":0,\"ctime7\":0,\n        \"atime0\":0,\"atime1\":65535,\"atime2\":0,\"atime3\":0,\"atime4\":0,\"atime5\":0,\"atime6\":0,\"atime7\":0,\n        \"m_Mode\":0,\n        \"m_NumColorKeys\":2,\n        \"m_NumAlphaKeys\":2\n    },\n    \"colour\":{\"r\":0.0,\"g\":0.0,\"b\":1.0,\"a\":0.5},\n    \"Size\":0.2,\n    \"MinSize\":0.01,\n    \"MaxSize\":0.2,\n    \"VisualisationWidth\":0.3,\n    \"VisualisationHeight\":0.3,\n    \"VisualisationDepth\":0.3\n};\nmsg.payload = visData;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":410,"y":260,"wires":[["b8e02ce8.0b7c3"]]},{"id":"ae8f4c56.e99a8","type":"inject","z":"89ca6e54.b8f36","name":"A","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":"5","topic":"","payload":"","payloadType":"date","x":190,"y":260,"wires":[["658d2b2c.3d4034"]]},{"id":"b8e02ce8.0b7c3","type":"function","z":"89ca6e54.b8f36","name":"Init vis from json","func":"try {\n    console.log(\"INIT IATK from NR ... 1\");\n    var nextId = Main_GetNextChartId();\n    \n    flow.set(\"envelopechart\", nextId);\n    \n    console.log(\"INIT IATK from NR ... 2\");\n    var chartObj = RT.VIS.GetNewChartObjectIATK2(\n        nextId, \n        MAIN.usercanvas.charts.length,\n        \"IATKChart\", \n        MAIN.usercanvas.canvasSize, \n        MAIN.usercanvas.canvasSpacedSize,\n        false);\n\n    MAIN.usercanvas.charts.push(chartObj);\n    MAIN.RR.Runtime.ToggleObjManipulation(chartObj.chartGoName);\n\n    chartObj.rtds.AddDimension(\"val\", 0, 100);\n    chartObj.abstractVisualisation.UpdateVisualisation(chartObj.PropertyType.Y);\n        \n    //apply json here\n    var json = JSON.stringify(msg.payload);\n    chartObj.vis.theVisualizationObject.creationConfiguration.DeserializeJson(json);\n    \n    //update from json\n    importNamespace(\"IATK\").Replicator.SyncVis(chartObj.vis);\n    chartObj.fctUpdateChart();\n    chartObj.vis.updateProperties();\n    \n    msg.payload = nextId;\n} catch(err) {\n    var strmsg = \"trying to run client side code ... => \" + err;\n    msg.payload = strmsg;\n    node.warn(\"CNR Init vis from json ERROR => \" + strmsg);\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":640,"y":260,"wires":[["9d16bcba.76fdb"]]},{"id":"a05039a1.3725b8","type":"function","z":"89ca6e54.b8f36","name":"Place vis","func":"\nvar chartId = flow.get(\"envelopechart\");\nmsg.payload = chartId;\n\ntry {\n    var chart = MAIN.usercanvas.charts[chartId];\n    \n    node.warn(\"CNR Place Vis 0\");\n    \n    //chart.panelGo.Expire();\n    \n    node.warn(\"CNR Place Vis 1\");\n    \n    var T = [0, 0, 0];\n    var R = [0, 0, 0, 1];\n    \n    node.warn(\"CNR Place Vis 2\");\n    \n    var deviceName = \"NETGEAR81-5G-midi\";\n    go = importNamespace(\"UnityEngine\").GameObject.Find(deviceName + \"control\");\n    \n    node.warn(\"CNR Place Vis 3\");\n\n    RT.Unity.SetParent(chart.chartGo, go);\n    \n    node.warn(\"CNR Place Vis 4\");\n    \n    RT.Unity.SetLocalPose(chart.chartGo, T, R, null);\n    \n    node.warn(\"CNR Place Vis 5\");\n    \n    RT.Unity.SetLocalPose(chart.chartGo, [-650, 600, 0], [-0.25, 0, 0, 0.96], [500, 500, 500]);\n    \n    node.warn(\"CNR Place Vis 6\");\n    \n} catch(err) {\n    node.warn(\"CNR Place Vis (maybe trying to run client code?) => \" + err);\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":360,"y":300,"wires":[["78cf941b.70171c"]]},{"id":"14f7aacc.f90d45","type":"inject","z":"89ca6e54.b8f36","name":"Late init","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":"7","topic":"","payload":"","payloadType":"date","x":200,"y":300,"wires":[["a05039a1.3725b8"]]},{"id":"acb83fff.94d62","type":"comment","z":"89ca6e54.b8f36","name":"Envelope chart","info":"","x":180,"y":220,"wires":[]},{"id":"a94263f9.74a2b","type":"debug","z":"89ca6e54.b8f36","name":"CNR midiclient 1","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":690,"y":160,"wires":[]},{"id":"9cc61afd.7e4728","type":"debug","z":"89ca6e54.b8f36","name":"CNR midiclient 3","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":790,"y":300,"wires":[]},{"id":"78cf941b.70171c","type":"function","z":"89ca6e54.b8f36","name":"remove html label","func":"\nvar chartId = flow.get(\"envelopechart\");\nmsg.payload = chartId;\n\ntry {\n    var chart = MAIN.usercanvas.charts[chartId];\n    chart.panelGo.Expire();\n} catch(err) {\n    node.warn(\"CNR remove html label => \" + err);\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":590,"y":300,"wires":[["9cc61afd.7e4728"]]},{"id":"6fca0e5f.4e943","type":"comment","z":"89ca6e54.b8f36","name":"Oszilator chart","info":"","x":170,"y":360,"wires":[]},{"id":"96bcdb22.74e568","type":"debug","z":"89ca6e54.b8f36","name":"CNR midiclient 2","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":870,"y":400,"wires":[]},{"id":"e88cf33f.17226","type":"function","z":"89ca6e54.b8f36","name":"oszilator json cfg","func":"var visData = \n{\n    \"UID\":\"\",\n    \"VisualisationType\":\"SCATTERPLOT\",\n    \"parallelCoordinatesDimensionsAttributes\":[],\n    \"parallelCoordinatesDimensionsMinFilter\":[],\n    \"parallelCoordinatesDimensionsMaxFilter\":[],\n    \"parallelCoordinatesDimensionsMinScale\":[],\n    \"parallelCoordinatesDimensionsMaxScale\":[],\n    \"Geometry\":4,\n    \"AxiesKeys\":[0,1],\n    \"AxiesValues\":[\"id\",\"val\"],\n    \"ColourDimension\":\"Undefined\",\n    \"SizeDimension\":\"Undefined\",\n    \"LinkingDimension\":\"names\",\n    \"colourKeys\":\n    {\n        \"serializedVersion\":\"2\",\n        \"key0\":{\"r\":1.0,\"g\":0.0,\"b\":0.0,\"a\":1.0},\n        \"key1\":{\"r\":0.0,\"g\":1.0,\"b\":0.0,\"a\":0.5},\n        \"key2\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key3\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key4\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key5\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key6\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key7\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"ctime0\":0,\"ctime1\":65535,\"ctime2\":0,\"ctime3\":0,\"ctime4\":0,\"ctime5\":0,\"ctime6\":0,\"ctime7\":0,\n        \"atime0\":0,\"atime1\":65535,\"atime2\":0,\"atime3\":0,\"atime4\":0,\"atime5\":0,\"atime6\":0,\"atime7\":0,\n        \"m_Mode\":0,\n        \"m_NumColorKeys\":2,\n        \"m_NumAlphaKeys\":2\n    },\n    \"colour\":{\"r\":0.0,\"g\":0.0,\"b\":1.0,\"a\":0.5},\n    \"Size\":0.2,\n    \"MinSize\":0.01,\n    \"MaxSize\":0.2,\n    \"VisualisationWidth\":0.3,\n    \"VisualisationHeight\":0.3,\n    \"VisualisationDepth\":0.3\n};\nmsg.payload = visData;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":410,"y":400,"wires":[["a1a67a0c.b48e88"]]},{"id":"4f01c063.14acf","type":"inject","z":"89ca6e54.b8f36","name":"A","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":"6","topic":"","payload":"","payloadType":"date","x":190,"y":400,"wires":[["e88cf33f.17226"]]},{"id":"a1a67a0c.b48e88","type":"function","z":"89ca6e54.b8f36","name":"Init vis from json","func":"try {\n    console.log(\"INIT IATK from NR ... 1\");\n    var nextId = Main_GetNextChartId();\n    \n    flow.set(\"oszichart\", nextId);\n    \n    console.log(\"INIT IATK from NR ... 2\");\n    var chartObj = RT.VIS.GetNewChartObjectIATK2(\n        nextId, \n        MAIN.usercanvas.charts.length,\n        \"IATKChart\", \n        MAIN.usercanvas.canvasSize, \n        MAIN.usercanvas.canvasSpacedSize,\n        false);\n\n    MAIN.usercanvas.charts.push(chartObj);\n    MAIN.RR.Runtime.ToggleObjManipulation(chartObj.chartGoName);\n\n    chartObj.rtds.AddDimension(\"val\", 0, 100);\n    chartObj.abstractVisualisation.UpdateVisualisation(chartObj.PropertyType.Y);\n        \n    //apply json here\n    var json = JSON.stringify(msg.payload);\n    chartObj.vis.theVisualizationObject.creationConfiguration.DeserializeJson(json);\n    \n    //update from json\n    importNamespace(\"IATK\").Replicator.SyncVis(chartObj.vis);\n    chartObj.fctUpdateChart();\n    chartObj.vis.updateProperties();\n    \n    msg.payload = nextId;\n} catch(err) {\n    var strmsg = \"trying to run client side code ... => \" + err;\n    msg.payload = strmsg;\n    node.warn(\"CNR Init vis from json ERROR => \" + strmsg);\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":640,"y":400,"wires":[["96bcdb22.74e568"]]},{"id":"9f6c8ae3.f72358","type":"function","z":"89ca6e54.b8f36","name":"Place vis","func":"\nvar chartId = flow.get(\"oszichart\");\nmsg.payload = chartId;\n\ntry {\n    var chart = MAIN.usercanvas.charts[chartId];\n    var deviceName = \"NETGEAR81-5G-midi\";\n    go = importNamespace(\"UnityEngine\").GameObject.Find(deviceName + \"control\");\n    RT.Unity.SetParent(chart.chartGo, go);\n    RT.Unity.SetLocalPose(chart.chartGo, [0,0,0], [0,0,0,1], null);\n    RT.Unity.SetLocalPose(chart.chartGo, [150, 600, 0], [-0.25, 0, 0, 0.96], [500, 500, 500]);\n} catch(err) {\n    node.warn(\"CNR Place Vis (maybe trying to run client code?) => \" + err);\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":360,"y":440,"wires":[["4351e66e.186d38"]]},{"id":"520748da.494798","type":"inject","z":"89ca6e54.b8f36","name":"Late init","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":"7","topic":"","payload":"","payloadType":"date","x":200,"y":440,"wires":[["9f6c8ae3.f72358"]]},{"id":"27fb4bd5.f9e344","type":"debug","z":"89ca6e54.b8f36","name":"CNR midiclient 3","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":790,"y":440,"wires":[]},{"id":"4351e66e.186d38","type":"function","z":"89ca6e54.b8f36","name":"remove html label","func":"\nvar chartId = flow.get(\"oszichart\");\nmsg.payload = chartId;\n\ntry {\n    var chart = MAIN.usercanvas.charts[chartId];\n    chart.panelGo.Expire();\n} catch(err) {\n    node.warn(\"CNR remove html label => \" + err);\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":590,"y":440,"wires":[["27fb4bd5.f9e344"]]},{"id":"89e9e9d8.d53368","type":"comment","z":"89ca6e54.b8f36","name":"Ui setup","info":"","x":160,"y":160,"wires":[]},{"id":"86b20e9f.74f6e","type":"mqtt in","z":"89ca6e54.b8f36","name":"","topic":"visusguest-midi/envelope/#","qos":"0","datatype":"auto","broker":"73e9a24f.21590c","x":210,"y":520,"wires":[["a76c3f73.fe206","1751214c.95fc1f"]]},{"id":"a76c3f73.fe206","type":"function","z":"89ca6e54.b8f36","name":"extract values","func":"\nvar topics = msg.topic.split(\"/\");\nvar t = topics[2];\nvar val = parseFloat(msg.payload);\nflow.set(t, val);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":460,"y":520,"wires":[["c9d1bb37.1048a8","2168c52b.8aed6a"]]},{"id":"5210b86c.f8dd68","type":"comment","z":"89ca6e54.b8f36","name":"Init values","info":"","x":160,"y":120,"wires":[]},{"id":"3a7e2055.93c88","type":"inject","z":"89ca6e54.b8f36","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"1","topic":"","payload":"","payloadType":"date","x":330,"y":120,"wires":[["64a4fc1a.2ffb34"]]},{"id":"64a4fc1a.2ffb34","type":"function","z":"89ca6e54.b8f36","name":"","func":"flow.set(\"attack\", 1);\nflow.set(\"decay\", 2);\nflow.set(\"release\", 3);\nflow.set(\"sustain\", 4);\n\nflow.set(\"harmonicity\", 4);\nflow.set(\"partialcount\", 3);\nflow.set(\"partials\", 2);\nflow.set(\"phase\", 1);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":500,"y":120,"wires":[[]]},{"id":"c9d1bb37.1048a8","type":"function","z":"89ca6e54.b8f36","name":"calc envelope","func":"var attack = flow.get(\"attack\");\nvar decay = flow.get(\"decay\");\nvar release = flow.get(\"release\");\nvar sustain = flow.get(\"sustain\");\n\nvals = [];\n\nvar i = 0;\nvar v = 0;\n//attack\nfor(i = 0; i < 25; i++) {\n    v = attack * i;\n    vals.push(v);\n}\n\n//decay\nfor(i = 0; i < 25; i++) {\n    v = decay*decay * i;\n    vals.push(v);\n}\n\n//release\nfor(i = 0; i < 25; i++) {\n    v = release * i;\n    vals.push(v);\n}\n\n//sustain\nfor(i = 0; i < 25; i++) {\n    v = sustain * i;\n    vals.push(v);\n}\n\nmsg.payload = vals;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":700,"y":520,"wires":[["885579e6.e8a4f8","c6e5243f.6b6cb8"]]},{"id":"885579e6.e8a4f8","type":"function","z":"89ca6e54.b8f36","name":"update chart","func":"//\"{\"Time\":\"2021-08-17T07:31:36\",\"BME280\":{\"Temperature\":26.1,\"Humidity\":47.2,\"DewPoint\":14.0,\"Pressure\":973.8},\"SR04\":{\"Distance\":59.368},\"PressureUnit\":\"hPa\",\"TempUnit\":\"C\"}\"\n\n\nvar chartId = flow.get(\"envelopechart\");\n\ntry {\n    var chart = MAIN.usercanvas.charts[chartId];\n    var vals = msg.payload;\n    for(var i = 0; i < vals.length; i++) {\n        chart.rtds.SetDataStrVal(\"val\", vals[i]);\n    }\n    chart.fctUpdateChart();\n} catch(err) {\n    node.warn(\"CNR J ERROR (maybe trying to run client code?) => \" + err);\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":930,"y":520,"wires":[["7d3d8d35.e30214"]]},{"id":"b2d32cbc.0502f","type":"comment","z":"e9bcdddb.5dd08","name":"envelope","info":"","x":160,"y":1580,"wires":[]},{"id":"11c2133f.1aa52d","type":"mqtt out","z":"e9bcdddb.5dd08","name":"","topic":"","qos":"0","retain":"false","broker":"73e9a24f.21590c","x":510,"y":1740,"wires":[]},{"id":"1751214c.95fc1f","type":"debug","z":"89ca6e54.b8f36","name":"CNR A","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":450,"y":560,"wires":[]},{"id":"2168c52b.8aed6a","type":"debug","z":"89ca6e54.b8f36","name":"CNR B","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":700,"y":560,"wires":[]},{"id":"c6e5243f.6b6cb8","type":"debug","z":"89ca6e54.b8f36","name":"CNR C","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":940,"y":560,"wires":[]},{"id":"7d3d8d35.e30214","type":"debug","z":"89ca6e54.b8f36","name":"CNR D","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1120,"y":560,"wires":[]},{"id":"982dcfca.98876","type":"mqtt in","z":"89ca6e54.b8f36","name":"","topic":"visusguest-midi/oszilator/#","qos":"0","datatype":"auto","broker":"73e9a24f.21590c","x":210,"y":620,"wires":[["486f4dfc.baa214","5689e16e.a5cfc"]]},{"id":"486f4dfc.baa214","type":"function","z":"89ca6e54.b8f36","name":"extract values","func":"\nvar topics = msg.topic.split(\"/\");\nvar t = topics[2];\nvar val = parseFloat(msg.payload);\nflow.set(t, val);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":460,"y":620,"wires":[["b1ae10c4.28477","e1feb3cd.7bf9e"]]},{"id":"b1ae10c4.28477","type":"function","z":"89ca6e54.b8f36","name":"calc oszilator","func":"var harmonicity = flow.get(\"harmonicity\");\nvar partialcount = flow.get(\"partialcount\");\nvar partials = flow.get(\"partials\");\nvar phase = flow.get(\"phase\");\n\nvals = [];\n\nvar i = 0;\nvar v = 0;\n//attack\nfor(i = 0; i < 25; i++) {\n    v = harmonicity * i;\n    vals.push(v);\n}\n\n//decay\nfor(i = 0; i < 25; i++) {\n    v = partialcount * i;\n    vals.push(v);\n}\n\n//release\nfor(i = 0; i < 25; i++) {\n    v = partials * i;\n    vals.push(v);\n}\n\n//sustain\nfor(i = 0; i < 25; i++) {\n    v = phase * i;\n    vals.push(v);\n}\n\nmsg.payload = vals;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":690,"y":620,"wires":[["51d9ad50.df3f94","3f148711.8807d8"]]},{"id":"51d9ad50.df3f94","type":"function","z":"89ca6e54.b8f36","name":"update chart","func":"//\"{\"Time\":\"2021-08-17T07:31:36\",\"BME280\":{\"Temperature\":26.1,\"Humidity\":47.2,\"DewPoint\":14.0,\"Pressure\":973.8},\"SR04\":{\"Distance\":59.368},\"PressureUnit\":\"hPa\",\"TempUnit\":\"C\"}\"\n\n\nvar chartId = flow.get(\"oszichart\");\n\ntry {\n    var chart = MAIN.usercanvas.charts[chartId];\n    var vals = msg.payload;\n    for(var i = 0; i < vals.length; i++) {\n        chart.rtds.SetDataStrVal(\"val\", vals[i]);\n    }\n    chart.fctUpdateChart();\n} catch(err) {\n    node.warn(\"CNR update oszi chart ERROR (maybe trying to run client code?) => \" + err);\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":930,"y":620,"wires":[["ad5990e7.ba3cf"]]},{"id":"5689e16e.a5cfc","type":"debug","z":"89ca6e54.b8f36","name":"CNR A","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":430,"y":660,"wires":[]},{"id":"e1feb3cd.7bf9e","type":"debug","z":"89ca6e54.b8f36","name":"CNR B","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":680,"y":660,"wires":[]},{"id":"3f148711.8807d8","type":"debug","z":"89ca6e54.b8f36","name":"CNR C","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":920,"y":660,"wires":[]},{"id":"ad5990e7.ba3cf","type":"debug","z":"89ca6e54.b8f36","name":"CNR D","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1120,"y":660,"wires":[]},{"id":"b8cd046f.f53808","type":"ui_slider","z":"e9bcdddb.5dd08","name":"","label":"attack","tooltip":"","group":"68cad0fd.621c2","order":5,"width":0,"height":0,"passthru":true,"outs":"all","topic":"visusguest-midi/envelope/attack","min":0,"max":"1","step":"0.01","x":150,"y":1620,"wires":[["11c2133f.1aa52d"]]},{"id":"92605287.66b8b","type":"ui_slider","z":"e9bcdddb.5dd08","name":"","label":"harmonicity","tooltip":"","group":"68cad0fd.621c2","order":5,"width":0,"height":0,"passthru":true,"outs":"all","topic":"visusguest-midi/oszilator/harmonicity","min":0,"max":"1","step":"0.01","x":170,"y":1840,"wires":[["11c2133f.1aa52d"]]},{"id":"e83dc638.3c77c8","type":"ui_slider","z":"e9bcdddb.5dd08","name":"","label":"decay","tooltip":"","group":"68cad0fd.621c2","order":5,"width":0,"height":0,"passthru":true,"outs":"all","topic":"visusguest-midi/envelope/decay","min":0,"max":"1","step":"0.01","x":150,"y":1660,"wires":[["11c2133f.1aa52d"]]},{"id":"ed5fcb6d.c80178","type":"ui_slider","z":"e9bcdddb.5dd08","name":"","label":"sustain","tooltip":"","group":"68cad0fd.621c2","order":5,"width":0,"height":0,"passthru":true,"outs":"all","topic":"visusguest-midi/envelope/sustain","min":0,"max":"1","step":"0.01","x":160,"y":1740,"wires":[["11c2133f.1aa52d"]]},{"id":"f51e2866.bd7658","type":"ui_slider","z":"e9bcdddb.5dd08","name":"","label":"release","tooltip":"","group":"68cad0fd.621c2","order":5,"width":0,"height":0,"passthru":true,"outs":"all","topic":"visusguest-midi/envelope/release","min":0,"max":"1","step":"0.01","x":160,"y":1700,"wires":[["11c2133f.1aa52d"]]},{"id":"e52d961d.4adca8","type":"comment","z":"e9bcdddb.5dd08","name":"oszilator","info":"","x":160,"y":1800,"wires":[]},{"id":"85000335.04e09","type":"ui_slider","z":"e9bcdddb.5dd08","name":"","label":"partialcount","tooltip":"","group":"68cad0fd.621c2","order":5,"width":0,"height":0,"passthru":true,"outs":"all","topic":"visusguest-midi/oszilator/partialcount","min":0,"max":"1","step":"0.01","x":170,"y":1880,"wires":[["11c2133f.1aa52d"]]},{"id":"dc3f0f35.79e56","type":"ui_slider","z":"e9bcdddb.5dd08","name":"","label":"partials","tooltip":"","group":"68cad0fd.621c2","order":5,"width":0,"height":0,"passthru":true,"outs":"all","topic":"visusguest-midi/oszilator/partials","min":0,"max":"1","step":"0.01","x":160,"y":1920,"wires":[["11c2133f.1aa52d"]]},{"id":"1af5b6b7.206249","type":"ui_slider","z":"e9bcdddb.5dd08","name":"","label":"phase","tooltip":"","group":"68cad0fd.621c2","order":5,"width":0,"height":0,"passthru":true,"outs":"all","topic":"visusguest-midi/oszilator/phase","min":0,"max":"1","step":"0.01","x":150,"y":1960,"wires":[["11c2133f.1aa52d"]]},{"id":"5cd36295.c288fc","type":"function","z":"ece826b8.56d178","name":"B","func":"var visData = \n{\n    \"UID\":\"\",\n    \"VisualisationType\":\"SCATTERPLOT\",\n    \"parallelCoordinatesDimensionsAttributes\":[],\n    \"parallelCoordinatesDimensionsMinFilter\":[],\n    \"parallelCoordinatesDimensionsMaxFilter\":[],\n    \"parallelCoordinatesDimensionsMinScale\":[],\n    \"parallelCoordinatesDimensionsMaxScale\":[],\n    \"Geometry\":4,\n    \"AxiesKeys\":[0,1],\n    \"AxiesValues\":[\"id\",\"distance\"],\n    \"ColourDimension\":\"distance\",\n    \"SizeDimension\":\"distance\",\n    \"LinkingDimension\":\"names\",\n    \"colourKeys\":\n    {\n        \"serializedVersion\":\"2\",\n        \"key0\":{\"r\":1.0,\"g\":0.0,\"b\":0.0,\"a\":1.0},\n        \"key1\":{\"r\":0.0,\"g\":1.0,\"b\":0.0,\"a\":0.5},\n        \"key2\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key3\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key4\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key5\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key6\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key7\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"ctime0\":0,\"ctime1\":65535,\"ctime2\":0,\"ctime3\":0,\"ctime4\":0,\"ctime5\":0,\"ctime6\":0,\"ctime7\":0,\n        \"atime0\":0,\"atime1\":65535,\"atime2\":0,\"atime3\":0,\"atime4\":0,\"atime5\":0,\"atime6\":0,\"atime7\":0,\n        \"m_Mode\":0,\n        \"m_NumColorKeys\":2,\n        \"m_NumAlphaKeys\":2\n    },\n    \"colour\":{\"r\":0.0,\"g\":0.0,\"b\":1.0,\"a\":0.5},\n    \"Size\":0.2,\n    \"MinSize\":0.01,\n    \"MaxSize\":0.2,\n    \"VisualisationWidth\":0.3,\n    \"VisualisationHeight\":0.3,\n    \"VisualisationDepth\":0.3\n};\nmsg.payload = visData;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":330,"y":120,"wires":[["7425f5e1.eec61c"]]},{"id":"d847a301.25e4c","type":"inject","z":"ece826b8.56d178","name":"A","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":"5","topic":"","payload":"","payloadType":"date","x":150,"y":120,"wires":[["5cd36295.c288fc"]]},{"id":"7425f5e1.eec61c","type":"function","z":"ece826b8.56d178","name":"C","func":"try {\n    console.log(\"INIT IATK from NR ... 1\");\n    var nextId = Main_GetNextChartId();\n    \n    flow.set(\"jsonchart\", nextId);\n    \n    console.log(\"INIT IATK from NR ... 2\");\n    var chartObj = RT.VIS.GetNewChartObjectIATK2(\n        nextId, \n        MAIN.usercanvas.charts.length,\n        \"IATKChart\", \n        MAIN.usercanvas.canvasSize, \n        MAIN.usercanvas.canvasSpacedSize,\n        false);\n\n    MAIN.usercanvas.charts.push(chartObj);\n    MAIN.RR.Runtime.ToggleObjManipulation(chartObj.chartGoName);\n\n    chartObj.rtds.AddDimension(\"distance\", 0, 300);\n    chartObj.rtds.SetDataStrVal(\"distance\", 250);\n    \n    chartObj.rtds.AddDimension(\"temperature\", 0, 1);\n    chartObj.abstractVisualisation.UpdateVisualisation(chartObj.PropertyType.Y);\n        \n    //apply json here\n    var json = JSON.stringify(msg.payload);\n    chartObj.vis.theVisualizationObject.creationConfiguration.DeserializeJson(json);\n    \n    //update from json\n    importNamespace(\"IATK\").Replicator.SyncVis(chartObj.vis);\n    chart.fctUpdateChart();\n    chart.vis.updateProperties();\n    \n    msg.payload = nextId;\n} catch(err) {\n    var strmsg = \"trying to run client side code ... => \" + err;\n    msg.payload = strmsg;\n    node.warn(\"C => \" + strmsg);\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":590,"y":120,"wires":[[]]},{"id":"39f2ed2b.e7e8d2","type":"mqtt in","z":"ece826b8.56d178","d":true,"name":"F","topic":"telemetry/inffeld16/2nd/id2068/thermometer/this/SENSOR","qos":"0","datatype":"auto","broker":"73e9a24f.21590c","x":130,"y":180,"wires":[["d183b135.b7298"]]},{"id":"8b95f38c.fa055","type":"function","z":"ece826b8.56d178","name":"J","func":"//\"{\"Time\":\"2021-08-17T07:31:36\",\"BME280\":{\"Temperature\":26.1,\"Humidity\":47.2,\"DewPoint\":14.0,\"Pressure\":973.8},\"SR04\":{\"Distance\":59.368},\"PressureUnit\":\"hPa\",\"TempUnit\":\"C\"}\"\n\nvar data = msg.payload;\nvar temperature = data.BME280.Temperature;\nvar humidity = data.BME280.Humidity;\nvar distance = data.SR04.Distance;\nvar chartId = flow.get(\"jsonchart\");\n\ntry {\n    var chart = MAIN.usercanvas.charts[chartId];\n    chart.rtds.SetDataStrVal(\"distance\", distance);\n    chart.rtds.SetDataStrVal(\"temperature\", temperature);\n    chart.fctUpdateChart();\n} catch(err) {\n    node.warn(\"CNR J ERROR (maybe trying to run client code?) => \" + err);\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":790,"y":180,"wires":[["af4a343a.ab9cd8"]]},{"id":"af4a343a.ab9cd8","type":"debug","z":"ece826b8.56d178","name":"K","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":930,"y":180,"wires":[]},{"id":"d52651e4.1de1d","type":"mqtt in","z":"ece826b8.56d178","d":true,"name":"G","topic":"telemetry/inffeld16/2nd/id2068/thermometer/this/STATUS8","qos":"0","datatype":"auto","broker":"73e9a24f.21590c","x":130,"y":240,"wires":[["9e6193c8.7d349"]]},{"id":"9e6193c8.7d349","type":"function","z":"ece826b8.56d178","name":"I","func":"var data = JSON.parse(msg.payload);\nmsg.payload = data.StatusSNS;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":590,"y":240,"wires":[["8b95f38c.fa055"]]},{"id":"d183b135.b7298","type":"function","z":"ece826b8.56d178","name":"H","func":"var data = JSON.parse(msg.payload);\nmsg.payload = data;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":590,"y":180,"wires":[["8b95f38c.fa055"]]},{"id":"1a8560ab.b445bf","type":"function","z":"ece826b8.56d178","name":"E","func":"\nvar chartId = flow.get(\"jsonchart\");\n\ntry {\n    var chart = MAIN.usercanvas.charts[chartId];\n    \n    \n    //Move to HUD\n    var hT = MAIN.camHookGo.transform.position;\n    var hR = MAIN.camHookGo.transform.rotation;\n    var T = [hT.x, hT.y, hT.z];\n    var R = [hR.x, hR.y, hR.z, hR.w];\n    RT.Unity.SetPose(chart.chartGo, T, R, null);\n    //RT.Unity.SetParent(chart.chartGo, MAIN.camHookGo);\n    //RT.Unity.SetLocalPose(chart.chartGo, [0,-0.1,0], null, null);\n    \n    var bc = MAIN.RR.Runtime.AddBoxCollider(chart.chartGo);\n    bc.size = new MAIN.UE.Vector3(0.3, 0.3, 0.3);\n    \n    /*\n    //Move to Palm\n    var targetGo = MAIN.UE.GameObject.Find(\"MyRightTip\");\n    //var targetGo = MAIN.palmHandMenuGo;\n    var hT = MAIN.camHookGo.transform.position;\n    var hR = MAIN.camHookGo.transform.rotation;\n    var T = [hT.x, hT.y, hT.z];\n    var R = [hR.x, hR.y, hR.z, hR.w];\n    RT.Unity.SetPose(chart.chartGo, T, R, null);\n    RT.Unity.SetParent(chart.chartGo, targetGo);\n    RT.Unity.SetLocalPose(chart.chartGo, [0,0,0], null, null);\n    */\n} catch(err) {\n    node.warn(\"CNR E ERROR (maybe trying to run client code?) => \" + err);\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":930,"y":120,"wires":[[]]},{"id":"1f48ada9.7ceab2","type":"inject","z":"ece826b8.56d178","name":"D","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":"7","topic":"","payload":"","payloadType":"date","x":790,"y":120,"wires":[["1a8560ab.b445bf"]]},{"id":"521c9eb0.5085f","type":"function","z":"ece826b8.56d178","name":"B","func":"var visData = \n{\n    \"UID\":\"\",\n    \"VisualisationType\":\"SCATTERPLOT\",\n    \"parallelCoordinatesDimensionsAttributes\":[],\n    \"parallelCoordinatesDimensionsMinFilter\":[],\n    \"parallelCoordinatesDimensionsMaxFilter\":[],\n    \"parallelCoordinatesDimensionsMinScale\":[],\n    \"parallelCoordinatesDimensionsMaxScale\":[],\n    \"Geometry\":4,\n    \"AxiesKeys\":[0,1],\n    \"AxiesValues\":[\"id\",\"temperature\"],\n    \"ColourDimension\":\"distance\",\n    \"SizeDimension\":\"Undefined\",\n    \"LinkingDimension\":\"names\",\n    \"colourKeys\":\n    {\n        \"serializedVersion\":\"2\",\n        \"key0\":{\"r\":1.0,\"g\":0.0,\"b\":0.0,\"a\":1.0},\n        \"key1\":{\"r\":0.0,\"g\":1.0,\"b\":0.0,\"a\":0.5},\n        \"key2\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key3\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key4\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key5\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key6\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key7\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"ctime0\":0,\"ctime1\":65535,\"ctime2\":0,\"ctime3\":0,\"ctime4\":0,\"ctime5\":0,\"ctime6\":0,\"ctime7\":0,\n        \"atime0\":0,\"atime1\":65535,\"atime2\":0,\"atime3\":0,\"atime4\":0,\"atime5\":0,\"atime6\":0,\"atime7\":0,\n        \"m_Mode\":0,\n        \"m_NumColorKeys\":2,\n        \"m_NumAlphaKeys\":2\n    },\n    \"colour\":{\"r\":0.0,\"g\":0.0,\"b\":1.0,\"a\":0.5},\n    \"Size\":0.2,\n    \"MinSize\":0.01,\n    \"MaxSize\":0.2,\n    \"VisualisationWidth\":0.3,\n    \"VisualisationHeight\":0.3,\n    \"VisualisationDepth\":0.3\n};\nmsg.payload = visData;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":330,"y":380,"wires":[["b16d67a2.816618"]]},{"id":"3268a0ff.4701e","type":"inject","z":"ece826b8.56d178","name":"A","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":"5","topic":"","payload":"","payloadType":"date","x":150,"y":380,"wires":[["521c9eb0.5085f"]]},{"id":"b16d67a2.816618","type":"function","z":"ece826b8.56d178","name":"C","func":"try {\n    console.log(\"INIT IATK from NR ... 1\");\n    var nextId = Main_GetNextChartId();\n    \n    flow.set(\"coolchart\", nextId);\n    \n    console.log(\"INIT IATK from NR ... 2\");\n    var chartObj = RT.VIS.GetNewChartObjectIATK2(\n        nextId, \n        MAIN.usercanvas.charts.length,\n        \"IATKChart\", \n        MAIN.usercanvas.canvasSize, \n        MAIN.usercanvas.canvasSpacedSize,\n        false);\n\n    MAIN.usercanvas.charts.push(chartObj);\n    MAIN.RR.Runtime.ToggleObjManipulation(chartObj.chartGoName);\n\n    chartObj.rtds.AddDimension(\"distance\", 0, 300);\n    chartObj.rtds.SetDataStrVal(\"distance\", 250);\n    \n    chartObj.rtds.AddDimension(\"temperature\", 0, 35);\n    chartObj.rtds.SetDataStrVal(\"distance\", 35);\n    \n    chartObj.abstractVisualisation.UpdateVisualisation(chartObj.PropertyType.Y);\n        \n    //apply json here\n    var json = JSON.stringify(msg.payload);\n    chartObj.vis.theVisualizationObject.creationConfiguration.DeserializeJson(json);\n    \n    //update from json\n    importNamespace(\"IATK\").Replicator.SyncVis(chartObj.vis);\n    chartObj.fctUpdateChart();\n    chartObj.vis.updateProperties();\n    \n    msg.payload = nextId;\n} catch(err) {\n    var strmsg = \"trying to run client side code ... => \" + err;\n    msg.payload = strmsg;\n    node.warn(\"C => \" + strmsg);\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":590,"y":380,"wires":[[]]},{"id":"9b634a31.323638","type":"mqtt in","z":"ece826b8.56d178","name":"F","topic":"telemetry/inffeld16/2nd/id2068/thermometer/this/SENSOR","qos":"0","datatype":"auto","broker":"73e9a24f.21590c","x":130,"y":440,"wires":[["ecec4d6c.ab4ca"]]},{"id":"3452183d.83eef8","type":"function","z":"ece826b8.56d178","name":"J","func":"//\"{\"Time\":\"2021-08-17T07:31:36\",\"BME280\":{\"Temperature\":26.1,\"Humidity\":47.2,\"DewPoint\":14.0,\"Pressure\":973.8},\"SR04\":{\"Distance\":59.368},\"PressureUnit\":\"hPa\",\"TempUnit\":\"C\"}\"\n\nvar data = msg.payload;\nvar temperature = data.BME280.Temperature;\nvar humidity = data.BME280.Humidity;\nvar distance = data.SR04.Distance;\nvar chartId = flow.get(\"coolchart\");\n\ntry {\n    var chart = MAIN.usercanvas.charts[chartId];\n    chart.rtds.SetDataStrVal(\"distance\", distance);\n    chart.rtds.SetDataStrVal(\"temperature\", temperature);\n    chart.fctUpdateChart();\n} catch(err) {\n    node.warn(\"CNR J ERROR (maybe trying to run client code?) => \" + err);\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":790,"y":440,"wires":[["fab7ccab.12da9"]]},{"id":"fab7ccab.12da9","type":"debug","z":"ece826b8.56d178","name":"K","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":930,"y":440,"wires":[]},{"id":"4f3ad504.6f92dc","type":"mqtt in","z":"ece826b8.56d178","name":"G","topic":"telemetry/inffeld16/2nd/id2068/thermometer/this/STATUS8","qos":"0","datatype":"auto","broker":"73e9a24f.21590c","x":130,"y":500,"wires":[["159aa941.1a39c7"]]},{"id":"159aa941.1a39c7","type":"function","z":"ece826b8.56d178","name":"I","func":"var data = JSON.parse(msg.payload);\nmsg.payload = data.StatusSNS;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":590,"y":500,"wires":[["3452183d.83eef8","d31b25db.a05348"]]},{"id":"ecec4d6c.ab4ca","type":"function","z":"ece826b8.56d178","name":"H","func":"var data = JSON.parse(msg.payload);\nmsg.payload = data;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":590,"y":440,"wires":[["3452183d.83eef8","d31b25db.a05348"]]},{"id":"c2100c77.0b19a","type":"function","z":"ece826b8.56d178","name":"E","func":"\nvar chartId = flow.get(\"coolchart\");\n\ntry {\n    var chart = MAIN.usercanvas.charts[chartId];\n    \n    \n    //Move to HUD\n    var hT = MAIN.camHookGo.transform.position;\n    var hR = MAIN.camHookGo.transform.rotation;\n    var T = [hT.x, hT.y, hT.z];\n    var R = [hR.x, hR.y, hR.z, hR.w];\n    RT.Unity.SetPose(chart.chartGo, T, R, null);\n    //RT.Unity.SetParent(chart.chartGo, MAIN.camHookGo);\n    //RT.Unity.SetLocalPose(chart.chartGo, [0,-0.1,0], null, null);\n    \n    var bc = MAIN.RR.Runtime.AddBoxCollider(chart.chartGo);\n    bc.size = new MAIN.UE.Vector3(0.3, 0.3, 0.3);\n    \n    /*\n    //Move to Palm\n    var targetGo = MAIN.UE.GameObject.Find(\"MyRightTip\");\n    //var targetGo = MAIN.palmHandMenuGo;\n    var hT = MAIN.camHookGo.transform.position;\n    var hR = MAIN.camHookGo.transform.rotation;\n    var T = [hT.x, hT.y, hT.z];\n    var R = [hR.x, hR.y, hR.z, hR.w];\n    RT.Unity.SetPose(chart.chartGo, T, R, null);\n    RT.Unity.SetParent(chart.chartGo, targetGo);\n    RT.Unity.SetLocalPose(chart.chartGo, [0,0,0], null, null);\n    */\n} catch(err) {\n    node.warn(\"CNR E ERROR (maybe trying to run client code?) => \" + err);\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":930,"y":380,"wires":[[]]},{"id":"c8fca45.daa8558","type":"inject","z":"ece826b8.56d178","name":"D","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":"7","topic":"","payload":"","payloadType":"date","x":790,"y":380,"wires":[["c2100c77.0b19a"]]},{"id":"58bfb280.04ca0c","type":"mqtt out","z":"ece826b8.56d178","name":"M rr/fridge/dist","topic":"rr/fridge/dist","qos":"0","retain":"false","broker":"73e9a24f.21590c","x":960,"y":500,"wires":[]},{"id":"a841d39.ca15b3","type":"mqtt in","z":"3d91de7c.8d0e42","name":"SA rr/fridge/dist","topic":"rr/fridge/dist","qos":"0","datatype":"auto","broker":"73e9a24f.21590c","x":180,"y":160,"wires":[["6f6fa803.3075b8"]]},{"id":"6f6fa803.3075b8","type":"function","z":"3d91de7c.8d0e42","name":"SB","func":"var distance = msg.payload;\nif(distance > 35) {\n    msg.payload = true;\n    return msg;\n}\nreturn null;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":350,"y":160,"wires":[["e164b83a.b9e398"]]},{"id":"e164b83a.b9e398","type":"mqtt out","z":"3d91de7c.8d0e42","name":"SC rr/fridge/dooropen","topic":"rr/fridge/dooropen","qos":"0","retain":"false","broker":"73e9a24f.21590c","x":540,"y":160,"wires":[]},{"id":"d82e6198.876ff","type":"mqtt in","z":"ece826b8.56d178","name":"N rr/fridge/dooropen","topic":"rr/fridge/dooropen","qos":"0","datatype":"auto","broker":"73e9a24f.21590c","x":630,"y":560,"wires":[["aa67989d.993e18"]]},{"id":"aa67989d.993e18","type":"function","z":"ece826b8.56d178","name":"O","func":"\ntry {\n    if(msg.payload) {\n        PlayNotification();\n    }\n} catch(err) {\n    node.warn(\"CNR J ERROR (maybe trying to run client code?) => \" + err);\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":930,"y":560,"wires":[[]]},{"id":"d31b25db.a05348","type":"function","z":"ece826b8.56d178","name":"L","func":"var data = msg.payload;\nmsg.payload = data.SR04.Distance;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":790,"y":500,"wires":[["58bfb280.04ca0c"]]},{"id":"e3df0de5.88f0f","type":"inject","z":"3d91de7c.8d0e42","name":"SD","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"36","payloadType":"num","x":170,"y":260,"wires":[["aefd319b.70914"]]},{"id":"aefd319b.70914","type":"mqtt out","z":"3d91de7c.8d0e42","name":"SE rr/fridge/dist","topic":"rr/fridge/dist","qos":"0","retain":"false","broker":"73e9a24f.21590c","x":390,"y":260,"wires":[]},{"id":"334722fd.97294e","type":"comment","z":"3d91de7c.8d0e42","name":"Testing","info":"","x":150,"y":220,"wires":[]},{"id":"90a9b5ec.d21948","type":"postgres","z":"2e447439.f12bdc","postgresdb":"20ba6cdb.ae7474","name":"","output":true,"perrow":false,"rowspermsg":"1","outputs":1,"x":580,"y":1340,"wires":[["5f0b43a7.c9b02c","f6e15fc.e906fa","9468841e.9b1e78"]]},{"id":"49327f86.7b9ef","type":"comment","z":"2e447439.f12bdc","name":"Mopop API","info":"","x":100,"y":1300,"wires":[]},{"id":"21064df2.1ad032","type":"http in","z":"2e447439.f12bdc","name":"[GET] /mopop/song","url":"/mopop/song","method":"get","upload":false,"swaggerDoc":"","x":130,"y":1340,"wires":[["ad99158b.ac8eb8","5f0b43a7.c9b02c"]]},{"id":"ad99158b.ac8eb8","type":"function","z":"2e447439.f12bdc","name":"parse query from parameters","func":"var coverid = msg.payload.coverid;\n\nvar query = \n\"SELECT \\\nb.name AS artist, \\\na.name AS song, \\\na.coverid AS coverid, \\\na.coverart AS coverart, \\\na.published AS publishdate, \\\na.publisher AS publisher, \\\nb.score AS score, \\\na.soldcopies AS soldcopies, \\\na.genre AS genre \\\nFROM \\\nmopop.works a, \\\nmopop.artists b \\\nWHERE a.coverid = '\" + coverid + \"'\" + \" \" +\n  \"AND a.artistid = b.id\"\n;\n\nmsg.payload = query;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":360,"y":1340,"wires":[["90a9b5ec.d21948"]]},{"id":"5f0b43a7.c9b02c","type":"debug","z":"2e447439.f12bdc","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":830,"y":1300,"wires":[]},{"id":"f6e15fc.e906fa","type":"http response","z":"2e447439.f12bdc","name":"","statusCode":"","headers":{},"x":830,"y":1340,"wires":[]},{"id":"17f08090.140d3f","type":"ui_text","z":"2e447439.f12bdc","group":"f5b93663.dcdb98","order":3,"width":0,"height":0,"name":"","label":"Artist","format":"{{msg.payload.artist}}","layout":"row-spread","x":830,"y":1380,"wires":[]},{"id":"76db42dd.14dc7c","type":"ui_text","z":"2e447439.f12bdc","group":"f5b93663.dcdb98","order":2,"width":0,"height":0,"name":"","label":"Song","format":"{{msg.payload.song}}","layout":"row-spread","x":830,"y":1420,"wires":[]},{"id":"dcd1c97c.17a578","type":"ui_text","z":"2e447439.f12bdc","group":"f5b93663.dcdb98","order":7,"width":0,"height":0,"name":"","label":"Year","format":"{{msg.payload}}","layout":"row-spread","x":830,"y":1460,"wires":[]},{"id":"f2c162b1.a4b6e","type":"ui_text","z":"2e447439.f12bdc","group":"f5b93663.dcdb98","order":6,"width":0,"height":0,"name":"","label":"Score","format":"{{msg.payload.score}}","layout":"row-spread","x":830,"y":1500,"wires":[]},{"id":"69be688f.f3ea78","type":"ui_text","z":"2e447439.f12bdc","group":"f5b93663.dcdb98","order":4,"width":0,"height":0,"name":"","label":"Genre","format":"{{msg.payload.genre}}","layout":"row-spread","x":830,"y":1540,"wires":[]},{"id":"9468841e.9b1e78","type":"function","z":"2e447439.f12bdc","name":"","func":"msg.payload = msg.payload[0];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":320,"y":1460,"wires":[["17f08090.140d3f","76db42dd.14dc7c","f2c162b1.a4b6e","69be688f.f3ea78","8dfc02e0.c7257","490a9ca1.f322c4","14fc63a1.0042ac"]]},{"id":"8dfc02e0.c7257","type":"function","z":"2e447439.f12bdc","name":"","func":"msg.payload = new Date(msg.payload.publishdate).getFullYear();\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":680,"y":1460,"wires":[["dcd1c97c.17a578"]]},{"id":"490a9ca1.f322c4","type":"ui_text","z":"2e447439.f12bdc","group":"f5b93663.dcdb98","order":5,"width":0,"height":0,"name":"","label":"Sold","format":"{{msg.payload.soldcopies}}","layout":"row-spread","x":830,"y":1580,"wires":[]},{"id":"14fc63a1.0042ac","type":"function","z":"2e447439.f12bdc","name":"","func":"var coverid = msg.payload.coverid;\nvar coverart = msg.payload.coverart;\n\n//var fn = \"/ragrug_mnt/uploads/\" + coverart;\nvar fn = \"http://10.0.0.2:8080/\" + coverart;\n\nmsg.payload = fn;\nmsg.payload.link = fn;\nmsg.link = fn;\nmsg.payload.file = fn;\nmsg.payload.filename = fn;\nmsg.file = fn;\nmsg.filename = fn;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":640,"y":1620,"wires":[["e8886b6b.14ecb8"]]},{"id":"e8886b6b.14ecb8","type":"ui_template","z":"2e447439.f12bdc","group":"f5b93663.dcdb98","name":"","order":1,"width":"3","height":"3","format":"<img src=\"{{msg.payload}}\" width=\"200px\" height=\"200px\"/>\n","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","x":820,"y":1620,"wires":[[]]},{"id":"73922aef.ce8a94","type":"comment","z":"ece826b8.56d178","name":"Temperature","info":"","x":150,"y":60,"wires":[]},{"id":"dda7ccc7.2d4de","type":"comment","z":"ece826b8.56d178","name":"Distance","info":"","x":140,"y":320,"wires":[]},{"id":"271e879d.534708","type":"comment","z":"f3784d00.40ef8","name":"Distatnce","info":"","x":120,"y":900,"wires":[]},{"id":"ed3b88b6.65fd88","type":"comment","z":"f3784d00.40ef8","name":"Temperature","info":"","x":130,"y":660,"wires":[]},{"id":"350164ec.5598ac","type":"comment","z":"e9bcdddb.5dd08","name":"","info":"","x":180,"y":2120,"wires":[]},{"id":"f7a5c22c.337b6","type":"function","z":"e9bcdddb.5dd08","name":"","func":"msg.payload = '{\"Time\":\"2021-09-13T23:36:11\",\"BME280\":{\"Temperature\":24.8,\"Humidity\":52.3,\"Pressure\":977.7},\"PressureUnit\":\"hPa\",\"TempUnit\":\"C\"}';\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":370,"y":2160,"wires":[["9b3d93f7.514d2"]]},{"id":"ca04fa48.2b12c8","type":"inject","z":"e9bcdddb.5dd08","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":180,"y":2160,"wires":[["f7a5c22c.337b6"]]},{"id":"9b3d93f7.514d2","type":"mqtt out","z":"e9bcdddb.5dd08","name":"","topic":"telemetry/inffeld16/basement/hallway/temp1/this/SENSOR","qos":"","retain":"","broker":"73e9a24f.21590c","x":760,"y":2160,"wires":[]},{"id":"d19b1b00.e92a18","type":"function","z":"6f1bb07c.9a108","name":"B - IATK Json Config","func":"var visData = \n{\n    \"UID\":\"\",\n    \"VisualisationType\":\"SCATTERPLOT\",\n    \"parallelCoordinatesDimensionsAttributes\":[],\n    \"parallelCoordinatesDimensionsMinFilter\":[],\n    \"parallelCoordinatesDimensionsMaxFilter\":[],\n    \"parallelCoordinatesDimensionsMinScale\":[],\n    \"parallelCoordinatesDimensionsMaxScale\":[],\n    \"Geometry\":4,\n    \"AxiesKeys\":[0,1],\n    \"AxiesValues\":[\"id\",\"temperature\"],\n    \"ColourDimension\":\"temperature\",\n    \"SizeDimension\":\"Undefined\",\n    \"LinkingDimension\":\"names\",\n    \"colourKeys\":\n    {\n        \"serializedVersion\":\"2\",\n        \"key0\":{\"r\":0.0,\"g\":1.0,\"b\":0.0,\"a\":1.0},\n        \"key1\":{\"r\":1.0,\"g\":0.0,\"b\":0.0,\"a\":1.0},\n        \"key2\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key3\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key4\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key5\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key6\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key7\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"ctime0\":0,\"ctime1\":65535,\"ctime2\":0,\"ctime3\":0,\"ctime4\":0,\"ctime5\":0,\"ctime6\":0,\"ctime7\":0,\n        \"atime0\":0,\"atime1\":65535,\"atime2\":0,\"atime3\":0,\"atime4\":0,\"atime5\":0,\"atime6\":0,\"atime7\":0,\n        \"m_Mode\":0,\n        \"m_NumColorKeys\":2,\n        \"m_NumAlphaKeys\":2\n    },\n    \"colour\":{\"r\":0.0,\"g\":0.0,\"b\":1.0,\"a\":0.5},\n    \"Size\":0.2,\n    \"MinSize\":0.02,\n    \"MaxSize\":0.2,\n    \"VisualisationWidth\":0.3,\n    \"VisualisationHeight\":0.3,\n    \"VisualisationDepth\":0.3\n};\nmsg.payload = visData;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":520,"y":320,"wires":[["8885aeb9.e0f6d"]]},{"id":"5aa61e7.66b3ee","type":"inject","z":"6f1bb07c.9a108","name":"A - Init Trigger 10sec","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":"10","topic":"","payload":"","payloadType":"date","x":200,"y":320,"wires":[["d19b1b00.e92a18"]]},{"id":"8885aeb9.e0f6d","type":"function","z":"6f1bb07c.9a108","name":"C - IATK Init","func":"try {\n    console.log(\"INIT IATK from NR ... 1\");\n    var nextId = Main_GetNextChartId();\n    \n    flow.set(\"coolchart\", nextId);\n    \n    console.log(\"INIT IATK from NR ... 2\");\n    var chartObj = RT.VIS.GetNewChartObjectIATK2(\n        nextId, \n        MAIN.usercanvas.charts.length,\n        \"IATKChart\", \n        MAIN.usercanvas.canvasSize, \n        MAIN.usercanvas.canvasSpacedSize,\n        false);\n\n    MAIN.usercanvas.charts.push(chartObj);\n    MAIN.RR.Runtime.ToggleObjManipulation(chartObj.chartGoName);\n\n    chartObj.rtds.AddDimension(\"temperature\", 0, 35);\n    chartObj.rtds.SetDataStrVal(\"temperature\", 35);\n    \n    chartObj.abstractVisualisation.UpdateVisualisation(chartObj.PropertyType.Y);\n        \n    //apply json here\n    var json = JSON.stringify(msg.payload);\n    chartObj.vis.theVisualizationObject.creationConfiguration.DeserializeJson(json);\n    \n    //update from json\n    importNamespace(\"IATK\").Replicator.SyncVis(chartObj.vis);\n    chartObj.fctUpdateChart();\n    chartObj.vis.updateProperties();\n    \n    msg.payload = nextId;\n} catch(err) {\n    var strmsg = \"trying to run client side code ... => \" + err;\n    msg.payload = strmsg;\n    node.warn(\"C => \" + strmsg);\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":750,"y":320,"wires":[[]]},{"id":"d483ca03.d841c8","type":"debug","z":"6f1bb07c.9a108","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":490,"y":80,"wires":[]},{"id":"b940043b.fc03d8","type":"inject","z":"6f1bb07c.9a108","name":"A","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":"5","topic":"","payload":"","payloadType":"date","x":130,"y":80,"wires":[["28b60f99.74bf4"]]},{"id":"28b60f99.74bf4","type":"function","z":"6f1bb07c.9a108","name":"","func":"msg.payload = \"partcnr starting for \" + LABEL.deviceId + \" / \" + pKey = LABEL.partId;\nnode.warn(msg.payload);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":310,"y":80,"wires":[["d483ca03.d841c8"]]},{"id":"8905ee2d.e9525","type":"function","z":"6f1bb07c.9a108","name":"E - Vis Placement (next to readings)","func":"\nvar chartId = flow.get(\"coolchart\");\n\ntry {\n    \n    var parentGo = Label_GetThisGo();\n    var chart = MAIN.usercanvas.charts[chartId];\n    \n    RT.Unity.SetParent(chart.chartGo, parentGo);\n    RT.Unity.SetLocalPose(chart.chartGo, [1500,-500,0], [0, 0, 0, 1], [2000, 2000, 2000]);\n    \n} catch(err) {\n    node.warn(\"CNR E ERROR (maybe trying to run client code?) => \" + err);\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":670,"y":360,"wires":[[]]},{"id":"3976882a.8bf4f8","type":"inject","z":"6f1bb07c.9a108","name":"D - Init Trigger 12sec","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":"12","topic":"","payload":"","payloadType":"date","x":200,"y":360,"wires":[["8905ee2d.e9525"]]},{"id":"ffb0453a.7fb9f8","type":"mqtt in","z":"6f1bb07c.9a108","name":"F - telemetry/inffeld16/basement/hallway/#","topic":"telemetry/inffeld16/basement/hallway/#","qos":"0","datatype":"auto","broker":"73e9a24f.21590c","x":240,"y":400,"wires":[["ac2878c9.960fa8"]]},{"id":"ac2878c9.960fa8","type":"function","z":"6f1bb07c.9a108","name":"G - Auto Topic Filter","func":"try {\n    var inTopic = msg.topic;\n    var thisTopic = LABEL.mqttTopic.replace(\"/#\",'');\n    //node.warn(\"partcnr: \" + inTopic + \" vs \" + thisTopic);\n    if(inTopic.indexOf(thisTopic) >= 0) {\n        //node.warn(\"partcnr: FOUND \" + inTopic + \" vs \" + thisTopic);\n        msg.payload = JSON.parse(msg.payload);\n        return msg;\n    }\n    return null;\n} catch(err) {\n    \n}\nreturn null;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":530,"y":400,"wires":[["46fbe480.6d076c"]]},{"id":"46fbe480.6d076c","type":"function","z":"6f1bb07c.9a108","name":"J - Vis Update","func":"//\"{\"Time\":\"2021-08-17T07:31:36\",\"BME280\":{\"Temperature\":26.1,\"Humidity\":47.2,\"DewPoint\":14.0,\"Pressure\":973.8},\"SR04\":{\"Distance\":59.368},\"PressureUnit\":\"hPa\",\"TempUnit\":\"C\"}\"\n\nvar data = msg.payload;\nvar temperature = data.BME280.Temperature;\nvar humidity = data.BME280.Humidity;\n//var distance = data.SR04.Distance;\nvar chartId = flow.get(\"coolchart\");\n\ntry {\n    var chart = MAIN.usercanvas.charts[chartId];\n    //chart.rtds.SetDataStrVal(\"distance\", distance);\n    chart.rtds.SetDataStrVal(\"temperature\", temperature);\n    chart.fctUpdateChart();\n} catch(err) {\n    node.warn(\"CNR J ERROR (maybe trying to run client code?) => \" + err);\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":740,"y":400,"wires":[[]]},{"id":"4652275c.3b9fa8","type":"function","z":"a3b70a95.71cd58","name":"Create Empty Vis","func":"\n//var nextId = Main_GetNextChartId();\nvar nextId = RT.Help.CreateGuid();\nflow.set(\"VIS0\", nextId);\nflow.set(\"VIS0LastUsed\", 0);\nflow.set(\"VIS0InitDone\", false);\nflow.set(\"VIS0Dist\", -1);\n\nvar chart = RT.VIS.GetNewChartObjectIATK2(\n    nextId, MAIN.usercanvas.charts2.length, \"IATKChart\", 0.3, 0,false);\n\nMAIN.usercanvas.charts2[nextId] = chart;\n\nMAIN.RR.Runtime.ToggleObjManipulation(chart.chartGoName);\nvar bc = MAIN.RR.Runtime.AddBoxCollider(chart.chartGo);\nbc.size = new MAIN.UE.Vector3(0.3, 0.3, 0.3);\n\nmsg.payload = nextId;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":610,"y":160,"wires":[["386a4687.45339a"]]},{"id":"e7d2d7e6.af5338","type":"inject","z":"a3b70a95.71cd58","name":"A","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":"1","topic":"","payload":"0","payloadType":"num","x":250,"y":160,"wires":[["5cf97193.3d6ab"]]},{"id":"386a4687.45339a","type":"function","z":"a3b70a95.71cd58","name":"add dimensions","func":"var chartId = msg.payload;\nvar chart = MAIN.usercanvas.charts2[chartId];\nchart.rtds.AddStringDimension(\"device\");\nchart.rtds.AddDimension(\"temperature\", 0, 100);\nchart.rtds.SetDimensionMinMax(\"device\", 0, 1);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":820,"y":160,"wires":[[]]},{"id":"eae3ac02.fdc14","type":"function","z":"a3b70a95.71cd58","name":"Setup JSON","func":"var visData = \n{\n    \"UID\":\"\",\n    \"VisualisationType\":\"SCATTERPLOT\",\n    \"parallelCoordinatesDimensionsAttributes\":[],\n    \"parallelCoordinatesDimensionsMinFilter\":[],\n    \"parallelCoordinatesDimensionsMaxFilter\":[],\n    \"parallelCoordinatesDimensionsMinScale\":[],\n    \"parallelCoordinatesDimensionsMaxScale\":[],\n    \"Geometry\": 6,\n    \"AxiesKeys\":[0, 1],\n    \"AxiesValues\":[\"device\",\"temperature\"],\n    \"ColourDimension\":\"temperature\",\n    \"SizeDimension\":\"Undefined\",\n    \"LinkingDimension\":\"Undefined\",\n    \"colourKeys\":\n    {\n        \"serializedVersion\":\"2\",\n        \"key0\":{\"r\":0.0,\"g\":1.0,\"b\":0.0,\"a\":1.0},\n        \"key1\":{\"r\":1.0,\"g\":0.0,\"b\":0.0,\"a\":1.0},\n        \"key2\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key3\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key4\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key5\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key6\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key7\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"ctime0\":0,\"ctime1\":65535,\"ctime2\":0,\"ctime3\":0,\"ctime4\":0,\"ctime5\":0,\"ctime6\":0,\"ctime7\":0,\n        \"atime0\":0,\"atime1\":65535,\"atime2\":0,\"atime3\":0,\"atime4\":0,\"atime5\":0,\"atime6\":0,\"atime7\":0,\n        \"m_Mode\":0,\n        \"m_NumColorKeys\":2,\n        \"m_NumAlphaKeys\":2\n    },\n    \"colour\":{\"r\":0.0,\"g\":0.0,\"b\":1.0,\"a\":0.5},\n    \"Size\":0.2,\n    \"MinSize\":0.01,\n    \"MaxSize\":0.2,\n    \"VisualisationWidth\":0.3,\n    \"VisualisationHeight\":0.3,\n    \"VisualisationDepth\":0.3\n};\nmsg.json = visData;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":790,"y":220,"wires":[["9d7c71e1.58914"]]},{"id":"9d7c71e1.58914","type":"function","z":"a3b70a95.71cd58","name":"apply json","func":"var chartId = msg.payload;\nvar chart = MAIN.usercanvas.charts2[chartId];\n\nvar json = JSON.stringify(msg.json);\nchart.vis.theVisualizationObject.creationConfiguration.DeserializeJson(json);\nimportNamespace(\"IATK\").Replicator.SyncVis(chart.vis);\nchart.fctUpdateChart();\nchart.vis.updateProperties();\n\nflow.set(\"VIS0InitDone\", true);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":980,"y":220,"wires":[[]]},{"id":"1abd91e9.7dea3e","type":"inject","z":"a3b70a95.71cd58","name":"A","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":"1","topic":"","payload":"0","payloadType":"num","x":250,"y":220,"wires":[["26ace308.9ada2c"]]},{"id":"1f35764c.66e38a","type":"mqtt in","z":"a3b70a95.71cd58","name":"","topic":"telemetry/#","qos":"0","datatype":"auto","broker":"73e9a24f.21590c","x":240,"y":280,"wires":[["cbf1c30a.ad67"]]},{"id":"d1926dbd.9d21f","type":"function","z":"a3b70a95.71cd58","name":"filter for temperature data","func":"\ntry {\n    \n    //search for \"Temperature\" or \"temperature\"\n    var foundStr = \"\";\n    var hasTemp = msg.payload.indexOf(\"temperature\");\n    \n    if(hasTemp < 0) {\n        hasTemp = msg.payload.indexOf(\"Temperature\");\n    }\n    \n    if(hasTemp >= 0) {\n        var s = -1;\n        var e = -1;\n        \n        var i = 0;\n        for(i = hasTemp; i >= 0; i--) {\n            if(msg.payload[i] == \"{\") {\n                s = i;\n                break;\n            }\n        }\n        \n        for(i = hasTemp; i < msg.payload.length; i++) {\n            if(msg.payload[i] == \"}\") {\n                e = i + 1;\n                break;\n            }\n        }\n        \n        if(s > -1 && e > -1) {\n            foundStr = msg.payload.substring(s,e);\n            //node.warn(\"foundStr = \" + s + \" /\" + e + \" => \" + foundStr);\n        }\n    }\n    \n    // send temperature object\n    if(foundStr.length > 0) {\n        msg.payload = foundStr.replace(\"Temperature\",\"temperature\");\n        return msg;\n    }\n} catch(err) {\n    \n}\n\n\nreturn null;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":770,"y":280,"wires":[["6a166621.c416d8"]]},{"id":"fa9ca46f.5c1918","type":"debug","z":"a3b70a95.71cd58","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1210,"y":280,"wires":[]},{"id":"fa81553a.f678f8","type":"catch","z":"eb66deb5.bea27","name":"","scope":["3e0613e4.b8843c"],"uncaught":false,"x":980,"y":1120,"wires":[["dd7ee12c.8b14e"]]},{"id":"dd7ee12c.8b14e","type":"debug","z":"eb66deb5.bea27","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1160,"y":1120,"wires":[]},{"id":"6a166621.c416d8","type":"function","z":"a3b70a95.71cd58","name":"data update","func":"var topic = msg.topic;\nvar data = JSON.parse(msg.payload);\n\nvar temp = data.temperature;\nvar posId = 0;\n\nposId = flow.get(topic);\nvar isNew = false;\nif(posId == 'undefined' || posId == null) {\n    posId = flow.get(\"VIS0LastUsed\");\n    flow.set(\"VIS0LastUsed\", posId + 1);\n    flow.set(topic, posId);\n    isNew = true;\n    node.warn(\"posId=\" + posId + \", \" + topic);\n}\n\nvar chartId = flow.get(\"VIS0\");\ntry {\n    var chart = MAIN.usercanvas.charts2[chartId];\n    if(isNew) {\n        node.warn(\"ADDING new device=\" + posId + \", \" + topic);\n    \n        chart.rtds.SetDimensionMinMax(\"device\", 0, posId+1);\n        chart.rtds.SetDataStrStrById(\"device\", topic, posId);\n        \n        chart.vis.updateProperties();\n        /*\n        chart.vis.UpdateVisualisation(chart.vis.PropertyType.X);\n        chart.vis.UpdateVisualisation(chart.vis.PropertyType.Y);\n        chart.vis.UpdateVisualisation(chart.vis.PropertyType.Z);\n        chart.vis.UpdateVisualisation(chart.vis.PropertyType.SizeValues);\n        chart.vis.UpdateVisualisation(chart.vis.PropertyType.GeometryType);\n        chart.vis.UpdateVisualisation(chart.vis.PropertyType.LinkingDimension);\n        */\n        chart.fctUpdateChart();\n        return msg;\n    }\n    \n    chart.rtds.SetDataStrValById(\"temperature\", temp, posId);\n    //node.warn(\"posId=\" + posId + \", \" + topic + \", temp=\" + temp);\n    chart.vis.updateProperties(); //was not here before for testing\n    chart.fctUpdateChart();\n\n    \n} catch(err) {\n    //node.warn(\"CNR (dataupdate) ERROR => \" + err);\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1010,"y":280,"wires":[["fa9ca46f.5c1918"]]},{"id":"3cde2d40.1654b2","type":"inject","z":"eb66deb5.bea27","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"8","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":110,"y":2340,"wires":[["db6372e8.d09c8"]]},{"id":"db6372e8.d09c8","type":"function","z":"eb66deb5.bea27","name":"telemetry/inffeld16/2nd/hallway/coffeemachine/heater","func":"var sensor = {};\nvar max = 0;\nvar min = 0;\n\nmax = 50;\nmin = 49;\nvar v1 = Math.random() * (max - min) + min;\n\nsensor.temperature = v1;\n\nvar topic = \"telemetry/inffeld16/2nd/hallway/coffeemachine/heater\";\nmsg.topic = topic;\nmsg.payload=sensor;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":420,"y":2340,"wires":[["964e426d.53168"]]},{"id":"b4b88fa1.546ae","type":"function","z":"a3b70a95.71cd58","name":"get chartid","func":"var chartId = flow.get(\"VIS0\");\nmsg.payload = chartId;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":590,"y":220,"wires":[["eae3ac02.fdc14"]]},{"id":"5cf97193.3d6ab","type":"function","z":"a3b70a95.71cd58","name":"client filter","func":"try {\n    var n = MAIN.usercanvas;\n    return msg;\n} catch(err) {\n    return null;\n}\nreturn null;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":400,"y":160,"wires":[["4652275c.3b9fa8"]]},{"id":"26ace308.9ada2c","type":"function","z":"a3b70a95.71cd58","name":"client filter","func":"try {\n    var n = MAIN.usercanvas;\n    return msg;\n} catch(err) {\n    return null;\n}\nreturn null;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":400,"y":220,"wires":[["b4b88fa1.546ae"]]},{"id":"cbf1c30a.ad67","type":"function","z":"a3b70a95.71cd58","name":"client filter","func":"try {\n    var n = MAIN.usercanvas;\n    return msg;\n} catch(err) {\n    return null;\n}\nreturn null;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":400,"y":280,"wires":[["13056b2b.7c3035"]]},{"id":"f0b0263f.97b128","type":"inject","z":"eb66deb5.bea27","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"5","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":110,"y":2400,"wires":[["d897f4bc.e4f198"]]},{"id":"d897f4bc.e4f198","type":"function","z":"eb66deb5.bea27","name":"telemetry/inffeld16/2nd/hallway/light/main","func":"var sensor = {};\nvar max = 0;\nvar min = 0;\n\nmax = 20;\nmin = 19;\nvar v1 = Math.random() * (max - min) + min;\n\nsensor.temperature = v1;\n\nvar topic = \"telemetry/inffeld16/2nd/hallway/light/main\";\nmsg.topic = topic;\nmsg.payload=sensor;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":460,"y":2400,"wires":[["964e426d.53168"]]},{"id":"13056b2b.7c3035","type":"function","z":"a3b70a95.71cd58","name":"check init","func":"var isInit = flow.get(\"VIS0InitDone\");\nif(!isInit) {\n    return null;\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":560,"y":280,"wires":[["d1926dbd.9d21f"]]},{"id":"30778bbe.6b97e4","type":"inject","z":"a3b70a95.71cd58","name":"A","props":[{"p":"payload"}],"repeat":"1","crontab":"","once":true,"onceDelay":"1","topic":"","payload":"0","payloadType":"num","x":230,"y":460,"wires":[["2954a9b0.8201d6"]]},{"id":"2954a9b0.8201d6","type":"function","z":"a3b70a95.71cd58","name":"client filter","func":"try {\n    var n = MAIN.usercanvas;\n    return msg;\n} catch(err) {\n    return null;\n}\nreturn null;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":380,"y":460,"wires":[["3ef7cd29.6aa472"]]},{"id":"3ef7cd29.6aa472","type":"function","z":"a3b70a95.71cd58","name":"check init","func":"var isInit = flow.get(\"VIS0InitDone\");\nif(!isInit) {\n    return null;\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":540,"y":460,"wires":[["7911e484.5ef57c"]]},{"id":"7911e484.5ef57c","type":"function","z":"a3b70a95.71cd58","name":"calc dist","func":"//flow.set(\"VIS0Dist\", \"far\");\nvar distState = flow.get(\"VIS0Dist\");\n\nnode.warn(\"proxemics ...\")\n\nvar maincam = MAIN.UE.Camera.main;\nif(maincam != null) {\n    \n    node.warn(\"proxemics ... 1\")\n    \n    //get cur head pose\n    var T = maincam.transform.position;\n    \n    node.warn(\"proxemics ... 2\")\n    \n    // get vis position\n    var chartId = flow.get(\"VIS0\");\n    msg.payload = chartId;\n    \n    var chart = MAIN.usercanvas.charts2[chartId];\n    \n    node.warn(\"proxemics ... 3 chartId=\" + chartId);\n    \n    var Tg = chart.chartGo.transform.position;\n    \n    node.warn(\"proxemics ... 4\")\n    \n    \n    var dist =\n    Math.sqrt(\n        (T.x - Tg.x) * (T.x - Tg.x) +\n        (T.y - Tg.y) * (T.y - Tg.y) +\n        (T.z - Tg.z) * (T.z - Tg.z)\n    );\n    msg.dist = dist;\n    \n    node.warn(\"proxemics dist = \" + dist);\n    \n    if(dist < 1) {\n        if(distState != 2) {\n            distState = 2;\n            flow.set(\"VIS0Dist\", 2);\n            node.warn(\"proxemics distState= \" + distState);\n            node.send([null, null, msg]);\n            return null;\n        }\n    } else if(dist < 3) {\n        if(distState != 1) {\n            distState = 1;\n            flow.set(\"VIS0Dist\", 1);\n            node.warn(\"proxemics distState= \" + distState);\n            node.send([null, msg, null]);\n            return null;\n        }\n    } else {\n        if(distState != 0) {\n            distState = 0;\n            flow.set(\"VIS0Dist\", 0);\n            node.warn(\"proxemics distState= \" + distState);\n            node.send([msg, null, null]);\n            return null;\n        }\n    }\n}\nreturn null;","outputs":3,"noerr":0,"initialize":"","finalize":"","x":700,"y":460,"wires":[["e16b5094.1b74b"],["1e150961.a06637"],["309fbb10.0806c4"]]},{"id":"309fbb10.0806c4","type":"function","z":"a3b70a95.71cd58","name":"Closest JSON","func":"var visData = \n{\n    \"UID\":\"\",\n    \"VisualisationType\":\"SCATTERPLOT\",\n    \"parallelCoordinatesDimensionsAttributes\":[],\n    \"parallelCoordinatesDimensionsMinFilter\":[],\n    \"parallelCoordinatesDimensionsMaxFilter\":[],\n    \"parallelCoordinatesDimensionsMinScale\":[],\n    \"parallelCoordinatesDimensionsMaxScale\":[],\n    \"Geometry\": 6, //bars\n    \"AxiesKeys\":[0, 1],\n    \"AxiesValues\":[\"device\",\"temperature\"],\n    \"ColourDimension\":\"device\",\n    \"SizeDimension\":\"temperature\",\n    \"LinkingDimension\":\"Undefined\",\n    \"colourKeys\":\n    {\n        \"serializedVersion\":\"2\",\n        \"key0\":{\"r\":1.0,\"g\":1.0,\"b\":0.0,\"a\":1.0},\n        \"key1\":{\"r\":0.0,\"g\":1.0,\"b\":0.0,\"a\":0.5},\n        \"key2\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key3\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key4\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key5\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key6\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key7\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"ctime0\":0,\"ctime1\":65535,\"ctime2\":0,\"ctime3\":0,\"ctime4\":0,\"ctime5\":0,\"ctime6\":0,\"ctime7\":0,\n        \"atime0\":0,\"atime1\":65535,\"atime2\":0,\"atime3\":0,\"atime4\":0,\"atime5\":0,\"atime6\":0,\"atime7\":0,\n        \"m_Mode\":0,\n        \"m_NumColorKeys\":2,\n        \"m_NumAlphaKeys\":2\n    },\n    \"colour\":{\"r\":0.0,\"g\":0.0,\"b\":1.0,\"a\":0.5},\n    \"Size\":0.3,\n    \"MinSize\":0.01,\n    \"MaxSize\":0.2,\n    \"VisualisationWidth\": 0.3,\n    \"VisualisationHeight\": 0.3,\n    \"VisualisationDepth\": 0.3\n};\nmsg.json = visData;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":980,"y":500,"wires":[["5c948d7b.296ab4","12f710d3.8c964f"]]},{"id":"5c948d7b.296ab4","type":"function","z":"a3b70a95.71cd58","name":"apply json","func":"node.warn(\"applying json msg.payload = \" + msg.payload);\n\nvar chartId = flow.get(\"VIS0\");\n//var chartId = msg.payload;\n\ntry {\n    node.warn(\"applying json chartId = \" + chartId);\n    node.warn(\"applying json ... #charts=\" + MAIN.usercanvas.charts.length);\n    \n    var chart = MAIN.usercanvas.charts2[chartId];\n    \n    node.warn(\"applying json ... 1 chart=\" + chart);\n    \n    var json = JSON.stringify(msg.json);\n    \n    node.warn(\"applying json ... 2 json => \" + json);\n    \n    \n    if(chart != null) {\n        if(chart.vis != null) {\n            if(chart.vis.theVisualizationObject != null) {\n                if(chart.vis.theVisualizationObject.creationConfiguration != null) {\n                    //all good here\n                } else node.warn(\"ERROR applying json ... 2 creationConfiguration is null \");\n            } else node.warn(\"ERROR applying json ... 2 theVisualizationObject is null \");\n        } else node.warn(\"ERROR applying json ... 2 vis is null \");\n    } else node.warn(\"ERROR applying json ... 2 chart is null \");\n    \n    node.warn(\"applying json ... 2b \");\n    \n    chart.vis.theVisualizationObject.creationConfiguration.DeserializeJson(json);\n    importNamespace(\"IATK\").Replicator.SyncVis(chart.vis);\n    \n    \n    chart.vis.updateProperties();\n    chart.fctUpdateChart();\n    node.warn(\"applying json ... 7\");\n    \n} catch(err) {\n    node.warn(\"CNR ERROR applying json => \" + err);\n    return null;\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1240,"y":500,"wires":[["8818c24a.9ae4f"]]},{"id":"8818c24a.9ae4f","type":"debug","z":"a3b70a95.71cd58","name":"PosePull","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1260,"y":560,"wires":[]},{"id":"53c1890.3a2af78","type":"debug","z":"a3b70a95.71cd58","name":"distState 0","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1250,"y":360,"wires":[]},{"id":"12f710d3.8c964f","type":"debug","z":"a3b70a95.71cd58","name":"distState 2","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1250,"y":440,"wires":[]},{"id":"1e150961.a06637","type":"function","z":"a3b70a95.71cd58","name":"Mid JSON","func":"var visData = \n{\n    \"UID\":\"\",\n    \"VisualisationType\":\"SCATTERPLOT\",\n    \"parallelCoordinatesDimensionsAttributes\":[],\n    \"parallelCoordinatesDimensionsMinFilter\":[],\n    \"parallelCoordinatesDimensionsMaxFilter\":[],\n    \"parallelCoordinatesDimensionsMinScale\":[],\n    \"parallelCoordinatesDimensionsMaxScale\":[],\n    \"Geometry\": 3, //quads\n    \"AxiesKeys\":[0, 1],\n    \"AxiesValues\":[\"device\",\"temperature\"],\n    \"ColourDimension\":\"temperature\",\n    \"SizeDimension\":\"Undefined\",\n    \"LinkingDimension\":\"Undefined\",\n    \"colourKeys\":\n    {\n        \"serializedVersion\":\"2\",\n        \"key0\":{\"r\":1.0,\"g\":1.0,\"b\":0.0,\"a\":1.0},\n        \"key1\":{\"r\":0.0,\"g\":1.0,\"b\":0.0,\"a\":0.5},\n        \"key2\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key3\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key4\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key5\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key6\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key7\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"ctime0\":0,\"ctime1\":65535,\"ctime2\":0,\"ctime3\":0,\"ctime4\":0,\"ctime5\":0,\"ctime6\":0,\"ctime7\":0,\n        \"atime0\":0,\"atime1\":65535,\"atime2\":0,\"atime3\":0,\"atime4\":0,\"atime5\":0,\"atime6\":0,\"atime7\":0,\n        \"m_Mode\":0,\n        \"m_NumColorKeys\":2,\n        \"m_NumAlphaKeys\":2\n    },\n    \"colour\":{\"r\":0.0,\"g\":0.0,\"b\":1.0,\"a\":0.5},\n    \"Size\":0.3,\n    \"MinSize\":0.01,\n    \"MaxSize\":0.2,\n    \"VisualisationWidth\": 0.3,\n    \"VisualisationHeight\": 0.3,\n    \"VisualisationDepth\": 0.3\n};\nmsg.json = visData;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":970,"y":460,"wires":[["5c948d7b.296ab4","38b7a6f6.94024a"]]},{"id":"38b7a6f6.94024a","type":"debug","z":"a3b70a95.71cd58","name":"distState 1","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1250,"y":400,"wires":[]},{"id":"e16b5094.1b74b","type":"function","z":"a3b70a95.71cd58","name":"Farthest JSON","func":"var visData = \n{\n    \"UID\":\"\",\n    \"VisualisationType\":\"SCATTERPLOT\",\n    \"parallelCoordinatesDimensionsAttributes\":[],\n    \"parallelCoordinatesDimensionsMinFilter\":[],\n    \"parallelCoordinatesDimensionsMaxFilter\":[],\n    \"parallelCoordinatesDimensionsMinScale\":[],\n    \"parallelCoordinatesDimensionsMaxScale\":[],\n    \"Geometry\": 1, //points\n    \"AxiesKeys\":[0, 1],\n    \"AxiesValues\":[\"device\",\"temperature\"],\n    \"ColourDimension\":\"Undefined\",\n    \"SizeDimension\":\"Undefined\",\n    \"LinkingDimension\":\"Undefined\",\n    \"colourKeys\":\n    {\n        \"serializedVersion\":\"2\",\n        \"key0\":{\"r\":0.0,\"g\":0.0,\"b\":1.0,\"a\":1.0},\n        \"key1\":{\"r\":1.0,\"g\":0.0,\"b\":0.0,\"a\":0.5},\n        \"key2\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key3\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key4\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key5\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key6\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key7\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"ctime0\":0,\"ctime1\":65535,\"ctime2\":0,\"ctime3\":0,\"ctime4\":0,\"ctime5\":0,\"ctime6\":0,\"ctime7\":0,\n        \"atime0\":0,\"atime1\":65535,\"atime2\":0,\"atime3\":0,\"atime4\":0,\"atime5\":0,\"atime6\":0,\"atime7\":0,\n        \"m_Mode\":0,\n        \"m_NumColorKeys\":2,\n        \"m_NumAlphaKeys\":2\n    },\n    \"colour\":{\"r\":0.0,\"g\":0.0,\"b\":1.0,\"a\":0.5},\n    \"Size\":0.5,\n    \"MinSize\":0.02,\n    \"MaxSize\":0.4,\n    \"VisualisationWidth\":0.3,\n    \"VisualisationHeight\":0.3,\n    \"VisualisationDepth\":0.3\n};\nmsg.json = visData;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":980,"y":420,"wires":[["5c948d7b.296ab4","53c1890.3a2af78"]]},{"id":"5d85611c.8a7b2","type":"comment","z":"923bd7d5.f34fa8","name":"Initialization","info":"","x":170,"y":220,"wires":[]},{"id":"6ebd5fac.c4772","type":"inject","z":"923bd7d5.f34fa8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"1","topic":"","payload":"","payloadType":"date","x":180,"y":260,"wires":[["daf2d4bc.a78248"]]},{"id":"2ac54556.5cc4da","type":"function","z":"923bd7d5.f34fa8","name":"Load Assets from location","func":"importNamespace(\"Vizario\").AssetBundleHolder.ImportFromFile(MAIN.location.envassetbundle, MAIN.location.envassetbundle);\nconsole.log(\"MOPOP CNR assets => \" + MAIN.location.envassetbundle);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":310,"y":320,"wires":[["defc0cb9.c596f","8b6ebf5a.0abf2"]]},{"id":"daf2d4bc.a78248","type":"function","z":"923bd7d5.f34fa8","name":"client filter","func":"try {\n    var n = MAIN.usercanvas;\n    return msg;\n} catch(err) {\n    return null;\n}\nreturn null;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":340,"y":260,"wires":[["a4db9195.8121c"]]},{"id":"8b6ebf5a.0abf2","type":"function","z":"923bd7d5.f34fa8","name":"Download tracking data xml","func":"var reqHeaders = [\"content-type\", \"application/x-www-form-urlencoded\"];\nvar url = MAIN.WEBAPI.apiBase + \"/getfile2?name=\";\nmsg.reqheaders = reqHeaders;\nmsg.url = url;\n\nvar urlA = msg.url + MAIN.location.envtargets.xml;\nconsole.log(\"MOPOP CNR type msg.reqheaders => \" + msg.reqheaders + \"|\" + typeof msg.reqheaders);\ntry {\n    //the callback might not be calle din the current version\n    RT.Web.DownloadFile(\"GET\", urlA, msg.reqheaders, MAIN.location.envtargets.xml, false, function () {\n        console.log(\"MOPOP CNR xml => \" + MAIN.location.envtargets.xml);\n        //node.send([{\"payload\":\"XML Download done! => \" + MAIN.location.envtargets.xml}]);\n    });\n} catch(err) {\n    console.log(\"MOPOP CNR urlA ERROR => \" + err);\n}\n//return null;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":600,"y":320,"wires":[["f4653c83.ed5b6","5969623e.86581c"]]},{"id":"5969623e.86581c","type":"function","z":"923bd7d5.f34fa8","name":"Download tracking data dat","func":"var reqHeaders = [\"content-type\", \"application/x-www-form-urlencoded\"];\nvar url = MAIN.WEBAPI.apiBase + \"/getfile2?name=\";\nmsg.reqheaders = reqHeaders;\nmsg.url = url;\n\nvar urlB = msg.url + MAIN.location.envtargets.dat;\ntry {\n//the callback might not be calle din the current version\nRT.Web.DownloadFile(\"GET\", urlB, msg.reqheaders, MAIN.location.envtargets.dat, false, function () {\n    console.log(\"MOPOP CNR dat => \" + MAIN.location.envtargets.dat);\n    //node.send([{\"payload\":\"DAT Download done! => \" + MAIN.location.envtargets.dat}]);\n});\n} catch(err) {\n    console.log(\"MOPOP CNR urlB ERROR => \" + err);\n}\n//return null;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":880,"y":320,"wires":[["124dd0a3.473e3f","c5a77e11.046b4"]]},{"id":"defc0cb9.c596f","type":"debug","z":"923bd7d5.f34fa8","name":"A","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":530,"y":360,"wires":[]},{"id":"f4653c83.ed5b6","type":"debug","z":"923bd7d5.f34fa8","name":"B","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":810,"y":360,"wires":[]},{"id":"124dd0a3.473e3f","type":"debug","z":"923bd7d5.f34fa8","name":"C","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1090,"y":320,"wires":[]},{"id":"5edc8dd2.6085d4","type":"mqtt in","z":"923bd7d5.f34fa8","name":"","topic":"MOPOP/wallyearhist/#","qos":"0","datatype":"auto","broker":"73e9a24f.21590c","x":160,"y":1460,"wires":[["ccf6932.bf8437"]]},{"id":"11d6a535.5f0b6b","type":"mqtt in","z":"923bd7d5.f34fa8","name":"","topic":"MOPOP/infocompare","qos":"0","datatype":"auto","broker":"73e9a24f.21590c","x":160,"y":1520,"wires":[["da86f847.c10478"]]},{"id":"f8ef30d1.04333","type":"function","z":"923bd7d5.f34fa8","name":"check world","func":"if (MAIN.worldgo == null) {\n        MAIN.worldgo = MAIN.UE.GameObject.Find(\"world\");\n    }\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":450,"y":520,"wires":[["41fae956.8da1f8"]]},{"id":"41fae956.8da1f8","type":"function","z":"923bd7d5.f34fa8","name":"Init hookwalls","func":"\nfunction MOPOP_HookWallHookEntry(mThis, mOther, mData) {\n    //{\"TrackableName\":\"16325654015\",\"TrackedGoName\":\"VIT-6-16325654015\",\"goName\":\"Test16325654015\",\"wuName\":\"UI16325654015\"}\n    \n    \n    // Filter to only handle Record labels\n    if (mOther.indexOf(\"UI\") < 0) {\n        return;\n    }\n    //node.warn(\"MOPOP_HookWallHookEntry mData => \" + mData);\n    var m = {\n        \"payload\": {\n            \"this\": mThis,\n            \"other\": mOther,\n            \"data\" : JSON.parse(mData)\n        }\n    };\n    node.send([null, m, null]);\n}\n\nfunction MOPOP_HookWallHookExit(mThis, mOther, mData) {\n    //activated on exit\n    \n    // Filter to only handle Record labels\n    if (mOther.indexOf(\"UI\") < 0) {\n        return;\n    }\n    var m = {\n        \"payload\" : {\n            \"this\": mThis,\n            \"other\": mOther,\n            \"data\" : JSON.parse(mData)\n        }\n    };\n    node.send([null, null, m]);\n}\n\nfunction MOPOP_SetupTimeline(hTimeline, hGo, tileSize, W, H, wallWidth, reversed) {\n    if (hTimeline != null) {\n        var hGoName = hGo.name;\n        var goTimelineName = hGoName + \"_TL\";\n        var goTimeline = new MAIN.UE.GameObject(goTimelineName);\n        goTimeline.transform.parent = hGo.transform;\n\n        var xOffset = ((W * 0.5) * tileSize) - tileSize * 0.5;\n        var yOffset = - tileSize;\n        var zOffset = 0.1;\n        goTimeline.transform.localPosition = new MAIN.UE.Vector3(xOffset, yOffset, zOffset);\n\n        var goTimelineBar = MAIN.UE.GameObject.CreatePrimitive(3); //cube\n        goTimelineBar.name = goTimelineName + \"_Bar\";\n        goTimelineBar.transform.parent = goTimeline.transform;\n        goTimelineBar.transform.localPosition = new MAIN.UE.Vector3(0, 0, 0);\n        goTimelineBar.transform.localScale = new MAIN.UE.Vector3(wallWidth, 0.01, 0.01);\n\n        var startYear = hTimeline.start;\n        var endYear = hTimeline.end;\n        var tick = hTimeline.tick;\n\n        MOPOP.startyear = startYear;\n        MOPOP.endyear = endYear;\n        MOPOP.midyear = (endYear - startYear) * 0.5 + startYear;\n\n        var Nyears = endYear - startYear;\n        var tickSpacing = wallWidth / Nyears;\n        for (var iTick = 0; iTick < Nyears + 1; iTick++) {\n            var goTimelineBarTick = MAIN.UE.GameObject.CreatePrimitive(3);\n            goTimelineBarTick.name = goTimelineName + \"_tick_\" + (startYear + iTick);\n\n            if (reversed) {\n                goTimelineBarTick.name = goTimelineName + \"_tick_\" + (endYear - iTick);\n            }\n\n            goTimelineBarTick.transform.parent = goTimeline.transform;\n            var tickPos = iTick * tickSpacing - wallWidth * 0.5;\n\n            goTimelineBarTick.transform.localPosition = new MAIN.UE.Vector3(tickPos, 0, 0);\n            goTimelineBarTick.transform.localScale = new MAIN.UE.Vector3(0.004, 0.05, 0.005);\n\n\n            if (iTick == 0) {\n                endTickPos = tickPos;\n            }\n\n            if (iTick == Nyears) {\n                endTickPos = tickPos;\n            }\n\n\n            if (iTick == 0 || iTick == Nyears || iTick == Nyears / 2) {\n                goTimelineBarTick.transform.localScale = new MAIN.UE.Vector3(0.008, 0.05, 0.005);\n                var r = goTimelineBarTick.GetComponent(MAIN.UE.Renderer);\n                if (r != null) {\n                    r.material.color = MAIN.UE.Color.green;\n                }\n            }\n        }\n\n        //set startyear label\n        if (MOPOP.startyear > 0) {\n            var xOffset = ((W * 0.5) * tileSize) - tileSize * 0.5;\n            //if (reversed) {\n            //    xOffset = ((W * 0.5) * tileSize) - tileSize * 0.5;\n            //}\n            var yOffset = - tileSize;\n            var startLabelName = goTimelineName + \"_L_\" + MOPOP.startyear;\n            var labelText = MOPOP.startyear;\n            if (reversed) {\n                startLabelName = goTimelineName + \"_L_\" + MOPOP.endyear;\n                labelText = MOPOP.endyear;\n            }\n            var wTrans = [xOffset - wallWidth * 0.7, yOffset - tileSize - 0.1, zOffset];\n            //if (reversed) {\n            //    wTrans = [xOffset + wallWidth * 0.7, yOffset - tileSize - 0.1, zOffset];\n            //}\n            var wRot = [0, 1, 0, 0];\n            var wScale = [0.001, 0.001, 0.001];\n            MAIN_CreateLabel(startLabelName, wTrans, wRot, wScale, hGo, labelText);\n        }\n\n        if (MOPOP.endyear > 0) {\n            var xOffset = ((W * 0.5) * tileSize) - tileSize * 0.5;\n            var yOffset = - tileSize;\n            var endLabelName = goTimelineName + \"_L_\" + MOPOP.endyear;\n            var labelText = MOPOP.endyear;\n            if (reversed) {\n                endLabelName = goTimelineName + \"_L_\" + MOPOP.startyear;\n                labelText = MOPOP.startyear;\n            }\n            var wTrans = [xOffset + wallWidth * 0.3, yOffset - tileSize - 0.1, zOffset];\n            var wRot = [0, 1, 0, 0];\n            var wScale = [0.001, 0.001, 0.001];\n            MAIN_CreateLabel(endLabelName, wTrans, wRot, wScale, hGo, labelText);\n\n            var midLabelName = goTimelineName + \"_L_\" + MOPOP.mid;\n            var wTrans2 = [xOffset - wallWidth * 0.2, yOffset - tileSize - 0.1, zOffset];\n            MAIN_CreateLabel(midLabelName, wTrans2, wRot, wScale, hGo, MOPOP.midyear);\n        }\n    }\n}\n\nfunction MOPOP_SetupHookwall(W, H, tileModel, tileSize, hGoName, hGo) {\n    for (var h = 0; h < H; h++) {\n        for (var w = 0; w < W; w++) {\n            //myconsolelog(\"MOPOP_InitEnv [\" + w + \",\" + h + \"] hookswalls tile[\" + i + \"] => current \" + w + \", \" + h);\n            var go = MAIN.VZ.AssetBundleHolder.InstantiateGameObject(MAIN.location.envassetbundle, tileModel);\n            if (go != null) {\n                //myconsolelog(\"MOPOP_InitEnv hookswals tile [\" + i + \"] => current \" + w + \", \" + h + \" => FOUND TILE\");\n                go.name = hGoName + \"_\" + w + \"_\" + h;\n                \n                //init info wu\n                var wuInfoName = \"WU_\" + go.name; \n                var wuInfo = RT.Unity.CreateWU(wuInfoName, \"0\", false, 250, 200);\n                RT.Unity.SetParent(wuInfo, go);\n                RT.Unity.SetLocalPose(wuInfo,\n                    [0.0, 0.0, 0.1], // T //z was 0.055\n                    [0, 1, 0, 0], // R\n                    [0.0005, 0.0005, 0.0001] // S was null\n                );\n\n\n\n                //HW_rockwall_6_1\n                //HW_rockwall_7_2\n                //[HW_rockwall_0_0][HW_rockwall_1_0][HW_rockwall_2_0]\n                //[HW_rockwall_0_1][HW_rockwall_1_1][HW_rockwall_2_1]\n                //[HW_rockwall_0_2][HW_rockwall_1_2][HW_rockwall_2_2]\n\n                MOPOP.hookwall[hGoName].hooks[go.name] = {\n                    \"isOccupied\": false,\n                    \"occupante\": null,\n                    \"x\": w,\n                    \"y\": h,\n                    \"wuinfo\": wuInfoName\n                };\n                myconsolelog(\"MOPOP_SetupHookwall [\" + w + \",\" + h + \"] XXX => \" + JSON.stringify(MOPOP.hookwall));\n\n                go.transform.parent = hGo.transform;\n                go.transform.localPosition = new MAIN.UE.Vector3(tileSize * w, tileSize * h, 0);\n\n                myconsolelog(\"MOPOP_SetupHookwall [\" + w + \",\" + h + \"] 1\");\n\n                //myconsolelog(\"MOPOP_InitEnv [\" + w + \",\" + h + \"] setting up trigger  hookswals[\" + i + \"] ...\");\n                //PrepareInteractionGo(GameObject go, JSCallback enterCB, JSCallback exitCB, string data)\n                var centerGo = MAIN.UE.GameObject.Find(go.name + \"/Hook\");\n                if (centerGo != null) {\n\n                    centerGo.transform.localScale =\n                        new MAIN.UE.Vector3(\n                            centerGo.transform.localScale.x * 5,\n                            centerGo.transform.localScale.y * 5,\n                            centerGo.transform.localScale.z * 10\n                        );\n                        \n                    myconsolelog(\"MOPOP_SetupHookwall [\" + w + \",\" + h + \"] 2\");\n\n                    //added that to fix starting color\n                    var r = centerGo.GetComponent(MAIN.UE.Renderer);\n                    if (r != null) {\n                        //r.material.color = MAIN.UE.Color.green;\n                        r.material.color = new MAIN.UE.Color(0.4, 0.4, 0.4, 0.5);\n                    }\n                    \n                    myconsolelog(\"MOPOP_SetupHookwall [\" + w + \",\" + h + \"] 3\");\n\n                    var triggerData = {\n                        \"hookWall\": hGoName,\n                        \"tileGoName\": go.name,\n                        \"hookGoName\": centerGo.name\n                    };\n                    \n                    myconsolelog(\"MOPOP_SetupHookwall [\" + w + \",\" + h + \"] 4\");\n                    \n                    MAIN.RR.Runtime.PrepareInteractionGo(\n                        centerGo,\n                        MOPOP_HookWallHookEntry,\n                        MOPOP_HookWallHookExit,\n                        JSON.stringify(triggerData)\n                    );\n                    \n                    myconsolelog(\"MOPOP_SetupHookwall [\" + w + \",\" + h + \"] 5\");\n                } else {\n                    myconsolelog(\"MOPOP_SetupHookwall [\" + w + \",\" + h + \"] center GO was NULL\");\n                }\n\n                var tileGo = MAIN.UE.GameObject.Find(go.name + \"/Tile\");\n                if (tileGo != null) {\n                    RT.Unity.DestroyGO(tileGo);\n                }\n            } else {\n                console.log(\"MOPOP_SetupHookwall hook model NOT FOUND!\");\n            }\n        }\n    }\n    console.log(\"MOPOP_SetupHookwall MOPOP.hookwall[\" + hGoName + \"] => \" + JSON.stringify(MOPOP.hookwall[hGoName]));\n}\n\nfunction myconsolelog(msg) {\n    //console.log(\"MOPOP => \" + msg);\n}\n\nvar mopop = MAIN.location.data.mopop;\nif (mopop.hasOwnProperty(\"hookwalls\")) {\n    var N = mopop.hookwalls.length;\n    myconsolelog(\"MOPOP_InitEnv #hookswals => \" + N);\n    for (var i = 0; i < N; i++) {\n\n        //this is a hook wall\n        var hw = mopop.hookwalls[i];\n        var hName = hw.name;\n        var hDisplayName = hw.displayname;\n        var tileModel = hw.tilemodel;\n        var tileSize = hw.tilesize;\n        var W = hw.width;\n        var H = hw.height;\n        var wallWidth = tileSize * W;\n        var wallHeight = tileSize * H;\n\n        var hTrans = null;\n        if (hw.hasOwnProperty(\"transform\")) {\n            hTrans = hw.transform;\n        }\n\n        var hTimeline = null;\n        if (hw.hasOwnProperty(\"timeline\")) {\n            //\"start\": 1990,\n            //\"end\": 2020,\n            //\"tick\": 1\n            hTimeline = hw.timeline;\n        }\n\n        myconsolelog(\"MOPOP_InitEnv hookswals[\" + i + \"] => \" + hName + \", \" + tileModel + \", \" + W + \", \" + H + \", \" + tileSize);\n\n        var hGoName = \"HW_\" + hName;\n        var hGo = null;\n        hGo = MAIN.UE.GameObject.Find(hGoName);\n        if (hGo != null) {\n            RT.Unity.DestroyGO(hGo);\n        }\n\n        hGo = new MAIN.UE.GameObject();\n        myconsolelog(\"MOPOP_InitEnv 1\");\n\n        if (hGo != null) {\n            hGo.name = hGoName;\n\n            if (MAIN.worldgo != null) {\n                RT.Unity.SetParent(hGo, MAIN.worldgo);\n            }\n\n            MAIN.RR.Runtime.ToggleObjManipulation(hGo.name);\n            MAIN.RR.Runtime.ToggleBounds(hGo.name);\n\n            myconsolelog(\"MOPOP_InitEnv 2\");\n\n            hGo.transform.localPosition = new MAIN.UE.Vector3(0, 0, i * 0.1);\n\n            myconsolelog(\"MOPOP_InitEnv 3\");\n\n            MOPOP.hookwall[hGoName] = {};\n            MOPOP.hookwall[hGoName].name = hGoName;\n            MOPOP.hookwall[hGoName].hooks = {};\n            MOPOP.hookwall[hGoName].genre = hw.genre;\n            \n            if(hTimeline != null) {\n                MOPOP.hookwall[hGoName].start = hTimeline.start;\n                MOPOP.hookwall[hGoName].end = hTimeline.end;\n            }\n\n            MAIN_CreateLabel(hGoName + \"_title\", [-tileSize * 0.5, wallHeight - tileSize * 0.5, 0], [0, 1, 0, 0],\n                [0.001, 0.001, 0.001], hGo, hDisplayName);\n\n            myconsolelog(\"MOPOP_InitEnv 4 setting up time line\");\n            //Creates a Timeline from cube as a set of children\n            MOPOP_SetupTimeline(hTimeline, hGo, tileSize, W, H, wallWidth, hw.reversed);\n\n            //creates and sets up the year-distribution chart per wall\n            //MOPOP_SetupYearHist(hName, hGo, wallWidth, wallHeight, hw.reversed);\n\n            //create a wall with its tiles and interactions callbacks\n            MOPOP.hookwall[hGoName].reversed = hw.reversed;\n            MOPOP.hookwall[hGoName].w = W;\n            MOPOP.hookwall[hGoName].h = H;\n            \n            myconsolelog(\"MOPOP_InitEnv 5 setting up hookwall\");\n            MOPOP_SetupHookwall(W, H, tileModel, tileSize, hGoName, hGo);\n\n            if (hTrans != null) {\n                RT.Unity.SetLocalPose(hGo, hTrans.position, hTrans.rotation, hTrans.scale);\n            }\n        }\n        myconsolelog(\"MOPOP_InitEnv NEXT WALL ...\");\n    }\n}\nreturn msg;","outputs":3,"noerr":0,"initialize":"","finalize":"","x":660,"y":520,"wires":[["302caf12.0371d"],["44ca191d.ac1908"],["9299635b.1b58d"]]},{"id":"a4db9195.8121c","type":"function","z":"923bd7d5.f34fa8","name":"init mopop variables and functions","func":"flow.set(\"imgtracking_started\", false);\n\nvar devicetype = RT.Help.GetDeviceType();\nflow.set(\"devicetype\", devicetype);\nconsole.log(\"devicetype => \" + devicetype);\n\nvar MOPOP = {};\nMOPOP.picked = null;\nMOPOP.hookwall = {};\nMOPOP.temptable = {};\nMOPOP.artefacts = {};\nMOPOP.scorechart = null;\nMOPOP.infochart = null;\nMOPOP.topics = {\n    \"wallscore\": \"MOPOP/wallscore\",\n    \"wallyearhist\": \"MOPOP/wallyearhist\",\n    \"infocompare\": \"MOPOP/infocompare\"\n}\nMOPOP.yearcharts = {};\nMOPOP.startyear = 0;\nMOPOP.endyear = 0;\n\nMOPOP.user = \"NOTSET\";\n\nMOPOP.info = {};\nMOPOP.infopicks = [];\n\nfunction MOPOP_GetYearFromString(mFullDateStr) {\n    const fullDate = new Date(mFullDateStr);\n    var year = fullDate.getFullYear();\n    return year;\n}\n\nfunction MOPOP_DownloadArtefact(mCoverId) {\n    myconsolelog(\"MOPOP_DownloadArtefact looking for => \" + mCoverId);\n    var url = MAIN.WEBAPI.apiBase + \"/mopop/song?coverid=\" + mCoverId;\n    var headers = [\"content-type\", \"application/x-www-form-urlencoded\"];\n    var data = \"\";\n\n    RT.Web.SendWebReq(\"GET\", url, headers, data,\n        function (mError, mData) {\n            myconsolelog(\"MOPOP_DownloadArtefact mData => \" + mData);\n            if (mError == false) {\n                var sData = JSON.parse(mData);\n                if (sData.length > 0) {\n                    var d = sData[0];\n                    myconsolelog(\"MOPOP_DownloadArtefact => \" + d.coverid);\n                    MOPOP.artefacts[d.coverid] = d;\n                }\n            }\n        });\n}\n\nfunction MOPOP_dist(a,b) {\n    return Math.sqrt(\n            (a[0] - b[0]) * (a[0] - b[0]) +\n            (a[1] - b[1]) * (a[1] - b[1]) +\n            (a[2] - b[2]) * (a[2] - b[2])\n        );\n}\n\nfunction MOPOP_ToggleWallManipulation() {\n    var mopop = MAIN.location.data.mopop;\n    if (mopop.hasOwnProperty(\"hookwalls\")) {\n        var N = mopop.hookwalls.length;\n        myconsolelog(\"MOPOP_InitEnv #hookswals => \" + N);\n        for (var i = 0; i < N; i++) {\n            var hw = mopop.hookwalls[i];\n            var hGoName = \"HW_\" + hw.name;\n            MAIN.RR.Runtime.ToggleObjManipulation(hGoName);\n            MAIN.RR.Runtime.ToggleBounds(hGoName);\n        }\n    }\n}\n\nfunction MOPOP_SaveEnv() {\n    var mopop = MAIN.location.data.mopop;\n    var isDirty = false;\n\n    //collect update hookwall transforms\n    if (mopop.hasOwnProperty(\"hookwalls\")) {\n        var N = mopop.hookwalls.length;\n        myconsolelog(\"MOPOP_SaveEnv #hookswals => \" + N);\n        for (var i = 0; i < N; i++) {\n            var hw = mopop.hookwalls[i];\n            var hGoName = \"HW_\" + hw.name;\n            var go = MAIN.UE.GameObject.Find(hGoName);\n            if (go != null) {\n                myconsolelog(\"MOPOP_SaveEnv reading => \" + hGoName);\n                var T = [go.transform.localPosition.x, go.transform.localPosition.y, go.transform.localPosition.z];\n                var R = [go.transform.localRotation.x, go.transform.localRotation.y, go.transform.localRotation.z, go.transform.localRotation.w];\n                var S = [go.transform.localScale.x, go.transform.localScale.y, go.transform.localScale.z];\n\n                MAIN.location.data.mopop.hookwalls[i].transform = {\n                    \"position\": T,\n                    \"rotation\": R,\n                    \"scale\": S\n                };\n                isDirty = true;\n            }\n        }\n    }\n    \n    //update chart pos\n    if(true) {\n        //scorechart\n        var scoreChartGoName = flow.get(\"scoreChartGoName\");\n        if(scoreChartGoName != null && scoreChartGoName != 'undefined'){\n            var scoreChartGo = MAIN.UE.GameObject.Find(scoreChartGoName)\n            if(scoreChartGo != null) {\n                var scT = scoreChartGo.transform.position;\n                var scR = scoreChartGo.transform.rotation;\n                var scS = scoreChartGo.transform.localScale;\n                MAIN.location.data.mopop.scoreChartPos = {\n                    \"T\": {\"x\":scT.x, \"y\":scT.y, \"z\":scT.z},\n                    \"R\": {\"x\":scR.x, \"y\":scR.y, \"z\":scR.z, \"w\":scR.w},\n                    \"S\": {\"x\":scS.x, \"y\":scS.y, \"z\":scS.z}\n                }\n                isDirty = true;\n            }\n        }\n        \n        var rockChartGoName = flow.get(\"rockChartGoName\");\n        if(rockChartGoName != null && rockChartGoName != 'undefined'){\n            var rockChartGo = MAIN.UE.GameObject.Find(rockChartGoName)\n            if(rockChartGo != null) {\n                var rcT = rockChartGo.transform.position;\n                var rcR = rockChartGo.transform.rotation;\n                var rcS = rockChartGo.transform.localScale;\n                MAIN.location.data.mopop.rockChartPos = {\n                    \"T\": {\"x\":rcT.x, \"y\":rcT.y, \"z\":rcT.z},\n                    \"R\": {\"x\":rcR.x, \"y\":rcR.y, \"z\":rcR.z, \"w\":rcR.w},\n                    \"S\": {\"x\":rcS.x, \"y\":rcS.y, \"z\":rcS.z}\n                }\n                isDirty = true;\n            }\n        }\n        \n        var popChartGoName = flow.get(\"popChartGoName\");\n        if(popChartGoName != null && popChartGoName != 'undefined'){\n            var popChartGo = MAIN.UE.GameObject.Find(popChartGoName)\n            if(popChartGo != null) {\n                var pcT = popChartGo.transform.position;\n                var pcR = popChartGo.transform.rotation;\n                var pcS = popChartGo.transform.localScale;\n                MAIN.location.data.mopop.popChartPos = {\n                    \"T\": {\"x\":pcT.x, \"y\":pcT.y, \"z\":pcT.z},\n                    \"R\": {\"x\":pcR.x, \"y\":pcR.y, \"z\":pcR.z, \"w\":pcR.w},\n                    \"S\": {\"x\":pcS.x, \"y\":pcS.y, \"z\":pcS.z}\n                }\n                isDirty = true;\n            }\n        }\n    }\n    \n\n    //collect update temptables transforms\n    /*\n    if (mopop.hasOwnProperty(\"temptables\")) {\n        var N = mopop.temptables.length;\n        for (var i = 0; i < N; i++) {\n            var hw = mopop.temptables[i];\n            var tGoName = \"TT_\" + hw.name;\n            var go = MAIN.UE.GameObject.Find(tGoName);\n            if (go != null) {\n                var T = [go.transform.localPosition.x, go.transform.localPosition.y, go.transform.localPosition.z];\n                var R = [go.transform.localRotation.x, go.transform.localRotation.y, go.transform.localRotation.z, go.transform.localRotation.w];\n                var S = [go.transform.localScale.x, go.transform.localScale.y, go.transform.localScale.z];\n                MAIN.location.data.mopop.temptables[i].transform = {\n                    \"position\": T,\n                    \"rotation\": R,\n                    \"scale\": S\n                };\n                isDirty = true;\n            }\n        }\n    }\n    */\n\n    if (isDirty) {\n        var id = MAIN.location.data._id;\n        var uUrl = MAIN.WEBAPI.apiBase + \"/data?name=\" + id;\n        var uHeaders = [\"content-type\", \"application/json\"];\n        var uData = JSON.stringify(MAIN.location.data);\n        RT.Web.SendWebReq(\"POST\", uUrl, uHeaders, uData,\n            function (mError2, mData2) {\n                if (!mError2) {\n                    var retObj = JSON.parse(mData2);\n                    MAIN.location.data._rev = retObj.rev;\n                }\n            });\n    }\n    return;\n}\n\n//pre download artefact data\nMOPOP_DownloadArtefact(\"16293957103\");\n\nwindow.MOPOP_DownloadArtefact = MOPOP_DownloadArtefact;\nwindow.MOPOP_GetYearFromString = MOPOP_GetYearFromString;\nwindow.MOPOP_dist = MOPOP_dist;\nwindow.MOPOP_ToggleWallManipulation = MOPOP_ToggleWallManipulation;\nwindow.MOPOP_SaveEnv = MOPOP_SaveEnv;\nwindow.MOPOP = MOPOP;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":580,"y":260,"wires":[["2ac54556.5cc4da"]]},{"id":"c5a77e11.046b4","type":"function","z":"923bd7d5.f34fa8","name":"delay test","func":"RT.Web.SetTiimeout(15000, function () {\n  var m = msg;\n  node.send([m]);  \n});\n//return msg;\nreturn null;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":240,"y":520,"wires":[["f8ef30d1.04333","431935a8.f6411c"]]},{"id":"431935a8.f6411c","type":"debug","z":"923bd7d5.f34fa8","name":"D","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":430,"y":480,"wires":[]},{"id":"dd5826f6.914388","type":"comment","z":"923bd7d5.f34fa8","name":"Setup world geometry","info":"","x":180,"y":460,"wires":[]},{"id":"5da1ead0.c52264","type":"comment","z":"923bd7d5.f34fa8","name":"Init score vis","info":"","x":130,"y":1640,"wires":[]},{"id":"44ca191d.ac1908","type":"mqtt out","z":"923bd7d5.f34fa8","name":"","topic":"MOPOP/hookentry","qos":"0","retain":"false","broker":"73e9a24f.21590c","x":970,"y":580,"wires":[]},{"id":"9299635b.1b58d","type":"mqtt out","z":"923bd7d5.f34fa8","name":"","topic":"MOPOP/hookexit","qos":"0","retain":"false","broker":"73e9a24f.21590c","x":970,"y":640,"wires":[]},{"id":"ef6f5a38.069b18","type":"mqtt in","z":"923bd7d5.f34fa8","name":"","topic":"MOPOP/hookexit","qos":"0","datatype":"auto","broker":"73e9a24f.21590c","x":120,"y":1300,"wires":[["21740f58.8f727"]]},{"id":"9b923395.43a25","type":"mqtt in","z":"923bd7d5.f34fa8","name":"","topic":"MOPOP/hookentry","qos":"0","datatype":"auto","broker":"73e9a24f.21590c","x":130,"y":1160,"wires":[["91d12c8b.d473e"]]},{"id":"d369cfb1.82dd5","type":"debug","z":"923bd7d5.f34fa8","name":"HookEntry","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":390,"y":1080,"wires":[]},{"id":"cf3cc690.6e9e28","type":"debug","z":"923bd7d5.f34fa8","name":"HookExit","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":380,"y":1220,"wires":[]},{"id":"302caf12.0371d","type":"function","z":"923bd7d5.f34fa8","name":"start tracking","func":"var vs = flow.get(\"imgtracking_started\");\nif(!vs) {\n    flow.set(\"imgtracking_started\", true);\n    node.send([{\"payload\":\"tracking starting ...\" + MAIN.location.envtargets.xml}, null, null]);\n    importNamespace(\"RR\").Runtime.StartImgTracking(\n        function (mTrackableName, mTrackedGoName) \n        {\n            node.send([null, { \"payload\":{ \"trackableName\" : mTrackableName, \"trackedGoName\": mTrackedGoName}}, null]);\n        },\n        function (mTrackableName, mTrackedGoName) {\n            node.send([null, null, { \"payload\":{ \"trackableName\" : mTrackableName, \"trackedGoName\": mTrackedGoName}}]);\n        },\n        MAIN.location.envtargets.xml\n    );\nnode.send([{\"payload\":\"tracking started\"}, null, null]);\n}\nreturn null;","outputs":3,"noerr":0,"initialize":"","finalize":"","x":950,"y":520,"wires":[[],["758cdd4a.9e9f34"],["4d9f1bb6.3acf44"]]},{"id":"758cdd4a.9e9f34","type":"mqtt out","z":"923bd7d5.f34fa8","name":"","topic":"MOPOP/tracked","qos":"0","retain":"false","broker":"73e9a24f.21590c","x":1200,"y":480,"wires":[]},{"id":"4d9f1bb6.3acf44","type":"mqtt out","z":"923bd7d5.f34fa8","name":"","topic":"MOPOP/trackinglost","qos":"0","retain":"false","broker":"73e9a24f.21590c","x":1220,"y":540,"wires":[]},{"id":"8e57213f.35c85","type":"mqtt in","z":"923bd7d5.f34fa8","name":"","topic":"MOPOP/trackinglost","qos":"0","datatype":"auto","broker":"73e9a24f.21590c","x":150,"y":980,"wires":[["27ddf7b9.f43138","70a5a8ef.94da08"]]},{"id":"53bc21a5.68e03","type":"mqtt in","z":"923bd7d5.f34fa8","name":"","topic":"MOPOP/tracked","qos":"0","datatype":"auto","broker":"73e9a24f.21590c","x":140,"y":880,"wires":[["3f277710.c50218","52734d21.16a674","631e1bf4.91d1c4"]]},{"id":"549b3513.8c1b9c","type":"debug","z":"923bd7d5.f34fa8","name":"tracked2","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":540,"y":840,"wires":[]},{"id":"70a5a8ef.94da08","type":"debug","z":"923bd7d5.f34fa8","name":"tracking lost","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":370,"y":940,"wires":[]},{"id":"dadefbc8.17dac8","type":"function","z":"923bd7d5.f34fa8","name":"load or activate cover","func":"function myconsolelog(msg) {\n    //console.log(\"MOPOP CVR => \" + msg);\n}\n\nvar data = JSON.parse(msg.payload);\nvar mTrackableName = data.trackableName;\nvar mTrackedGoName = data.trackedGoName;\n\nnode.warn(\"MOPOP CVR msg.payload => \" + msg.payload);\nnode.warn(\"MOPOP CVR mTrackableName => \" + mTrackableName);\nnode.warn(\"MOPOP CVR mTrackedGoName => \" + mTrackedGoName);\n\nif (mTrackableName == \"18746832409\") {\n    return;\n}\n\nmyconsolelog(\"MOPOP_TestDB Target Found => \" + mTrackableName + \", \" + mTrackedGoName);\n\nvar goName = \"Test\" + mTrackableName;\nvar wuName = \"UI\" + mTrackableName;\n\nvar artefactData = {\n    \"TrackableName\": mTrackableName,\n    \"TrackedGoName\": mTrackedGoName,\n    \"goName\": goName,\n    \"wuName\": wuName\n};\n\n\n\n\nif (MOPOP.artefacts.hasOwnProperty(mTrackableName) == false) {\n    myconsolelog(\"MOPOP CVR Downloading artefact => \" + mTrackableName);\n    MOPOP_DownloadArtefact(mTrackableName);\n}\n\nmyconsolelog(\"MOPOP CVR Target found looking for data => \" + mTrackableName);\nmyconsolelog(\"MOPOP CVR artefacts => \" + MAIN.location.data.mopop.artefacts)\n\n\n\n//TODO check if its on a hook\n// if it is on a hook, check if it is further away eg 5ck\n// if so pick it up\n\n\n\n//igonre that with registered artefacts\nif (true || MAIN.location.data.mopop.artefacts) {\n    var entry = MAIN.location.data.mopop.artefacts[mTrackableName];\n    myconsolelog(\"MOPOP CVR Target found data => \" + mTrackableName + \" => \" + entry);\n\n    // picked up flag\n    MOPOP.picked = artefactData;\n    //RT.Unity.SpawnNotification(5, \"Picked Up \" + mTrackableName);\n    PlayNotification();\n    $(\"#rr_mopop_bottom_picked\").html(mTrackableName);\n\n    try {\n        var tw1 = MAIN.PUI.WorldUI.Find(wuName);\n        var parent = MAIN.UE.GameObject.Find(mTrackedGoName);\n        RT.Unity.SetParent(tw1, parent);\n        \n        if (tw1 != null) {\n            tw1.document.Run(\"Artefact_MakeMePicked\", [\"\"]);\n        }\n    } catch (setPickedErr) {\n        myconsolelog(\"MOPOP CVR Artefact_MakeMePicked ERROR => \" + setPickedErr);\n    }\n\n    //MOPOP_ReportUserEvent(MOPOP.userevents.picked, MOPOP.picked, Date.now(), MOPOP.user);\n\n    try {\n        if (MOPOP.artefacts[mTrackableName].hasOwnProperty(\"bezGo\")) {\n            var bezGo = MOPOP.artefacts[mTrackableName].bezGo;\n            MOPOP.artefacts[mTrackableName].bezGo = null;\n            RT.Unity.DestroyGO(bezGo);\n        }\n    } catch (bezCheckErr) {\n        myconsolelog(\"MOPOP CVR Target ERROR bezCheckErr => \" + bezCheckErr);\n    }\n\n    try {\n        //this was on\n        //MOPOP_UpdateHookOccupation();\n    } catch (MP_UHO_err) {\n        myconsolelog(\"MOPOP CVR Target occupation ERROR => \" + MP_UHO_err);\n    }\n} else {\n    $(\"#rr_mopop_bottom_info\").html(mTrackableName + \"NOT in artefacts\");\n}\n\n\nmyconsolelog(\"MOPOP CVR INITCOVER goName => \" + goName);\n\nvar go = MAIN.UE.GameObject.Find(goName);\nif (go == null) {\n\n    go = new MAIN.UE.GameObject(goName);\n    var url = MAIN.WEBAPI.uiurl + \"/artefact.html\";\n\n    //go = MAIN.UE.GameObject.CreatePrimitive(3);\n    //go.name = goName;\n\n    var np = MAIN.UE.GameObject.Find(mTrackedGoName);\n    RT.Unity.SetParent(go, np);\n\n    RT.Unity.SetLocalPose(go, [0, 0, 0], [0, 0, 0, 1], [0.05, 0.05, 0.05]);\n\n\n    var wu = RT.Unity.CreateWU(wuName, url, true, 1080, 1080);\n    RT.Unity.SetParent(wu, go);\n    RT.Unity.SetLocalPose(wu,\n        [0, 0, 0],\n        [1, 0, 0, 1],\n        [0.003, 0.003, 0.001] //was null\n    );\n\n\n    var jsonStr = JSON.stringify(artefactData);\n\n    //test external init\n    myconsolelog(\"MOPOP CVR before AttrComb_ExternalInitMe data2share => \" + jsonStr);\n\n    RT.Web.SetTiimeout(500, function () {\n        var tw = MAIN.PUI.WorldUI.Find(wuName);\n        if (tw != null) {\n            tw.document.Run(\"Artefact_ExternalInitMe\", [jsonStr]);\n            tw.document.Run(\"Artefact_MakeMePicked\", [\"\"]);\n        } else {\n            myconsolelog(\"MOPOP CVR before TM tw NOT found for AttrComb_ExternalInitMe\");\n        }\n    });\n\n    RT.Web.SetTiimeout(600, function () {\n        var PUI = importNamespace(\"PowerUI\");\n        var tw = PUI.WorldUI.Find(wuName);\n        if (tw != null) {\n            tw.document.Run(\"Artefact_ExternalTrackingOn\", [\"some data\"]);\n        } else {\n            myconsolelog(\"MOPOP CVR before TM tw NOT found for AttrComb_ExternalInitMe\");\n        }\n    });\n} else {\n    RT.Web.SetTiimeout(5, function () {\n        var PUI = importNamespace(\"PowerUI\");\n        var tw = PUI.WorldUI.Find(wuName);\n        \n        var op = MAIN.UE.GameObject.Find(/*mTrackedGoName*/goName); //try to rehook\n        RT.Unity.SetParent(tw, op);\n        RT.Unity.SetLocalPose(tw,\n            [0, 0, 0],\n            [1, 0, 0, 1],\n            [0.003, 0.003, 0.001] //was null\n        );\n        \n        if (tw != null) {\n            tw.document.Run(\"Artefact_ExternalTrackingOn\", [\"some data\"]);\n        } else {\n            myconsolelog(\"MOPOP CVR before TM tw NOT found for AttrComb_ExternalInitMe\");\n        }\n    });\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":860,"y":880,"wires":[[]]},{"id":"a8ad92dd.f396e","type":"function","z":"923bd7d5.f34fa8","name":"check if world reference","func":"var data = JSON.parse(msg.payload);\nvar mTrackableName = data.trackableName;\nvar mTrackedGoName = data.trackedGoName;\n\nif (mTrackableName == \"18746832409\" || mTrackableName == \"16075378946\") {\n    console.log(\"XXXX => found \" + mTrackableName);\n    if (MAIN.worldgo != null) {\n        console.log(\"XXXX => found MAIN.worldgo\");\n        var go = MAIN.UE.GameObject.Find(mTrackedGoName);\n        if (go != null) {\n            console.log(\"XXXX => found mTrackedGoName => \" + mTrackedGoName);\n            //RT.Unity.SetParent(MAIN.worldgo, go);\n            RT.Unity.SetLocalPose(MAIN.worldgo, [0, 0, 0], [0, 0, 0, 0], [1, 1, 1]);\n            MAIN.worldgo.transform.rotation = go.transform.rotation;\n            MAIN.worldgo.transform.position = go.transform.position;\n\n            //adding temp world anchors\n            RT.WA.AddToGO(MAIN.worldgo.name);\n            //RT.WA.AddToGO(\"HW_popwall\");\n            //RT.WA.AddToGO(\"HW_rockwall\");\n        }\n    }\n    return;\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":850,"y":920,"wires":[[]]},{"id":"3f277710.c50218","type":"function","z":"923bd7d5.f34fa8","name":"client filter","func":"try {\n    var n = MAIN.usercanvas;\n    return msg;\n} catch(err) {\n    return null;\n}\nreturn null;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":380,"y":880,"wires":[["94dda791.66c4c8"]]},{"id":"5553e21b.38526c","type":"comment","z":"923bd7d5.f34fa8","name":"Tracking interactions","info":"","x":150,"y":820,"wires":[]},{"id":"d7558f7.8f1947","type":"function","z":"923bd7d5.f34fa8","name":"cleanup after tracking lost","func":"function myconsolelog(msg) {\n    console.log(\"MOPOP => \" + msg);\n}\n\nvar data = JSON.parse(msg.payload);\nvar mTrackableName = data.trackableName;\nvar mTrackedGoName = data.trackedGoName;\n\nvar wuName = \"UI\" + mTrackableName;\nmyconsolelog(\"MOPOP_TestDB Target Lost => \" + mTrackableName + \", \" + mTrackedGoName);\n\n\nRT.Web.SetTiimeout(5, function () {\n    var PUI = importNamespace(\"PowerUI\");\n    var tw = PUI.WorldUI.Find(wuName);\n    if (tw != null) {\n        tw.document.Run(\"Artefact_ExternalTrackingOff\", [\"some data\"]);\n    } else {\n        myconsolelog(\"before TM tw NOT found for AttrComb_ExternalInitMe\");\n    }\n});\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":590,"y":980,"wires":[[]]},{"id":"27ddf7b9.f43138","type":"function","z":"923bd7d5.f34fa8","name":"client filter","func":"try {\n    var n = MAIN.usercanvas;\n    return msg;\n} catch(err) {\n    return null;\n}\nreturn null;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":360,"y":980,"wires":[["d7558f7.8f1947"]]},{"id":"52734d21.16a674","type":"function","z":"923bd7d5.f34fa8","name":"","func":"return {\"payload\" : JSON.parse(msg.payload)};","outputs":1,"noerr":0,"initialize":"","finalize":"","x":380,"y":840,"wires":[["549b3513.8c1b9c"]]},{"id":"631e1bf4.91d1c4","type":"debug","z":"923bd7d5.f34fa8","name":"tracked","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":380,"y":800,"wires":[]},{"id":"b8bb7d29.21f5f","type":"function","z":"923bd7d5.f34fa8","name":"","func":"msg = {};\nmsg.payload = {\n    \"trackableName\": 16075378946,\n    \"trackedGoName\": \"VIT-87-16075378946\"\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":960,"y":460,"wires":[["758cdd4a.9e9f34"]]},{"id":"a84962d1.6bbdf","type":"inject","z":"923bd7d5.f34fa8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":800,"y":460,"wires":[["b8bb7d29.21f5f"]]},{"id":"91d12c8b.d473e","type":"function","z":"923bd7d5.f34fa8","name":"client filter","func":"try {\n    var n = MAIN.usercanvas;\n    return msg;\n} catch(err) {\n    return null;\n}\nreturn null;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":380,"y":1160,"wires":[["44b2d1d.975843"]]},{"id":"44b2d1d.975843","type":"function","z":"923bd7d5.f34fa8","name":"perform hook entry interaction","func":"function myconsolelog(msg) {\n    //console.log(\"MOPOP => \" + msg);\n}\n\nvar data = JSON.parse(msg.payload);\nvar mThis = data.this;\nvar mOther = data.other;\nvar mData = data.data;\n\n//var dObj = JSON.parse(mData);\nvar dObj = mData;\n\n//only process tracked label hits\nif (mOther.indexOf(\"UI\") < 0) {\n    return;\n}\n\n//hook access for testing\nvar hookOcc = MOPOP.hookwall[dObj.hookWall].hooks[dObj.tileGoName];\nvar wallGenre = MOPOP.hookwall[dObj.hookWall].genre;\n\nvar yearStart = MOPOP.hookwall[dObj.hookWall].start;\nvar yearEnd = MOPOP.hookwall[dObj.hookWall].end;\nmyconsolelog(\"VZTrigger Occ years => \" + yearStart + \" - \" + yearEnd);\n\nmyconsolelog(\"VZTrigger Occ [\" + dObj.hookWall + \", \" + dObj.tileGoName + \"] => \" +\n    hookOcc.isOccupied + \" / \" + hookOcc.occupante);\n// MOPOP => VZTrigger Occ [HW_popwall, HW_popwall_6_4] => false / null\n\n//myconsolelog(\"VZTrigger hookwall=> \" + JSON.stringify(MOPOP.hookwall[dObj.hookWall]));\n//myconsolelog(\"VZTrigger hookOcc=> \" + JSON.stringify(hookOcc));\n//MOPOP => VZTrigger hookOcc=> {\"isOccupied\":false,\"occupante\":null,\"x\":8,\"y\":1}\n\nmyconsolelog(\"VZTrigger genre => \" + wallGenre);\n\nif (MOPOP.picked != null) {\n    /*MOPOP_ReportUserEvent(MOPOP.userevents.placed,\n        {\n            \"artefact\": MOPOP.picked,\n            \"wall\": dObj.hookWall,\n            \"hook\": dObj.tileGoName\n        }, Date.now(), MOPOP.user);*/\n\n    try {\n        myconsolelog(\"MOPOP Artefact_MakeMePlaced => \" + MOPOP.picked.wuName);\n        var wuName1 = MOPOP.picked.wuName;\n        var tw1 = MAIN.PUI.WorldUI.Find(wuName1);\n        \n        // added this: put on hook -> move to world space\n        RT.Unity.SetParent(tw1, MAIN.worldgo);\n        \n        \n        if (tw1 != null) {\n            tw1.document.Run(\"Artefact_MakeMePlaced\", [\"\"]);\n        }\n    } catch (setPlacedErr) {\n        myconsolelog(\"MOPOP Artefact_MakeMePlaced ERROR => \" + setPlacedErr);\n    }\n\n    var pickedName = MOPOP.picked.TrackableName;\n    var pickedGoName = MOPOP.picked.TrackedGoName;\n    var pickedWu = MOPOP.picked.wuName;\n    myconsolelog(\"VZTrigger Enter smth picked? => \" + JSON.stringify(MOPOP.picked));\n\n    MOPOP.hookwall[dObj.hookWall].hooks[dObj.tileGoName].isOccupied = true;\n    MOPOP.hookwall[dObj.hookWall].hooks[dObj.tileGoName].occupante = MOPOP.picked;\n    MOPOP.picked = null;\n\n\n\n    $(\"#rr_mopop_bottom_picked\").html(\"\");\n    $(\"#rr_mopop_bottom_info\").html(dObj.tileGoName + \"=>\" + pickedName);\n\n    //set is now placed on wall\n\n    //find hook and change color\n    var goHookParent = dObj.hookWall + \"/\" + dObj.tileGoName;\n    var goHookName = dObj.hookWall + \"/\" + dObj.tileGoName + \"/\" + dObj.hookGoName;\n    myconsolelog(\"VZTrigger looking for => \" + goHookName);\n    var hookGo = MAIN.UE.GameObject.Find(goHookName);\n    if (hookGo != null) {\n        var r = hookGo.GetComponent(MAIN.UE.Renderer);\n        if (r != null) {\n            //r.material.color = MAIN.UE.Color.red;\n            r.material.color = new MAIN.UE.Color(0, 1, 0, 0.8);\n            //RT.Unity.SpawnNotification(5, \"Occupied hook \" + dObj.tileGoName);\n            PlayNotification();\n            //MOPOP_CalcScore(); // was on\n        }\n    }\n\n    //set timeline bezier\n    var fullDateStr = MOPOP.artefacts[pickedName].publishdate;\n    myconsolelog(\"VZTrigger TL MOPOP.artefacts = > \" + JSON.stringify(MOPOP.artefacts));\n    myconsolelog(\"VZTrigger TL fullDateStr = > \" + fullDateStr);\n\n    //const fullDate = new Date(fullDateStr);\n    //var year = fullDate.getFullYear();\n    var year = MOPOP_GetYearFromString(fullDateStr);\n    myconsolelog(\"VZTrigger TL year = > \" + year);\n\n\n    //this works\n    var correctWall = true;\n    var recordGenre = MOPOP.artefacts[pickedName].genre;\n    if(recordGenre != wallGenre) {\n        correctWall = false;\n        myconsolelog(\"VZTrigger correctWall => \" + correctWall + \" (\" + recordGenre + \" vs. \" + wallGenre);\n        RT.Unity.SpawnAlert(15, \"ERROR!</br>Wrong Genre\");\n    }\n    \n    var yearInt = parseInt(year);\n    if(yearInt < yearStart || yearInt > yearEnd) {\n        RT.Unity.SpawnAlert(15, \"ERROR!</br>Wrong Year\");\n    } else {\n        var bezName = \"BZ\" + \"_\" + pickedName;\n        var yearTickGoName = dObj.hookWall + \"/\" + dObj.hookWall + \"_TL\" + \"/\" + dObj.hookWall + \"_TL_tick_\" + year;\n    \n        myconsolelog(\"VZTrigger TL bezName => \" + bezName);\n        myconsolelog(\"VZTrigger TL yearTickGoName => \" + yearTickGoName);\n    \n        var bezGo = RT.Unity.CreateBezier(bezName, /*pickedGoName*/pickedWu, yearTickGoName);\n        MOPOP.artefacts[pickedName].bezGo = bezGo;\n    }\n    \n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":630,"y":1160,"wires":[["a0719739.b86ec8","23bdae4d.aa40a2"]]},{"id":"a6ea1b5f.9a27f8","type":"function","z":"923bd7d5.f34fa8","name":"","func":"return {\"payload\" : JSON.parse(msg.payload)};","outputs":1,"noerr":0,"initialize":"","finalize":"","x":380,"y":1120,"wires":[["52a20f6e.f8bbf"]]},{"id":"52a20f6e.f8bbf","type":"debug","z":"923bd7d5.f34fa8","name":"HookEntry2","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":570,"y":1120,"wires":[]},{"id":"21740f58.8f727","type":"function","z":"923bd7d5.f34fa8","name":"client filter","func":"try {\n    var n = MAIN.usercanvas;\n    return msg;\n} catch(err) {\n    return null;\n}\nreturn null;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":380,"y":1300,"wires":[["3e2b5677.be57ca"]]},{"id":"ff13e768.c93128","type":"function","z":"923bd7d5.f34fa8","name":"","func":"return {\"payload\" : JSON.parse(msg.payload)};","outputs":1,"noerr":0,"initialize":"","finalize":"","x":380,"y":1260,"wires":[["985d8a15.cc2688"]]},{"id":"985d8a15.cc2688","type":"debug","z":"923bd7d5.f34fa8","name":"HookExit2","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":570,"y":1260,"wires":[]},{"id":"3e2b5677.be57ca","type":"function","z":"923bd7d5.f34fa8","name":"perform hook exit interaction","func":"function myconsolelog(msg) {\n    //console.log(\"MOPOP => \" + msg);\n}\n\nvar data = JSON.parse(msg.payload);\nvar mThis = data.this;\nvar mOther = data.other;\nvar mData = data.data;\n\nif (mOther.indexOf(\"UI\") < 0) {\n    return;\n}\n\n//var dObj = JSON.parse(mData);\nvar dObj = mData;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":620,"y":1300,"wires":[["2071e1af.8775de"]]},{"id":"5e9c0f60.c4042","type":"function","z":"923bd7d5.f34fa8","name":"Update Hook occupation","func":"function myconsolelog(msg) {\n    //console.log(\"MOPOP CNR (Update Hook occupation) => \" + msg);\n}\n\ntry {\n    if (true || MOPOP.picked != null) {\n        //myconsolelog(\"MOPOP_UpdateHookOccupation picked=> \" + JSON.stringify(MOPOP.picked));\n\n        //picked \n        // picked=> {\"TrackableName\":\"2805595956\",\"TrackedGoName\":\"VIT-13-2805595956\",\"goName\":\"Test2805595956\",\"wuName\":\"UI2805595956\"}\n\n        //hookwall\n        //{\"HW_A\":{\"name\":\"HW_A\",\"hooks\":{\"HW_A_0_0\":{\"isOccupied\":false,\"occupante\":null},\"HW_A_1_0\":{\"isOccupied\":false,\"occupante\":null},\"HW_A_2_0\":{\"isOccupied\":false,\"occupante\":null},\"HW_A_3_0\":{\"isOccupied\":false,\"occupante\":null},\"HW_A_4_0\":{\"isOccupied\":false,\"occupante\":null},\"HW_A_0_1\":{\"isOccupied\":false,\"occupante\":null},\"HW_A_1_1\":{\"isOccupied\":false,\"occupante\":null},\"HW_A_2_1\":{\"isOccupied\":false,\"occupante\":null},\"HW_A_3_1\":{\"isOccupied\":false,\"occupante\":null},\"HW_A_4_1\":{\"isOccupied\":false,\"occupante\":null},\"HW_A_0_2\":{\"isOccupied\":false,\"occupante\":null},\"HW_A_1_2\":{\"isOccupied\":false,\"occupante\":null},\"HW_A_2_2\":{\"isOccupied\":false,\"occupante\":null},\"HW_A_3_2\":{\"isOccupied\":false,\"occupante\":null},\"HW_A_4_2\":{\"isOccupied\":false,\"occupante\":null}}},\"HW_B\":{\"name\":\"HW_B\",\"hooks\":{\"HW_B_0_0\":{\"isOccupied\":false,\"occupante\":null},\"HW_B_1_0\":{\"isOccupied\":false,\"occupante\":null},\"HW_B_2_0\":{\"isOccupied\":false,\"occupante\":null},\"HW_B_3_0\":{\"isOccupied\":false,\"occupante\":null},\"HW_B_0_1\":{\"isOccupied\":false,\"occupante\":null},\"HW_B_1_1\":{\"isOccupied\":false,\"occupante\":null},\"HW_B_2_1\":{\"isOccupied\":false,\"occupante\":null},\"HW_B_3_1\":{\"isOccupied\":false,\"occupante\":null},\"HW_B_0_2\":{\"isOccupied\":false,\"occupante\":null},\"HW_B_1_2\":{\"isOccupied\":false,\"occupante\":null},\"HW_B_2_2\":{\"isOccupied\":false,\"occupante\":null},\"HW_B_3_2\":{\"isOccupied\":false,\"occupante\":null}}}}\n\n        //occupante\n        //aHook => {\"isOccupied\":true,\"occupante\":{\"TrackableName\":\"2805595956\",\"TrackedGoName\":\"VIT-13-2805595956\",\"goName\":\"Test2805595956\",\"wuName\":\"UI2805595956\"}}\n\n\n        var dirtyScore = false;\n        // update hookwalls here\n        var walls = MOPOP.hookwall;\n        for (var wKey in walls) {\n            if (walls.hasOwnProperty(wKey)) {\n                var aWall = walls[wKey];\n                var wName = aWall.name;\n                var wHooks = aWall.hooks;\n\n                //myconsolelog(\"MOPOP_UpdateHookOccupation ... walls[\" + wKey + \"].name=\" + wName);\n\n                //var occupantList = [];\n                for (var hKey in wHooks) {\n                    //myconsolelog(\"MOPOP_UpdateHookOccupation ... hKey => \" + hKey);\n\n\n                    if (wHooks.hasOwnProperty(hKey)) {\n                        var aHook = wHooks[hKey];\n                        var isOccupied = aHook.isOccupied;\n\n                        if (isOccupied) {\n                            var occupante = aHook.occupante;\n                            var occupanteId = occupante.TrackableName;\n\n\n                            /*occupantList.push({\n                                \"occ\": occupante,\n                                \"hook\": hKey\n                            });*/\n\n\n                            //myconsolelog(\"MOPOP_UpdateHookOccupation id check => \" + occupanteId + \" == \" + MOPOP.picked.TrackableName);\n                            //look if the picked one occupied a hook\n                            if (true) {\n                                //if (occupanteId == MOPOP.picked.TrackableName) {\n\n                                myconsolelog(\"MOPOP_UpdateHookOccupation FOUND wKey => \" + wKey);\n                                myconsolelog(\"MOPOP_UpdateHookOccupation FOUND wName => \" + wName);\n                                myconsolelog(\"MOPOP_UpdateHookOccupation FOUND hKey => \" + hKey);\n                                myconsolelog(\"MOPOP_UpdateHookOccupation FOUND aHook => \" + JSON.stringify(aHook));\n\n\n                                //the hooks gameobject, not the tile only the hook\n                                var hookGoName = wKey + \"/\" + hKey + \"/\" + \"Hook\";\n                                var hookGo = MAIN.UE.GameObject.Find(hookGoName);\n\n                                //var artefactName = aHook.occupante.TrackedGoName; // orig version, measuring from vufo-target\n                                var artefactName = aHook.occupante.wuName; //measuring from label\n                                var artefactGo = MAIN.UE.GameObject.Find(artefactName);\n\n                                //TODO check here for the distance\n                                var dist = 0;\n                                if (hookGo != null && artefactGo != null) {\n                                    var hookPos = hookGo.transform.position;\n                                    var artefactPos = artefactGo.transform.position;\n\n                                    myconsolelog(\"MOPOP_UpdateHookOccupation hookPos=(\" + hookPos.x + \", \" + hookPos.y + \", \" + hookPos.z + \")\");\n                                    myconsolelog(\"MOPOP_UpdateHookOccupation artefactPos=(\" + artefactPos.x + \", \" + artefactPos.y + \", \" + artefactPos.z + \")\");\n\n                                    dist =\n                                        Math.sqrt(\n                                            (hookPos.x - artefactPos.x) * (hookPos.x - artefactPos.x) +\n                                            (hookPos.y - artefactPos.y) * (hookPos.y - artefactPos.y) +\n                                            (hookPos.z - artefactPos.z) * (hookPos.z - artefactPos.z)\n                                        );\n                                    myconsolelog(\"MOPOP_UpdateHookOccupation dist=\" + dist);\n                                }\n\n                                if (dist > 0.2) {\n                                    //var hookGo = MAIN.UE.GameObject.Find(hookGoName);\n                                    if (hookGo != null) {\n                                        var r = hookGo.GetComponent(MAIN.UE.Renderer);\n                                        if (r != null) {\n                                            //r.material.color = MAIN.UE.Color.green;\n                                            r.material.color = new MAIN.UE.Color(0.4, 0.4, 0.4, 0.5);\n                                        }\n                                    }\n\n                                    //TODO maybe set picked here?\n                                    //TODO make cover unplaced\n                                    MOPOP.picked = aHook.occupante;\n                                    try {\n                                        var wuName = occupante.wuName;\n                                        var tw1 = MAIN.PUI.WorldUI.Find(wuName);\n                                        if (tw1 != null) {\n                                            tw1.document.Run(\"Artefact_MakeMePicked\", [\"\"]);\n                                        }\n                                    } catch (setPickedErr) {\n                                        myconsolelog(\"MOPOP Artefact_MakeMePicked ERROR => \" + setPickedErr);\n                                    }\n\n                                    //TODO killBez here?\n                                    aHook.isOccupied = false;\n                                    aHook.occupante = null;\n                                    dirtyScore = true;\n                                    //MOPOP_CalcScore();\n                                }\n                            }\n                        }\n                    } else {\n                        myconsolelog(\"MOPOP_UpdateHookOccupation ... hKey => \" + hKey + \" NOT FOUND\");\n                    }\n                }\n\n                //check occupant list neighbor relations\n                /*if (false) {\n\n\n                    var bezParentGo = new MAIN.UE.GameObject.Find(\"pairbezparent\");\n                    if (bezParentGo == null) {\n                        bezParentGo = new MAIN.UE.GameObject(\"pairbezparent\");\n                    }\n\n\n                    //occupantList.push({\n                    //    \"occ\": occupante,\n                    //    \"hook\": hKey\n                    //});\n                    //{\"isOccupied\":true,\"occupante\":{\"TrackableName\":\"2805595956\",\"TrackedGoName\":\"VIT-13-2805595956\",\"goName\":\"Test2805595956\",\"wuName\":\"UI2805595956\"}}\n                    for (var ai = 0; ai < occupantList.length; ai++) {\n                        for (var bi = ai + 1; bi < occupantList.length; bi++) {\n                            var occupantA = occupantList[ai];\n                            var occupantB = occupantList[bi];\n\n                            //occupantA.occ\n                            //occupantA.hook\n\n\n                            var hookGoA = MAIN.UE.GameObject.Find(occupantA.hook)\n                            var hookGoB = MAIN.UE.GameObject.Find(occupantB.hook)\n\n                            if (hookGoA != null && hookGoB != null) {\n                                var posA = hookGoA.transform.localPosition;\n                                var posB = hookGoB.transform.localPosition;\n\n                                // check distance\n                                // if close, check artist\n\n                                var dist =\n                                    Math.sqrt(\n                                        (posA.x - posB.x) * (posA.x - posB.x) +\n                                        (posA.y - posB.y) * (posA.y - posB.y) +\n                                        (posA.z - posB.z) * (posA.z - posB.z)\n                                    );\n\n                                if (dist < 0.3) {\n                                    var coverIdA = occupantA.occ.TrackableName;\n                                    var coverIdB = occupantB.occ.TrackableName;\n\n                                    var coverA = MOPOP.artefacts[coverIdA];\n                                    var coverB = MOPOP.artefacts[coverIdB];\n\n                                    var artistA = coverA.artist;\n                                    var artistB = coverB.artist;\n\n                                    if (artistA == artistB) {\n                                        //same artist, which are also close to each other\n                                        scoreweight += 0.05;\n                                        //\n\n                                        var bezName = \"pairbez-\" + occupantA.hook + \"-\" + occupantB.hook;\n                                        var bezGo = RT.Unity.CreateBezier(bezName, occupantA.hook, occupantB.hook);\n                                        if (bezGo != null) {\n                                            RT.Unity.SetParent(bezGo, bezParentGo);\n                                        }\n                                    }\n                                }\n                            }\n\n                        }\n                    }\n                }*/\n\n\n            }\n        }\n\n        if (dirtyScore) {\n            //MOPOP_CalcScore(); //this was on\n            dirtyScore = false;\n            node.send([{\"payload\":true}])\n        }\n\n        //update temp tables here\n        var tables = MOPOP.temptable;\n        for (var wKey in tables) {\n            if (tables.hasOwnProperty(wKey)) {\n                var aTable = tables[wKey];\n                var wName = aTable.name;\n                var wHooks = aTable.hooks;\n\n                for (var hKey in wHooks) {\n                    if (wHooks.hasOwnProperty(hKey)) {\n                        var aHook = wHooks[hKey];\n                        var isOccupied = aHook.isOccupied;\n                        if (isOccupied) {\n                            var occupante = aHook.occupante;\n                            var occupanteId = occupante.TrackableName;\n\n                            if (true) {\n\n                                //the hooks gameobject, not the tile only the hook\n                                var hookGoName = wKey + \"/\" + hKey + \"/\" + \"Hook\";\n                                var hookGo = MAIN.UE.GameObject.Find(hookGoName);\n\n                                var artefactName = aHook.occupante.TrackedGoName;\n                                var artefactGo = MAIN.UE.GameObject.Find(artefactName);\n\n                                var dist = 0;\n                                if (hookGo != null && artefactGo != null) {\n                                    var hookPos = hookGo.transform.position;\n                                    var artefactPos = artefactGo.transform.position;\n\n                                    dist =\n                                        Math.sqrt(\n                                            (hookPos.x - artefactPos.x) * (hookPos.x - artefactPos.x) +\n                                            (hookPos.y - artefactPos.y) * (hookPos.y - artefactPos.y) +\n                                            (hookPos.z - artefactPos.z) * (hookPos.z - artefactPos.z)\n                                        );\n                                }\n\n                                if (dist > 0.2) { // was 0.05\n                                    if (hookGo != null) {\n                                        var r = hookGo.GetComponent(MAIN.UE.Renderer);\n                                        if (r != null) {\n                                            //r.material.color = MAIN.UE.Color.green;\n                                            r.material.color = new MAIN.UE.Color(0.4, 0.4, 0.4, 0.5);\n                                        }\n                                    }\n\n                                    MOPOP.picked = aHook.occupante;\n                                    try {\n                                        var wuName = occupante.wuName;\n                                        var tw1 = MAIN.PUI.WorldUI.Find(wuName);\n                                        if (tw1 != null) {\n                                            tw1.document.Run(\"Artefact_MakeMePicked\", [\"\"]);\n                                        }\n                                    } catch (setPickedErr) {\n                                        myconsolelog(\"MOPOP Artefact_MakeMePicked ERROR => \" + setPickedErr);\n                                    }\n\n                                    //TODO killBez here?\n                                    aHook.isOccupied = false;\n                                    aHook.occupante = null;\n                                }\n                            }\n                        }\n                    } else {\n                        myconsolelog(\"MOPOP_UpdateHookOccupation ... hKey => \" + hKey + \" NOT FOUND\");\n                    }\n                }\n            }\n        }\n    }\n} catch (err) {\n    myconsolelog(\"MOPOP_UpdateHookOccupation ERROR => \" + err);\n}\nreturn null;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":910,"y":1200,"wires":[["46fbd016.56cf2","23bdae4d.aa40a2"]]},{"id":"a0719739.b86ec8","type":"debug","z":"923bd7d5.f34fa8","name":"after entry interaction","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":920,"y":1120,"wires":[]},{"id":"2071e1af.8775de","type":"debug","z":"923bd7d5.f34fa8","name":"after exit interaction","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":950,"y":1300,"wires":[]},{"id":"46fbd016.56cf2","type":"debug","z":"923bd7d5.f34fa8","name":"hook occupation","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1200,"y":1200,"wires":[]},{"id":"23bdae4d.aa40a2","type":"function","z":"923bd7d5.f34fa8","name":"Compute score","func":"function myconsolelog(msg) {\n    //console.log(\"MOPOP => \" + msg);\n}\n\nmyconsolelog(\"MOPOP_CalcScore ... \");\n//MOPOP.hookwall[dObj.hookWall].hooks[dObj.tileGoName];\n//MOPOP.hookwall[hGoName].hooks[go.name] = {\n//    \"isOccupied\": false,\n//    \"occupante\": null\n//};\n\nvar walls = MOPOP.hookwall;\n\n/*var test = { \"HW_A\": { \"name\": \"HW_A\", \"hooks\": { \"HW_A_0_0\": { \"isOccupied\": false, \"occupante\": null }, \"HW_A_1_0\": { \"isOccupied\": false, \"occupante\": null }, \"HW_A_2_0\": { \"isOccupied\": false, \"occupante\": null }, \"HW_A_3_0\": { \"isOccupied\": false, \"occupante\": null }, \"HW_A_0_1\": { \"isOccupied\": false, \"occupante\": null }, \"HW_A_1_1\": { \"isOccupied\": false, \"occupante\": null }, \"HW_A_2_1\": { \"isOccupied\": false, \"occupante\": null }, \"HW_A_3_1\": { \"isOccupied\": false, \"occupante\": null }, \"HW_A_0_2\": { \"isOccupied\": false, \"occupante\": null }, \"HW_A_1_2\": { \"isOccupied\": false, \"occupante\": null }, \"HW_A_2_2\": { \"isOccupied\": false, \"occupante\": null }, \"HW_A_3_2\": { \"isOccupied\": false, \"occupante\": null } } }, \"HW_B\": { \"name\": \"HW_B\", \"hooks\": { \"HW_B_0_0\": { \"isOccupied\": false, \"occupante\": null }, \"HW_B_1_0\": { \"isOccupied\": false, \"occupante\": null }, \"HW_B_2_0\": { \"isOccupied\": false, \"occupante\": null }, \"HW_B_3_0\": { \"isOccupied\": false, \"occupante\": null }, \"HW_B_0_1\": { \"isOccupied\": false, \"occupante\": null }, \"HW_B_1_1\": { \"isOccupied\": false, \"occupante\": null }, \"HW_B_2_1\": { \"isOccupied\": false, \"occupante\": null }, \"HW_B_3_1\": { \"isOccupied\": false, \"occupante\": null }, \"HW_B_0_2\": { \"isOccupied\": false, \"occupante\": null }, \"HW_B_1_2\": { \"isOccupied\": false, \"occupante\": null }, \"HW_B_2_2\": { \"isOccupied\": false, \"occupante\": null }, \"HW_B_3_2\": { \"isOccupied\": false, \"occupante\": null } } } };\nvar test2 = { \"HW_A\": { \"name\": \"HW_A\", \"hooks\": { \"HW_A_0_0\": { \"isOccupied\": false, \"occupante\": null }, \"HW_A_1_0\": { \"isOccupied\": false, \"occupante\": null }, \"HW_A_2_0\": { \"isOccupied\": false, \"occupante\": null }, \"HW_A_3_0\": { \"isOccupied\": false, \"occupante\": null }, \"HW_A_0_1\": { \"isOccupied\": true, \"occupante\": { \"TrackableName\": \"865341506\", \"TrackedGoName\": \"VIT-19-865341506\", \"goName\": \"Test865341506\", \"wuName\": \"UI865341506\" } }, \"HW_A_1_1\": { \"isOccupied\": true, \"occupante\": { \"TrackableName\": \"865341506\", \"TrackedGoName\": \"VIT-19-865341506\", \"goName\": \"Test865341506\", \"wuName\": \"UI865341506\" } }, \"HW_A_2_1\": { \"isOccupied\": false, \"occupante\": null }, \"HW_A_3_1\": { \"isOccupied\": false, \"occupante\": null }, \"HW_A_0_2\": { \"isOccupied\": false, \"occupante\": null }, \"HW_A_1_2\": { \"isOccupied\": false, \"occupante\": null }, \"HW_A_2_2\": { \"isOccupied\": false, \"occupante\": null }, \"HW_A_3_2\": { \"isOccupied\": false, \"occupante\": null } } }, \"HW_B\": { \"name\": \"HW_B\", \"hooks\": { \"HW_B_0_0\": { \"isOccupied\": false, \"occupante\": null }, \"HW_B_1_0\": { \"isOccupied\": false, \"occupante\": null }, \"HW_B_2_0\": { \"isOccupied\": false, \"occupante\": null }, \"HW_B_3_0\": { \"isOccupied\": false, \"occupante\": null }, \"HW_B_0_1\": { \"isOccupied\": false, \"occupante\": null }, \"HW_B_1_1\": { \"isOccupied\": false, \"occupante\": null }, \"HW_B_2_1\": { \"isOccupied\": false, \"occupante\": null }, \"HW_B_3_1\": { \"isOccupied\": false, \"occupante\": null }, \"HW_B_0_2\": { \"isOccupied\": false, \"occupante\": null }, \"HW_B_1_2\": { \"isOccupied\": false, \"occupante\": null }, \"HW_B_2_2\": { \"isOccupied\": false, \"occupante\": null }, \"HW_B_3_2\": { \"isOccupied\": false, \"occupante\": null } } } };\nvar walls = test2;*/\n\nmyconsolelog(\"MOPOP_CalcScore ... walls => \" + JSON.stringify(walls));\n\nvar wallsScore = 0;\nvar usedYearPerWall = {};\n\nvar totalWeight = 1;\nvar totalGroup = 1;\nvar totalOrder = 1;\n\n// go over walls\nfor (var wKey in walls) {\n    myconsolelog(\"MOPOP_CalcScore ... wKey => \" + wKey);\n    if (walls.hasOwnProperty(wKey)) {\n        usedYearPerWall[wKey] = {};\n        myconsolelog(\"MOPOP_CalcScore ... wKey => \" + wKey + \" => FOUND\");\n        var aWall = walls[wKey];\n        var wName = aWall.name;\n        var wHooks = aWall.hooks;\n        var isReversed = aWall.reversed;\n        var wallW = aWall.w;\n        var wallH = aWall.h;\n        var wallGenre = aWall.genre;\n        myconsolelog(\"MOPOP_CalcScore ... walls[\" + wKey + \"].name=\" + wName + \", \" + wallGenre);\n\n        var occupantList = [];\n        for (var hKey in wHooks) {\n            myconsolelog(\"MOPOP_CalcScore ...   hKey => \" + hKey);\n            if (wHooks.hasOwnProperty(hKey)) {\n                var aHook = wHooks[hKey];\n\n                var wuInfoName = \"WU_\" + hKey;\n                var wuInfo = MAIN.PUI.WorldUI.Find(wuInfoName);\n                \n                var wuScBoardName = flow.get(\"mopop_score_chart_board\");\n                var wuScBoard = MAIN.PUI.WorldUI.Find(wuScBoardName);\n\n                // is hook occupied?\n                var isOccupied = aHook.isOccupied;\n                if (isOccupied) {\n\n                    //prepare list of occupants\n                    occupantList.push({\n                        \"hook\": aHook,\n                        \"hookname\": hKey\n                    });\n\n                    var occupante = aHook.occupante;\n                    myconsolelog(\"MOPOP_CalcScore ... walls[\" + wKey + \"].hooks[\" + hKey + \"].occupied=\" + isOccupied);\n                    myconsolelog(\"MOPOP_CalcScore ... walls[\" + wKey + \"].hooks[\" + hKey + \"].occupante=>\" + JSON.stringify(occupante));\n\n                    // check if tehre is a stored occupant\n                    var occupanteId = occupante.TrackableName;\n                    if (MOPOP.artefacts.hasOwnProperty(occupanteId)) {\n\n                        var wuInfoContent = \"\";\n                        \n                        var artefact = MOPOP.artefacts[occupanteId];\n                        \n                        var genre = artefact.genre;\n                        var score = artefact.score;\n                        var year = MOPOP_GetYearFromString(artefact.publishdate);\n                        var extraWeight = 1;\n                        \n                        //count as zero \n                        if(genre != wallGenre) {\n                            extraWeight = 0;\n                            wuInfoContent += \"Wrong Genre!\" + \"</br>\";\n                            myconsolelog(\"MOPOP_CalcScore ... Artefact[\" + occupanteId + \"].genre => \" + genre + \" != \" + wallGenre);\n                        }\n                        \n                        // #sold copies normalizer: 1x10^6 ==> 1\n                        var soldcopies = 0;\n                        if (artefact.hasOwnProperty(\"soldcopies\")) {\n                            soldcopies = parseFloat(artefact.soldcopies.replace(\",\", \"\"));\n                            soldcopies *= 0.000001;\n                        }\n\n\n                        //year occupation for year distribution\n                        var yearWeight = 1;\n                        var yearOk = (parseFloat(year) >=  MOPOP.startyear) || (parseFloat(year) <=  MOPOP.endyear);\n                        if(yearOk) {\n                            if (!usedYearPerWall[wKey].hasOwnProperty(year)) {\n                                var dataId = parseFloat(year) - parseFloat(MOPOP.startyear);\n                                usedYearPerWall[wKey][year] = {\n                                    \"val\": 0,\n                                    \"id\": dataId\n                                };\n                                //usedYearPerWall[wKey][year].val += 1;\n                                myconsolelog(\"MOPOP_CalcScore ... Artefact[\" + occupanteId + \"].score => \" + score);\n                            }\n                        } else {\n                            yearWeight = 0;\n                        }\n                        \n                        \n\n                        var soldScore = parseFloat(score) * soldcopies;\n                        var contribScore = soldScore * extraWeight * yearWeight;\n                        \n                        wuInfoContent += \"Sold: \" + soldScore.toFixed(2) + \"</br>\";\n                        wuInfoContent += \"Weight: \" + extraWeight.toFixed(2) + \"</br>\";\n                        wuInfoContent += \"Single: \" + contribScore.toFixed(2) + \"</br>\";\n\n                        usedYearPerWall[wKey][year].val += 1;\n                        wallsScore += contribScore;\n                        \n                        if(wuInfo != null) {\n                            wuInfo.document.innerHTML = \n                                '<div id=\"wrap\" style=\"font-size:24px;background-color:silver;color:black;border:solid 4px blue;margin:5px;padding:5px;border-radius:4px;\">' + \n                                wuInfoContent + \n                                \"</div>\";\n                        }\n                    }\n                } else {\n                    if(wuInfo != null) {\n                        wuInfo.document.innerHTML = \"\";\n                    }\n                }\n            }\n        }\n\n        // calc occupant features, artist groups, ... here\n        try {\n            if (occupantList.length > 0) { // was 2\n\n                //reversed for year direction\n                //isReversed\n                var NBins = wallW;\n                var xBins = [];\n\n                //prepare xbins\n                for (var wi = 0; wi < NBins; wi++) {\n                    xBins.push([]);\n                }\n\n                var weightedPenalty = 1;\n                var groupBonus = 1;\n                var orderWeight=1;\n\n                //collect years of occupants\n                var N = occupantList.length;\n                for (var i = 0; i < N; i++) {\n                    var occ = occupantList[i];\n                    var hook = occ.hook;\n                    var hookname = occ.hookname;\n                    var hookOccupant = hook.occupante;\n                    occupanteId = hookOccupant.TrackableName;\n                    \n                    var wuInfoName = \"WU_\" + hookname;\n                    var wuInfo = MAIN.PUI.WorldUI.Find(wuInfoName);\n                    \n                    myconsolelog(\"MOPOP_CalcScore OCCULIST => hookname= \" + hookname);\n                    myconsolelog(\"MOPOP_CalcScore OCCULIST => occ= \" + JSON.stringify(occ));\n                    myconsolelog(\"MOPOP_CalcScore OCCULIST => hookOccupant= \" + JSON.stringify(hookOccupant));\n                    myconsolelog(\"MOPOP_CalcScore OCCULIST => occupanteId= \" + hookOccupant.TrackableName);\n                    myconsolelog(\"MOPOP_CalcScore OCCULIST => occupanteId= \" + occupanteId);\n\n                    \n                    var hookX = hook.x;\n                    var hookY = hook.y;\n\n                    var hooksArtefact = MOPOP.artefacts[occupanteId];\n                    var hooksArtist = hooksArtefact.artist;\n                    \n                    myconsolelog(\"MOPOP_CalcScore OCCULIST => hooksArtist= \" + hooksArtist);\n                    myconsolelog(\"MOPOP_CalcScore OCCULIST => hookX= \" + hookX + \", hookY=\" + hookY);\n                \n                    \n                    var hooksYearStr = MOPOP_GetYearFromString(hooksArtefact.publishdate);\n                    var hooksYear = parseInt(hooksYearStr);\n\n                    //xBins[hookX].push(hooksYear); //was this\n                    xBins[hookX].push({\"year\": hooksYear, \"hookname\": hookname, \"occupanteId\": occupanteId});\n                    \n                    //var groupBonus = 1;\n                    \n                    var partgroup = 1;\n                    //look for other artists close by\n                    // start at i = k +1  \n                    if(true) {\n                    //if(i + 1 < N) {\n                        for(var ia = 0; ia < N; ia++ ) {\n                        //for(var ia = i + 1; ia < N; ia++ ) {\n                            var tocc = occupantList[ia];\n                            var thook = tocc.hook;\n                            var thookX = thook.x;\n                            var thookY = thook.y;\n                            var thookname = tocc.hookname;\n                            var thookOccupant = thook.occupante;\n                            var toccupanteId = thookOccupant.TrackableName;\n                            var thooksArtefact = MOPOP.artefacts[toccupanteId];\n                            var thooksArtist = thooksArtefact.artist;\n                            myconsolelog(\"MOPOP_CalcScore OCCULIST => hookX= \" + hookX + \", hookY=\" + hookY);\n                            \n                            myconsolelog(\"MOPOP_CalcScore artist => thooksArtist= \" + thooksArtist + \", hooksArtist=\" + hooksArtist);\n                            // if the same artis\n                            if(thooksArtist == hooksArtist && toccupanteId != occupanteId) {\n                            //if(thooksArtist == hooksArtist) {\n                                dhx = Math.abs(thookX - hookX);\n                                dhy = Math.abs(thookY - hookY);\n                                //check if its placed on a hook next to it\n                                if(dhx == 1 || dhy == 1) {\n                                //if(dhx < 2 || dhy < 2) {\n                                    myconsolelog(\"MOPOP_CalcScore OCCULIST ARTISTBONUS\");\n                                    weightedPenalty *= 1.2;\n                                    groupBonus *= 1.2;\n                                    partgroup *= 1.2;\n                                    wuInfo.document.getElementById(\"wrap\").innerHTML += \"Group: \" + partgroup.toFixed(2) + \"</br>\";\n                                }\n                            }\n                        }\n                    }\n                    \n                    //if(wuInfo != null) {\n                        //wuInfo.document.getElementById(\"wrap\").innerHTML += \n                        //\"GroupAll: \" + groupBonus.toFixed(2) + \"</br>\";\n                        //wuInfo.document.innerHTML += \"groupBonus: \" + groupBonus.toFixed(2) + \"</br>\";\n                    //}\n                    \n                    if(wuScBoard != null) {\n                        wuScBoard.document.getElementById(\"group\").innerHTML = groupBonus.toFixed(2);\n                    }\n                }\n\n                if(wuScBoard != null) {\n                    wuScBoard.document.getElementById(\"order\").innerHTML = orderWeight.toFixed(2);\n                    wuScBoard.document.getElementById(\"penalty\").innerHTML = weightedPenalty.toFixed(2);\n                }\n\n                //filter only used bins, so that we can go pairwise through them\n                var filteredBins = [];\n                for (var wi = 0; wi < NBins; wi++) {\n                    if (xBins[wi].length > 0) {\n                        filteredBins.push(xBins[wi]);\n                    }\n                }\n                \n                //console.log(\"MOPOP_CalcScore xBins => \" + JSON.stringify(xBins));\n                //console.log(\"MOPOP_CalcScore filteredBins => \" + JSON.stringify(filteredBins));\n                \n                //check for weak monotonic years\n                var fNbins = filteredBins.length;\n                for (var wi = 1; wi < fNbins; wi++) {\n                    var prevBin = filteredBins[wi - 1];\n                    var curBin = filteredBins[wi];\n\n                    for (pwi = 0; pwi < prevBin.length; pwi++) {\n                        //curPrevYear = prevBin[pwi]; //was this\n                        curPrevYear = prevBin[pwi].year; //was\n                        \n                        var curPrevHookname = prevBin[pwi].hookname;\n                        var curPrevWu = MAIN.PUI.WorldUI.Find(\"WU_\" + curPrevHookname);\n                        var tempWeight = 1;\n\n                        for (cwi = 0; cwi < curBin.length; cwi++) {\n                            //curCurYear = curBin[cwi]; //was this\n                            curCurYear = curBin[cwi].year; //was this\n                            var curCurHookname = prevBin[pwi].hookname;\n\n\n                            //console.log(\"MOPOP_CalcScore years check => \" + curPrevYear + \" vs \" + curCurYear);\n\n                            //check each year of bin A vs each year of bin b\n                            //every violation causes a 5% penalty\n                            if (isReversed) {\n\n                                //reverse means year gos from 1990 to 2000 where the hook ids go from 13 to 0\n                                //therefore to be monotonic increasing, the years seen from the ids would be\n                                // decreasing, theferefor we penalize when its increasing\n                                if (curPrevYear < curCurYear) {\n                                    weightedPenalty *= 0.8; // local order penalty\n                                    tempWeight *= 0.8;\n                                }\n                            } else {\n                                //regular monotonic increase where the yeare goes from 1990 to 2000 and the\n                                // hook id from 0 to 13, therefore we penalize violations when decreasing\n                                // which means prev year is bigger as next year\n                                if (curPrevYear > curCurYear) {\n                                    weightedPenalty *= 0.8;\n                                    tempWeight *= 0.8; //local order penalty\n                                    orderWeight *=0.8;\n                                }\n                            }\n                        }\n                    }\n                }\n                \n                if(wuScBoard != null) {\n                    totalWeight *= weightedPenalty;\n                    totalGroup *= groupBonus;\n                    totalOrder *= orderWeight;\n                    wuScBoard.document.getElementById(\"order\").innerHTML = totalOrder.toFixed(2);\n                    wuScBoard.document.getElementById(\"penalty\").innerHTML = totalWeight.toFixed(2);\n                    wuScBoard.document.getElementById(\"group\").innerHTML = totalGroup.toFixed(2);\n                }\n                        \n                wallsScore *= weightedPenalty;\n            }\n        } catch (tlerr) {\n            console.log(\"MOPOP_CalcScore TL ERROR => \" + tlerr);\n        }\n    }\n\n} // walls\n\n    if (wallsScore > 0) {\n        //MOPOP_ReportUserEvent(MOPOP.userevents.score, { \"score\": wallsScore }, Date.now(), MOPOP.user);\n\n        var data = {\n            \"score\": wallsScore //TODO use real score here\n        };\n        var jsonScores = JSON.stringify(data);\n        //RT.MQTT.Publish(MOPOP.topics.wallscore, jsonScores);\n        myconsolelog(\"MOPOP_CalcScore ... done SCORES => \" + jsonScores);\n        //node.send([{\"topic\": \"MOPOP/wallscore\", \"payload\":jsonScores}]);\n        node.send([{\"topic\": \"MOPOP/wallscore\", \"payload\": data}]);\n\n        for (var k in usedYearPerWall) {\n            var jsonYears = JSON.stringify(usedYearPerWall[k]);\n            var topic = MOPOP.topics.wallyearhist + \"/\" + k.replace(\"HW_\", \"\"); //dirty fix!!!!\n            //RT.MQTT.Publish(topic, jsonYears);\n            myconsolelog(\"MOPOP_CalcScore ... done YEARS: \" + topic + \"/ => \" + jsonYears);\n            \n            var keys = Object.keys(usedYearPerWall[k]);\n            myconsolelog(\"MOPOP_CalcScore ... done YEARS: \" + topic + \"/ => #\" + keys.length);\n            \n            //node.send([{\"topic\": topic, \"payload\":jsonYears}]);\n            if(keys.length > 0) {\n                node.send([{\"topic\": topic, \"payload\":usedYearPerWall[k]}]);\n            }\n        }\n    }\nreturn null;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1200,"y":1160,"wires":[["e0543339.eaacd","c28331d2.38be1"]]},{"id":"e0543339.eaacd","type":"debug","z":"923bd7d5.f34fa8","name":"computed score","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1460,"y":1120,"wires":[]},{"id":"c28331d2.38be1","type":"mqtt out","z":"923bd7d5.f34fa8","name":"","topic":"","qos":"0","retain":"false","broker":"73e9a24f.21590c","x":1430,"y":1160,"wires":[]},{"id":"ccf6932.bf8437","type":"debug","z":"923bd7d5.f34fa8","name":"dbg score B","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":470,"y":1460,"wires":[]},{"id":"da86f847.c10478","type":"debug","z":"923bd7d5.f34fa8","name":"dbg score C","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":470,"y":1520,"wires":[]},{"id":"efa1449b.d79bd8","type":"comment","z":"923bd7d5.f34fa8","name":"Hook interactions","info":"","x":140,"y":1100,"wires":[]},{"id":"988f0b52.7012b8","type":"inject","z":"923bd7d5.f34fa8","name":"A","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":"5","topic":"","payload":"","payloadType":"date","x":130,"y":1680,"wires":[["e661df09.17f5f"]]},{"id":"6ee8a3d1.ff3f3c","type":"function","z":"923bd7d5.f34fa8","name":"apply data","func":"//\"{\"Time\":\"2021-08-17T07:31:36\",\"BME280\":{\"Temperature\":26.1,\"Humidity\":47.2,\"DewPoint\":14.0,\"Pressure\":973.8},\"SR04\":{\"Distance\":59.368},\"PressureUnit\":\"hPa\",\"TempUnit\":\"C\"}\"\n\nvar data = msg.payload;\nvar score = data.score;\nvar chartId = flow.get(\"mopop_score_chart\");\n\n\nvar chart = MAIN.usercanvas.charts2[chartId];\nchart.rtds.SetDataStrVal(\"score\", score);\nchart.vis.updateProperties(); //for testing\nchart.fctUpdateChart();\n\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":670,"y":2440,"wires":[["511069c4.af7308"]]},{"id":"511069c4.af7308","type":"debug","z":"923bd7d5.f34fa8","name":"K","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":810,"y":2440,"wires":[]},{"id":"92d46e62.c2cb","type":"function","z":"923bd7d5.f34fa8","name":"to object","func":"var data = JSON.parse(msg.payload);\nmsg.payload = data;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":320,"y":2440,"wires":[["d3fbf03a.133ad"]]},{"id":"e661df09.17f5f","type":"function","z":"923bd7d5.f34fa8","name":"client filter","func":"try {\n    var n = MAIN.usercanvas;\n    return msg;\n} catch(err) {\n    return null;\n}\nreturn null;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":280,"y":1680,"wires":[["f7fa955c.d3c138"]]},{"id":"5527d01e.3a919","type":"mqtt in","z":"923bd7d5.f34fa8","name":"","topic":"MOPOP/wallscore","qos":"0","datatype":"auto","broker":"73e9a24f.21590c","x":110,"y":2440,"wires":[["92d46e62.c2cb","6599171b.190158"]]},{"id":"6599171b.190158","type":"debug","z":"923bd7d5.f34fa8","name":"dbg score A","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":350,"y":2480,"wires":[]},{"id":"94eb4702.852a78","type":"inject","z":"923bd7d5.f34fa8","name":"A","props":[{"p":"payload"}],"repeat":"1","crontab":"","once":true,"onceDelay":"10","topic":"","payload":"","payloadType":"date","x":570,"y":1200,"wires":[["50a24611.a785d8"]]},{"id":"94dda791.66c4c8","type":"function","z":"923bd7d5.f34fa8","name":"cooldown pickup","func":"// for a period of 5 secs, user have to look at the target to pick it up\n\nvar data1 = JSON.parse(msg.payload);\nvar mTrackableName = data1.trackableName;\nvar mTrackedGoName = data1.trackedGoName;\nnode.warn(\"MOPOP CDP msg => \" + JSON.stringify(msg));\nnode.warn(\"MOPOP CDP msg.payload => \" + msg.payload);\nnode.warn(\"MOPOP CDP mTrackableName => \" + mTrackableName);\nnode.warn(\"MOPOP CDP mTrackedGoName => \" + mTrackedGoName);\n\nvar go = MAIN.UE.GameObject.Find(mTrackedGoName);\nvar dkey = \"dist-\" + mTrackedGoName;\n\nif(go != null) {\n    node.warn(\"MOPOP CDP dkey => \" + dkey);\n    \n    var t = go.transform.position;\n    var posd = {\"p\" : [t.x,t.y,t.z], \"d\": 0};\n    flow.set(dkey, JSON.stringify(posd));\n    \n    var wuName = \"loader\";\n    var url = MAIN.WEBAPI.uiurl + \"/loader.html\";\n    var wu = RT.Unity.CreateWU(wuName, url, true, 400, 200);\n    RT.Unity.SetParent(wu, go);\n    RT.Unity.SetLocalPose(wu,\n        [0, 0.05, 0],\n        [1, 0, 0, 1],\n        [0.0003, 0.0003, 0.0001] //was null\n    );\n    \n    \n    \n    \n    \n    RT.Web.SetTiimeout(1500, function () {\n        \n        node.warn(\"MOPOP CDP after 2sec msg => \" + msg);\n        node.warn(\"MOPOP CDP after 2sec dkey => \" + dkey);\n        node.warn(\"MOPOP CDP after 2sec mTrackedGoName => \" + mTrackedGoName);\n        \n        //get old pos and dist\n        var pdStr = flow.get(dkey);\n        var pd = JSON.parse(pdStr);\n        \n        var go = MAIN.UE.GameObject.Find(mTrackedGoName);\n        var t = go.transform.position;\n        var dist = MOPOP_dist([t.x,t.y,t.z], pd.p);\n        \n        node.warn(\"MOPOP CDP after 2sec dist=\" + dist);\n        \n        if(dist < 0.5) {\n            var posd = {\"p\" : [t.x,t.y,t.z], \"d\":dist};\n            flow.set(dkey, JSON.stringify(posd));\n            \n            RT.Web.SetTiimeout(1500, function () {\n                \n                node.warn(\"MOPOP CDP after 4sec msg => \" + JSON.stringify(msg));\n                node.warn(\"MOPOP CDP after 4sec dkey => \" + dkey);\n                node.warn(\"MOPOP CDP after 4sec mTrackedGoName => \" + mTrackedGoName);\n                \n                //get old pos and dist\n                var pdStr = flow.get(dkey);\n                var pd = JSON.parse(pdStr);\n                \n                var go = MAIN.UE.GameObject.Find(mTrackedGoName);\n                var t = go.transform.position;\n                var dist = MOPOP_dist([t.x,t.y,t.z], pd.p);\n                node.warn(\"MOPOP CDP after 4sec dist=\" + dist);\n                \n                if(dist < 0.1) {\n                    wu.Expire();\n                    node.warn(\"MOPOP CDP forwarding msg=\" + JSON.stringify(msg));\n                    node.send([msg]); \n                }\n                wu.Expire();\n            });\n        } else {\n            wu.Expire();\n        }\n    });\n}\n\n\nreturn null;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":590,"y":880,"wires":[["dadefbc8.17dac8","a8ad92dd.f396e"]]},{"id":"77de3708.46786","type":"debug","z":"eb66deb5.bea27","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1360,"y":1520,"wires":[]},{"id":"955bf6c6.ccfe2","type":"debug","z":"f3784d00.40ef8","name":"K","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":410,"y":1120,"wires":[]},{"id":"1711b0d5.b605af","type":"comment","z":"923bd7d5.f34fa8","name":"Init rock year vis","info":"","x":140,"y":1920,"wires":[]},{"id":"88f6879a.901e38","type":"inject","z":"923bd7d5.f34fa8","name":"A","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":"10","topic":"","payload":"","payloadType":"date","x":130,"y":1960,"wires":[["eb7035cf.8a3298"]]},{"id":"24b91bde.60d394","type":"function","z":"923bd7d5.f34fa8","name":"apply data","func":"/*\nvar d = {\n    \"2000\": {\n        \"val\":2,\n        \"id\":1\n    }, \n    \"2004\":{\n        \"val\":6,\n        \"id\":5\n    },\n    \"2018\":{\n        \"val\":3,\n        \"id\":6\n    }\n};\n*/\n\nvar data = msg.payload;\nvar score = data.score;\nvar chartId = flow.get(\"mopop_rockyear_chart\");\n\nvar chart = MAIN.usercanvas.charts2[chartId];\nvar keys = Object.keys(data);\n\nfor(var i = 0; i < keys.length; i++) {\n    node.warn(\"MOPOP VIS hist => key: \" + key);\n    var key = keys[i];\n    var entry = data[key];\n    var id = entry.id;\n    var v = entry.val;\n    node.warn(\"MOPOP VIS hist => \" + id + \" / \" + v);\n    chart.rtds.SetDataStrValById(\"count\", v, id);\n}\n\nchart.vis.updateProperties(); //for testing\nchart.fctUpdateChart();\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":670,"y":2540,"wires":[["d847877d.0ed978"]]},{"id":"d847877d.0ed978","type":"debug","z":"923bd7d5.f34fa8","name":"K","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":810,"y":2540,"wires":[]},{"id":"933dbedf.f37aa","type":"function","z":"923bd7d5.f34fa8","name":"to object","func":"node.warn(\"MOPOP VIS wallscore => \" + msg.payload);\nvar data = JSON.parse(msg.payload);\nmsg.payload = data;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":380,"y":2540,"wires":[["c295f022.931c5"]]},{"id":"b5bee9fd.d42c98","type":"function","z":"923bd7d5.f34fa8","name":"apply position","func":"var hT = null;\nvar hR = null;\nvar hS = null;\nif(MAIN.location.data.mopop.hasOwnProperty(\"rockChartPos\")) {\n    hT = MAIN.location.data.mopop.rockChartPos.T;\n    hR = MAIN.location.data.mopop.rockChartPos.R;\n    hS = MAIN.location.data.mopop.rockChartPos.S;\n} else {\n    hT = MAIN.camHookGo.transform.position;\n    hR = MAIN.camHookGo.transform.rotation;\n    hS = [1, 1, 1];\n}\n\nvar chartId = flow.get(\"mopop_rockyear_chart\");\nvar chart = MAIN.usercanvas.charts2[chartId];\n\nvar T = [hT.x, hT.y, hT.z];\nvar R = [hR.x, hR.y, hR.z, hR.w];\nvar S = [hS.x, hS.y, hS.z];\nRT.Unity.SetPose(chart.chartGo, T, R, S);\n\nMAIN_CreateLabel(\"rock_label\", [0,1,0], [0,0,0,1], [0.001,0.001,0.001], chart.chartGo, \"Rock distribution\");\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":300,"y":2080,"wires":[[]]},{"id":"eb7035cf.8a3298","type":"function","z":"923bd7d5.f34fa8","name":"client filter","func":"try {\n    var n = MAIN.usercanvas;\n    return msg;\n} catch(err) {\n    return null;\n}\nreturn null;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":280,"y":1960,"wires":[["b36dd500.66cf58"]]},{"id":"e67300f5.20616","type":"mqtt in","z":"923bd7d5.f34fa8","name":"","topic":"MOPOP/wallyearhist/rockwall","qos":"0","datatype":"auto","broker":"73e9a24f.21590c","x":140,"y":2540,"wires":[["63090de6.91a064","933dbedf.f37aa"]]},{"id":"63090de6.91a064","type":"debug","z":"923bd7d5.f34fa8","name":"dbg score A","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":410,"y":2580,"wires":[]},{"id":"b36dd500.66cf58","type":"function","z":"923bd7d5.f34fa8","name":"Create Empty Vis","func":"node.warn(\"MOPOP VIS A\");\n\nvar nextId = RT.Help.CreateGuid();\nvar chart = RT.VIS.GetNewChartObjectIATK2(\n    nextId, 0, \"IATKChart\", 0.4, 0.2, false);\n\n//store chart object\nMAIN.usercanvas.charts2[nextId] = chart;\n\n//chartData.chartGoName\n//UCanvas_f52d7ced-010e-8f6a-5eaa-aea214e6ad72\n\nflow.set(\"rockChartGoName\", chart.chartGoName);\n\n//allow movement\nMAIN.RR.Runtime.ToggleObjManipulation(chart.chartGoName);\nvar bc = MAIN.RR.Runtime.AddBoxCollider(chart.chartGo);\nbc.size = new MAIN.UE.Vector3(0.3, 0.3, 0.3);\n\nmsg.payload = nextId;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":470,"y":1960,"wires":[["e9608045.8c133","29c20d47.9a01c2"]]},{"id":"e9608045.8c133","type":"function","z":"923bd7d5.f34fa8","name":"add dimensions","func":"node.warn(\"MOPOP VIS B\");\nvar chart = MAIN.usercanvas.charts2[msg.payload];\nchart.rtds.AddStringDimension(\"year\");\nchart.rtds.AddDimension(\"count\", 0, 100);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":720,"y":1960,"wires":[["2c63b2c2.50785e"]]},{"id":"2c63b2c2.50785e","type":"function","z":"923bd7d5.f34fa8","name":"delay test","func":"RT.Web.SetTiimeout(1000, function () {\n  var m = msg;\n  node.send([m]);  \n});\n//return msg;\nreturn null;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":280,"y":2020,"wires":[["64db31bd.fc486"]]},{"id":"64db31bd.fc486","type":"function","z":"923bd7d5.f34fa8","name":"json","func":"node.warn(\"MOPOP VIS C\");\nvar visData = \n{\n    \"UID\":\"\",\n    \"VisualisationType\":\"SCATTERPLOT\",\n    \"parallelCoordinatesDimensionsAttributes\":[],\n    \"parallelCoordinatesDimensionsMinFilter\":[],\n    \"parallelCoordinatesDimensionsMaxFilter\":[],\n    \"parallelCoordinatesDimensionsMinScale\":[],\n    \"parallelCoordinatesDimensionsMaxScale\":[],\n    \"Geometry\":6,\n    \"AxiesKeys\":[0,1],\n    \"AxiesValues\":[\"year\",\"count\"],\n    \"ColourDimension\":\"year\",\n    \"SizeDimension\":\"Undefined\",\n    \"LinkingDimension\":\"Undefined\",\n    \"colourKeys\":\n    {\n        \"serializedVersion\":\"2\",\n        \"key0\":{\"r\":1.0,\"g\":0.0,\"b\":0.0,\"a\":1.0},\n        \"key1\":{\"r\":0.0,\"g\":1.0,\"b\":0.0,\"a\":0.5},\n        \"key2\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key3\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key4\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key5\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key6\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key7\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"ctime0\":0,\"ctime1\":65535,\"ctime2\":0,\"ctime3\":0,\"ctime4\":0,\"ctime5\":0,\"ctime6\":0,\"ctime7\":0,\n        \"atime0\":0,\"atime1\":65535,\"atime2\":0,\"atime3\":0,\"atime4\":0,\"atime5\":0,\"atime6\":0,\"atime7\":0,\n        \"m_Mode\":0,\n        \"m_NumColorKeys\":2,\n        \"m_NumAlphaKeys\":2\n    },\n    \"colour\":{\"r\":0.0,\"g\":0.0,\"b\":1.0,\"a\":0.5},\n    \"Size\":0.6,\n    \"MinSize\":0.04,\n    \"MaxSize\":0.2,\n    \"VisualisationWidth\":0.4,\n    \"VisualisationHeight\":0.4,\n    \"VisualisationDepth\":0.4\n};\nmsg.json = visData;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":430,"y":2020,"wires":[["6fa4013c.6a027"]]},{"id":"6fa4013c.6a027","type":"function","z":"923bd7d5.f34fa8","name":"apply json","func":"node.warn(\"MOPOP VIS D\");\n\nvar chartId = msg.payload;\nvar chart = MAIN.usercanvas.charts2[chartId];\n\nvar json = JSON.stringify(msg.json);\nchart.vis.theVisualizationObject.creationConfiguration.DeserializeJson(json);\nimportNamespace(\"IATK\").Replicator.SyncVis(chart.vis);\nchart.vis.updateProperties();\nchart.fctUpdateChart();\n\nflow.set(\"mopop_rockyear_chart_init\", true);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":580,"y":2020,"wires":[["c78b3b04.308818"]]},{"id":"c78b3b04.308818","type":"function","z":"923bd7d5.f34fa8","name":"setup years","func":"node.warn(\"MOPOP VIS E\");\n\n//TODO take year from walls\n\nvar chartId = flow.get(\"mopop_rockyear_chart\");\nvar chart = MAIN.usercanvas.charts2[chartId];\n\nvar N = 10;\n\nchart.rtds.SetDimensionMinMax(\"year\", 0, N);\nfor(var i = 0; i < N; i++) {\n    var y = 1990 + i;\n    var yStr = \"Y \" + y;\n    chart.rtds.SetDataStrStrById(\"year\", \"\" + (1990 + i), i);\n}\n\nchart.vis.updateProperties();\nchart.fctUpdateChart();\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":750,"y":2020,"wires":[["b5bee9fd.d42c98"]]},{"id":"f7fa955c.d3c138","type":"function","z":"923bd7d5.f34fa8","name":"Create Empty Vis","func":"\nnode.warn(\"MOPOP VIS A\");\nvar nextId = RT.Help.CreateGuid();\n\nvar chartObj = RT.VIS.GetNewChartObjectIATK2(\n    nextId, 0, \"IATKChart\", 0.4, 0.2, false);\n\nMAIN.usercanvas.charts2[nextId] = chartObj;\n\nflow.set(\"scoreChartGoName\", chartObj.chartGoName);\n\nMAIN.RR.Runtime.ToggleObjManipulation(chartObj.chartGoName);\nvar bc = MAIN.RR.Runtime.AddBoxCollider(chartObj.chartGo);\nbc.size = new MAIN.UE.Vector3(0.3, 0.3, 0.3);\n\nmsg.payload = nextId;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":470,"y":1680,"wires":[["f6e66b43.8213f8","987e9977.e94d88"]]},{"id":"f6e66b43.8213f8","type":"function","z":"923bd7d5.f34fa8","name":"add dimensions","func":"node.warn(\"MOPOP VIS B\");\nvar chart = MAIN.usercanvas.charts2[msg.payload];\nchart.rtds.shiftdata = true;\nchart.rtds.AddDimension(\"score\", 0, 300);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":700,"y":1680,"wires":[["7d38b9d0.292d88"]]},{"id":"7d38b9d0.292d88","type":"function","z":"923bd7d5.f34fa8","name":"delay","func":"RT.Web.SetTiimeout(1000, function () {\n  var m = msg;\n  node.send([m]);  \n});\n//return msg;\nreturn null;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":150,"y":1740,"wires":[["e03392ee.0e966"]]},{"id":"e03392ee.0e966","type":"function","z":"923bd7d5.f34fa8","name":"json","func":"node.warn(\"MOPOP VIS C\");\nvar visData = \n{\n    \"UID\":\"\",\n    \"VisualisationType\":\"SCATTERPLOT\",\n    \"parallelCoordinatesDimensionsAttributes\":[],\n    \"parallelCoordinatesDimensionsMinFilter\":[],\n    \"parallelCoordinatesDimensionsMaxFilter\":[],\n    \"parallelCoordinatesDimensionsMinScale\":[],\n    \"parallelCoordinatesDimensionsMaxScale\":[],\n    \"Geometry\":4,\n    \"AxiesKeys\":[0,1],\n    \"AxiesValues\":[\"id\",\"score\"],\n    \"ColourDimension\":\"score\",\n    \"SizeDimension\":\"Undefined\",\n    \"LinkingDimension\":\"names\",\n    \"colourKeys\":\n    {\n        \"serializedVersion\":\"2\",\n        \"key0\":{\"r\":1.0,\"g\":0.0,\"b\":0.0,\"a\":1.0},\n        \"key1\":{\"r\":1.0,\"g\":0.0,\"b\":0.0,\"a\":1.0},\n        \"key2\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key3\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key4\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key5\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key6\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key7\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"ctime0\":0,\"ctime1\":65535,\"ctime2\":0,\"ctime3\":0,\"ctime4\":0,\"ctime5\":0,\"ctime6\":0,\"ctime7\":0,\n        \"atime0\":0,\"atime1\":65535,\"atime2\":0,\"atime3\":0,\"atime4\":0,\"atime5\":0,\"atime6\":0,\"atime7\":0,\n        \"m_Mode\":0,\n        \"m_NumColorKeys\":2,\n        \"m_NumAlphaKeys\":2\n    },\n    \"colour\":{\"r\":0.0,\"g\":0.0,\"b\":1.0,\"a\":0.5},\n    \"Size\":0.2,\n    \"MinSize\":0.04,\n    \"MaxSize\":0.2,\n    \"VisualisationWidth\":0.4,\n    \"VisualisationHeight\":0.4,\n    \"VisualisationDepth\":0.4\n};\nmsg.json = visData;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":310,"y":1740,"wires":[["495a9b25.99d2c4"]]},{"id":"495a9b25.99d2c4","type":"function","z":"923bd7d5.f34fa8","name":"apply json","func":"node.warn(\"MOPOP VIS D\");\n\nvar chartId = msg.payload;\nvar chart = MAIN.usercanvas.charts2[chartId];\n\nvar json = JSON.stringify(msg.json);\nchart.vis.theVisualizationObject.creationConfiguration.DeserializeJson(json);\nimportNamespace(\"IATK\").Replicator.SyncVis(chart.vis);\n\nchart.vis.updateProperties();\nchart.fctUpdateChart();\n\nnode.warn(\"SCORESC => Init Done!\");\nflow.set(\"mopop_score_chart_init\", true);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":460,"y":1740,"wires":[["cb80d96d.da1f28","5bdd9c4.1644b64"]]},{"id":"cb80d96d.da1f28","type":"debug","z":"923bd7d5.f34fa8","name":"create scores chart","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":650,"y":1780,"wires":[]},{"id":"5bdd9c4.1644b64","type":"function","z":"923bd7d5.f34fa8","name":"delay","func":"RT.Web.SetTiimeout(1000, function () {\n  var m = msg;\n  node.send([m]);  \n});\n//return msg;\nreturn null;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":630,"y":1740,"wires":[["f629e517.23dd68"]]},{"id":"f629e517.23dd68","type":"function","z":"923bd7d5.f34fa8","name":"move chart","func":"var hT = null;\nvar hR = null;\nvar hS = null;\nif(MAIN.location.data.mopop.hasOwnProperty(\"scoreChartPos\")) {\n    hT = MAIN.location.data.mopop.scoreChartPos.T;\n    hR = MAIN.location.data.mopop.scoreChartPos.R;\n    hS = MAIN.location.data.mopop.scoreChartPos.S;\n} else {\n    node.warn(\"SCORESC => default\");\n    hT = MAIN.camHookGo.transform.position;\n    hR = MAIN.camHookGo.transform.rotation;\n    hS = [1, 1, 1];\n}\n\nvar chartId = flow.get(\"mopop_score_chart\");\nvar chart = MAIN.usercanvas.charts2[chartId];\n\nvar T = [hT.x, hT.y, hT.z];\nvar R = [hR.x, hR.y, hR.z, hR.w];\nvar S = [hS.x, hS.y, hS.z];\nRT.Unity.SetPose(chart.chartGo, T, R, S);\n\n//MAIN_CreateLabel(mName, mTranslation, mRotation, mScale, mParent, mLabelText)\n\nMAIN_CreateLabel(\"score_label\", [0,1,0], [0,0,0,1], [0.001,0.001,0.001], chart.chartGo, \"Score: 0\");\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":810,"y":1740,"wires":[["9a44a838.9f2618"]]},{"id":"5c946bce.4916d4","type":"inject","z":"2e447439.f12bdc","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":140,"y":780,"wires":[["55c919f4.d7cfb8"]]},{"id":"55c919f4.d7cfb8","type":"function","z":"2e447439.f12bdc","name":"0 all","func":"var max = 0;\nvar min = 0;\n\nmax = 100;\nmin = 35;\nvar v1 = Math.random() * (max - min) + min;\n\n//var d = {\"HW_A\":{\"1956\":2},\"HW_B\":{}};\nvar d = {\n    \"2000\": {\n        \"val\":0,\n        \"id\":0\n    },\n    \"2001\": {\n        \"val\":0,\n        \"id\":1\n    },\n    \"2002\": {\n        \"val\":0,\n        \"id\":2\n    },\n    \"2003\": {\n        \"val\":0,\n        \"id\":3\n    },\n    \"2004\": {\n        \"val\":0,\n        \"id\":4\n    },\n    \"2005\": {\n        \"val\":0,\n        \"id\":5\n    },\n    \"2006\": {\n        \"val\":0,\n        \"id\":6\n    },\n    \"2007\": {\n        \"val\":0,\n        \"id\":7\n    },\n    \"2008\": {\n        \"val\":0,\n        \"id\":8\n    },\n    \"2009\": {\n        \"val\":0,\n        \"id\":9\n    }\n};\nmsg.payload = d;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":310,"y":780,"wires":[["54c545ed.84593c"]]},{"id":"b94842e4.654ad","type":"inject","z":"2e447439.f12bdc","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":140,"y":820,"wires":[["e7e03f84.dfac2"]]},{"id":"e7e03f84.dfac2","type":"function","z":"2e447439.f12bdc","name":"test 1","func":"var max = 0;\nvar min = 0;\n\nmax = 100;\nmin = 35;\nvar v1 = Math.random() * (max - min) + min;\n\n//var d = {\"HW_A\":{\"1956\":2},\"HW_B\":{}};\nvar d = {\n    \"2000\": {\n        \"val\":1,\n        \"id\":0\n    },\n    \"2001\": {\n        \"val\":5,\n        \"id\":1\n    },\n    \"2002\": {\n        \"val\":1,\n        \"id\":2\n    },\n    \"2003\": {\n        \"val\":1,\n        \"id\":3\n    },\n    \"2004\": {\n        \"val\":1,\n        \"id\":4\n    },\n    \"2005\": {\n        \"val\":1,\n        \"id\":5\n    },\n    \"2006\": {\n        \"val\":1,\n        \"id\":6\n    },\n    \"2007\": {\n        \"val\":1,\n        \"id\":7\n    },\n    \"2008\": {\n        \"val\":1,\n        \"id\":8\n    },\n    \"2009\": {\n        \"val\":3,\n        \"id\":9\n    }\n};\nmsg.payload = d;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":310,"y":820,"wires":[["54c545ed.84593c"]]},{"id":"d3fbf03a.133ad","type":"function","z":"923bd7d5.f34fa8","name":"client filter","func":"try {\n    var n = MAIN.usercanvas;\n    return msg;\n} catch(err) {\n    return null;\n}\nreturn null;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":480,"y":2440,"wires":[["6ee8a3d1.ff3f3c","8cd27c12.b0fb4"]]},{"id":"c295f022.931c5","type":"function","z":"923bd7d5.f34fa8","name":"client filter","func":"try {\n    var n = MAIN.usercanvas;\n    return msg;\n} catch(err) {\n    return null;\n}\nreturn null;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":520,"y":2540,"wires":[["24b91bde.60d394"]]},{"id":"29c20d47.9a01c2","type":"function","z":"923bd7d5.f34fa8","name":"store id","func":"flow.set(\"mopop_rockyear_chart\", msg.payload);\nflow.set(\"mopop_rockyear_chart_init\", false);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":700,"y":1920,"wires":[[]]},{"id":"987e9977.e94d88","type":"function","z":"923bd7d5.f34fa8","name":"store id","func":"flow.set(\"mopop_score_chart\", msg.payload);\nflow.set(\"mopop_score_chart_init\", false);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":680,"y":1640,"wires":[[]]},{"id":"a18a0815.b97978","type":"comment","z":"923bd7d5.f34fa8","name":"Init popyear vis","info":"","x":120,"y":2160,"wires":[]},{"id":"51875921.b2b608","type":"inject","z":"923bd7d5.f34fa8","name":"A","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":"10","topic":"","payload":"","payloadType":"date","x":110,"y":2200,"wires":[["636d5c55.ac9c04"]]},{"id":"9dab54db.af5098","type":"function","z":"923bd7d5.f34fa8","name":"apply position","func":"var hT = null;\nvar hR = null;\nvar hS = null;\nif(MAIN.location.data.mopop.hasOwnProperty(\"popChartPos\")) {\n    hT = MAIN.location.data.mopop.popChartPos.T;\n    hR = MAIN.location.data.mopop.popChartPos.R;\n    hS = MAIN.location.data.mopop.popChartPos.S;\n} else {\n    hT = MAIN.camHookGo.transform.position;\n    hR = MAIN.camHookGo.transform.rotation;\n    hS = [1, 1, 1];\n}\n\nvar chartId = flow.get(\"mopop_popyear_chart\");\nvar chart = MAIN.usercanvas.charts2[chartId];\n\nvar T = [hT.x, hT.y, hT.z];\nvar R = [hR.x, hR.y, hR.z, hR.w];\nvar S = [hS.x, hS.y, hS.z];\nRT.Unity.SetPose(chart.chartGo, T, R, S);\n\nMAIN_CreateLabel(\"pop_label\", [0,1,0], [0,0,0,1], [0.001,0.001,0.001], chart.chartGo, \"Pop distribution\");\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":280,"y":2320,"wires":[[]]},{"id":"636d5c55.ac9c04","type":"function","z":"923bd7d5.f34fa8","name":"client filter","func":"try {\n    var n = MAIN.usercanvas;\n    return msg;\n} catch(err) {\n    return null;\n}\nreturn null;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":260,"y":2200,"wires":[["11fadcfb.10e533"]]},{"id":"11fadcfb.10e533","type":"function","z":"923bd7d5.f34fa8","name":"Create Empty Vis","func":"node.warn(\"MOPOP VIS A\");\n\nvar nextId = RT.Help.CreateGuid();\nvar chart = RT.VIS.GetNewChartObjectIATK2(\n    nextId, 0, \"IATKChart\", 0.4, 0.2, false);\n\n//store chart object\nMAIN.usercanvas.charts2[nextId] = chart;\n\nflow.set(\"popChartGoName\", chart.chartGoName);\n\n//allow movement\nMAIN.RR.Runtime.ToggleObjManipulation(chart.chartGoName);\nvar bc = MAIN.RR.Runtime.AddBoxCollider(chart.chartGo);\nbc.size = new MAIN.UE.Vector3(0.3, 0.3, 0.3);\n\nmsg.payload = nextId;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":450,"y":2200,"wires":[["eaaee5.f9435118","1028576f.246579"]]},{"id":"eaaee5.f9435118","type":"function","z":"923bd7d5.f34fa8","name":"add dimensions","func":"node.warn(\"MOPOP VIS B\");\nvar chart = MAIN.usercanvas.charts2[msg.payload];\nchart.rtds.AddStringDimension(\"year\");\nchart.rtds.AddDimension(\"count\", 0, 10);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":700,"y":2200,"wires":[["e8c26df3.bb6c5"]]},{"id":"e8c26df3.bb6c5","type":"function","z":"923bd7d5.f34fa8","name":"delay test","func":"RT.Web.SetTiimeout(1000, function () {\n  var m = msg;\n  node.send([m]);  \n});\n//return msg;\nreturn null;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":260,"y":2260,"wires":[["bda074ab.53e6a8"]]},{"id":"bda074ab.53e6a8","type":"function","z":"923bd7d5.f34fa8","name":"json","func":"node.warn(\"MOPOP VIS C\");\nvar visData = \n{\n    \"UID\":\"\",\n    \"VisualisationType\":\"SCATTERPLOT\",\n    \"parallelCoordinatesDimensionsAttributes\":[],\n    \"parallelCoordinatesDimensionsMinFilter\":[],\n    \"parallelCoordinatesDimensionsMaxFilter\":[],\n    \"parallelCoordinatesDimensionsMinScale\":[],\n    \"parallelCoordinatesDimensionsMaxScale\":[],\n    \"Geometry\":6,\n    \"AxiesKeys\":[0,1],\n    \"AxiesValues\":[\"year\",\"count\"],\n    \"ColourDimension\":\"year\",\n    \"SizeDimension\":\"Undefined\",\n    \"LinkingDimension\":\"Undefined\",\n    \"colourKeys\":\n    {\n        \"serializedVersion\":\"2\",\n        \"key0\":{\"r\":1.0,\"g\":0.0,\"b\":0.0,\"a\":1.0},\n        \"key1\":{\"r\":0.0,\"g\":1.0,\"b\":0.0,\"a\":0.5},\n        \"key2\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key3\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key4\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key5\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key6\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"key7\":{\"r\":0.0,\"g\":0.0,\"b\":0.0,\"a\":0.0},\n        \"ctime0\":0,\"ctime1\":65535,\"ctime2\":0,\"ctime3\":0,\"ctime4\":0,\"ctime5\":0,\"ctime6\":0,\"ctime7\":0,\n        \"atime0\":0,\"atime1\":65535,\"atime2\":0,\"atime3\":0,\"atime4\":0,\"atime5\":0,\"atime6\":0,\"atime7\":0,\n        \"m_Mode\":0,\n        \"m_NumColorKeys\":2,\n        \"m_NumAlphaKeys\":2\n    },\n    \"colour\":{\"r\":0.0,\"g\":0.0,\"b\":1.0,\"a\":0.5},\n    \"Size\":0.6,\n    \"MinSize\":0.04,\n    \"MaxSize\":0.2,\n    \"VisualisationWidth\":0.4,\n    \"VisualisationHeight\":0.4,\n    \"VisualisationDepth\":0.4\n};\nmsg.json = visData;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":410,"y":2260,"wires":[["5f941816.8cc388"]]},{"id":"5f941816.8cc388","type":"function","z":"923bd7d5.f34fa8","name":"apply json","func":"node.warn(\"MOPOP VIS D\");\nvar chartId = msg.payload;\n\nvar chart = MAIN.usercanvas.charts2[chartId];\nvar json = JSON.stringify(msg.json);\nchart.vis.theVisualizationObject.creationConfiguration.DeserializeJson(json);\nimportNamespace(\"IATK\").Replicator.SyncVis(chart.vis);\nchart.fctUpdateChart();\nchart.vis.updateProperties();\n\nflow.set(\"mopop_popyear_chart_init\", true);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":560,"y":2260,"wires":[["f8a65a35.2be8a8"]]},{"id":"f8a65a35.2be8a8","type":"function","z":"923bd7d5.f34fa8","name":"setup years","func":"node.warn(\"MOPOP VIS E\");\n\nvar chartId = flow.get(\"mopop_popyear_chart\");\nvar chart = MAIN.usercanvas.charts2[chartId];\n\nvar N = 10;\n\nchart.rtds.SetDimensionMinMax(\"year\", 0, N);\nfor(var i = 0; i < N; i++) {\n    var y = 1990 + i;\n    var yStr = \"Y \" + y;\n    chart.rtds.SetDataStrStrById(\"year\", \"\" + (1990 + i), i);\n}\n\nchart.vis.updateProperties();\nchart.fctUpdateChart();\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":730,"y":2260,"wires":[["9dab54db.af5098"]]},{"id":"1028576f.246579","type":"function","z":"923bd7d5.f34fa8","name":"store id","func":"flow.set(\"mopop_popyear_chart\", msg.payload);\nflow.set(\"mopop_popyear_chart_init\", false);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":680,"y":2160,"wires":[[]]},{"id":"7800c92c.5908f8","type":"mqtt out","z":"2e447439.f12bdc","name":"","topic":"MOPOP/wallyearhist/popwall","qos":"0","retain":"false","broker":"73e9a24f.21590c","x":700,"y":940,"wires":[]},{"id":"58d33317.20936c","type":"inject","z":"2e447439.f12bdc","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":140,"y":880,"wires":[["78890c65.7b2b34"]]},{"id":"78890c65.7b2b34","type":"function","z":"2e447439.f12bdc","name":"","func":"var max = 0;\nvar min = 0;\n\nmax = 100;\nmin = 35;\nvar v1 = Math.random() * (max - min) + min;\n\n//var d = {\"HW_A\":{\"1956\":2},\"HW_B\":{}};\nvar d = {\n    \"2000\": {\n        \"val\":1,\n        \"id\":0\n    }, \n    \"2004\":{\n        \"val\":2,\n        \"id\":4\n    },\n    \"2005\":{\n        \"val\":3,\n        \"id\":5\n    }\n};\nmsg.payload = d;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":320,"y":880,"wires":[["7800c92c.5908f8"]]},{"id":"c8dd77d1.45d3a8","type":"inject","z":"2e447439.f12bdc","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":140,"y":920,"wires":[["fa93e495.94fa88"]]},{"id":"fa93e495.94fa88","type":"function","z":"2e447439.f12bdc","name":"","func":"var max = 0;\nvar min = 0;\n\nmax = 100;\nmin = 35;\nvar v1 = Math.random() * (max - min) + min;\n\n//var d = {\"HW_A\":{\"1956\":2},\"HW_B\":{}};\nvar d = {\n    \"2000\": {\n        \"val\":2,\n        \"id\":0\n    }, \n    \"2004\":{\n        \"val\":6,\n        \"id\":4\n    },\n    \"2017\":{\n        \"val\":1,\n        \"id\":7\n    },\n    \"2018\":{\n        \"val\":2,\n        \"id\":7\n    }\n};\nmsg.payload = d;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":320,"y":920,"wires":[["7800c92c.5908f8"]]},{"id":"2dc9fe3f.e11ec2","type":"inject","z":"2e447439.f12bdc","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":140,"y":960,"wires":[["86a1bea4.70fd9"]]},{"id":"86a1bea4.70fd9","type":"function","z":"2e447439.f12bdc","name":"0 all","func":"var max = 0;\nvar min = 0;\n\nmax = 100;\nmin = 35;\nvar v1 = Math.random() * (max - min) + min;\n\n//var d = {\"HW_A\":{\"1956\":2},\"HW_B\":{}};\nvar d = {\n    \"2000\": {\n        \"val\":0,\n        \"id\":0\n    },\n    \"2001\": {\n        \"val\":0,\n        \"id\":1\n    },\n    \"2002\": {\n        \"val\":0,\n        \"id\":2\n    },\n    \"2003\": {\n        \"val\":0,\n        \"id\":3\n    },\n    \"2004\": {\n        \"val\":0,\n        \"id\":4\n    },\n    \"2005\": {\n        \"val\":0,\n        \"id\":5\n    },\n    \"2006\": {\n        \"val\":0,\n        \"id\":6\n    },\n    \"2007\": {\n        \"val\":0,\n        \"id\":7\n    },\n    \"2008\": {\n        \"val\":0,\n        \"id\":8\n    },\n    \"2009\": {\n        \"val\":0,\n        \"id\":9\n    }\n};\nmsg.payload = d;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":310,"y":960,"wires":[["7800c92c.5908f8"]]},{"id":"8201b47.87fc748","type":"inject","z":"2e447439.f12bdc","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":140,"y":1000,"wires":[["6a8689c8.a45048"]]},{"id":"6a8689c8.a45048","type":"function","z":"2e447439.f12bdc","name":"test 1","func":"var max = 0;\nvar min = 0;\n\nmax = 100;\nmin = 35;\nvar v1 = Math.random() * (max - min) + min;\n\n//var d = {\"HW_A\":{\"1956\":2},\"HW_B\":{}};\nvar d = {\n    \"2000\": {\n        \"val\":1,\n        \"id\":0\n    },\n    \"2001\": {\n        \"val\":5,\n        \"id\":1\n    },\n    \"2002\": {\n        \"val\":1,\n        \"id\":2\n    },\n    \"2003\": {\n        \"val\":1,\n        \"id\":3\n    },\n    \"2004\": {\n        \"val\":1,\n        \"id\":4\n    },\n    \"2005\": {\n        \"val\":1,\n        \"id\":5\n    },\n    \"2006\": {\n        \"val\":1,\n        \"id\":6\n    },\n    \"2007\": {\n        \"val\":1,\n        \"id\":7\n    },\n    \"2008\": {\n        \"val\":1,\n        \"id\":8\n    },\n    \"2009\": {\n        \"val\":3,\n        \"id\":9\n    }\n};\nmsg.payload = d;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":310,"y":1000,"wires":[["7800c92c.5908f8"]]},{"id":"a6b738df.f418f8","type":"function","z":"923bd7d5.f34fa8","name":"apply data","func":"/*\nvar d = {\n    \"2000\": {\n        \"val\":2,\n        \"id\":1\n    }, \n    \"2004\":{\n        \"val\":6,\n        \"id\":5\n    },\n    \"2018\":{\n        \"val\":3,\n        \"id\":6\n    }\n};\n*/\n\nvar data = msg.payload;\nvar score = data.score;\nvar chartId = flow.get(\"mopop_popyear_chart\");\nvar chart = MAIN.usercanvas.charts2[chartId];\n\nvar keys = Object.keys(data);\nfor(var i = 0; i < keys.length; i++) {\n    node.warn(\"MOPOP VIS hist => key: \" + key);\n    var key = keys[i];\n    var entry = data[key];\n    var id = entry.id;\n    var v = entry.val;\n    node.warn(\"MOPOP VIS hist => \" + id + \" / \" + v);\n    chart.rtds.SetDataStrValById(\"count\", v, id);\n}\n\nchart.vis.updateProperties(); //for testing\nchart.fctUpdateChart();\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":670,"y":2640,"wires":[["27a9e67a.4b0e6a"]]},{"id":"27a9e67a.4b0e6a","type":"debug","z":"923bd7d5.f34fa8","name":"K","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":810,"y":2640,"wires":[]},{"id":"e49adecb.23e6f","type":"function","z":"923bd7d5.f34fa8","name":"to object","func":"node.warn(\"MOPOP VIS wallscore => \" + msg.payload);\nvar data = JSON.parse(msg.payload);\nmsg.payload = data;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":380,"y":2640,"wires":[["42f77163.a124d"]]},{"id":"9bdcdab2.432a68","type":"mqtt in","z":"923bd7d5.f34fa8","name":"","topic":"MOPOP/wallyearhist/popwall","qos":"0","datatype":"auto","broker":"73e9a24f.21590c","x":140,"y":2640,"wires":[["6859dc2e.d775c4","e49adecb.23e6f"]]},{"id":"6859dc2e.d775c4","type":"debug","z":"923bd7d5.f34fa8","name":"dbg score A","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":410,"y":2680,"wires":[]},{"id":"42f77163.a124d","type":"function","z":"923bd7d5.f34fa8","name":"client filter","func":"try {\n    var n = MAIN.usercanvas;\n    return msg;\n} catch(err) {\n    return null;\n}\nreturn null;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":520,"y":2640,"wires":[["a6b738df.f418f8"]]},{"id":"49a90c22.d4c9b4","type":"function","z":"923bd7d5.f34fa8","name":"","func":"//{\"TrackableName\":\"16325654015\",\"TrackedGoName\":\"VIT-6-16325654015\",\"goName\":\"Test16325654015\",\"wuName\":\"UI16325654015\"}\n//15758985189\nvar mTrackableName = \"15758985189\";\nvar mTrackedGoName = \"VIT-22-15758985189\";\nnode.send([{ \"payload\":{ \"trackableName\" : mTrackableName, \"trackedGoName\": mTrackedGoName}}]);\n\nreturn null;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":340,"y":700,"wires":[["a467cb07.b22128"]]},{"id":"94be9a6a.409d88","type":"inject","z":"923bd7d5.f34fa8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":140,"y":700,"wires":[["49a90c22.d4c9b4"]]},{"id":"a467cb07.b22128","type":"mqtt out","z":"923bd7d5.f34fa8","name":"","topic":"MOPOP/trackedtest","qos":"0","retain":"false","broker":"73e9a24f.21590c","x":561,"y":700,"wires":[]},{"id":"c169fdc.5c534","type":"comment","z":"923bd7d5.f34fa8","name":"Testing","info":"","x":90,"y":580,"wires":[]},{"id":"27bf91b4.73438e","type":"mqtt in","z":"923bd7d5.f34fa8","name":"","topic":"MOPOP/trackedtest","qos":"0","datatype":"auto","broker":"73e9a24f.21590c","x":610,"y":760,"wires":[["dadefbc8.17dac8"]]},{"id":"ee9f1ca7.feaf5","type":"function","z":"923bd7d5.f34fa8","name":"","func":"//{\"TrackableName\":\"16325654015\",\"TrackedGoName\":\"VIT-6-16325654015\",\"goName\":\"Test16325654015\",\"wuName\":\"UI16325654015\"}\n//15758985189\nvar mTrackableName = \"15389896507\";\nvar mTrackedGoName = \"VIT-23-15389896507\";\nnode.send([{ \"payload\":{ \"trackableName\" : mTrackableName, \"trackedGoName\": mTrackedGoName}}]);\n\nreturn null;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":340,"y":660,"wires":[["a467cb07.b22128"]]},{"id":"a605f584.2289a8","type":"inject","z":"923bd7d5.f34fa8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":140,"y":660,"wires":[["ee9f1ca7.feaf5"]]},{"id":"463ef086.ab7d","type":"ui_list","z":"615cd8c9.e4e9f8","group":"5639fe60.0e244","name":"","order":1,"width":6,"height":10,"lineType":"three","actionType":"click","allowHTML":false,"outputs":1,"topic":"","x":790,"y":240,"wires":[["c0accad9.9c7228","4bcefeeb.255f9"]]},{"id":"9c95b2bc.9f3dc","type":"function","z":"615cd8c9.e4e9f8","name":"testing list data","func":"var a1 = {};\na1.title = \"A1\";\na1.description = \"A1 long\";\na1.id=\"12134\";\n\nvar a2 = {};\na2.title = \"A2\";\na2.description = \"A2 long\";\na2.id=\"143655\";\n\nvar a3 = {};\na3.title = \"A3\";\na3.description = \"A3 long\";\na3.id=\"a2342\";\n\nmsg.payload = [a1, a2, a3];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":600,"y":300,"wires":[["463ef086.ab7d"]]},{"id":"98ddf5ea.428358","type":"inject","z":"615cd8c9.e4e9f8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":420,"y":300,"wires":[["9c95b2bc.9f3dc"]]},{"id":"c0accad9.9c7228","type":"debug","z":"615cd8c9.e4e9f8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":970,"y":280,"wires":[]},{"id":"5c012e63.b7385","type":"comment","z":"615cd8c9.e4e9f8","name":"records list","info":"","x":140,"y":200,"wires":[]},{"id":"3718c243.c41fde","type":"ui_list","z":"615cd8c9.e4e9f8","group":"efe01547.5b7098","name":"","order":1,"width":6,"height":10,"lineType":"three","actionType":"click","allowHTML":false,"outputs":1,"topic":"","x":1150,"y":580,"wires":[["244dfdff.932552","4bcefeeb.255f9"]]},{"id":"c70eddcc.2cc62","type":"function","z":"615cd8c9.e4e9f8","name":"","func":"var a1 = {};\na1.title = \"A1\";\na1.description = \"A1 long\";\n\nvar a2 = {};\na2.title = \"A2\";\na2.description = \"A2 long\";\n\nvar a3 = {};\na3.title = \"A3\";\na3.description = \"A3 long\";\n\nmsg.payload = [a1, a2, a3];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":980,"y":580,"wires":[["3718c243.c41fde"]]},{"id":"e2612625.0c21f8","type":"inject","z":"615cd8c9.e4e9f8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":800,"y":580,"wires":[["c70eddcc.2cc62"]]},{"id":"244dfdff.932552","type":"debug","z":"615cd8c9.e4e9f8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1330,"y":580,"wires":[]},{"id":"9bb37d3b.83ca9","type":"comment","z":"615cd8c9.e4e9f8","name":"occupation list","info":"","x":800,"y":540,"wires":[]},{"id":"8cd27c12.b0fb4","type":"function","z":"923bd7d5.f34fa8","name":"update score label","func":"\nvar data = msg.payload;\nvar score = data.score;\n\nvar labelname = \"score_label\";\n\nvar PUI = importNamespace(\"PowerUI\");\nvar wu = PUI.WorldUI.Find(labelname);\n\nif (wu != null) {\n    //wu.document.Run(\"document.\",[\"\"]);\n    //wu.document.getElementById(\"thislabel\").innerHTML = \"Score: \" + score;\n    //wu.document.Run(\"document.getElementById('thislabel').innerHTML = 'Score: '\" + score + \";\",[\"\"]);\n    //wu.document.Run(\"eval\",[\"document.getElementById('thislabel').innerHTML = 'Score: '\" + score + \";\"]);\n    wu.document.getElementById(\"thislabel\").innerHTML = \"Score: \" + score.toFixed(2);\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":690,"y":2400,"wires":[[]]},{"id":"9a3e8eb2.23fe5","type":"function","z":"615cd8c9.e4e9f8","name":"parse query from parameters","func":"var coverid = msg.payload.coverid;\n\nvar query = \n\"SELECT \\\nCONCAT(a.name, ' (', a.genre, ')') as title, \\\nb.name AS description, \\\nb.name AS artist, \\\na.name AS song, \\\na.coverid AS coverid, \\\na.coverart AS coverart, \\\na.published AS publishdate, \\\na.publisher AS publisher, \\\nb.score AS score, \\\na.soldcopies AS soldcopies, \\\na.genre AS genre \\\nFROM \\\nmopop.works a, \\\nmopop.artists b \\\nWHERE 1=1 \\\n  AND a.artistid = b.id \\\nORDER BY a.name ASC \\\n\"\n;\n//CONCAT(a.name, ', ', b.name) as title \\\n// \"AND a.coverid = '\" + coverid + \"'\" + \" \"\nmsg.payload = query;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":370,"y":240,"wires":[["f24a8ffa.3560d"]]},{"id":"f24a8ffa.3560d","type":"postgres","z":"615cd8c9.e4e9f8","postgresdb":"20ba6cdb.ae7474","name":"","output":true,"perrow":false,"rowspermsg":"1","outputs":1,"x":620,"y":240,"wires":[["c305e84a.3d7c38","463ef086.ab7d","608b6c7a.69a0e4","3187f89b.272298","862c3783.b01048"]]},{"id":"720b7c35.8c8774","type":"inject","z":"615cd8c9.e4e9f8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"1","topic":"","payload":"","payloadType":"date","x":150,"y":240,"wires":[["9a3e8eb2.23fe5","ed91b465.3c73a8"]]},{"id":"c305e84a.3d7c38","type":"debug","z":"615cd8c9.e4e9f8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":810,"y":200,"wires":[]},{"id":"bf74bc1a.260b8","type":"ui_text","z":"615cd8c9.e4e9f8","group":"616933a4.93a86c","order":11,"width":6,"height":1,"name":"","label":"Artist","format":"{{msg.payload.artist}}","layout":"row-spread","x":1350,"y":160,"wires":[]},{"id":"f85b98c2.c65d08","type":"ui_text","z":"615cd8c9.e4e9f8","group":"616933a4.93a86c","order":10,"width":6,"height":1,"name":"","label":"Song","format":"{{msg.payload.song}}","layout":"row-spread","x":1350,"y":200,"wires":[]},{"id":"10b5b4b0.24b1fb","type":"ui_text","z":"615cd8c9.e4e9f8","group":"616933a4.93a86c","order":15,"width":6,"height":1,"name":"","label":"Year","format":"{{msg.payload}}","layout":"row-spread","x":1350,"y":240,"wires":[]},{"id":"bae9c6a4.5453a8","type":"ui_text","z":"615cd8c9.e4e9f8","group":"616933a4.93a86c","order":14,"width":6,"height":1,"name":"","label":"Score","format":"{{msg.payload.score}}","layout":"row-spread","x":1350,"y":280,"wires":[]},{"id":"841fb05d.030ef","type":"ui_text","z":"615cd8c9.e4e9f8","group":"616933a4.93a86c","order":12,"width":6,"height":1,"name":"","label":"Genre","format":"{{msg.payload.genre}}","layout":"row-spread","x":1350,"y":320,"wires":[]},{"id":"4bcefeeb.255f9","type":"function","z":"615cd8c9.e4e9f8","name":"","func":"//msg.payload = msg.payload[0];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":960,"y":240,"wires":[["bf74bc1a.260b8","f85b98c2.c65d08","bae9c6a4.5453a8","841fb05d.030ef","1af2e5ab.2ca6da","22a382e8.1cbeee","e19cedb3.b990c"]]},{"id":"1af2e5ab.2ca6da","type":"function","z":"615cd8c9.e4e9f8","name":"","func":"msg.payload = new Date(msg.payload.publishdate).getFullYear();\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1200,"y":240,"wires":[["10b5b4b0.24b1fb"]]},{"id":"22a382e8.1cbeee","type":"ui_text","z":"615cd8c9.e4e9f8","group":"616933a4.93a86c","order":13,"width":6,"height":1,"name":"","label":"Sold","format":"{{msg.payload.soldcopies}}","layout":"row-spread","x":1350,"y":360,"wires":[]},{"id":"e19cedb3.b990c","type":"function","z":"615cd8c9.e4e9f8","name":"","func":"var coverid = msg.payload.coverid;\nvar coverart = msg.payload.coverart;\n\n//var fn = \"/ragrug_mnt/uploads/\" + coverart;\n//var fn = \"http://10.0.0.2:8080/\" + coverart;\nvar fn = \"http://129.27.186.88:8080/\" + coverart;\n\nmsg.payload = fn;\nmsg.payload.link = fn;\nmsg.link = fn;\nmsg.payload.file = fn;\nmsg.payload.filename = fn;\nmsg.file = fn;\nmsg.filename = fn;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1180,"y":400,"wires":[["f9880875.7484f8"]]},{"id":"f9880875.7484f8","type":"ui_template","z":"615cd8c9.e4e9f8","group":"616933a4.93a86c","name":"","order":2,"width":4,"height":4,"format":"<img src=\"{{msg.payload}}\" width=\"200px\" height=\"200px\"/>\n","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","x":1340,"y":400,"wires":[[]]},{"id":"b00867ba.647088","type":"mqtt in","z":"2e447439.f12bdc","name":"","topic":"MOPOP/debug","qos":"0","datatype":"auto","broker":"73e9a24f.21590c","x":760,"y":600,"wires":[["112f0b98.aac8f4"]]},{"id":"112f0b98.aac8f4","type":"debug","z":"2e447439.f12bdc","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":990,"y":600,"wires":[]},{"id":"e2b65334.e2b62","type":"comment","z":"2e447439.f12bdc","name":"Mopop cnr debug","info":"","x":720,"y":560,"wires":[]},{"id":"b85f9729.a2cb68","type":"comment","z":"615cd8c9.e4e9f8","name":"backup","info":"","x":150,"y":80,"wires":[]},{"id":"a0877054.259b4","type":"inject","z":"615cd8c9.e4e9f8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":320,"y":80,"wires":[[]]},{"id":"351f4e5c.5a2b72","type":"inject","z":"615cd8c9.e4e9f8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"2","topic":"","payload":"","payloadType":"date","x":320,"y":120,"wires":[[]]},{"id":"2dbddb71.1da194","type":"function","z":"615cd8c9.e4e9f8","name":"Auto start Mopop in curator mode","func":"//node.warn(\"MCNR before calling MCNR_TestFunc\");\n//MCNR_TestFunc();\n//node.warn(\"MCNR after calling MCNR_TestFunc\");\n\n//node.warn(\"MCNR before calling MOPOP_InitEnv\");\n//MOPOP_InitEnv();\n//node.warn(\"MCNR after calling MOPOP_InitEnv\");\n\nnode.warn(\"Auto starting MOPOP ...\");\n$(\"#rr_mopop_u_started\").hide();\n        var murl = MAIN.WEBAPI.uiurl + \"/mopop/mopop-opening.jpg\";\n        $(\"#rr_mopop_u_started\").html('<img src=\"' + murl + '\" width=\"100%\" />');\n        $(\"#rr_mopop_u_started\").show();\n        RT.Web.SetTiimeout(8000, function () {\n            importNamespace(\"Vizario\").AssetBundleHolder.ImportFromFile(\n                MAIN.location.envassetbundle, MAIN.location.envassetbundle);\n            MOPOP_AutoStart();\n        });\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":550,"y":120,"wires":[[]]},{"id":"45b274ba.dc291c","type":"function","z":"615cd8c9.e4e9f8","name":"MOPOP Lib","func":"/// 2021 By Philipp Fleck\n///\n/// MOPOP Start here\n///\n\n//occupant\n// {\"TrackableName\":\"2805595956\",\"TrackedGoName\":\"VIT-13-2805595956\",\"goName\":\"Test2805595956\",\"wuName\":\"UI2805595956\"}\n//hookwall\n//{ \"HW_A\": { \"name\": \"HW_A\", \"hooks\": { \"HW_A_0_0\": { \"isOccupied\": false, \"occupante\": null }, \"HW_A_1_0\": { \"isOccupied\": false, \"occupante\": null }, \"HW_A_2_0\": { \"isOccupied\": false, \"occupante\": null }, \"HW_A_3_0\": { \"isOccupied\": false, \"occupante\": null }, \"HW_A_0_1\": { \"isOccupied\": false, \"occupante\": null }, \"HW_A_1_1\": { \"isOccupied\": false, \"occupante\": null }, \"HW_A_2_1\": { \"isOccupied\": false, \"occupante\": null }, \"HW_A_3_1\": { \"isOccupied\": false, \"occupante\": null }, \"HW_A_0_2\": { \"isOccupied\": false, \"occupante\": null }, \"HW_A_1_2\": { \"isOccupied\": false, \"occupante\": null }, \"HW_A_2_2\": { \"isOccupied\": false, \"occupante\": null }, \"HW_A_3_2\": { \"isOccupied\": false, \"occupante\": null } } }, \"HW_B\": { \"name\": \"HW_B\", \"hooks\": { \"HW_B_0_0\": { \"isOccupied\": false, \"occupante\": null }, \"HW_B_1_0\": { \"isOccupied\": false, \"occupante\": null }, \"HW_B_2_0\": { \"isOccupied\": false, \"occupante\": null }, \"HW_B_3_0\": { \"isOccupied\": false, \"occupante\": null }, \"HW_B_0_1\": { \"isOccupied\": false, \"occupante\": null }, \"HW_B_1_1\": { \"isOccupied\": false, \"occupante\": null }, \"HW_B_2_1\": { \"isOccupied\": false, \"occupante\": null }, \"HW_B_3_1\": { \"isOccupied\": false, \"occupante\": null }, \"HW_B_0_2\": { \"isOccupied\": false, \"occupante\": null }, \"HW_B_1_2\": { \"isOccupied\": false, \"occupante\": null }, \"HW_B_2_2\": { \"isOccupied\": false, \"occupante\": null }, \"HW_B_3_2\": { \"isOccupied\": false, \"occupante\": null } } } }\n\n\n/**\n * @typedef {Object} aHookwall\n * @property {string} name\n * @property {Object.<string,aHook>}       hooks\n * \n*/\n\n/**\n * @typedef {Object} aHook\n * @property {boolean} isOccupied\n * @property {aOccupant} occupant\n*/\n\n/**\n * @typedef {Object} aOccupant\n * @property {string} TrackableName\n * @property {string} TrackedGoName\n * @property {string} goName\n * @property {string} wuName\n*/\n/**\n * @typedef {Object} aTemptable \n * @property {string} name\n * @property {Object.<string,aHook>} hooks\n */\n\n/**\n * @typedef {Object} aMOPOP\n * @property {aOccupant} picked \n * @property {Object.<string,aHookwall>} hookwall\n * @property {Object.<string,aHook>} hookwall.hooks\n * @property {Object.<string,aTemptable>} temptable\n * @property {Object.<string,Onject>} artefacts\n * @property {ChartDataIATK} scorechart\n * @property {ChartDataIATK} [scorechart]\n * @property {Object.<string,string>} topics \n * @property {Object.<string,ChartDataIATK>} yearcharts\n * @property {number} startyear\n * @property {number} endyear\n * @property {string} user\n * @property {Object} info\n * @property {string[]} infopicks\n * @property {function(string):void} AddInfoPick\n */\n\n/** \n * @type {aMOPOP}\n * */\nvar MOPOP = {};\nMOPOP.picked = null;\nMOPOP.hookwall = {};\nMOPOP.temptable = {};\nMOPOP.artefacts = {};\nMOPOP.scorechart = null;\nMOPOP.infochart = null;\nMOPOP.topics = {\n    \"wallscore\": \"MOPOP/wallscore\",\n    \"wallyearhist\": \"MOPOP/wallyearhist\",\n    \"infocompare\": \"MOPOP/infocompare\"\n}\nMOPOP.yearcharts = {};\nMOPOP.startyear = 0;\nMOPOP.endyear = 0;\n\nMOPOP.user = \"NOTSET\";\n\nMOPOP.info = {};\nMOPOP.infopicks = [];\n/**\n * \n * @param {string} mArtefactId\n */\nMOPOP.AddInfoPick = function (mArtefactId) {\n    var artefact = MOPOP.artefacts[mArtefactId];\n    MOPOP.infopicks.push(artefact);\n    if (MOPOP.infopicks.length > 3) {\n        MOPOP.infopicks.shift();\n    }\n}\n\n/*\n * Not used anymore\nfunction MOPOP_Register(mMode) {\n    myconsolelog(\"MOPOP_Register mMode = \" + mMode);\n\n    if (mMode == \"STORAGEA\") {\n        var go = MAIN.UE.GameObject.Find(\"ENV_storage_a\");\n        if (go == null) {\n            MOPOP_LoadFromEnv(\"ENV_storage_a\", \"Shelf\");\n        }\n    }\n\n    if (mMode == \"STORAGEB\") {\n        var go = MAIN.UE.GameObject.Find(\"ENV_storage_b\");\n        if (go == null) {\n            MOPOP_LoadFromEnv(\"ENV_storage_b\", \"Shelf\");\n        }\n    }\n\n    if (mMode == \"STORAGEB\") {\n        var go = MAIN.UE.GameObject.Find(\"ENV_storage_b\");\n        if (go == null) {\n            MOPOP_LoadFromEnv(\"ENV_storage_b\", \"Shelf\");\n        }\n    }\n\n    if (mMode == \"TABLETOP\") {\n        var go = MAIN.UE.GameObject.Find(\"ENV_tabletop\");\n        if (go == null) {\n            MOPOP_LoadFromEnv(\"ENV_tabletop\", \"TableTop\");\n        }\n    }\n\n    if (mMode == \"HOOKWALLA\") {\n        var go = MAIN.UE.GameObject.Find(\"ENV_hookwall_a\");\n        if (go == null) {\n            MOPOP_LoadFromEnv(\"ENV_hookwall_a\", \"HookWall\");\n        }\n    }\n\n    if (mMode == \"HOOKWALLB\") {\n        var go = MAIN.UE.GameObject.Find(\"ENV_hookwall_b\");\n        if (go == null) {\n            MOPOP_LoadFromEnv(\"ENV_hookwall_b\", \"HookWall\");\n        }\n    }\n}\n*/\n\n/*\n * Not used anymore\nfunction MOPOP_LoadFromEnv(mName, mAssetName) {\n    // Shelf\n    // TableTop\n    // HookWall\n    myconsolelog(\"MOPOP_SetWall ...\");\n    try {\n        var VZ = importNamespace(\"Vizario\");\n\n        myconsolelog(\"MOPOP_SetWall ... 1\");\n\n        var go = VZ.AssetBundleHolder.InstantiateGameObject(MAIN.location.envassetbundle, mAssetName);\n\n        myconsolelog(\"MOPOP_SetWall ... 2\");\n\n        if (go != null) {\n            go.name = mName;\n\n            myconsolelog(\"MOPOP_SetWall ... 3 \" + go);\n            var c = importNamespace(\"RR\").Runtime.ToggleObjManipulation(go.name);\n        }\n\n        myconsolelog(\"MOPOP_SetWall ... 4\");\n    } catch (err) {\n        myconsolelog(\"MOPOP_SetWall ERROR => \" + err);\n    }\n}\n*/\n\nfunction MOPOP_CalcScore() {\n    myconsolelog(\"MOPOP_CalcScore ... \");\n    //MOPOP.hookwall[dObj.hookWall].hooks[dObj.tileGoName];\n    //MOPOP.hookwall[hGoName].hooks[go.name] = {\n    //    \"isOccupied\": false,\n    //    \"occupante\": null\n    //};\n\n    var walls = MOPOP.hookwall;\n\n    /*var test = { \"HW_A\": { \"name\": \"HW_A\", \"hooks\": { \"HW_A_0_0\": { \"isOccupied\": false, \"occupante\": null }, \"HW_A_1_0\": { \"isOccupied\": false, \"occupante\": null }, \"HW_A_2_0\": { \"isOccupied\": false, \"occupante\": null }, \"HW_A_3_0\": { \"isOccupied\": false, \"occupante\": null }, \"HW_A_0_1\": { \"isOccupied\": false, \"occupante\": null }, \"HW_A_1_1\": { \"isOccupied\": false, \"occupante\": null }, \"HW_A_2_1\": { \"isOccupied\": false, \"occupante\": null }, \"HW_A_3_1\": { \"isOccupied\": false, \"occupante\": null }, \"HW_A_0_2\": { \"isOccupied\": false, \"occupante\": null }, \"HW_A_1_2\": { \"isOccupied\": false, \"occupante\": null }, \"HW_A_2_2\": { \"isOccupied\": false, \"occupante\": null }, \"HW_A_3_2\": { \"isOccupied\": false, \"occupante\": null } } }, \"HW_B\": { \"name\": \"HW_B\", \"hooks\": { \"HW_B_0_0\": { \"isOccupied\": false, \"occupante\": null }, \"HW_B_1_0\": { \"isOccupied\": false, \"occupante\": null }, \"HW_B_2_0\": { \"isOccupied\": false, \"occupante\": null }, \"HW_B_3_0\": { \"isOccupied\": false, \"occupante\": null }, \"HW_B_0_1\": { \"isOccupied\": false, \"occupante\": null }, \"HW_B_1_1\": { \"isOccupied\": false, \"occupante\": null }, \"HW_B_2_1\": { \"isOccupied\": false, \"occupante\": null }, \"HW_B_3_1\": { \"isOccupied\": false, \"occupante\": null }, \"HW_B_0_2\": { \"isOccupied\": false, \"occupante\": null }, \"HW_B_1_2\": { \"isOccupied\": false, \"occupante\": null }, \"HW_B_2_2\": { \"isOccupied\": false, \"occupante\": null }, \"HW_B_3_2\": { \"isOccupied\": false, \"occupante\": null } } } };\n    var test2 = { \"HW_A\": { \"name\": \"HW_A\", \"hooks\": { \"HW_A_0_0\": { \"isOccupied\": false, \"occupante\": null }, \"HW_A_1_0\": { \"isOccupied\": false, \"occupante\": null }, \"HW_A_2_0\": { \"isOccupied\": false, \"occupante\": null }, \"HW_A_3_0\": { \"isOccupied\": false, \"occupante\": null }, \"HW_A_0_1\": { \"isOccupied\": true, \"occupante\": { \"TrackableName\": \"865341506\", \"TrackedGoName\": \"VIT-19-865341506\", \"goName\": \"Test865341506\", \"wuName\": \"UI865341506\" } }, \"HW_A_1_1\": { \"isOccupied\": true, \"occupante\": { \"TrackableName\": \"865341506\", \"TrackedGoName\": \"VIT-19-865341506\", \"goName\": \"Test865341506\", \"wuName\": \"UI865341506\" } }, \"HW_A_2_1\": { \"isOccupied\": false, \"occupante\": null }, \"HW_A_3_1\": { \"isOccupied\": false, \"occupante\": null }, \"HW_A_0_2\": { \"isOccupied\": false, \"occupante\": null }, \"HW_A_1_2\": { \"isOccupied\": false, \"occupante\": null }, \"HW_A_2_2\": { \"isOccupied\": false, \"occupante\": null }, \"HW_A_3_2\": { \"isOccupied\": false, \"occupante\": null } } }, \"HW_B\": { \"name\": \"HW_B\", \"hooks\": { \"HW_B_0_0\": { \"isOccupied\": false, \"occupante\": null }, \"HW_B_1_0\": { \"isOccupied\": false, \"occupante\": null }, \"HW_B_2_0\": { \"isOccupied\": false, \"occupante\": null }, \"HW_B_3_0\": { \"isOccupied\": false, \"occupante\": null }, \"HW_B_0_1\": { \"isOccupied\": false, \"occupante\": null }, \"HW_B_1_1\": { \"isOccupied\": false, \"occupante\": null }, \"HW_B_2_1\": { \"isOccupied\": false, \"occupante\": null }, \"HW_B_3_1\": { \"isOccupied\": false, \"occupante\": null }, \"HW_B_0_2\": { \"isOccupied\": false, \"occupante\": null }, \"HW_B_1_2\": { \"isOccupied\": false, \"occupante\": null }, \"HW_B_2_2\": { \"isOccupied\": false, \"occupante\": null }, \"HW_B_3_2\": { \"isOccupied\": false, \"occupante\": null } } } };\n    var walls = test2;*/\n\n    myconsolelog(\"MOPOP_CalcScore ... walls => \" + JSON.stringify(walls));\n\n    var wallsScore = 0;\n    var usedYearPerWall = {};\n\n\n    for (var wKey in walls) {\n        myconsolelog(\"MOPOP_CalcScore ... wKey => \" + wKey);\n        if (walls.hasOwnProperty(wKey)) {\n            usedYearPerWall[wKey] = {};\n            myconsolelog(\"MOPOP_CalcScore ... wKey => \" + wKey + \" => FOUND\");\n            var aWall = walls[wKey];\n            var wName = aWall.name;\n            var wHooks = aWall.hooks;\n            var isReversed = aWall.reversed;\n            var wallW = aWall.w;\n            var wallH = aWall.h;\n            myconsolelog(\"MOPOP_CalcScore ... walls[\" + wKey + \"].name=\" + wName);\n\n\n            var occupantList = [];\n\n\n            for (var hKey in wHooks) {\n                myconsolelog(\"MOPOP_CalcScore ...   hKey => \" + hKey);\n                if (wHooks.hasOwnProperty(hKey)) {\n                    var aHook = wHooks[hKey];\n\n                    //console.log(\"aHook => \" + aHook.x + \", \" + aHook.y);\n\n                    var isOccupied = aHook.isOccupied;\n                    if (isOccupied) {\n\n                        //prepare list of occupants\n                        occupantList.push({\n                            \"hook\": aHook,\n                            \"hookname\": hKey\n                        });\n\n                        var occupante = aHook.occupante;\n                        myconsolelog(\"MOPOP_CalcScore ... walls[\" + wKey + \"].hooks[\" + hKey + \"].occupied=\" + isOccupied);\n                        myconsolelog(\"MOPOP_CalcScore ... walls[\" + wKey + \"].hooks[\" + hKey + \"].occupante=>\" + JSON.stringify(occupante));\n\n                        var occupanteId = occupante.TrackableName;\n                        if (MOPOP.artefacts.hasOwnProperty(occupanteId)) {\n                            var artefact = MOPOP.artefacts[occupanteId];\n                            var score = artefact.score;\n                            var year = MOPOP_GetYearFromString(artefact.publishdate);\n                            var soldcopies = 0;\n                            if (artefact.hasOwnProperty(\"soldcopies\")) {\n                                soldcopies = parseFloat(artefact.soldcopies.replace(\",\", \"\"));\n                                soldcopies *= 0.000001;\n                            }\n\n                            //year occupation for year distribution\n                            if (!usedYearPerWall[wKey].hasOwnProperty(year)) {\n                                var dataId = parseFloat(year) - parseFloat(MOPOP.startyear);\n                                usedYearPerWall[wKey][year] = {\n                                    \"val\": 0,\n                                    \"id\": dataId\n                                };\n                                //usedYearPerWall[wKey][year].val += 1;\n                                myconsolelog(\"MOPOP_CalcScore ... Artefact[\" + occupanteId + \"].score => \" + score);\n                            }\n\n                            usedYearPerWall[wKey][year].val += 1;\n                            wallsScore += parseFloat(score) * soldcopies;\n                        }\n                    }\n                }\n            }\n\n            try {\n                if (occupantList.length > 2) {\n\n                    //reversed for year direction\n                    //isReversed\n\n                    var NBins = wallW;\n                    var xBins = [];\n\n                    //prepare xbins\n                    for (var wi = 0; wi < NBins; wi++) {\n                        xBins.push([]);\n                    }\n\n                    var weightedPenalty = 1;\n\n                    //collect years of occupants\n                    var N = occupantList.length;\n                    for (var i = 0; i < N; i++) {\n                        var occ = occupantList[i];\n                        var hook = occ.hook;\n                        var hookname = occ.hookname;\n                        var hookOccupant = hook.occupante;\n\n                        var hookX = hook.x;\n                        var hookY = hook.y;\n\n                        var hooksArtefact = MOPOP.artefacts[occupanteId];\n                        var hooksYearStr = MOPOP_GetYearFromString(arthooksArtefactefact.publishdate);\n                        var hooksYear = parseInt(hooksYearStr);\n\n                        xBins[hookX].push(hooksYear);\n                    }\n\n\n                    //filter only used bins, so that we can go pairwise through them\n                    var filteredBins = [];\n                    for (var wi = 0; wi < NBins; wi++) {\n                        if (xBins[wi].length > 0) {\n                            filteredBins.push(xBins[wi]);\n                        }\n                    }\n\n                    //check for weak monotonic years\n                    var fNbins = filteredBins.length;\n                    for (var wi = 1; wi < fNbins; wi++) {\n\n                        var prevBin = filteredBins[wi - 1];\n                        var curBin = filteredBins[wi];\n\n                        for (pwi = 0; pwi < prevBin.length; pwi++) {\n                            curPrevYear = prevBin[pwi];\n\n                            for (cwi = 0; cwi < curBin.length; cwi++) {\n                                curCurYear = curBin[cwi];\n\n                                //check each year of bin A vs each year of bin b\n                                //every violation causes a 5% penalty\n                                if (isReversed) {\n\n                                    //reverse means year gos from 1990 to 2000 where the hook ids go from 13 to 0\n                                    //therefore to be monotonic increasing, the years seen from the ids would be\n                                    // decreasing, theferefor we penalize when its increasing\n                                    if (curPrevYear < curCurYear) {\n                                        weightedPenalty *= 0.9;\n                                    }\n                                } else {\n                                    //regular monotonic increase where the yeare goes from 1990 to 2000 and the\n                                    // hook id from 0 to 13, therefore we penalize violations when decreasing\n                                    // which means prev year is bigger as next year\n                                    if (curPrevYear > curCurYear) {\n                                        weightedPenalty *= 0.9;\n                                    }\n                                }\n                            }\n\n\n                            //TODO maybe check violations inside a xBin\n                            /*\n                            if (curYear != prevYear) {\n                                weightedPenalty += -0.01;\n                            }\n                            nextYear = prevBin[cwi - 1];\n                            */\n                        }\n                    }\n                    wallsScore *= weightedPenalty;\n                }\n            } catch (tlerr) {\n                console.log(\"MOPOP_CalcScore TL ERROR => \" + tlerr);\n            }\n        }\n\n        if (wallsScore > 0) {\n            MOPOP_ReportUserEvent(MOPOP.userevents.score, { \"score\": wallsScore }, Date.now(), MOPOP.user);\n\n            var data = {\n                \"score\": wallsScore //TODO use real score here\n            };\n            var jsonScores = JSON.stringify(data);\n            RT.MQTT.Publish(MOPOP.topics.wallscore, jsonScores);\n            myconsolelog(\"MOPOP_CalcScore ... done SCORES => \" + jsonScores);\n\n            for (var k in usedYearPerWall) {\n                var jsonYears = JSON.stringify(usedYearPerWall[k]);\n                var topic = MOPOP.topics.wallyearhist + \"/\" + k.replace(\"HW_\", \"\"); //dirty fix!!!!\n                RT.MQTT.Publish(topic, jsonYears);\n                myconsolelog(\"MOPOP_CalcScore ... done YEARS: \" + topic + \"/ => \" + jsonYears);\n            }\n        }\n    }\n}\n\nfunction MOPOP_UpdateHookOccupation2() {\n    //myconsolelog(\"MOPOP_UpdateHookOccupation2 ..\");\n    MOPOP_UpdateHookOccupation();\n}\n\nvar scoreweight = 1;\n\nfunction MOPOP_UpdateHookOccupation() {\n    try {\n        if (true || MOPOP.picked != null) {\n            //myconsolelog(\"MOPOP_UpdateHookOccupation picked=> \" + JSON.stringify(MOPOP.picked));\n\n            //picked \n            // picked=> {\"TrackableName\":\"2805595956\",\"TrackedGoName\":\"VIT-13-2805595956\",\"goName\":\"Test2805595956\",\"wuName\":\"UI2805595956\"}\n\n            //hookwall\n            //{\"HW_A\":{\"name\":\"HW_A\",\"hooks\":{\"HW_A_0_0\":{\"isOccupied\":false,\"occupante\":null},\"HW_A_1_0\":{\"isOccupied\":false,\"occupante\":null},\"HW_A_2_0\":{\"isOccupied\":false,\"occupante\":null},\"HW_A_3_0\":{\"isOccupied\":false,\"occupante\":null},\"HW_A_4_0\":{\"isOccupied\":false,\"occupante\":null},\"HW_A_0_1\":{\"isOccupied\":false,\"occupante\":null},\"HW_A_1_1\":{\"isOccupied\":false,\"occupante\":null},\"HW_A_2_1\":{\"isOccupied\":false,\"occupante\":null},\"HW_A_3_1\":{\"isOccupied\":false,\"occupante\":null},\"HW_A_4_1\":{\"isOccupied\":false,\"occupante\":null},\"HW_A_0_2\":{\"isOccupied\":false,\"occupante\":null},\"HW_A_1_2\":{\"isOccupied\":false,\"occupante\":null},\"HW_A_2_2\":{\"isOccupied\":false,\"occupante\":null},\"HW_A_3_2\":{\"isOccupied\":false,\"occupante\":null},\"HW_A_4_2\":{\"isOccupied\":false,\"occupante\":null}}},\"HW_B\":{\"name\":\"HW_B\",\"hooks\":{\"HW_B_0_0\":{\"isOccupied\":false,\"occupante\":null},\"HW_B_1_0\":{\"isOccupied\":false,\"occupante\":null},\"HW_B_2_0\":{\"isOccupied\":false,\"occupante\":null},\"HW_B_3_0\":{\"isOccupied\":false,\"occupante\":null},\"HW_B_0_1\":{\"isOccupied\":false,\"occupante\":null},\"HW_B_1_1\":{\"isOccupied\":false,\"occupante\":null},\"HW_B_2_1\":{\"isOccupied\":false,\"occupante\":null},\"HW_B_3_1\":{\"isOccupied\":false,\"occupante\":null},\"HW_B_0_2\":{\"isOccupied\":false,\"occupante\":null},\"HW_B_1_2\":{\"isOccupied\":false,\"occupante\":null},\"HW_B_2_2\":{\"isOccupied\":false,\"occupante\":null},\"HW_B_3_2\":{\"isOccupied\":false,\"occupante\":null}}}}\n\n            //occupante\n            //aHook => {\"isOccupied\":true,\"occupante\":{\"TrackableName\":\"2805595956\",\"TrackedGoName\":\"VIT-13-2805595956\",\"goName\":\"Test2805595956\",\"wuName\":\"UI2805595956\"}}\n\n\n            var dirtyScore = false;\n            // update hookwalls here\n            var walls = MOPOP.hookwall;\n            for (var wKey in walls) {\n                if (walls.hasOwnProperty(wKey)) {\n                    var aWall = walls[wKey];\n                    var wName = aWall.name;\n                    var wHooks = aWall.hooks;\n\n                    //myconsolelog(\"MOPOP_UpdateHookOccupation ... walls[\" + wKey + \"].name=\" + wName);\n\n                    //var occupantList = [];\n                    for (var hKey in wHooks) {\n                        //myconsolelog(\"MOPOP_UpdateHookOccupation ... hKey => \" + hKey);\n\n\n                        if (wHooks.hasOwnProperty(hKey)) {\n                            var aHook = wHooks[hKey];\n                            var isOccupied = aHook.isOccupied;\n\n                            if (isOccupied) {\n                                var occupante = aHook.occupante;\n                                var occupanteId = occupante.TrackableName;\n\n\n                                /*occupantList.push({\n                                    \"occ\": occupante,\n                                    \"hook\": hKey\n                                });*/\n\n\n                                //myconsolelog(\"MOPOP_UpdateHookOccupation id check => \" + occupanteId + \" == \" + MOPOP.picked.TrackableName);\n                                //look if the picked one occupied a hook\n                                if (true) {\n                                    //if (occupanteId == MOPOP.picked.TrackableName) {\n\n                                    myconsolelog(\"MOPOP_UpdateHookOccupation FOUND wKey => \" + wKey);\n                                    myconsolelog(\"MOPOP_UpdateHookOccupation FOUND wName => \" + wName);\n                                    myconsolelog(\"MOPOP_UpdateHookOccupation FOUND hKey => \" + hKey);\n                                    myconsolelog(\"MOPOP_UpdateHookOccupation FOUND aHook => \" + JSON.stringify(aHook));\n\n\n                                    //the hooks gameobject, not the tile only the hook\n                                    var hookGoName = wKey + \"/\" + hKey + \"/\" + \"Hook\";\n                                    var hookGo = MAIN.UE.GameObject.Find(hookGoName);\n\n                                    var artefactName = aHook.occupante.TrackedGoName;\n                                    var artefactGo = MAIN.UE.GameObject.Find(artefactName);\n\n                                    //TODO check here for the distance\n                                    var dist = 0;\n                                    if (hookGo != null && artefactGo != null) {\n                                        var hookPos = hookGo.transform.position;\n                                        var artefactPos = artefactGo.transform.position;\n\n                                        myconsolelog(\"MOPOP_UpdateHookOccupation hookPos=(\" + hookPos.x + \", \" + hookPos.y + \", \" + hookPos.z + \")\");\n                                        myconsolelog(\"MOPOP_UpdateHookOccupation artefactPos=(\" + artefactPos.x + \", \" + artefactPos.y + \", \" + artefactPos.z + \")\");\n\n                                        dist =\n                                            Math.sqrt(\n                                                (hookPos.x - artefactPos.x) * (hookPos.x - artefactPos.x) +\n                                                (hookPos.y - artefactPos.y) * (hookPos.y - artefactPos.y) +\n                                                (hookPos.z - artefactPos.z) * (hookPos.z - artefactPos.z)\n                                            );\n                                        myconsolelog(\"MOPOP_UpdateHookOccupation dist=\" + dist);\n                                    }\n\n                                    if (dist > 0.2) {\n                                        //var hookGo = MAIN.UE.GameObject.Find(hookGoName);\n                                        if (hookGo != null) {\n                                            var r = hookGo.GetComponent(MAIN.UE.Renderer);\n                                            if (r != null) {\n                                                //r.material.color = MAIN.UE.Color.green;\n                                                r.material.color = new MAIN.UE.Color(0.4, 0.4, 0.4, 0.5);\n                                            }\n                                        }\n\n                                        //TODO maybe set picked here?\n                                        //TODO make cover unplaced\n                                        MOPOP.picked = aHook.occupante;\n                                        try {\n                                            var wuName = occupante.wuName;\n                                            var tw1 = MAIN.PUI.WorldUI.Find(wuName);\n                                            if (tw1 != null) {\n                                                tw1.document.Run(\"Artefact_MakeMePicked\", [\"\"]);\n                                            }\n                                        } catch (setPickedErr) {\n                                            myconsolelog(\"MOPOP Artefact_MakeMePicked ERROR => \" + setPickedErr);\n                                        }\n\n                                        //TODO killBez here?\n                                        aHook.isOccupied = false;\n                                        aHook.occupante = null;\n                                        dirtyScore = true;\n                                        //MOPOP_CalcScore();\n                                    }\n                                }\n                            }\n                        } else {\n                            myconsolelog(\"MOPOP_UpdateHookOccupation ... hKey => \" + hKey + \" NOT FOUND\");\n                        }\n                    }\n\n                    //check occupant list neighbor relations\n                    /*if (false) {\n\n\n                        var bezParentGo = new MAIN.UE.GameObject.Find(\"pairbezparent\");\n                        if (bezParentGo == null) {\n                            bezParentGo = new MAIN.UE.GameObject(\"pairbezparent\");\n                        }\n\n\n                        //occupantList.push({\n                        //    \"occ\": occupante,\n                        //    \"hook\": hKey\n                        //});\n                        //{\"isOccupied\":true,\"occupante\":{\"TrackableName\":\"2805595956\",\"TrackedGoName\":\"VIT-13-2805595956\",\"goName\":\"Test2805595956\",\"wuName\":\"UI2805595956\"}}\n                        for (var ai = 0; ai < occupantList.length; ai++) {\n                            for (var bi = ai + 1; bi < occupantList.length; bi++) {\n                                var occupantA = occupantList[ai];\n                                var occupantB = occupantList[bi];\n\n                                //occupantA.occ\n                                //occupantA.hook\n\n\n                                var hookGoA = MAIN.UE.GameObject.Find(occupantA.hook)\n                                var hookGoB = MAIN.UE.GameObject.Find(occupantB.hook)\n\n                                if (hookGoA != null && hookGoB != null) {\n                                    var posA = hookGoA.transform.localPosition;\n                                    var posB = hookGoB.transform.localPosition;\n\n                                    // check distance\n                                    // if close, check artist\n\n                                    var dist =\n                                        Math.sqrt(\n                                            (posA.x - posB.x) * (posA.x - posB.x) +\n                                            (posA.y - posB.y) * (posA.y - posB.y) +\n                                            (posA.z - posB.z) * (posA.z - posB.z)\n                                        );\n\n                                    if (dist < 0.3) {\n                                        var coverIdA = occupantA.occ.TrackableName;\n                                        var coverIdB = occupantB.occ.TrackableName;\n\n                                        var coverA = MOPOP.artefacts[coverIdA];\n                                        var coverB = MOPOP.artefacts[coverIdB];\n\n                                        var artistA = coverA.artist;\n                                        var artistB = coverB.artist;\n\n                                        if (artistA == artistB) {\n                                            //same artist, which are also close to each other\n                                            scoreweight += 0.05;\n                                            //\n\n                                            var bezName = \"pairbez-\" + occupantA.hook + \"-\" + occupantB.hook;\n                                            var bezGo = RT.Unity.CreateBezier(bezName, occupantA.hook, occupantB.hook);\n                                            if (bezGo != null) {\n                                                RT.Unity.SetParent(bezGo, bezParentGo);\n                                            }\n                                        }\n                                    }\n                                }\n\n                            }\n                        }\n                    }*/\n\n\n                }\n            }\n\n            if (dirtyScore) {\n                MOPOP_CalcScore();\n                dirtyScore = false;\n            }\n\n            //update temp tables here\n            var tables = MOPOP.temptable;\n            for (var wKey in tables) {\n                if (tables.hasOwnProperty(wKey)) {\n                    var aTable = tables[wKey];\n                    var wName = aTable.name;\n                    var wHooks = aTable.hooks;\n\n                    for (var hKey in wHooks) {\n                        if (wHooks.hasOwnProperty(hKey)) {\n                            var aHook = wHooks[hKey];\n                            var isOccupied = aHook.isOccupied;\n                            if (isOccupied) {\n                                var occupante = aHook.occupante;\n                                var occupanteId = occupante.TrackableName;\n\n                                if (true) {\n\n                                    //the hooks gameobject, not the tile only the hook\n                                    var hookGoName = wKey + \"/\" + hKey + \"/\" + \"Hook\";\n                                    var hookGo = MAIN.UE.GameObject.Find(hookGoName);\n\n                                    var artefactName = aHook.occupante.TrackedGoName;\n                                    var artefactGo = MAIN.UE.GameObject.Find(artefactName);\n\n                                    var dist = 0;\n                                    if (hookGo != null && artefactGo != null) {\n                                        var hookPos = hookGo.transform.position;\n                                        var artefactPos = artefactGo.transform.position;\n\n                                        dist =\n                                            Math.sqrt(\n                                                (hookPos.x - artefactPos.x) * (hookPos.x - artefactPos.x) +\n                                                (hookPos.y - artefactPos.y) * (hookPos.y - artefactPos.y) +\n                                                (hookPos.z - artefactPos.z) * (hookPos.z - artefactPos.z)\n                                            );\n                                    }\n\n                                    if (dist > 0.2) { // was 0.05\n                                        if (hookGo != null) {\n                                            var r = hookGo.GetComponent(MAIN.UE.Renderer);\n                                            if (r != null) {\n                                                //r.material.color = MAIN.UE.Color.green;\n                                                r.material.color = new MAIN.UE.Color(0.4, 0.4, 0.4, 0.5);\n                                            }\n                                        }\n\n                                        MOPOP.picked = aHook.occupante;\n                                        try {\n                                            var wuName = occupante.wuName;\n                                            var tw1 = MAIN.PUI.WorldUI.Find(wuName);\n                                            if (tw1 != null) {\n                                                tw1.document.Run(\"Artefact_MakeMePicked\", [\"\"]);\n                                            }\n                                        } catch (setPickedErr) {\n                                            myconsolelog(\"MOPOP Artefact_MakeMePicked ERROR => \" + setPickedErr);\n                                        }\n\n                                        //TODO killBez here?\n                                        aHook.isOccupied = false;\n                                        aHook.occupante = null;\n                                    }\n                                }\n                            }\n                        } else {\n                            myconsolelog(\"MOPOP_UpdateHookOccupation ... hKey => \" + hKey + \" NOT FOUND\");\n                        }\n                    }\n                }\n            }\n        }\n    } catch (err) {\n        myconsolelog(\"MOPOP_UpdateHookOccupation ERROR => \" + err);\n    }\n}\n\n/** */\nfunction MOPOP_InitMqtt() {\n\n    //scores topic for vis\n    var scoresTopic = MOPOP.topics.wallscore;\n    RT.MQTT.Subscribe(scoresTopic);\n    RT.MQTT.RegisterCallbackTopic(\n        function (topic, payload) {\n            myconsolelog(\"MOPOP_NEW_SCORE: \" + topic + \" | \" + payload);\n\n            //TODO update score chart\n        }, scoresTopic);\n}\n\n/**\n * \n * @param {string} mKey\n * @param {GameObject} mParentGo\n * @param {function(string, GameObject):void} mFctDone\n */\nfunction MOPOP_InitYearHist(mKey, mParentGo, mFctDone) {\n    var key = mKey;\n    var parentGo = mParentGo;\n    myconsolelog(\"MOPOP_InitYearHist mKey=>\" + mKey);\n\n    var nextId = Main_GetNextChartId();\n    MOPOP.yearcharts[key] = RT.VIS.GetNewChartObject(nextId, 0,\n        \"BarChart2D\", MAIN.usercanvas.canvasSize,\n        MAIN.usercanvas.canvasSpacedSize);\n\n    RT.Web.SetTiimeout(250, function () {\n        var sy = MOPOP.startyear;\n        var ey = MOPOP.endyear;\n\n        labels = [];\n        for (var i = sy; i < ey + 1; i++) {\n            labels.push(i);\n        }\n\n        //var dataObj = JSON.parse(mData);\n        //var dimensionName = dataObj.data.dimensionname;\n        //var topic = dataObj.data.mqtt;\n        //var labels = dataObj.data.labels;\n        var data = {\n            \"data\": {\n                \"xdimname\": \"years\",\n                \"xlabels\": labels,\n                \"ydimname\": \"count\",\n                \"nindices\": labels.length,\n                \"mqtt\": MOPOP.topics.wallyearhist + \"/\" + key,\n                \"mqttdimensionkey\": \"count\",\n                \"reset\": true\n            }\n        };\n        var dataJson = JSON.stringify(data);\n\n        MOPOP.yearcharts[key].fctAddDimensionWithRealtimeKeys(dataJson);\n        if (mFctDone != null) {\n            mFctDone(key, parentGo);\n        }\n    });\n}\n\n/**\n * \n * @param {string} mKey\n * @param {GameObject} mParentGo\n * @param {function(string,GameObject):void} mFctDone\n */\nfunction MOPOP_InitInfoCompareChart(mKey, mParentGo, mFctDone) {\n    var key = mKey;\n    var parentGo = mParentGo;\n    myconsolelog(\"MOPOP_InitInfoCompareChart mKey=>\" + mKey);\n\n    var nextId = Main_GetNextChartId();\n    MOPOP.infochart = RT.VIS.GetNewChartObject(nextId, 0,\n        \"BarChart3D\", MAIN.usercanvas.canvasSize,\n        MAIN.usercanvas.canvasSpacedSize);\n\n    RT.Web.SetTiimeout(250, function () {\n        var Nslots = 3;//MOPOP.infopicks.length;\n        for (var si = 0; si < Nslots; si++) {\n            labels = [\"score\", \"sold\"];\n            //labels = [0, 1];\n            var data = {\n                \"data\": {\n                    \"xdimname\": \"Cover\" + si,\n                    \"xlabels\": labels,\n                    //\"ydimname\": \"y\" + si,\n                    //\"zdimname\": \"z\" + si,\n                    \"nindices\": labels.length,\n                    \"mqtt\": MOPOP.topics.infocompare + \"/\" + si,\n                    \"mqttdimensionkey\": \"Cover\" + si,\n                    \"reset\": true\n                }\n            };\n            var dataJson = JSON.stringify(data);\n            MOPOP.infochart.fctAddDimensionWithRealtimeKeys(dataJson);\n        }\n\n        if (mFctDone != null) {\n            mFctDone(key, parentGo);\n        }\n    });\n}\n\n/**\n * \n * @param {function():void} mFctDone\n */\nfunction MOPOP_InitScoreChart(mFctDone) {\n    var nextId = Main_GetNextChartId();\n\n    if (true) {\n        //iatk based\n        MOPOP.scorechart = RT.VIS.GetNewChartObjectIATK(nextId, 0,\n            \"LineChart2D\", MAIN.usercanvas.canvasSize,\n            MAIN.usercanvas.canvasSpacedSize);\n\n        var scoreData = {\n            \"data\": {\n                \"fieldname\": \"score\",\n                \"mqtt\": MOPOP.topics.wallscore\n            }\n        }\n        var jsonStr = JSON.stringify(scoreData);\n        MOPOP.scorechart.fctAddRealtimeDimension(jsonStr, 1);\n\n        if (mFctDone != null) {\n            mFctDone();\n        }\n\n    } else {\n        // u2vis based version\n\n        MOPOP.scorechart = RT.VIS.GetNewChartObject(nextId, 0,\n            \"LineChart2D\", MAIN.usercanvas.canvasSize,\n            MAIN.usercanvas.canvasSpacedSize);\n\n        //var fieldname = dataObj.data.fieldname;\n        //var topic = dataObj.data.mqtt;\n        RT.Web.SetTiimeout(250, function () {\n            var scoreData = {\n                \"data\": {\n                    \"fieldname\": \"score\",\n                    \"mqtt\": MOPOP.topics.wallscore\n                }\n            }\n\n            var scoreData2 = {\n                \"attrId\": \"score\",\n                \"data\": MOPOP.topics.wallscore,\n            };\n            var jsonStr = JSON.stringify(scoreData);\n\n            //we need to do some init here\n\n            MOPOP.scorechart.fctAddRealtimeDimension(jsonStr, 0);\n            MOPOP.scorechart.fctAddRealtimeDimension(jsonStr, 0); //THIS a nasty work around to rule out a dimension\n            if (mFctDone != null) {\n                mFctDone();\n            }\n            //MOPOP.scorechart.panelGo.Expire();\n        });\n    }\n}\n\n\n/**\n * \n * @param {string} mFullDateStr\n */\nfunction MOPOP_GetYearFromString(mFullDateStr) {\n    const fullDate = new Date(mFullDateStr);\n    var year = fullDate.getFullYear();\n    return year;\n}\n\n\n//TODO move this\n/**\n * \n * @param {string} mName\n * @param {[x:number,y:number,z:number]} mTranslation\n * @param {[x:number,y:number,z:number, w:number]} mRotation\n * @param {[x:number,y:number,z:number]} mScale\n * @param {GameObject} mParent\n * @param {string} mLabelText\n * @returns {WorldUI}\n */\nfunction MAIN_CreateLabel(mName, mTranslation, mRotation, mScale, mParent, mLabelText) {\n    try {\n        var content = '<div style=\"position: absolute;top: \\\nposition: absolute;top: 0;left: 0; \\\nheight: auto; margin: 2vh; padding: 2vh; font-size: 14vh; \\\nfont-weight: bold; color: rgb(238, 238, 238); \\\nbackground-color: rgb(0, 77, 109); border: solid rgb(238, 238, 238) 2px; \\\ndisplay: block; border-radius: 5px;\">' + mLabelText + '</div>';\n        var tWu1 = RT.Unity.CreateWU(mName, content, false, 700, 360);\n        tWu1.SetOrigin(0.5, 0.5);\n        RT.Unity.SetParent(tWu1, mParent);\n        RT.Unity.SetLocalPose(tWu1, mTranslation, mRotation, mScale);\n        return tWu1;\n    } catch (err) {\n        myconsolelog(\"MAIN_CreateLabel ERROR => \" + err);\n    }\n    return null;\n}\n\nfunction MOPOP_SaveEnv() {\n\n    var mopop = MAIN.location.data.mopop;\n    myconsolelog(\"MOPOP_SaveEnv location => \" + JSON.stringify(MAIN.location.data));\n\n    var isDirty = false;\n\n    //collect update hookwall transforms\n    if (mopop.hasOwnProperty(\"hookwalls\")) {\n        var N = mopop.hookwalls.length;\n        myconsolelog(\"MOPOP_SaveEnv #hookswals => \" + N);\n        for (var i = 0; i < N; i++) {\n            var hw = mopop.hookwalls[i];\n            var hGoName = \"HW_\" + hw.name;\n            var go = MAIN.UE.GameObject.Find(hGoName);\n            if (go != null) {\n                myconsolelog(\"MOPOP_SaveEnv reading => \" + hGoName);\n                var T = [go.transform.localPosition.x, go.transform.localPosition.y, go.transform.localPosition.z];\n                var R = [go.transform.localRotation.x, go.transform.localRotation.y, go.transform.localRotation.z, go.transform.localRotation.w];\n                var S = [go.transform.localScale.x, go.transform.localScale.y, go.transform.localScale.z];\n\n                myconsolelog(\"MOPOP_SaveEnv T => \" + T);\n\n                MAIN.location.data.mopop.hookwalls[i].transform = {\n                    \"position\": T,\n                    \"rotation\": R,\n                    \"scale\": S\n                };\n                isDirty = true;\n            }\n        }\n    }\n\n    //collect update temptables transforms\n    if (mopop.hasOwnProperty(\"temptables\")) {\n        var N = mopop.temptables.length;\n        myconsolelog(\"MOPOP_SaveEnv #temptables => \" + N);\n        for (var i = 0; i < N; i++) {\n            var hw = mopop.temptables[i];\n            var tGoName = \"TT_\" + hw.name;\n            var go = MAIN.UE.GameObject.Find(tGoName);\n            if (go != null) {\n                myconsolelog(\"MOPOP_SaveEnv reading => \" + tGoName);\n                var T = [go.transform.localPosition.x, go.transform.localPosition.y, go.transform.localPosition.z];\n                var R = [go.transform.localRotation.x, go.transform.localRotation.y, go.transform.localRotation.z, go.transform.localRotation.w];\n                var S = [go.transform.localScale.x, go.transform.localScale.y, go.transform.localScale.z];\n\n                myconsolelog(\"MOPOP_SaveEnv T => \" + T);\n\n                MAIN.location.data.mopop.temptables[i].transform = {\n                    \"position\": T,\n                    \"rotation\": R,\n                    \"scale\": S\n                };\n                isDirty = true;\n            }\n        }\n    }\n\n    if (isDirty) {\n        var id = MAIN.location.data._id;\n        var uUrl = MAIN.WEBAPI.apiBase + \"/data?name=\" + id;\n        var uHeaders = [\"content-type\", \"application/json\"];\n        var uData = JSON.stringify(MAIN.location.data);\n\n        RT.Web.SendWebReq(\"POST\", uUrl, uHeaders, uData,\n            function (mError2, mData2) {\n                myconsolelog(\"MOPOP_SaveEnv updated => \" + mError2 + \"|\" + mData2);\n                if (!mError2) {\n                    var retObj = JSON.parse(mData2);\n                    MAIN.location.data._rev = retObj.rev;\n                }\n            });\n    }\n    return;\n}\n\nfunction MOPOP_SetupTimeline(hTimeline, hGo, tileSize, W, H, wallWidth, reversed) {\n    if (hTimeline != null) {\n        var hGoName = hGo.name;\n        var goTimelineName = hGoName + \"_TL\";\n        var goTimeline = new MAIN.UE.GameObject(goTimelineName);\n        goTimeline.transform.parent = hGo.transform;\n\n        var xOffset = ((W * 0.5) * tileSize) - tileSize * 0.5;\n        var yOffset = - tileSize;\n        var zOffset = 0.1;\n        goTimeline.transform.localPosition = new MAIN.UE.Vector3(xOffset, yOffset, zOffset);\n\n        var goTimelineBar = MAIN.UE.GameObject.CreatePrimitive(3); //cube\n        goTimelineBar.name = goTimelineName + \"_Bar\";\n        goTimelineBar.transform.parent = goTimeline.transform;\n        goTimelineBar.transform.localPosition = new MAIN.UE.Vector3(0, 0, 0);\n        goTimelineBar.transform.localScale = new MAIN.UE.Vector3(wallWidth, 0.01, 0.01);\n\n        var startYear = hTimeline.start;\n        var endYear = hTimeline.end;\n        var tick = hTimeline.tick;\n\n        MOPOP.startyear = startYear;\n        MOPOP.endyear = endYear;\n        MOPOP.midyear = (endYear - startYear) * 0.5 + startYear;\n\n        var Nyears = endYear - startYear;\n        var tickSpacing = wallWidth / Nyears;\n        for (var iTick = 0; iTick < Nyears + 1; iTick++) {\n            var goTimelineBarTick = MAIN.UE.GameObject.CreatePrimitive(3);\n            goTimelineBarTick.name = goTimelineName + \"_tick_\" + (startYear + iTick);\n\n            if (reversed) {\n                goTimelineBarTick.name = goTimelineName + \"_tick_\" + (endYear - iTick);\n            }\n\n            goTimelineBarTick.transform.parent = goTimeline.transform;\n            var tickPos = iTick * tickSpacing - wallWidth * 0.5;\n\n            goTimelineBarTick.transform.localPosition = new MAIN.UE.Vector3(tickPos, 0, 0);\n            goTimelineBarTick.transform.localScale = new MAIN.UE.Vector3(0.004, 0.05, 0.005);\n\n\n            if (iTick == 0) {\n                endTickPos = tickPos;\n            }\n\n            if (iTick == Nyears) {\n                endTickPos = tickPos;\n            }\n\n\n            if (iTick == 0 || iTick == Nyears || iTick == Nyears / 2) {\n                goTimelineBarTick.transform.localScale = new MAIN.UE.Vector3(0.008, 0.05, 0.005);\n                var r = goTimelineBarTick.GetComponent(MAIN.UE.Renderer);\n                if (r != null) {\n                    r.material.color = MAIN.UE.Color.green;\n                }\n            }\n        }\n\n        //set startyear label\n        if (MOPOP.startyear > 0) {\n            var xOffset = ((W * 0.5) * tileSize) - tileSize * 0.5;\n            //if (reversed) {\n            //    xOffset = ((W * 0.5) * tileSize) - tileSize * 0.5;\n            //}\n            var yOffset = - tileSize;\n            var startLabelName = goTimelineName + \"_L_\" + MOPOP.startyear;\n            var labelText = MOPOP.startyear;\n            if (reversed) {\n                startLabelName = goTimelineName + \"_L_\" + MOPOP.endyear;\n                labelText = MOPOP.endyear;\n            }\n            var wTrans = [xOffset - wallWidth * 0.7, yOffset - tileSize - 0.1, zOffset];\n            //if (reversed) {\n            //    wTrans = [xOffset + wallWidth * 0.7, yOffset - tileSize - 0.1, zOffset];\n            //}\n            var wRot = [0, 1, 0, 0];\n            var wScale = [0.001, 0.001, 0.001];\n            MAIN_CreateLabel(startLabelName, wTrans, wRot, wScale, hGo, labelText);\n        }\n\n        if (MOPOP.endyear > 0) {\n            var xOffset = ((W * 0.5) * tileSize) - tileSize * 0.5;\n            var yOffset = - tileSize;\n            var endLabelName = goTimelineName + \"_L_\" + MOPOP.endyear;\n            var labelText = MOPOP.endyear;\n            if (reversed) {\n                endLabelName = goTimelineName + \"_L_\" + MOPOP.startyear;\n                labelText = MOPOP.startyear;\n            }\n            var wTrans = [xOffset + wallWidth * 0.3, yOffset - tileSize - 0.1, zOffset];\n            var wRot = [0, 1, 0, 0];\n            var wScale = [0.001, 0.001, 0.001];\n            MAIN_CreateLabel(endLabelName, wTrans, wRot, wScale, hGo, labelText);\n\n            var midLabelName = goTimelineName + \"_L_\" + MOPOP.mid;\n            var wTrans2 = [xOffset - wallWidth * 0.2, yOffset - tileSize - 0.1, zOffset];\n            MAIN_CreateLabel(midLabelName, wTrans2, wRot, wScale, hGo, MOPOP.midyear);\n        }\n    }\n}\n\nfunction MOPOP_SetupYearHist(hName, hGo, wallWidth, wallHeight, reversed) {\n\n    var keyWall = hName;\n    var parentGo = hGo;\n    myconsolelog(\"MOPOP_InitYearHist before call keyWall => \" + keyWall);\n\n    MOPOP_InitYearHist(keyWall, parentGo, function (keyWall, parentGo) {\n        myconsolelog(\"MOPOP_InitYearHist after cb ... keyWall => \" + keyWall);\n        if (MOPOP.yearcharts[keyWall] != null) {\n            var chartData = MOPOP.yearcharts[keyWall];\n            try {\n                if (chartData.chartGo) {\n\n                    var T = [-wallWidth * 0.2, wallHeight * 0.4, 0.2]; //was: [-wallWidth * 0.2, -wallHeight * 0.2, 0],\n                    var R = [0, -0.707, 0, 0.707]; //[0, 1, 0, 0]\n                    var S = [0.5, 0.5, 0.5];\n                    if (reversed) {\n                        T = [wallWidth, wallHeight * 0.4, 0.6];\n                        R = [0, 0.707, 0, 0.707];\n                    }\n\n                    RT.Unity.SetParent(chartData.chartGo, parentGo);\n                    RT.Unity.SetLocalPose(\n                        chartData.chartGo,\n                        T, //was: [-wallWidth * 0.2, -wallHeight * 0.2, 0],\n                        R, //[0, 1, 0, 0]\n                        S\n                    );\n\n                    if (!reversed) {\n                        chartData.chartGo.transform.Rotate(0, 0, -2.6);\n                    } else {\n                        chartData.chartGo.transform.Rotate(0, 0, 9.7);\n                    }\n                    //chartData.chartGo.transform.rotation = new UE.Quaternion(R[0], R[1], R[2], R[3]);\n\n                    //chartData.chartGo.transform.Rotate()\n\n                    //add background\n                    if (true) {\n                        var bgGo = RT.Unity.GetVisPrefabInstance(\"bgplane\", chartData.chartGo.name + \"bg\");\n                        RT.Unity.SetParent(bgGo, chartData.chartGo);\n                        RT.Unity.SetLocalPose(\n                            bgGo,\n                            [0.5, 0.5, 0.1], //was: [-wallWidth * 0.2, -wallHeight * 0.2, 0],\n                            [-0.707, 0, 0, 0.707], //[0, 1, 0, 0]\n                            [0.15, 0.2, 0.15]\n                        );\n\n                        var r = bgGo.GetComponent(MAIN.UE.Renderer);\n                        if (r != null) {\n                            //r.material.color = MAIN.UE.Color.green;\n                            r.material.color = new MAIN.UE.Color(0.3, 0.3, 0.3, 0.9);\n                        }\n                    }\n\n\n                    var axisP = chartData.bvv.Presenter.AxisPresenters;\n                    axisP[0].IsCategorical = true;\n                    axisP[0].LabelTickIntervall = 5;\n                    axisP[0].LabelOrientation = 2; //X-Axis //this works\n                    axisP[1].LabelOrientation = 2; //Y-Axis //this works\n\n                    myconsolelog(\"MOPOP_InitYearHist after cb setting axis ... #axisP=\" + axisP.length);\n                    chartData.bvv.Rebuild();\n                }\n            } catch (err) {\n                myconsolelog(\"MOPOP_InitYearHist after cb pos ERROR => \" + err);\n            }\n\n            try {\n                if (chartData.panelGo) {\n                    myconsolelog(\"MOPOP_InitYearHist after cb setiing panel ... => \" + chartData.panelGoName);\n                    chartData.panelGo.Expire();\n                    var tWu = MAIN_CreateLabel(chartData.panelGoName, [0.8, 0.9, 0], [0, 0, 0, 0],\n                        [0.0015, 0.0015, 0.0015], chartData.chartGo, \"Year Distribution\");\n                    chartData.panelGo = tWu;\n                }\n            } catch (err) {\n                myconsolelog(\"MOPOP_InitYearHist after cb wu ERROR => \" + err);\n            }\n        }\n    });\n}\n\nfunction MOPOP_SetupScoreChart(hGo, wallWidth, wallHeight) {\n    var parentGo = hGo;\n\n    //iatk\n    MOPOP_InitScoreChart(function () {\n        try {\n            console.log(\"MOPOP_InitScoreChart CB 0\");\n            if (MOPOP.scorechart != null) {\n                console.log(\"MOPOP_InitScoreChart CB 0b\");\n\n                var chartData = MOPOP.scorechart;\n                if (chartData.chartGo) {\n                    console.log(\"MOPOP_SetupScoreChart SC name => \" + chartData.chartGo.name);\n\n                    console.log(\"MOPOP_InitScoreChart CB 1\");\n                    RT.Unity.SetParent(chartData.chartGo, parentGo);\n                    RT.Unity.SetLocalPose(\n                        chartData.chartGo,\n                        [-wallWidth * 0.4, wallHeight * 0.5, 0],\n                        [0, 1, 0, 0],\n                        [0.35, 0.35, 0.35]\n                    );\n\n                    console.log(\"MOPOP_InitScoreChart CB 2\");\n\n                    //make chart 2d by removing z axis\n                    chartData.abstractVisualisation.visualisationReference.zDimension.Attribute = \"Undefined\";\n                    console.log(\"MOPOP_InitScoreChart CB 2b\");\n\n                    chartData.abstractVisualisation.UpdateVisualisation(chartData.PropertyType.Z);\n                    console.log(\"MOPOP_InitScoreChart CB 2c\");\n\n                    //chartData.abstractVisualisation.visualisationReference.sizeDimension = \"score\";\n                    //chartData.abstractVisualisation.UpdateVisualisation(chartData.PropertyType.Size);\n\n                    console.log(\"MOPOP_InitScoreChart CB 3\");\n                    //chartData.fctChangeStyle(chartData.GeometryType.Lines); // --> maybe do that later\n\n                    \n                    //set gradient\n                    var UE = importNamespace(\"UnityEngine\");\n                    var gradient = new UE.Gradient();\n    \n                    // Populate the color keys at the relative time 0 and 1 (0 and 100%)\n                    var colorKey = [new UE.GradientColorKey(), new UE.GradientColorKey(), new UE.GradientColorKey()];\n                    colorKey[0].color = new UE.Color(1, 0, 0);\n                    colorKey[0].time = 0.0;\n                    colorKey[1].color = new UE.Color(1, 1, 0)\n                    colorKey[1].time = 0.5;\n                    colorKey[2].color = new UE.Color(0, 1, 0)\n                    colorKey[2].time = 1.0;\n\n                    console.log(\"MOPOP_InitScoreChart CB 3b\");\n    \n                    // Populate the alpha  keys at relative time 0 and 1  (0 and 100%)\n                    var alphaKey = [new UE.GradientAlphaKey(), new UE.GradientAlphaKey(), new UE.GradientAlphaKey()];\n                    alphaKey[0].alpha = 1.0;\n                    alphaKey[0].time = 0.0;\n                    alphaKey[1].alpha = 1.0;\n                    alphaKey[1].time = 0.5;\n                    alphaKey[2].alpha = 1.0;\n                    alphaKey[2].time = 1.0;\n                    gradient.SetKeys(colorKey, alphaKey);\n\n                    console.log(\"MOPOP_InitScoreChart CB 3c\");\n    \n                    chartData.abstractVisualisation.visualisationReference.colourDimension = \"score\";\n                    console.log(\"MOPOP_InitScoreChart CB 3d\");\n\n                    chartData.abstractVisualisation.visualisationReference.dimensionColour = gradient;\n                    console.log(\"MOPOP_InitScoreChart CB 3e\");\n\n                    chartData.abstractVisualisation.UpdateVisualisation(chartData.PropertyType.Colour);\n                    console.log(\"MOPOP_InitScoreChart CB 3f\");\n                    \n\n                    if (true) {\n                        console.log(\"MOPOP_InitScoreChart CB 4\");\n                        var tWuName = \"WU_ScoreEvents\";\n                        var tWuEHist = RT.Unity.CreateWU(tWuName, MAIN.WEBAPI.uiurl + \"/eventhistory.html\", true, 700, 1000);\n                        RT.Unity.SetParent(tWuEHist, chartData.chartGo);\n                        RT.Unity.SetLocalPose(tWuEHist, [1.8, 0.5, 0], [0, 0, 0, 1], [0.001, 0.001, 0.0001]);\n                    }\n\n                    console.log(\"MOPOP_InitScoreChart CB 5\");\n\n                    RT.Web.SetTiimeout(500, function () {\n                        MOPOP.scorechart.fctChangeStyle(MOPOP.scorechart.GeometryType.Bars);\n                        //MOPOP.scorechart.abstractVisualisation.UpdateVisualisation(chartData.PropertyType.GeometryType);\n                    });\n                    console.log(\"MOPOP_InitScoreChart CB 5b\");\n                }\n\n                console.log(\"MOPOP_InitScoreChart CB 6\");\n\n                if (chartData.panelGo) {\n                    chartData.panelGo.Expire();\n\n                    var tWu = MAIN_CreateLabel(chartData.panelGoName, [0.8, 0.9, 0], [0, 0, 0, 0],\n                        [0.0015, 0.0015, 0.0015], chartData.chartGo, \"Live Score\");\n                    chartData.panelGo = tWu;\n                    MOPOP.scorechart.panelGo = tWu;\n                    console.log(\"MOPOP_InitScoreChart CB 7\");\n                }\n\n                console.log(\"MOPOP_InitScoreChart CB 8\");\n\n                if (true) {\n                    var bgGo = RT.Unity.GetVisPrefabInstance(\"bgplane\", chartData.chartGo.name + \"bg\");\n                    RT.Unity.SetParent(bgGo, chartData.chartGo);\n                    RT.Unity.SetLocalPose(\n                        bgGo,\n                        [0.5, 0.5, 0.1], //was: [-wallWidth * 0.2, -wallHeight * 0.2, 0],\n                        [-0.707, 0, 0, 0.707], //[0, 1, 0, 0]\n                        [0.15, 0.2, 0.15]\n                    );\n\n                    var r = bgGo.GetComponent(MAIN.UE.Renderer);\n                    if (r != null) {\n                        //r.material.color = MAIN.UE.Color.green;\n                        r.material.color = new MAIN.UE.Color(0.3, 0.3, 0.3, 0.9);\n                    }\n                }\n            }\n        } catch (err) {\n            console.log(\"MOPOP_InitScoreChart CB ERROR => \" + err);\n        }\n    });\n\n    return;\n    //u2v\n    /*\n    MOPOP_InitScoreChart(function () {\n        if (MOPOP.scorechart != null) {\n            var chartData = MOPOP.scorechart;\n            try {\n                if (chartData.chartGo) {\n                    myconsolelog(\"MOPOP_SetupScoreChart SC name => \" + chartData.chartGo.name);\n                    RT.Unity.SetParent(chartData.chartGo, parentGo);\n                    RT.Unity.SetLocalPose(\n                        chartData.chartGo,\n                        [-wallWidth * 0.4, wallHeight * 0.5, 0],\n                        [0, 1, 0, 0],\n                        [0.35, 0.35, 0.35]\n                    );\n\n                    // adding bg plane for readability\n                    if (true) {\n                        var bgGo = RT.Unity.GetVisPrefabInstance(\"bgplane\", chartData.chartGo.name + \"bg\");\n                        RT.Unity.SetParent(bgGo, chartData.chartGo);\n                        RT.Unity.SetLocalPose(\n                            bgGo,\n                            [0.5, 0.5, 0.1], //was: [-wallWidth * 0.2, -wallHeight * 0.2, 0],\n                            [-0.707, 0, 0, 0.707], //[0, 1, 0, 0]\n                            [0.15, 0.2, 0.15]\n                        );\n\n                        var r = bgGo.GetComponent(MAIN.UE.Renderer);\n                        if (r != null) {\n                            //r.material.color = MAIN.UE.Color.green;\n                            r.material.color = new MAIN.UE.Color(0.3, 0.3, 0.3, 0.9);\n                        }\n                    }\n\n                    // adding score event history\n                    if (true) {\n                        var tWuName = \"WU_ScoreEvents\";\n                        var tWuEHist = RT.Unity.CreateWU(tWuName, MAIN.WEBAPI.uiurl + \"/eventhistory.html\", true, 700, 1000);\n                        RT.Unity.SetParent(tWuEHist, chartData.chartGo);\n                        RT.Unity.SetLocalPose(tWuEHist, [1.8, 0.5, 0], [0, 0, 0, 1], [0.001, 0.001, 0.0001]);\n                    }\n\n                    var U2V = importNamespace(\"u2vis\");\n                    var axisP = chartData.chartGo.GetComponentsInChildren(U2V.GenericAxisView);\n                    axisP[1].AxisPresenter.LabelOrientation = 2; //Y-Axis\n                    chartData.bvv.Rebuild();\n                }\n            } catch (err) {\n                myconsolelog(\"MOPOP_SetupScoreChart SC ERROR => \" + err);\n            }\n\n            try {\n                if (chartData.panelGo) {\n                    chartData.panelGo.Expire();\n\n                    var tWu = MAIN_CreateLabel(chartData.panelGoName, [0.8, 0.9, 0], [0, 0, 0, 0],\n                        [0.0015, 0.0015, 0.0015], chartData.chartGo, \"Live Score\");\n                    chartData.panelGo = tWu;\n                    MOPOP.scorechart.panelGo = tWu;\n                }\n            } catch (err) {\n                myconsolelog(\"MOPOP_SetupScoreChart SC panel ERROR => \" + err);\n            }\n        }\n    });*/\n}\n\n\n\nfunction MOPOP_HookWallHookEntry(mThis, mOther, mData) {\n    //{\"TrackableName\":\"16325654015\",\"TrackedGoName\":\"VIT-6-16325654015\",\"goName\":\"Test16325654015\",\"wuName\":\"UI16325654015\"}\n    var dObj = JSON.parse(mData);\n\n    //only process tracked label hits\n    if (mOther.indexOf(\"UI\") < 0) {\n        return;\n    }\n\n    //hook access for testing\n    var hookOcc = MOPOP.hookwall[dObj.hookWall].hooks[dObj.tileGoName];\n    myconsolelog(\"VZTrigger Occ [\" + dObj.hookWall + \", \" + dObj.tileGoName + \"] => \" +\n        hookOcc.isOccupied + \" / \" + hookOcc.occupante);\n\n    if (MOPOP.picked != null) {\n        MOPOP_ReportUserEvent(MOPOP.userevents.placed,\n            {\n                \"artefact\": MOPOP.picked,\n                \"wall\": dObj.hookWall,\n                \"hook\": dObj.tileGoName\n            }, Date.now(), MOPOP.user);\n\n        try {\n            myconsolelog(\"MOPOP Artefact_MakeMePlaced => \" + MOPOP.picked.wuName);\n            var wuName1 = MOPOP.picked.wuName;\n            var tw1 = MAIN.PUI.WorldUI.Find(wuName1);\n            if (tw1 != null) {\n                tw1.document.Run(\"Artefact_MakeMePlaced\", [\"\"]);\n            }\n        } catch (setPlacedErr) {\n            myconsolelog(\"MOPOP Artefact_MakeMePlaced ERROR => \" + setPlacedErr);\n        }\n\n        var pickedName = MOPOP.picked.TrackableName;\n        var pickedGoName = MOPOP.picked.TrackedGoName;\n        myconsolelog(\"VZTrigger Enter smth picked? => \" + JSON.stringify(MOPOP.picked));\n\n        MOPOP.hookwall[dObj.hookWall].hooks[dObj.tileGoName].isOccupied = true;\n        MOPOP.hookwall[dObj.hookWall].hooks[dObj.tileGoName].occupante = MOPOP.picked;\n        MOPOP.picked = null;\n\n\n\n        $(\"#rr_mopop_bottom_picked\").html(\"\");\n        $(\"#rr_mopop_bottom_info\").html(dObj.tileGoName + \"=>\" + pickedName);\n\n        //set is now placed on wall\n\n        //find hook and change color\n        var goHookParent = dObj.hookWall + \"/\" + dObj.tileGoName;\n        var goHookName = dObj.hookWall + \"/\" + dObj.tileGoName + \"/\" + dObj.hookGoName;\n        myconsolelog(\"VZTrigger looking for => \" + goHookName);\n        var hookGo = MAIN.UE.GameObject.Find(goHookName);\n        if (hookGo != null) {\n            var r = hookGo.GetComponent(MAIN.UE.Renderer);\n            if (r != null) {\n                //r.material.color = MAIN.UE.Color.red;\n                r.material.color = new MAIN.UE.Color(0, 1, 0, 0.8);\n                //RT.Unity.SpawnNotification(5, \"Occupied hook \" + dObj.tileGoName);\n                PlayNotification();\n                MOPOP_CalcScore();\n            }\n        }\n\n        //set timeline bezier\n        var fullDateStr = MOPOP.artefacts[pickedName].publishdate;\n        myconsolelog(\"VZTrigger TL MOPOP.artefacts = > \" + JSON.stringify(MOPOP.artefacts));\n        myconsolelog(\"VZTrigger TL fullDateStr = > \" + fullDateStr);\n\n        //const fullDate = new Date(fullDateStr);\n        //var year = fullDate.getFullYear();\n        var year = MOPOP_GetYearFromString(fullDateStr);\n        myconsolelog(\"VZTrigger TL year = > \" + year);\n\n        var bezName = \"BZ\" + \"_\" + pickedName;\n        var yearTickGoName = dObj.hookWall + \"/\" + dObj.hookWall + \"_TL\" + \"/\" + dObj.hookWall + \"_TL_tick_\" + year;\n\n        myconsolelog(\"VZTrigger TL bezName => \" + bezName);\n        myconsolelog(\"VZTrigger TL yearTickGoName => \" + yearTickGoName);\n\n        var bezGo = RT.Unity.CreateBezier(bezName, pickedGoName, yearTickGoName);\n        MOPOP.artefacts[pickedName].bezGo = bezGo;\n    }\n}\n\nfunction MOPOP_HookWallHookExit(mThis, mOther, mData) {\n    //activated on exit\n}\n\nfunction MOPOP_SetupHookwall(W, H, tileModel, tileSize, hGoName, hGo) {\n    for (var h = 0; h < H; h++) {\n        for (var w = 0; w < W; w++) {\n            //myconsolelog(\"MOPOP_InitEnv [\" + w + \",\" + h + \"] hookswalls tile[\" + i + \"] => current \" + w + \", \" + h);\n            var go = MAIN.VZ.AssetBundleHolder.InstantiateGameObject(MAIN.location.envassetbundle, tileModel);\n            if (go != null) {\n                //myconsolelog(\"MOPOP_InitEnv hookswals tile [\" + i + \"] => current \" + w + \", \" + h + \" => FOUND TILE\");\n                go.name = hGoName + \"_\" + w + \"_\" + h;\n\n                //HW_rockwall_6_1\n                //HW_rockwall_7_2\n                //[HW_rockwall_0_0][HW_rockwall_1_0][HW_rockwall_2_0]\n                //[HW_rockwall_0_1][HW_rockwall_1_1][HW_rockwall_2_1]\n                //[HW_rockwall_0_2][HW_rockwall_1_2][HW_rockwall_2_2]\n\n                MOPOP.hookwall[hGoName].hooks[go.name] = {\n                    \"isOccupied\": false,\n                    \"occupante\": null,\n                    \"x\": w,\n                    \"y\": h\n                };\n                myconsolelog(\"MOPOP_InitEnv [\" + w + \",\" + h + \"] XXX => \" + JSON.stringify(MOPOP.hookwall));\n\n                go.transform.parent = hGo.transform;\n                go.transform.localPosition = new MAIN.UE.Vector3(tileSize * w, tileSize * h, 0);\n\n                //myconsolelog(\"MOPOP_InitEnv [\" + w + \",\" + h + \"] setting up trigger  hookswals[\" + i + \"] ...\");\n                //PrepareInteractionGo(GameObject go, JSCallback enterCB, JSCallback exitCB, string data)\n                var centerGo = MAIN.UE.GameObject.Find(go.name + \"/Hook\");\n                if (centerGo != null) {\n\n                    centerGo.transform.localScale =\n                        new MAIN.UE.Vector3(\n                            centerGo.transform.localScale.x * 5,\n                            centerGo.transform.localScale.y * 5,\n                            centerGo.transform.localScale.z * 10\n                        );\n\n                    //added that to fix starting color\n                    var r = centerGo.GetComponent(MAIN.UE.Renderer);\n                    if (r != null) {\n                        //r.material.color = MAIN.UE.Color.green;\n                        r.material.color = new MAIN.UE.Color(0.4, 0.4, 0.4, 0.5);\n                    }\n\n                    var triggerData = {\n                        \"hookWall\": hGoName,\n                        \"tileGoName\": go.name,\n                        \"hookGoName\": centerGo.name\n                    };\n                    MAIN.RR.Runtime.PrepareInteractionGo(\n                        centerGo,\n                        MOPOP_HookWallHookEntry,\n                        MOPOP_HookWallHookExit,\n                        JSON.stringify(triggerData)\n                    );\n                }\n\n                var tileGo = MAIN.UE.GameObject.Find(go.name + \"/Tile\");\n                if (tileGo != null) {\n                    RT.Unity.DestroyGO(tileGo);\n                }\n            }\n        }\n    }\n\n    console.log(\"MOPOP_SetupHookwall MOPOP.hookwall[\" + hGoName + \"] => \" + JSON.stringify(MOPOP.hookwall[hGoName]));\n}\n\nfunction MOPOP_TempTable_InfoHookEntry(mThis, mOther, mData) {\n    if (mOther.indexOf(\"UI\") < 0) {\n        return;\n    }\n\n    var pickedName = MOPOP.picked.TrackableName;\n\n    MOPOP_TempTable_StandardHookEntry(mThis, mOther, mData);\n    //{\"TrackableName\":\"16325654015\",\"TrackedGoName\":\"VIT-6-16325654015\",\"goName\":\"Test16325654015\",\"wuName\":\"UI16325654015\"}\n\n    myconsolelog(\"MOPOP_TempTable_InfoHookEntry \" + mThis + \", \" + mOther + \", \" + mData);\n    //MOPOP_TempTable_InfoHookEntry Hook, Tile, {\"temptable\":\"TT_infotable\",\"tileGoName\":\"TT_infotable_0_0\",\"hookGoName\":\"Hook\"}\n    var dObj = JSON.parse(mData);\n\n    MOPOP.AddInfoPick(pickedName);\n    var infoPickedJson = JSON.stringify(MOPOP.infopicks);\n\n    var wuName = MOPOP.temptable[\"TT_infotable\"].wuName;\n    var tw = MAIN.PUI.WorldUI.Find(wuName);\n    if (tw != null) {\n        tw.document.Run(\"Infotable_NewPick\", [infoPickedJson]);\n    } else {\n        myconsolelog(\"MOPOP_TempTable_InfoHookEntry before TM tw NOT found for AttrComb_ExternalInitMe\");\n    }\n}\n\nfunction MOPOP_TempTable_StandardHookEntry(mThis, mOther, mData) {\n\n    //{\"TrackableName\":\"16325654015\",\"TrackedGoName\":\"VIT-6-16325654015\",\"goName\":\"Test16325654015\",\"wuName\":\"UI16325654015\"}\n    var dObj = JSON.parse(mData);\n\n    //only process tracked label hits\n    if (mOther.indexOf(\"UI\") < 0) {\n        myconsolelog(\"VZTrigger Enter no VIT object\");\n        return;\n    }\n\n    myconsolelog(\"VZTrigger Enter -> \" + mThis + \", \" + mOther + \", \" + mData);\n\n    //hook access for testing\n    var ttOcc = MOPOP.temptable[dObj.temptable].hooks[dObj.tileGoName];\n\n    if (MOPOP.picked != null) {\n        MOPOP_ReportUserEvent(MOPOP.userevents.placedontable,\n            {\n                \"artefact\": MOPOP.picked,\n                \"temptable\": dObj.temptable,\n                \"hook\": dObj.tileGoName\n            }, Date.now(), MOPOP.user);\n\n        try {\n            myconsolelog(\"MOPOP Artefact_MakeMePlaced => \" + MOPOP.picked.wuName);\n            var wuName1 = MOPOP.picked.wuName;\n            var tw1 = MAIN.PUI.WorldUI.Find(wuName1);\n            if (tw1 != null) {\n                tw1.document.Run(\"Artefact_MakeMePlaced\", [\"\"]);\n            }\n        } catch (setPlacedErr) {\n            myconsolelog(\"MOPOP Artefact_MakeMePlaced ERROR => \" + setPlacedErr);\n        }\n\n        var pickedName = MOPOP.picked.TrackableName;\n        var pickedGoName = MOPOP.picked.TrackedGoName;\n        myconsolelog(\"VZTrigger Enter smth picked? => \" + JSON.stringify(MOPOP.picked));\n\n        MOPOP.temptable[dObj.temptable].hooks[dObj.tileGoName].isOccupied = true;\n        MOPOP.temptable[dObj.temptable].hooks[dObj.tileGoName].occupante = MOPOP.picked;\n        MOPOP.picked = null;\n\n        //find hook and change color\n        var goHookName = dObj.temptable + \"/\" + dObj.tileGoName + \"/\" + dObj.hookGoName;\n        myconsolelog(\"VZTrigger looking for => \" + goHookName);\n        var hookGo = MAIN.UE.GameObject.Find(goHookName);\n        if (hookGo != null) {\n            var r = hookGo.GetComponent(MAIN.UE.Renderer);\n            if (r != null) {\n                //r.material.color = MAIN.UE.Color.red;\n                r.material.color = new MAIN.UE.Color(0, 1, 0, 0.8);\n                //RT.Unity.SpawnNotification(5, \"Occupied hook \" + dObj.tileGoName);\n                PlayNotification();\n                MOPOP_CalcScore();\n            }\n        }\n\n    }\n}\n\n\nfunction MOPOP_TempTable_StandardHookExit(mThis, mOther, mData) {\n\n}\n\n\nfunction MOPOP_InitEnv() {\n    myconsolelog(\"MOPOP_InitEnv starting ...\");\n    myconsolelog(\"MOPOP_InitEnv starting ... Date.now() => \" + Date.now());\n\n    myconsolelog(\"MOPOP_InitEnv starting ... MOPOP_UpdateHookOccupation every 500ms\");\n    RT.Web.SetInterval(3000, 500, MOPOP_UpdateHookOccupation2);\n\n    var mUser = RT.Help.GetStringFromCfg(\"user\");\n    myconsolelog(\"MOPOP_InitEnv starting ... mUser = \" + mUser);\n    if (mUser != null && mUser.length > 0) {\n        MOPOP.user = mUser;\n    } else {\n        MOPOP.user = \"auto\" + Date.now();\n    }\n\n    myconsolelog(\"MOPOP_InitEnv starting ... MOPOP.user = \" + MOPOP.user);\n\n    MOPOP_ReportUserEvent(MOPOP.userevents.start, \"\", Date.now(), MOPOP.user);\n\n\n    if (MAIN.hasOwnProperty(\"location\")) {\n        myconsolelog(\"MOPOP_InitEnv MAIN.location FOUND\");\n        if (MAIN.location.hasOwnProperty(\"data\")) {\n            myconsolelog(\"MOPOP_InitEnv MAIN.location.data FOUND\");\n            if (MAIN.location.data.hasOwnProperty(\"mopop\")) {\n                myconsolelog(\"MOPOP_InitEnv MAIN.location.data.mopop FOUND\");\n            }\n        }\n    }\n\n    myconsolelog(\"MOPOP_InitEnv MAIN.location.data.mopop => \" + MAIN.location.data.mopop);\n\n    if (MAIN.worldgo == null) {\n        MAIN.worldgo = MAIN.UE.GameObject.Find(\"world\");\n    }\n\n    MOPOP_InitMqtt();\n    try {\n        var mopop = MAIN.location.data.mopop;\n        if (mopop.hasOwnProperty(\"hookwalls\")) {\n            var N = mopop.hookwalls.length;\n            myconsolelog(\"MOPOP_InitEnv #hookswals => \" + N);\n            for (var i = 0; i < N; i++) {\n\n                //this is a hook wall\n                var hw = mopop.hookwalls[i];\n                var hName = hw.name;\n                var hDisplayName = hw.displayname;\n                var tileModel = hw.tilemodel;\n                var tileSize = hw.tilesize;\n                var W = hw.width;\n                var H = hw.height;\n                var wallWidth = tileSize * W;\n                var wallHeight = tileSize * H;\n\n                var hTrans = null;\n                if (hw.hasOwnProperty(\"transform\")) {\n                    hTrans = hw.transform;\n                }\n\n                var hTimeline = null;\n                if (hw.hasOwnProperty(\"timeline\")) {\n                    //\"start\": 1990,\n                    //\"end\": 2020,\n                    //\"tick\": 1\n                    hTimeline = hw.timeline;\n                }\n\n                myconsolelog(\"MOPOP_InitEnv hookswals[\" + i + \"] => \" + hName + \", \" + tileModel + \", \" + W + \", \" + H + \", \" + tileSize);\n\n                var hGoName = \"HW_\" + hName;\n                var hGo = null;\n                hGo = MAIN.UE.GameObject.Find(hGoName);\n                if (hGo != null) {\n                    RT.Unity.DestroyGO(hGo);\n                }\n\n                hGo = new MAIN.UE.GameObject();\n                myconsolelog(\"MOPOP_InitEnv 1\");\n\n                if (hGo != null) {\n                    hGo.name = hGoName;\n\n                    if (MAIN.worldgo != null) {\n                        RT.Unity.SetParent(hGo, MAIN.worldgo);\n                    }\n\n                    MAIN.RR.Runtime.ToggleObjManipulation(hGo.name);\n                    MAIN.RR.Runtime.ToggleBounds(hGo.name);\n\n                    myconsolelog(\"MOPOP_InitEnv 2\");\n\n                    hGo.transform.localPosition = new MAIN.UE.Vector3(0, 0, i * 0.1);\n\n                    myconsolelog(\"MOPOP_InitEnv 3\");\n\n                    MOPOP.hookwall[hGoName] = {};\n                    MOPOP.hookwall[hGoName].name = hGoName;\n                    MOPOP.hookwall[hGoName].hooks = {};\n\n                    MAIN_CreateLabel(hGoName + \"_title\", [-tileSize * 0.5, wallHeight - tileSize * 0.5, 0], [0, 1, 0, 0],\n                        [0.001, 0.001, 0.001], hGo, hDisplayName);\n\n                    //Creates a Timeline from cube as a set of children\n                    MOPOP_SetupTimeline(hTimeline, hGo, tileSize, W, H, wallWidth, hw.reversed);\n\n                    //creates and sets up the year-distribution chart per wall\n                    MOPOP_SetupYearHist(hName, hGo, wallWidth, wallHeight, hw.reversed);\n\n                    //create a wall with its tiles and interactions callbacks\n                    MOPOP.hookwall[hGoName].reversed = hw.reversed;\n                    MOPOP.hookwall[hGoName].w = W;\n                    MOPOP.hookwall[hGoName].h = H;\n                    MOPOP_SetupHookwall(W, H, tileModel, tileSize, hGoName, hGo);\n\n                    if (hTrans != null) {\n                        RT.Unity.SetLocalPose(hGo, hTrans.position, hTrans.rotation, hTrans.scale);\n                    }\n                }\n                myconsolelog(\"MOPOP_InitEnv NEXT WALL ...\");\n            }\n        }\n\n        //init temptables\n        if (mopop.hasOwnProperty(\"temptables\")) {\n            var N = mopop.temptables.length;\n            myconsolelog(\"MOPOP_InitEnv #temptables => \" + N);\n            for (var i = 0; i < N; i++) {\n\n                var tt = mopop.temptables[i];\n                var tName = tt.name;\n                var tDisplayName = tt.displayname;\n                var tileModel = tt.tilemodel;\n                var tileSize = tt.tilesize;\n                var W = tt.width;\n                var H = tt.height;\n                var wallWidth = tileSize * W;\n                var wallHeight = tileSize * H;\n\n                var tTrans = null;\n                if (tt.hasOwnProperty(\"transform\")) {\n                    tTrans = tt.transform;\n                }\n\n                var tGoName = \"TT_\" + tName;\n                var tGo = null;\n                tGo = MAIN.UE.GameObject.Find(tGoName);\n                if (tGo != null) {\n                    RT.Unity.DestroyGO(tGo);\n                }\n                tGo = new MAIN.UE.GameObject();\n\n                if (tGo != null) {\n                    tGo.name = tGoName;\n\n                    if (MAIN.worldgo != null) {\n                        RT.Unity.SetParent(tGo, MAIN.worldgo);\n                    }\n\n                    MAIN.RR.Runtime.ToggleObjManipulation(tGo.name);\n                    tGo.transform.localPosition = new MAIN.UE.Vector3(0, 0, i * 0.1);\n                    MOPOP.temptable[tGoName] = {};\n                    MOPOP.temptable[tGoName].name = tGoName;\n                    MOPOP.temptable[tGoName].hooks = {};\n                    MOPOP.temptable[tGoName].wuName = \"TT_WU_\" + tName;\n\n                    if (tName != \"infotable\") {\n                        MAIN_CreateLabel(tGoName + \"_title\", [-tileSize * 0.5, wallHeight - tileSize * 0.5, 0],\n                            [0, 0.707, 0.707, 0], [0.001, 0.001, 0.001], tGo, tDisplayName);\n                    }\n\n                    if (tName == \"infotable\") {\n                        var tWuName = MOPOP.temptable[tGoName].wuName;\n                        var tWuMenu = RT.Unity.CreateWU(tWuName, MAIN.WEBAPI.uiurl + \"/infomenu.html\", true, 700, 1000);\n                        RT.Unity.SetParent(tWuMenu, tGo);\n                        RT.Unity.SetLocalPose(tWuMenu, [-tileSize, 0, tileSize], [0, 0.707, 0.707, 0], [0.0005, 0.0005, 0.0005]);\n                    }\n\n                    //Creates and sets up a score chart\n                    if (tName == \"scoretable\") {\n                        MOPOP_SetupScoreChart(tGo, wallWidth, wallHeight);\n                        RT.Web.SetTiimeout(500, function () {\n                            //RT.Unity.SetLocalPose(MOPOP.scorechart.chartGo, [-tileSize * 2, 0, tileSize * 0.5], [0, 0.707, 0.707, 0], null);\n                            RT.Unity.SetLocalPose(MOPOP.scorechart.chartGo, [0, tileSize * 0.5, -1.5 * tileSize], [0, 0.707, 0.707, 0], null);\n                        });\n                    }\n\n                    //init temptable tiles\n                    for (var h = 0; h < H; h++) {\n                        for (var w = 0; w < W; w++) {\n                            var go = MAIN.VZ.AssetBundleHolder.InstantiateGameObject(MAIN.location.envassetbundle, tileModel);\n                            if (go != null) {\n                                go.name = tGoName + \"_\" + w + \"_\" + h;\n                                MOPOP.temptable[tGoName].hooks[go.name] = {\n                                    \"isOccupied\": false,\n                                    \"occupante\": null\n                                };\n\n                                go.transform.parent = tGo.transform;\n                                go.transform.localPosition = new MAIN.UE.Vector3(tileSize * w, tileSize * h, 0);\n\n                                var centerGo = MAIN.UE.GameObject.Find(go.name + \"/Hook\");\n                                if (centerGo != null) {\n\n                                    centerGo.transform.localScale =\n                                        new MAIN.UE.Vector3(\n                                            centerGo.transform.localScale.x * 4,\n                                            centerGo.transform.localScale.y * 4,\n                                            centerGo.transform.localScale.z * 8\n                                        );\n\n                                    var triggerData = {\n                                        \"temptable\": tGoName,\n                                        \"tileGoName\": go.name,\n                                        \"hookGoName\": centerGo.name\n                                    };\n\n                                    if (tName == \"infotable\") {\n                                        MAIN.RR.Runtime.PrepareInteractionGo(\n                                            centerGo,\n                                            MOPOP_TempTable_InfoHookEntry,\n                                            MOPOP_TempTable_StandardHookExit,\n                                            JSON.stringify(triggerData)\n                                        );\n                                    } else {\n                                        MAIN.RR.Runtime.PrepareInteractionGo(\n                                            centerGo,\n                                            MOPOP_TempTable_StandardHookEntry,\n                                            MOPOP_TempTable_StandardHookExit,\n                                            JSON.stringify(triggerData)\n                                        );\n                                    }\n\n\n                                }\n                            }\n                        }\n                    }\n                    if (tTrans != null) {\n                        RT.Unity.SetLocalPose(tGo, tTrans.position, tTrans.rotation, tTrans.scale);\n                    }\n                }\n            }\n        }\n    } catch (err) {\n        myconsolelog(\"MOPOP_InitEnv ERROR => \" + err);\n    }\n\n    MOPOP_ToggleWallManipulation();\n}\n\nfunction MOPOP_InfotableClick(mButtonName) {\n    if (mButtonName.toUpperCase() == \"COMPARE\") {\n\n        //TODO replace that through hookwall access\n        var parentGo = MAIN.UE.GameObject.Find(\"TT_infotable\");\n\n        try {\n            myconsolelog(\"MOPOP_InfotableClick 1\");\n            //MOPOP.AddInfoPick(\"2805595956\");\n\n            //parse table here\n            myconsolelog(\"MOPOP_InfotableClick 2\");\n            if (MOPOP.infopicks.length > 0) {\n                if (MOPOP.info.wu != null) {\n                    MOPOP.info.wu.Expire();\n                }\n\n                myconsolelog(\"MOPOP_InfotableClick 3 #MOPOP.infopicks=\" + MOPOP.infopicks.length);\n                myconsolelog(\"MOPOP_InfotableClick 3 MOPOP.infopicks=\" + JSON.stringify(MOPOP.infopicks));\n                //setup comparison table here\n                //[{\"artist\":\"Lady Gaga\",\"song\":\"The Fame\",\"coverid\":\"2805595956\",\"coverart\":\"2805595956.jpg\",\"publishdate\":\"2008-10-28T00:00:00.000Z\",\"publisher\":\"\",\"score\":\"100\"}]\n                var infoTrans = {\n                    '<>': 'div',\n                    'style': 'margin:1vh; padding:1vh; border: solid rgb(238,238,238) 2px; background-color:rgb(0,77,109); border-radius:1vh;font-weight:bold;width:500px;',\n                    'html': '${index} <span style=\"width:30%;margin:1vh;\">${artist} - ${song}</span> <span style=\"width:10%;margin:1vh;\">${publisher}</span> <span style=\"width:10%;margin:1vh;\">${score}</span> <span style=\"width:10%;margin:1vh;\">${soldcopies}</span>'\n                };\n                var html = '<div style=\"margin:1vh; padding:1vh; border: solid rgb(238,238,238) 2px; background-color:rgb(49,182,188); border-radius:2vh; font-weight:bold; width:550px;\">';\n                html += '<span style=\"width:30%;margin:1vh;\">ARTIST - SONG</span> <span style=\"width:10%;margin:1vh;\">PUBLISHER</span> <span style=\"width:10%;margin:1vh;\">SCORE</span> <span style=\"width:10%;margin:1vh;\">SOLD</span>';\n                html += json2html.transform(MOPOP.infopicks, infoTrans);\n                html += \"</div>\";\n\n                myconsolelog(\"MOPOP_InfotableClick 4 html =>\" + html);\n\n                MOPOP.info.wuName = \"TT_WU_infotable\";\n                MOPOP.info.wu = RT.Unity.CreateWU(MOPOP.info.wuName, html, false, 1024, 768);\n\n                myconsolelog(\"MOPOP_InfotableClick 5\");\n\n                RT.Unity.SetParent(MOPOP.info.wu, parentGo);\n                RT.Unity.SetLocalPose(MOPOP.info.wu, [0, 0, 0], [0, 0.707, 0.707, 0], [0.001, 0.001, 0.0001]);\n            }\n        } catch (berr) {\n            myconsolelog(\"MOPOP_InfotableClick ERROR berr => \" + berr);\n        }\n\n        if (MOPOP.infochart == null) {\n\n            MOPOP_InitInfoCompareChart(\"slot\", parentGo, function (keyWall, parentGo) {\n                myconsolelog(\"MOPOP_InitInfoCompareChart after cb ... keyWall => \" + keyWall);\n                if (MOPOP.infochart != null) {\n                    var chartData = MOPOP.infochart;\n                    try {\n                        if (chartData.chartGo) {\n                            RT.Unity.SetParent(chartData.chartGo, parentGo);\n                            RT.Unity.SetLocalPose(\n                                chartData.chartGo,\n                                [0.4, -0.4, 0],\n                                [0, -0.707, -0.707, 0],\n                                [0.3, 0.3, 0.3]\n                            );\n\n                            //TODO fix axis and the cat label axis\n\n                            var axisP = chartData.bvv.Presenter.AxisPresenters;\n                            axisP[0].IsCategorical = true;\n                            axisP[0].LabelTickIntervall = 5;\n                            axisP[0].LabelOrientation = 2; //X-Axis //this works\n                            axisP[1].LabelOrientation = 2; //Y-Axis //this works\n                            chartData.bvv.Rebuild();\n                        }\n\n\n                        //setup data here\n                        if (chartData.chartGo) {\n                            /*\n                            if (MOPOP.infochart.gdp != null) {\n                                try {\n                                    MOPOP.infochart.gdp.Initialize(this.rtp, 0, 2, [2, 4, 6]);\n                                } catch (err) {\n                                    MOPOP.infochart.gdp.Initialize(this.rtp, 0, 2, 0, [2, 4, 6]);\n                                }\n                            }\n                            chartData.bvv.Rebuild();\n                            */\n                            /*var Nslots = 3;//MOPOP.infopicks.length;\n                            for (var si = 0; si < Nslots; si++) {\n                                labels = [\"score\", \"sold\"];\n                                var data = {\n                                    \"data\": {\n                                        \"xdimname\": \"\",\n                                        \"xlabels\": labels,\n                                        \"ydimname\": \"amount\",\n                                        \"nindices\": labels.length,\n                                        \"mqtt\": MOPOP.topics.infocompare + \"/\" + si,\n                                        \"mqttdimensionkey\": \"amount\",\n                                        \"reset\": true\n                                    }\n                                };\n                                var dataJson = JSON.stringify(data);\n                                MOPOP.infochart.fctAddDimensionWithRealtimeKeys(dataJson);\n                            }*/\n                        }\n                    } catch (err) {\n                        myconsolelog(\"MOPOP_InfotableClick after cb pos ERROR => \" + err);\n                    }\n\n                    try {\n                        if (chartData.panelGo) {\n                            chartData.panelGo.Expire();\n                            //var tWu = MAIN_CreateLabel(chartData.panelGoName, [0.8, 0.9, 0], [0, 0, 0, 0],\n                            //    [0.0015, 0.0015, 0.0015], chartData.chartGo, \"Year Distribution\");\n                            //chartData.panelGo = tWu;\n                        }\n                    } catch (err) {\n                        myconsolelog(\"MOPOP_InfotableClick after cb wu ERROR => \" + err);\n                    }\n                }\n\n                //reset chart after init\n                RT.Web.SetTiimeout(100, function () {\n                    var pN = 3;\n                    for (var pi = 0; pi < pN; pi++) {\n                        var pl = {\n                            \"0\": {\n                                \"val\": 0, //to replace with val from cover\n                                \"id\": 0\n                            },\n                            \"1\": {\n                                \"val\": 0,\n                                \"id\": 1\n                            }\n                        };\n                        var topic = MOPOP.topics.infocompare + \"/\" + pi;\n                        var plStr = JSON.stringify(pl);\n                        myconsolelog(\"MOPOP_InfotableClick publish => \" + pN + \"|\" + topic + \" | \" + plStr);\n                        RT.MQTT.Publish(topic, plStr);\n                    }\n                });\n            });\n        }\n\n        //publish mqtt data here\n        RT.Web.SetTiimeout(800, function () {\n            if (MOPOP.infopicks.length > 0) {\n                //{\"artist\":\"Lady Gaga\",\"song\":\"The Fame\",\"coverid\":\"2805595956\",\"coverart\":\"2805595956.jpg\",\"publishdate\": \"2008-10-28T00:00:00.000Z\", \"publisher\": \"\", \"score\": \"100\"}\n                var picks = MOPOP.infopicks;\n                var pN = MOPOP.infopicks.length;\n                for (var pi = 0; pi < pN; pi++) {\n                    var pick = picks[pi];\n\n                    var soldCopiesStr = pick.soldcopies.replace(',', '');\n                    var soldCopies = parseFloat(soldCopiesStr) * 0.0001;\n                    //TODO normalize data here\n                    var pl = {\n                        \"0\": {\n                            \"val\": soldCopies, //to replace with val from cover\n                            \"id\": 0\n                        },\n                        \"1\": {\n                            \"val\": parseInt(pick.score),\n                            \"id\": 1\n                        }\n                    };\n                    var topic = MOPOP.topics.infocompare + \"/\" + pi;\n                    var plStr = JSON.stringify(pl);\n                    myconsolelog(\"MOPOP_InfotableClick publish => \" + pN + \"|\" + topic + \" | \" + plStr);\n                    RT.MQTT.Publish(topic, plStr);\n                }\n            }\n        });\n    }\n\n    if (mButtonName.toUpperCase() == \"CLEAR\") {\n        MOPOP.infopicks = [];\n        if (MOPOP.info.wu != null) {\n            MOPOP.info.wu.Expire();\n        }\n\n        RT.Web.SetTiimeout(100, function () {\n            var pN = 3;\n            for (var pi = 0; pi < pN; pi++) {\n                var pl = {\n                    \"0\": {\n                        \"val\": 0, //to replace with val from cover\n                        \"id\": 0\n                    },\n                    \"1\": {\n                        \"val\": 0,\n                        \"id\": 1\n                    }\n                };\n                var topic = MOPOP.topics.infocompare + \"/\" + pi;\n                var plStr = JSON.stringify(pl);\n                myconsolelog(\"MOPOP_InfotableClick publish => \" + pN + \"|\" + topic + \" | \" + plStr);\n                RT.MQTT.Publish(topic, plStr);\n            }\n        });\n    }\n}\n\nfunction MOPOP_DownloadArtefact(mCoverId) {\n    myconsolelog(\"MOPOP_DownloadArtefact looking for => \" + mCoverId);\n    var url = MAIN.WEBAPI.apiBase + \"/mopop/song?coverid=\" + mCoverId;\n    var headers = [\"content-type\", \"application/x-www-form-urlencoded\"];\n    var data = \"\";\n\n    RT.Web.SendWebReq(\"GET\", url, headers, data,\n        function (mError, mData) {\n            myconsolelog(\"MOPOP_DownloadArtefact mData => \" + mData);\n            if (mError == false) {\n                var sData = JSON.parse(mData);\n                if (sData.length > 0) {\n                    var d = sData[0];\n                    myconsolelog(\"MOPOP_DownloadArtefact => \" + d.coverid);\n                    MOPOP.artefacts[d.coverid] = d;\n                }\n            }\n        });\n}\n\nfunction MOPOP_AddAnchors() {\n    RT.WA.AddToGO(\"HW_popwall\");\n    RT.WA.AddToGO(\"HW_rockwall\");\n}\n\n\n/// MOPOP imple -> MOVE ELSEWHERE\nfunction MOPOP_TestDB() {\n    myconsolelog(\"MOPOP_TestDB ...\");\n    myconsolelog(\"MOPOP_TestDB MAIN.location.envtargets.xml=\" + MAIN.location.envtargets.xml);\n    myconsolelog(\"MOPOP_TestDB MAIN.location.envtargets.dat=\" + MAIN.location.envtargets.dat);\n\n\n    var reqHeaders = [\"content-type\", \"application/x-www-form-urlencoded\"];\n    var url = MAIN.WEBAPI.apiBase + \"/getfile2?name=\";\n\n    var urlA = url + MAIN.location.envtargets.xml;\n    RT.Web.DownloadFile(\"GET\", urlA, reqHeaders, MAIN.location.envtargets.xml, false, function () {\n        myconsolelog(\"MOPOP_TestDB downloaded => \" + MAIN.location.envtargets.xml);\n    });\n\n    var urlB = url + MAIN.location.envtargets.dat;\n    RT.Web.DownloadFile(\"GET\", urlB, reqHeaders, MAIN.location.envtargets.dat, false, function () {\n        myconsolelog(\"MOPOP_TestDB downloaded => \" + MAIN.location.envtargets.dat);\n    });\n\n    //TODO delay here\n    myconsolelog(\"MOPOP_TestDB Enabling tracking ...\");\n\n    RT.Web.SetTiimeout(5, function () {\n        RT.Unity.SpawnNotification(5, \"Artefact tracking started\");\n    });\n\n    //TODO pass here observeable go\n    importNamespace(\"RR\").Runtime.StartImgTracking(\n        function (mTrackableName, mTrackedGoName) {\n            myconsolelog(\"MOPOP_TestDB Target Found => \" + mTrackableName + \", \" + mTrackedGoName);\n\n            var goName = \"Test\" + mTrackableName;\n            var wuName = \"UI\" + mTrackableName;\n\n            var artefactData = {\n                \"TrackableName\": mTrackableName,\n                \"TrackedGoName\": mTrackedGoName,\n                \"goName\": goName,\n                \"wuName\": wuName\n            };\n\n            if (mTrackableName == \"18746832409\") {\n                console.log(\"XXXX => found \" + mTrackableName);\n                if (MAIN.worldgo != null) {\n                    console.log(\"XXXX => found MAIN.worldgo\");\n                    var go = MAIN.UE.GameObject.Find(mTrackedGoName);\n                    if (go != null) {\n                        console.log(\"XXXX => found mTrackedGoName => \" + mTrackedGoName);\n                        //RT.Unity.SetParent(MAIN.worldgo, go);\n                        RT.Unity.SetLocalPose(MAIN.worldgo, [0, 0, 0], [0, 0, 0, 0], [1, 1, 1]);\n                        MAIN.worldgo.transform.rotation = go.transform.rotation;\n                        MAIN.worldgo.transform.position = go.transform.position;\n\n                        //adding temp world anchors\n                        RT.WA.AddToGO(MAIN.worldgo.name);\n                        //RT.WA.AddToGO(\"HW_popwall\");\n                        //RT.WA.AddToGO(\"HW_rockwall\");\n                    }\n                }\n                return;\n            }\n\n\n            if (MOPOP.artefacts.hasOwnProperty(mTrackableName) == false) {\n                myconsolelog(\"MOPOP_TestDB Downloading artefact => \" + mTrackableName);\n                MOPOP_DownloadArtefact(mTrackableName);\n            }\n\n            myconsolelog(\"MOPOP Target found looking for data => \" + mTrackableName);\n            myconsolelog(\"MOPOP artefacts => \" + MAIN.location.data.mopop.artefacts)\n\n\n\n            //TODO check if its on a hook\n            // if it is on a hook, check if it is further away eg 5ck\n            // if so pick it up\n\n\n\n            //igonre that with registered artefacts\n            if (true || MAIN.location.data.mopop.artefacts) {\n                var entry = MAIN.location.data.mopop.artefacts[mTrackableName];\n                myconsolelog(\"MOPOP Target found data => \" + mTrackableName + \" => \" + entry);\n\n                // picked up flag\n                MOPOP.picked = artefactData;\n                //RT.Unity.SpawnNotification(5, \"Picked Up \" + mTrackableName);\n                PlayNotification();\n                $(\"#rr_mopop_bottom_picked\").html(mTrackableName);\n\n                try {\n                    var tw1 = MAIN.PUI.WorldUI.Find(wuName);\n                    if (tw1 != null) {\n                        tw1.document.Run(\"Artefact_MakeMePicked\", [\"\"]);\n                    }\n                } catch (setPickedErr) {\n                    myconsolelog(\"MOPOP Artefact_MakeMePicked ERROR => \" + setPickedErr);\n                }\n\n                MOPOP_ReportUserEvent(MOPOP.userevents.picked, MOPOP.picked, Date.now(), MOPOP.user);\n\n                try {\n                    if (MOPOP.artefacts[mTrackableName].hasOwnProperty(\"bezGo\")) {\n                        var bezGo = MOPOP.artefacts[mTrackableName].bezGo;\n                        MOPOP.artefacts[mTrackableName].bezGo = null;\n                        RT.Unity.DestroyGO(bezGo);\n                    }\n                } catch (bezCheckErr) {\n                    myconsolelog(\"MOPOP_TestDB Target ERROR bezCheckErr => \" + bezCheckErr);\n                }\n\n                try {\n                    //this was on\n                    //MOPOP_UpdateHookOccupation();\n                } catch (MP_UHO_err) {\n                    myconsolelog(\"MOPOP_TestDB Target occupation ERROR => \" + MP_UHO_err);\n                }\n            } else {\n                $(\"#rr_mopop_bottom_info\").html(mTrackableName + \"NOT in artefacts\");\n            }\n\n\n            /*RT.Web.SetTiimeout(5, function () {\n                RT.Unity.SpawnNotification(5, \"Found \" + mTrackableName);\n            });*/\n\n            var go = MAIN.UE.GameObject.Find(goName);\n            if (go == null) {\n\n                go = new MAIN.UE.GameObject(goName);\n                var url = MAIN.WEBAPI.uiurl + \"/artefact.html\";\n\n                //go = MAIN.UE.GameObject.CreatePrimitive(3);\n                //go.name = goName;\n\n                var parent = MAIN.UE.GameObject.Find(mTrackedGoName);\n\n                RT.Unity.SetParent(go, parent);\n                RT.Unity.SetLocalPose(go, [0, 0, 0], [0, 0, 0, 1], [0.05, 0.05, 0.05]);\n\n\n                var wu = RT.Unity.CreateWU(wuName, url, true, 1080, 1080);\n                RT.Unity.SetParent(wu, go);\n                RT.Unity.SetLocalPose(wu,\n                    [0, 0, 0],\n                    [1, 0, 0, 1],\n                    [0.003, 0.003, 0.001] //was null\n                );\n\n\n                var jsonStr = JSON.stringify(artefactData);\n\n                //test external init\n                myconsolelog(\"before AttrComb_ExternalInitMe data2share => \" + jsonStr);\n\n                RT.Web.SetTiimeout(500, function () {\n                    var tw = MAIN.PUI.WorldUI.Find(wuName);\n                    if (tw != null) {\n                        tw.document.Run(\"Artefact_ExternalInitMe\", [jsonStr]);\n                        tw.document.Run(\"Artefact_MakeMePicked\", [\"\"]);\n                    } else {\n                        myconsolelog(\"before TM tw NOT found for AttrComb_ExternalInitMe\");\n                    }\n                });\n\n                RT.Web.SetTiimeout(600, function () {\n                    var PUI = importNamespace(\"PowerUI\");\n                    var tw = PUI.WorldUI.Find(wuName);\n                    if (tw != null) {\n                        tw.document.Run(\"Artefact_ExternalTrackingOn\", [\"some data\"]);\n                    } else {\n                        myconsolelog(\"before TM tw NOT found for AttrComb_ExternalInitMe\");\n                    }\n                });\n            } else {\n                RT.Web.SetTiimeout(5, function () {\n                    var PUI = importNamespace(\"PowerUI\");\n                    var tw = PUI.WorldUI.Find(wuName);\n                    if (tw != null) {\n                        tw.document.Run(\"Artefact_ExternalTrackingOn\", [\"some data\"]);\n                    } else {\n                        myconsolelog(\"before TM tw NOT found for AttrComb_ExternalInitMe\");\n                    }\n                });\n            }\n            //MOPOP_CalcScore();\n        },\n        function (mTrackableName, mTrackedGoName) {\n            var wuName = \"UI\" + mTrackableName;\n            myconsolelog(\"MOPOP_TestDB Target Lost => \" + mTrackableName + \", \" + mTrackedGoName);\n\n            //RT.Web.SetTiimeout(5, function () {\n            //RT.Unity.SpawnNotification(5, \"Lost \" + mTrackableName);\n            //});\n            //PlayNotification();\n\n            RT.Web.SetTiimeout(5, function () {\n                var PUI = importNamespace(\"PowerUI\");\n                var tw = PUI.WorldUI.Find(wuName);\n                if (tw != null) {\n                    tw.document.Run(\"Artefact_ExternalTrackingOff\", [\"some data\"]);\n                } else {\n                    myconsolelog(\"before TM tw NOT found for AttrComb_ExternalInitMe\");\n                }\n            });\n        },\n        MAIN.location.envtargets.xml\n    );\n}\n\nfunction MOPOP_MenuHide() {\n    $('#rr_mopop_testing').hide();\n    var go = MAIN.UE.GameObject.Find(\"SLIDER_mopop_main\");\n    if (go != null) {\n        RT.Unity.DestroyGO(go);\n    }\n}\n\nfunction MOPOP_MenuShow() {\n    myconsolelog(\"MOPOP_MenuShow ...\");\n    $('#rr_mopop_testing').show();\n\n    myconsolelog(\"MOPOP_MenuShow ... importing ... \");\n    importNamespace(\"Vizario\").AssetBundleHolder.ImportFromFile(\n        MAIN.location.envassetbundle, MAIN.location.envassetbundle);\n\n    myconsolelog(\"MOPOP_MenuShow ... importing ... done\");\n\n    //var mainUi = MAIN.UE.GameObject.Find(\"UI\");\n    var mainUi = MAIN.UE.GameObject.Find(\"Main\");\n    var mainScale = mainUi.transform.localScale;\n\n    var iSx = 1 / mainScale.x;\n    var iSy = 1 / mainScale.y;\n    var iSz = 1 / mainScale.z;\n\n    RT.Unity.SetupSlider(\"SLIDER_mopop_main\", mainUi,\n        [0.0, 0.0, -90.0],\n        [0.12 * iSx, 0.03 * iSy, 0 * iSz],\n        [0.2 * iSx, 0.4 * iSy, 0.4 * iSz],\n        function (sliderGoName, oldVal, newVal) {\n            var elem = document.getElementById(\"rr_mopop_top\");\n            var maxScroll = elem.scrollHeight * 2;\n            var newPos = newVal * maxScroll;\n            elem.scrollTop = newPos;\n        }\n    );\n}\n\n\nfunction MOPOP_ToggleWallManipulation() {\n    var mopop = MAIN.location.data.mopop;\n    if (mopop.hasOwnProperty(\"hookwalls\")) {\n        var N = mopop.hookwalls.length;\n        myconsolelog(\"MOPOP_InitEnv #hookswals => \" + N);\n        for (var i = 0; i < N; i++) {\n            var hw = mopop.hookwalls[i];\n            var hGoName = \"HW_\" + hw.name;\n            MAIN.RR.Runtime.ToggleObjManipulation(hGoName);\n            MAIN.RR.Runtime.ToggleBounds(hGoName);\n        }\n    }\n}\n\nMOPOP.userevents = {\n    \"start\": {\n        \"name\": \"start\",\n        \"id\": 0\n    },\n    \"picked\": {\n        \"name\": \"picked\",\n        \"id\": 1\n    },\n    \"placed\": {\n        \"name\": \"placed\",\n        \"id\": 2\n    },\n    \"score\": {\n        \"name\": \"score\",\n        \"id\": 3\n    },\n    \"placedontable\": {\n        \"name\": \"placedontable\",\n        \"id\": 4\n    }\n}\n\n\nfunction MOPOP_ReportUserEvent(mEventObj, mDataObj, mEventtime, mUser) {\n\n    try {\n        var eventName = mEventObj.name;\n        var eventId = mEventObj.id;\n        var data = mDataObj;\n        var eventTime = mEventtime;\n        var thisUser = mUser;\n\n        var reportObj = {\n            \"user\": thisUser,\n            \"name\": eventName,\n            \"id\": eventId,\n            \"data\": data,\n            \"time\": eventTime\n        }\n        var reportStr = JSON.stringify(reportObj);\n        RT.MQTT.Publish(\"MOPOP/userevents\", reportStr);\n    } catch (err) {\n        myconsolelog(\"MOPOP_ReportUserEvent ERROR => \" + err);\n    }\n}\n\nfunction MOPOP_AutoStart() {\n    RT.Web.SetTiimeout(8000, function () {\n        MOPOP_InitEnv();\n        RT.Web.SetTiimeout(2000, function () {\n            MOPOP_TestDB();\n            //<img src=\"http://localhost:9999/mopop/mopop.jpg\" />\n            var murl = MAIN.WEBAPI.uiurl + \"/mopop/mopop.jpg\";\n            $(\"#rr_mopop_u_started\").html('<img src=\"' + murl + '\" width=\"100%\"/>');\n            $(\"#rr_mopop_u_started\").show();\n        });\n    });\n}\n\nfunction MOPOP_ImportAssets() {\n    importNamespace(\"Vizario\").AssetBundleHolder.ImportFromFile(\n        MAIN.location.envassetbundle, MAIN.location.envassetbundle);\n}\n\nwindow.MOPOP = MOPOP;\nwindow.MOPOP_InitEnv = MOPOP_InitEnv;\nwindow.MOPOP_InitMqtt = MOPOP_InitMqtt;\nwindow.scoreweight = scoreweight;\nwindow.MOPOP_CalcScore = MOPOP_CalcScore;\nwindow.MOPOP_UpdateHookOccupation2 = MOPOP_UpdateHookOccupation2;\nwindow.MOPOP_UpdateHookOccupation = MOPOP_UpdateHookOccupation;\nwindow.MOPOP_InitYearHist = MOPOP_InitYearHist;\nwindow.MOPOP_InitInfoCompareChart =MOPOP_InitInfoCompareChart;\nwindow.MOPOP_InitScoreChart = MOPOP_InitScoreChart;\nwindow.MOPOP_SetupYearHist = MOPOP_SetupYearHist;\nwindow.MOPOP_SetupTimeline = MOPOP_SetupTimeline;\nwindow.MOPOP_SaveEnv =MOPOP_SaveEnv;\nwindow.MAIN_CreateLabel = MAIN_CreateLabel;\nwindow.MOPOP_GetYearFromString = MOPOP_GetYearFromString;\nwindow.MOPOP_ImportAssets = MOPOP_ImportAssets;\nwindow.MOPOP_AutoStart = MOPOP_AutoStart;\nwindow.MOPOP_ReportUserEvent = MOPOP_ReportUserEvent;\nwindow.MOPOP_ToggleWallManipulation =MOPOP_ToggleWallManipulation;\nwindow.MOPOP_MenuShow = MOPOP_MenuShow;\nwindow.MOPOP_MenuHide = MOPOP_MenuHide;\nwindow.MOPOP_TestDB = MOPOP_TestDB;\nwindow.MOPOP_AddAnchors = MOPOP_AddAnchors;\nwindow.MOPOP_DownloadArtefact = MOPOP_DownloadArtefact;\nwindow.MOPOP_InfotableClick = MOPOP_InfotableClick;\nwindow.MOPOP_TempTable_StandardHookExit = MOPOP_TempTable_StandardHookExit;\nwindow.MOPOP_TempTable_StandardHookEntry =MOPOP_TempTable_StandardHookEntry;\nwindow.MOPOP_TempTable_InfoHookEntry =MOPOP_TempTable_InfoHookEntry;\nwindow.MOPOP_SetupHookwall =MOPOP_SetupHookwall;\nwindow.MOPOP_HookWallHookExit =MOPOP_HookWallHookExit;\nwindow.MOPOP_HookWallHookEntry =MOPOP_HookWallHookEntry;\nwindow.MOPOP_SetupScoreChart = MOPOP_SetupScoreChart;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":480,"y":80,"wires":[[]]},{"id":"6dea600c.5e0d4","type":"function","z":"615cd8c9.e4e9f8","name":"Init temptables","func":"if (mopop.hasOwnProperty(\"temptables\")) {\n    var N = mopop.temptables.length;\n    myconsolelog(\"MOPOP_InitEnv #temptables => \" + N);\n    for (var i = 0; i < N; i++) {\n\n        var tt = mopop.temptables[i];\n        var tName = tt.name;\n        var tDisplayName = tt.displayname;\n        var tileModel = tt.tilemodel;\n        var tileSize = tt.tilesize;\n        var W = tt.width;\n        var H = tt.height;\n        var wallWidth = tileSize * W;\n        var wallHeight = tileSize * H;\n\n        var tTrans = null;\n        if (tt.hasOwnProperty(\"transform\")) {\n            tTrans = tt.transform;\n        }\n\n        var tGoName = \"TT_\" + tName;\n        var tGo = null;\n        tGo = MAIN.UE.GameObject.Find(tGoName);\n        if (tGo != null) {\n            RT.Unity.DestroyGO(tGo);\n        }\n        tGo = new MAIN.UE.GameObject();\n\n        if (tGo != null) {\n            tGo.name = tGoName;\n\n            if (MAIN.worldgo != null) {\n                RT.Unity.SetParent(tGo, MAIN.worldgo);\n            }\n\n            MAIN.RR.Runtime.ToggleObjManipulation(tGo.name);\n            tGo.transform.localPosition = new MAIN.UE.Vector3(0, 0, i * 0.1);\n            MOPOP.temptable[tGoName] = {};\n            MOPOP.temptable[tGoName].name = tGoName;\n            MOPOP.temptable[tGoName].hooks = {};\n            MOPOP.temptable[tGoName].wuName = \"TT_WU_\" + tName;\n\n            if (tName != \"infotable\") {\n                MAIN_CreateLabel(tGoName + \"_title\", [-tileSize * 0.5, wallHeight - tileSize * 0.5, 0],\n                    [0, 0.707, 0.707, 0], [0.001, 0.001, 0.001], tGo, tDisplayName);\n            }\n\n            if (tName == \"infotable\") {\n                var tWuName = MOPOP.temptable[tGoName].wuName;\n                var tWuMenu = RT.Unity.CreateWU(tWuName, MAIN.WEBAPI.uiurl + \"/infomenu.html\", true, 700, 1000);\n                RT.Unity.SetParent(tWuMenu, tGo);\n                RT.Unity.SetLocalPose(tWuMenu, [-tileSize, 0, tileSize], [0, 0.707, 0.707, 0], [0.0005, 0.0005, 0.0005]);\n            }\n\n            //Creates and sets up a score chart\n            if (tName == \"scoretable\") {\n                MOPOP_SetupScoreChart(tGo, wallWidth, wallHeight);\n                RT.Web.SetTiimeout(500, function () {\n                    //RT.Unity.SetLocalPose(MOPOP.scorechart.chartGo, [-tileSize * 2, 0, tileSize * 0.5], [0, 0.707, 0.707, 0], null);\n                    RT.Unity.SetLocalPose(MOPOP.scorechart.chartGo, [0, tileSize * 0.5, -1.5 * tileSize], [0, 0.707, 0.707, 0], null);\n                });\n            }\n\n            //init temptable tiles\n            for (var h = 0; h < H; h++) {\n                for (var w = 0; w < W; w++) {\n                    var go = MAIN.VZ.AssetBundleHolder.InstantiateGameObject(MAIN.location.envassetbundle, tileModel);\n                    if (go != null) {\n                        go.name = tGoName + \"_\" + w + \"_\" + h;\n                        MOPOP.temptable[tGoName].hooks[go.name] = {\n                            \"isOccupied\": false,\n                            \"occupante\": null\n                        };\n\n                        go.transform.parent = tGo.transform;\n                        go.transform.localPosition = new MAIN.UE.Vector3(tileSize * w, tileSize * h, 0);\n\n                        var centerGo = MAIN.UE.GameObject.Find(go.name + \"/Hook\");\n                        if (centerGo != null) {\n\n                            centerGo.transform.localScale =\n                                new MAIN.UE.Vector3(\n                                    centerGo.transform.localScale.x * 4,\n                                    centerGo.transform.localScale.y * 4,\n                                    centerGo.transform.localScale.z * 8\n                                );\n\n                            var triggerData = {\n                                \"temptable\": tGoName,\n                                \"tileGoName\": go.name,\n                                \"hookGoName\": centerGo.name\n                            };\n\n                            if (tName == \"infotable\") {\n                                MAIN.RR.Runtime.PrepareInteractionGo(\n                                    centerGo,\n                                    MOPOP_TempTable_InfoHookEntry,\n                                    MOPOP_TempTable_StandardHookExit,\n                                    JSON.stringify(triggerData)\n                                );\n                            } else {\n                                MAIN.RR.Runtime.PrepareInteractionGo(\n                                    centerGo,\n                                    MOPOP_TempTable_StandardHookEntry,\n                                    MOPOP_TempTable_StandardHookExit,\n                                    JSON.stringify(triggerData)\n                                );\n                            }\n\n\n                        }\n                    }\n                }\n            }\n            if (tTrans != null) {\n                RT.Unity.SetLocalPose(tGo, tTrans.position, tTrans.rotation, tTrans.scale);\n            }\n        }\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":790,"y":120,"wires":[["b7d13b3f.5aa638"]]},{"id":"b7d13b3f.5aa638","type":"function","z":"615cd8c9.e4e9f8","name":"Toggle Manipulation","func":"var mopop = MAIN.location.data.mopop;\nif (mopop.hasOwnProperty(\"hookwalls\")) {\n    var N = mopop.hookwalls.length;\n    myconsolelog(\"MOPOP_InitEnv #hookswals => \" + N);\n    for (var i = 0; i < N; i++) {\n        var hw = mopop.hookwalls[i];\n        var hGoName = \"HW_\" + hw.name;\n        MAIN.RR.Runtime.ToggleObjManipulation(hGoName);\n        MAIN.RR.Runtime.ToggleBounds(hGoName);\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1010,"y":120,"wires":[[]]},{"id":"ca099020.9b42b","type":"comment","z":"615cd8c9.e4e9f8","name":"Mopop 1.0 Full js imple in one node","info":"","x":710,"y":80,"wires":[]},{"id":"a7e479d.b018288","type":"comment","z":"615cd8c9.e4e9f8","name":"mopop sim","info":"","x":120,"y":780,"wires":[]},{"id":"608b6c7a.69a0e4","type":"ui_template","z":"615cd8c9.e4e9f8","group":"ceea8389.aebd9","name":"","order":4,"width":13,"height":15,"format":"<style>\n.grid {\n  background: darksalmon;\n  width:60%;\n  margin: 10px;\n}\n\n.fill {\n  /*background-image: url('https://source.unsplash.com/random/150x150');*/\n  background-size: 50px;\n  position: relative;\n  height: 50px !important;\n  width: 50px !important;\n  margin: 0;\n  padding: 0;\n  /*top: 5px;\n  left: 5px;*/\n  /*cursor: pointer;*/\n  /*margin: 5px;*/\n}\n\n\n.fill img {\n    border:none;\n    /*width:50px;\n    height:50px;*/\n    margin:0;\n    padding:0;\n    top:0;\n    left:0;\n}\n\n.hold {\n  border: solid 5px #ccc;\n}\n\n.dropzone {\n  display: inline-block;\n  height: 50px !important;\n  width: 50px !important;\n  margin: 5px;\n  padding:0px;\n  border: solid 1px salmon;\n  background: white;\n}\n\n.hovered {\n  background: #f4f4f4;\n  border-style: dashed;\n}\n\n.creclist {\n    height:50% !important;\n    overflow:auto;\n    margin:10px;\n}\n</style>\n\n<!--\n<div class=\"dropzone\" id=\"b0\">\n    <div class=\"fill\" style=\"width:50px;background:url('http://10.0.0.2:8080/18812296198.jpg');\" draggable=\"true\"> \n        <img src=\"http://10.0.0.2:8080/18812296198.jpg\" width=\"50px\" height=\"50px\"/>\n    </div>\n</div>\n-->\n<!--\n<div class=\"fill\" style=\"width:50px;background:url('http://10.0.0.2:8080/18812296198.jpg');\" draggable=\"true\"> \n</div>\n-->\n\n<!--\nhttps://developer.mozilla.org/en-US/docs/Web/API/Document/drag_event\n-->\n\n\n<div>Records</div>\n<div id=\"recordslist\" class=\"creclist\">\n    </div>\n\n<div>Pop 2000-1990</div>\n<div class=\"popgrid grid\">\n    <div class=\"dropzone\" id=\"HW_popwall_5_3\"></div>\n    <div class=\"dropzone\" id=\"HW_popwall_4_3\"></div>\n    <div class=\"dropzone\" id=\"HW_popwall_3_3\"></div>\n    <div class=\"dropzone\" id=\"HW_popwall_2_3\"></div>\n    <div class=\"dropzone\" id=\"HW_popwall_1_3\"></div>\n    <div class=\"dropzone\" id=\"HW_popwall_0_3\"></div>\n    \n    <div class=\"dropzone\" id=\"HW_popwall_5_2\"></div>\n    <div class=\"dropzone\" id=\"HW_popwall_4_2\"></div>\n    <div class=\"dropzone\" id=\"HW_popwall_3_2\"></div>\n    <div class=\"dropzone\" id=\"HW_popwall_2_2\"></div>\n    <div class=\"dropzone\" id=\"HW_popwall_1_2\"></div>\n    <div class=\"dropzone\" id=\"HW_popwall_0_2\"></div>\n    \n    <div class=\"dropzone\" id=\"HW_popwall_5_1\"></div>\n    <div class=\"dropzone\" id=\"HW_popwall_4_1\"></div>\n    <div class=\"dropzone\" id=\"HW_popwall_3_1\"></div>\n    <div class=\"dropzone\" id=\"HW_popwall_2_1\"></div>\n    <div class=\"dropzone\" id=\"HW_popwall_1_1\"></div>\n    <div class=\"dropzone\" id=\"HW_popwall_0_1\"></div>\n    \n    <div class=\"dropzone\" id=\"HW_popwall_5_0\"></div>\n    <div class=\"dropzone\" id=\"HW_popwall_4_0\"></div>\n    <div class=\"dropzone\" id=\"HW_popwall_3_0\"></div>\n    <div class=\"dropzone\" id=\"HW_popwall_2_0\"></div>\n    <div class=\"dropzone\" id=\"HW_popwall_1_0\"></div>\n    <div class=\"dropzone\" id=\"HW_popwall_0_0\"></div>\n</div>\n\n<div>Rock 2000-1990</div>\n<div class=\"rockgrid grid\">\n    <!-- HW_rockwall_6_1 -->\n    <div class=\"dropzone\" id=\"HW_rockwall_5_3\"></div>\n    <div class=\"dropzone\" id=\"HW_rockwall_4_3\"></div>\n    <div class=\"dropzone\" id=\"HW_rockwall_3_3\"></div>\n    <div class=\"dropzone\" id=\"HW_rockwall_2_3\"></div>\n    <div class=\"dropzone\" id=\"HW_rockwall_1_3\"></div>\n    <div class=\"dropzone\" id=\"HW_rockwall_0_3\"></div>\n    \n    <div class=\"dropzone\" id=\"HW_rockwall_5_2\"></div>\n    <div class=\"dropzone\" id=\"HW_rockwall_4_2\"></div>\n    <div class=\"dropzone\" id=\"HW_rockwall_3_2\"></div>\n    <div class=\"dropzone\" id=\"HW_rockwall_2_2\"></div>\n    <div class=\"dropzone\" id=\"HW_rockwall_1_2\"></div>\n    <div class=\"dropzone\" id=\"HW_rockwall_0_2\"></div>\n    \n    <div class=\"dropzone\" id=\"HW_rockwall_5_1\"></div>\n    <div class=\"dropzone\" id=\"HW_rockwall_4_1\"></div>\n    <div class=\"dropzone\" id=\"HW_rockwall_3_1\"></div>\n    <div class=\"dropzone\" id=\"HW_rockwall_2_1\"></div>\n    <div class=\"dropzone\" id=\"HW_rockwall_1_1\"></div>\n    <div class=\"dropzone\" id=\"HW_rockwall_0_1\"></div>\n    \n    <div class=\"dropzone\" id=\"HW_rockwall_5_0\"></div>\n    <div class=\"dropzone\" id=\"HW_rockwall_4_0\"></div>\n    <div class=\"dropzone\" id=\"HW_rockwall_3_0\"></div>\n    <div class=\"dropzone\" id=\"HW_rockwall_2_0\"></div>\n    <div class=\"dropzone\" id=\"HW_rockwall_1_0\"></div>\n    <div class=\"dropzone\" id=\"HW_rockwall_0_0\"></div>\n</div>\n\n\n<script>\n\n    // Drag Functions\n    var dragged;\n    \n    function dragStart(e) {\n      dragged = e.target;\n      clickedItem(e);\n      \n      //e.target.style.opacity = .5;\n      //this.className += ' hold';\n      //setTimeout(() => (this.className = 'invisible'), 0);\n    }\n    \n    function dragEnd() {\n      //this.className = 'fill';\n    }\n    \n    function dragOver(e) {\n      e.preventDefault();\n    }\n    \n    function dragEnter(e) {\n      e.preventDefault();\n    }\n    \n    function dragLeave() {\n    }\n    \n    function dragDrop(e) {\n      \n      // V1\n      //var oldParent = dragged.parentNode.id;\n      //dragged.parentNode.removeChild( dragged );\n      //e.target.appendChild(dragged);\n      \n      // V2\n      var oldParent = dragged.parentNode.parentNode.id;\n      e.target.appendChild(dragged.parentNode);\n      e.target.childNodes[0].appendChild(dragged);\n      //dragged.parentNode.removeChild( dragged );\n      \n      var hsplits = e.target.id.split(\"_\");\n      var p = {\n          \"type\": \"drop\",\n          \"prevhook\": oldParent,\n          \"fullhook\" : e.target.id,\n          \"recordid\" : dragged.id,\n          \"wall\" : hsplits[1],\n          \"x\": parseInt(hsplits[2]),\n          \"y\": parseInt(hsplits[3])\n      }\n      //myscope.send({\"payload\": dragged.id + \" | \" + e.target.id});\n      myscope.send({\"payload\": p});\n    }\n    \n    function clickedItem(e){\n        var oldParent = dragged.parentNode.parentNode.id;\n        var hsplits = e.target.id.split(\"_\");\n        var p = {\n          \"type\": \"click\",\n          \"prevhook\": oldParent,\n          \"fullhook\" : e.target.id,\n          \"recordid\" : dragged.id,\n          \"wall\" : hsplits[1],\n          \"x\": parseInt(hsplits[2]),\n          \"y\": parseInt(hsplits[3])\n        }\n        myscope.send({\"payload\": p});\n    }\n    //this.scope.send({\"payload\": \"testB\"});\n    \n</script>\n\n<script>\n    var myscope;\n    (function(scope) {\n        myscope = scope;\n        scope.$watch('msg.payload', function(data) {\n            console.log(data);\n            \n            \n            \n            /*\n            artist: \"Faith No More\"\n            coverart: \"13860827829.jpg\"\n            coverid: \"13860827829\"\n            description: \"Faith No More\"\n            genre: \"rock\"\n            publishdate: \"1997-06-12T00:00:00.000Z\"\n            publisher: null\n            score: \"100\"\n            soldcopies: \"1,000,000\"\n            song: \"Album of the Year\"\n            title: \"Album of the Year (rock)\"\n            */\n            //<div class=\"fill\" style=\"width:50px;background:url('http://10.0.0.2:8080/18812296198.jpg');\" draggable=\"true\"> \n            \n            //init records pool\n            //var apibase = \"http://10.0.0.2:8080/\";\n            var apibase = \"http://129.27.186.88:8080/\";\n            var n = data.length;\n            console.log(\"n => \" + n);\n            \n            if(n > 0) {\n                $('#recordslist').html(\"\");\n            }\n            \n            for(var i = 0; i < n; i++) {\n                var d = data[i];\n                var url = apibase + d.coverart;\n                \n                var html = \"\";\n                html += '<div class=\"dropzone\" >';\n                html += '<div class=\"fill\" draggable=\"true\" id=\"' + d.coverid + '\">';\n                html += '<img id=\"' + d.coverid + '\" src=\"' + url + '\" width=\"50px\" height=\"50px\"/>'\n                html += \"</div>\";\n                html += '</div>';\n                \n                $('#recordslist').append(html);\n            }\n            \n            const empties = document.querySelectorAll('.dropzone');\n            const fills = document.querySelectorAll('.fill');\n            for (const fill of fills) {\n                fill.addEventListener('dragstart', dragStart);\n                fill.addEventListener('dragend', dragEnd);\n                //fill.addEventListener('click', dragEnd);\n            }\n            \n            // Loop through dropzone boxes and add listeners\n            for (const dropzone of empties) {\n              dropzone.addEventListener('dragover', dragOver);\n              dropzone.addEventListener('dragenter', dragEnter);\n              dropzone.addEventListener('dragleave', dragLeave);\n              dropzone.addEventListener('drop', dragDrop);\n            }\n        });\n    })(scope);\n</script>","storeOutMessages":false,"fwdInMessages":false,"resendOnRefresh":true,"templateScope":"local","x":500,"y":860,"wires":[["4ee8695b.abe0b8","70620ecf.a249"]]},{"id":"3187f89b.272298","type":"debug","z":"615cd8c9.e4e9f8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":940,"y":420,"wires":[]},{"id":"54110a5e.1242e4","type":"inject","z":"923bd7d5.f34fa8","name":"A","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":"30","topic":"","payload":"","payloadType":"date","x":810,"y":1240,"wires":[["df585204.d8c6"]]},{"id":"4ee8695b.abe0b8","type":"debug","z":"615cd8c9.e4e9f8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":690,"y":820,"wires":[]},{"id":"71c47e79.0d6dc","type":"function","z":"615cd8c9.e4e9f8","name":"prepare hook interaction/occupation","func":"\n//{\"fullhook\":\"HW_popwall_0_3\",\"recordid\":\"26279535209\",\"wall\":\"popwall\",\"x\":0,\"y\":3}\n\n/*\nMOPOP.hookwall[hGoName].hooks[go.name] = {\n                    \"isOccupied\": false,\n                    \"occupante\": null,\n                    \"x\": w,\n                    \"y\": h,\n                    \"wuinfo\": wuInfoName\n                }\n*/\n\n//picked\n/*\nvar artefactData = {\n    \"TrackableName\": mTrackableName,\n    \"TrackedGoName\": mTrackedGoName,\n    \"goName\": goName,\n    \"wuName\": wuName\n};\n*/\n\n//default init\nvar hookwall = flow.get(\"hookwall\");\nif(hookwall == null || hookwall == 'undefined') {\n    hookwall = {};\n    \n    var genres = [\"pop\", \"rock\"];\n    var walls = [\"popwall\", \"rockwall\"];\n    for(var i = 0; i < walls.length; i++) {\n        var wall = walls[i];\n        hookwall[wall] = {\n            \"hooks\": {},\n            \"genre\": genres[i],\n            \"startyear\": 1990,\n            \"endyear\": 2000\n        };\n        \n        for(var x = 0; x < 6; x++) {\n            for(var y = 0; y < 4; y++) {\n                var curhook = \"HW_\" + wall + \"_\" + x + \"_\" + y;\n                hookwall[wall].hooks[curhook] = {\n                    \"isOccupied\": false,\n                    \"occupante\": null,\n                    \"x\": x,\n                    \"y\": y\n                }\n            }    \n        }\n    }\n    flow.set(\"hookwall\",hookwall);\n}\n\n\nvar cd = msg.payload;\nif(cd.prevhook.includes(\"HW_\")) {\n    var prevParts = cd.prevhook.split(\"_\");\n    var prevWall = prevParts[1];\n    hookwall[prevWall].hooks[cd.prevhook].isOccupied = false;\n    hookwall[prevWall].hooks[cd.prevhook].occupante = null;\n}\n\nif(cd.fullhook.length > 0) {\n    hookwall[cd.wall].hooks[cd.fullhook].isOccupied = true;\n    hookwall[cd.wall].hooks[cd.fullhook].occupante = {\n        \"TrackableName\": cd.recordid,\n        \"TrackedGoName\": \"TGO-\" + cd.recordid,\n        \"goName\": \"TGO-\" + cd.recordid,\n        \"wuName\": \"WU-\" + cd.recordid\n    };\n}\nflow.set(\"hookwall\",hookwall);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":920,"y":880,"wires":[["dc306ddc.1471c","8b8afd83.1ab15"]]},{"id":"50a24611.a785d8","type":"function","z":"923bd7d5.f34fa8","name":"client filter","func":"try {\n    var n = MAIN.usercanvas;\n    return msg;\n} catch(err) {\n    return null;\n}\nreturn null;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":700,"y":1200,"wires":[["5e9c0f60.c4042"]]},{"id":"df585204.d8c6","type":"function","z":"923bd7d5.f34fa8","name":"client filter","func":"try {\n    var n = MAIN.usercanvas;\n    return msg;\n} catch(err) {\n    return null;\n}\nreturn null;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":960,"y":1240,"wires":[["23bdae4d.aa40a2"]]},{"id":"862c3783.b01048","type":"function","z":"615cd8c9.e4e9f8","name":"cache all covers","func":"\nvar all = msg.payload;\nvar records = {};\n\nfor(var i = 0; i < all.length; i++) {\n    var d = all[i];\n    records[d.coverid] = d;\n}\n\nflow.set(\"records\", records);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":970,"y":480,"wires":[[]]},{"id":"dc306ddc.1471c","type":"function","z":"615cd8c9.e4e9f8","name":"compute score","func":"var walls = [\"popwall\", \"rockwall\"];\nvar hookwall = flow.get(\"hookwall\");\nvar records = flow.get(\"records\");\n\n/*\nvar artefact = MOPOP.artefacts[occupanteId];\nvar genre = artefact.genre;\nvar score = artefact.score;\nvar year = MOPOP_GetYearFromString(artefact.publishdate);\nvar extraWeight = 1;\n*/\n\nvar wallsScore = 0;\nvar usedYearPerWall = {};\n\nfor(var walli = 0; walli < walls.length; walli++) {\n    var wall = walls[walli];\n    var hw = hookwall[wall];\n    var hwhooks = hw.hooks;\n    var wallGenre = hw.genre;\n    \n    var keys = Object.keys(hwhooks);\n    \n    usedYearPerWall[wall] = {};\n    var occupantList = [];\n    for(var j = 0; j < keys.length; j++) {\n        var k = keys[j];\n        \n        var isOccu = hwhooks[k].isOccupied;\n        if(isOccu) {\n            var occu = hwhooks[k].occupante;\n            var recordid = occu.TrackableName;\n            \n            //prepare list of occupants\n            occupantList.push({\n                \"hook\": occu,\n                \"hookname\": k\n            });\n            \n            var artefact = records[recordid];\n            var genre = artefact.genre;\n            var score = artefact.score;\n            const year = new Date(artefact.publishdate).getFullYear();\n            var extraWeight = 1;\n            //var wuInfoContent = \"\";\n            \n            if(genre != wallGenre) {\n                extraWeight = 0;\n                //wuInfoContent += \"Wrong Genre!\" + \"</br>\";\n                //node.warn(\"MOPOP_CalcScore ... Artefact[\" + recordid + \"].genre => \" + genre + \" != \" + wallGenre);\n            }\n            \n            var soldcopies = 0;\n            if (artefact.hasOwnProperty(\"soldcopies\")) {\n                soldcopies = parseFloat(artefact.soldcopies.replace(\",\", \"\"));\n                soldcopies *= 0.000001;\n            }\n            \n            var yearWeight = 1;\n            var yearOk = (parseFloat(year) >=  hw.startyear) || (parseFloat(year) <=  hw.endyear);\n            if(yearOk) {\n                if (!usedYearPerWall[wall].hasOwnProperty(year)) {\n                    var dataId = parseFloat(year) - parseFloat(hw.startyear);\n                    usedYearPerWall[wall][year] = {\n                        \"val\": 0,\n                        \"id\": dataId\n                    };\n                    //usedYearPerWall[wKey][year].val += 1;\n                }\n            } else {\n                yearWeight = 0;\n            }\n            \n            var soldScore = parseFloat(score) * soldcopies;\n            //node.warn(\"soldScore => \" + soldScore);\n            \n            var contribScore = soldScore * extraWeight * yearWeight;\n            //node.warn(\"contribScore => \" + contribScore);\n            \n            usedYearPerWall[wall][year].val += 1;\n            wallsScore += contribScore;\n            \n        } //isOccupied\n    } //hooks\n    \n    //occupant list checks, neighborhood\n    if (occupantList.length > 0) { // was 2\n        \n        var wallW = 6;\n\n        //reversed for year direction\n        //isReversed\n        var isReversed = false;\n        var NBins = wallW;\n        var xBins = [];\n\n        //prepare xbins\n        for (var wi = 0; wi < NBins; wi++) {\n            xBins.push([]);\n        }\n\n        var weightedPenalty = 1;\n        var groupBonus = 1;\n        \n        //collect years of occupants\n        var N = occupantList.length;\n        for (var i = 0; i < N; i++) {\n            var occ = occupantList[i];\n            var hook = occ.hook;\n            node.warn(hook);\n            var hookname = occ.hookname;\n            var hookOccupant = hook;//hook.occupante;\n            occupanteId = hookOccupant.TrackableName;\n            \n            var hookparts = hookname.split(\"_\");\n            var hookX = hookparts[2];//hook.x;\n            var hookY = hookparts[3];//hook.y;\n\n            var hooksArtefact = records[occupanteId];\n            var hooksArtist = hooksArtefact.artist;\n        \n            var hooksYearStr = new Date(hooksArtefact.publishdate).getFullYear();\n            var hooksYear = parseInt(hooksYearStr);\n\n            //node.warn(\"before push => \" + xBins + \" | \" + hookX + \" | occ => \" + JSON.stringify(occ));\n            xBins[hookX].push({\"year\": hooksYear, \"hookname\": hookname, \"occupanteId\": occupanteId});\n            //node.warn(\"after push\");\n            \n            //var groupBonus = 1;\n            \n            //look for other artists close by\n            // start at i = k +1  \n            if(true) {\n            //if(i + 1 < N) {\n                for(var ia = 0; ia < N; ia++ ) {\n                //for(var ia = i + 1; ia < N; ia++ ) {\n                    var tocc = occupantList[ia];\n                    var thook = tocc.hook;\n                    //var thookX = thook.x;\n                    //var thookY = thook.y;\n                    var thookparts = tocc.hookname.split(\"_\");\n                    var thookX = thookparts[2];//hook.x;\n                    var thookY = thookparts[3];//hook.y;\n                    var thookname = tocc.hookname;\n                    var thookOccupant = thook;//thook.occupante;\n                    var toccupanteId = thookOccupant.TrackableName;\n                    var thooksArtefact = records[toccupanteId];\n                    var thooksArtist = thooksArtefact.artist;\n                    \n                    node.warn(thooksArtist + \" vs \" + hooksArtist + \", \" + toccupanteId + \" vs \" + occupanteId);\n                    // if the same artis\n                    if(thooksArtist == hooksArtist && toccupanteId != occupanteId) {\n                        dhx = Math.abs(thookX - hookX);\n                        dhy = Math.abs(thookY - hookY);\n                        //node.warn(\"thookX=\" + thookX + \", hookX=\" + hookX + \", dhx=\" + dhx);\n                        //node.warn(\"thookY=\" + thookY + \", hookY=\" + hookY + \", dhy=\" + dhy);\n                        //check if its placed on a hook next to it\n                        if(dhx < 2 && dhy < 2) {\n                            weightedPenalty *= 1.2;\n                            groupBonus *= 1.2;\n                        }\n                    }\n                }\n            }\n        }\n        \n        node.warn(xBins);\n\n\n        //filter only used bins, so that we can go pairwise through them\n        var filteredBins = [];\n        for (var wi = 0; wi < NBins; wi++) {\n            if (xBins[wi].length > 0) {\n                filteredBins.push(xBins[wi]);\n            }\n        }\n\n        var tempWeight = 1;\n        //check for weak monotonic years\n        var fNbins = filteredBins.length;\n        for (var wi = 1; wi < fNbins; wi++) {\n\n            var prevBin = filteredBins[wi - 1];\n            var curBin = filteredBins[wi];\n            \n            for (pwi = 0; pwi < prevBin.length; pwi++) {\n                //curPrevYear = prevBin[pwi]; //was this\n                curPrevYear = prevBin[pwi].year; //was\n                \n                var curPrevHookname = prevBin[pwi].hookname;\n                //var curPrevWu = MAIN.PUI.WorldUI.Find(\"WU_\" + curPrevHookname);\n                var curPrevWu = null;\n                \n                for (cwi = 0; cwi < curBin.length; cwi++) {\n                    //curCurYear = curBin[cwi]; //was this\n                    curCurYear = curBin[cwi].year; //was this\n                    var curCurHookname = prevBin[pwi].hookname;\n\n                    //check each year of bin A vs each year of bin b\n                    //every violation causes a 5% penalty\n                    if (isReversed) {\n\n                        //reverse means year gos from 1990 to 2000 where the hook ids go from 13 to 0\n                        //therefore to be monotonic increasing, the years seen from the ids would be\n                        // decreasing, theferefor we penalize when its increasing\n                        if (curPrevYear < curCurYear) {\n                            weightedPenalty *= 0.8;\n                            tempWeight *= 0.8;\n                        }\n                    } else {\n                        //regular monotonic increase where the yeare goes from 1990 to 2000 and the\n                        // hook id from 0 to 13, therefore we penalize violations when decreasing\n                        // which means prev year is bigger as next year\n                        if (curPrevYear > curCurYear) {\n                            weightedPenalty *= 0.8;\n                            tempWeight *= 0.8;\n                        }\n                    }\n                }\n                \n                \n                \n                if(curPrevWu != null) {\n                    curPrevWu.document.getElementById(\"wrap\").innerHTML += \n                    \"Order penalty: \" + tempWeight.toFixed(2) + \"</br>\";\n                }\n\n\n                //TODO maybe check violations inside a xBin\n                /*\n                if (curYear != prevYear) {\n                    weightedPenalty += -0.01;\n                }\n                nextYear = prevBin[cwi - 1];\n                */\n            }\n        }\n        //node.warn(\"wall=\" + wall);\n        //node.warn(\"weightedPenalty=\" + weightedPenalty);\n        //node.warn(\"tempWeight=\" + tempWeight);\n        //node.warn(\"groupBonus=\" + groupBonus);\n        \n        var repmsg = {};\n        repmsg.payload = {};\n        repmsg.payload[wall] = {};\n        repmsg.payload[wall].penalty = weightedPenalty.toFixed(2);\n        repmsg.payload[wall].group = groupBonus.toFixed(2);\n        repmsg.payload[wall].order = tempWeight.toFixed(2);\n        node.warn(repmsg);\n        if(wall == \"popwall\") {\n            node.send([null, repmsg, null, null]);\n        } else {\n            node.send([null, null, repmsg, null]);\n        }\n        //node.send([null, null, null, repmsg]);\n        wallsScore *= weightedPenalty;\n    }\n} //walls\n    \n    \n// score notification\nif (wallsScore >= 0) {\n    var data = {\n        \"score\": wallsScore //TODO use real score here\n    };\n    \n    var jsonScores = JSON.stringify(data);\n    node.send([{\"topic\": \"MOPOP/wallscore\", \"payload\": data}, null, null, null]);\n\n    //node.warn(usedYearPerWall);\n    for (var k in usedYearPerWall) {\n        var jsonYears = JSON.stringify(usedYearPerWall[k]);\n        var topic = \"MOPOP/wallyearhist\" + \"/\" + k.replace(\"HW_\", \"\"); //dirty fix!!!!\n        \n        var keys = Object.keys(usedYearPerWall[k]);\n        if(keys.length > 0) {\n            node.send([{\"topic\": topic, \"payload\":usedYearPerWall[k]}, null, null, null]);\n        }\n    }\n}\n    \n\n//node.warn(\"wallsScore => \" + wallsScore);\n\n\nreturn null;","outputs":4,"noerr":0,"initialize":"","finalize":"","x":600,"y":960,"wires":[["f9a6b10.4ca045"],["caa76f09.c3031"],["d5b47556.a91068"],[]]},{"id":"c305d4ee.dbd298","type":"function","z":"615cd8c9.e4e9f8","name":"reset hookwall","func":"flow.set(\"hookwall\", null);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":710,"y":780,"wires":[[]]},{"id":"f9a6b10.4ca045","type":"mqtt out","z":"615cd8c9.e4e9f8","name":"","topic":"","qos":"0","retain":"false","broker":"73e9a24f.21590c","x":890,"y":940,"wires":[]},{"id":"62ec707d.d9eb1","type":"function","z":"2e447439.f12bdc","name":"set 0","func":"for(var i = 0; i < 1; i++) {\n    var max = 0;\n    var min = 0;\n    \n    max = 100;\n    min = 35;\n    var v1 = Math.random() * (max - min) + min;\n    \n    var d = {\n        \"score\":0\n    }\n    msg.payload = d;\n    node.send(msg);\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":290,"y":620,"wires":[["74e71579.13bdac"]]},{"id":"12124d1a.3b1223","type":"inject","z":"2e447439.f12bdc","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":140,"y":620,"wires":[["62ec707d.d9eb1"]]},{"id":"578f1368.2bb01c","type":"ui_text","z":"615cd8c9.e4e9f8","group":"ceea8389.aebd9","order":5,"width":5,"height":1,"name":"","label":"Pop Penalty","format":"{{msg.payload.popwall.penalty}}","layout":"row-spread","x":1010,"y":1000,"wires":[]},{"id":"333f17c7.92ea68","type":"ui_text","z":"615cd8c9.e4e9f8","group":"ceea8389.aebd9","order":6,"width":5,"height":1,"name":"","label":"Pop Group","format":"{{msg.payload.popwall.group}}","layout":"row-spread","x":1010,"y":1040,"wires":[]},{"id":"3b4c9615.c0f0fa","type":"ui_text","z":"615cd8c9.e4e9f8","group":"ceea8389.aebd9","order":7,"width":5,"height":1,"name":"","label":"Pop Order","format":"{{msg.payload.popwall.order}}","layout":"row-spread","x":1010,"y":1080,"wires":[]},{"id":"759f9b74.fa99c4","type":"ui_text","z":"615cd8c9.e4e9f8","group":"ceea8389.aebd9","order":8,"width":5,"height":1,"name":"","label":"Rock Penalty","format":"{{msg.payload.rockwall.penalty}}","layout":"row-spread","x":1010,"y":1120,"wires":[]},{"id":"b03c6ec9.f8f1a","type":"ui_text","z":"615cd8c9.e4e9f8","group":"ceea8389.aebd9","order":9,"width":5,"height":1,"name":"","label":"Rock Group","format":"{{msg.payload.rockwall.group}}","layout":"row-spread","x":1010,"y":1160,"wires":[]},{"id":"cd462b1.e3fded8","type":"ui_text","z":"615cd8c9.e4e9f8","group":"ceea8389.aebd9","order":10,"width":5,"height":1,"name":"","label":"Rock Order","format":"{{msg.payload.rockwall.order}}","layout":"row-spread","x":1010,"y":1200,"wires":[]},{"id":"d66ba560.217ad8","type":"ui_button","z":"615cd8c9.e4e9f8","name":"","group":"ceea8389.aebd9","order":1,"width":2,"height":1,"passthru":false,"label":"Reset Scores","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":280,"y":1140,"wires":[["4f863bed.435fb4","fbddc0e.5874a4"]]},{"id":"4f863bed.435fb4","type":"function","z":"615cd8c9.e4e9f8","name":"","func":"var repmsg = {};\nrepmsg.payload = {};\n\nvar val = 1;\nvar wall = \"popwall\";\nrepmsg.payload[wall] = {};\nrepmsg.payload[wall].penalty = val.toFixed(2);\nrepmsg.payload[wall].group = val.toFixed(2);\nrepmsg.payload[wall].order = val.toFixed(2);\n\nvar wall = \"rockwall\";\nrepmsg.payload[wall] = {};\nrepmsg.payload[wall].penalty = val.toFixed(2);\nrepmsg.payload[wall].group = val.toFixed(2);\nrepmsg.payload[wall].order = val.toFixed(2);\n\nreturn repmsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":480,"y":1140,"wires":[["caa76f09.c3031","d5b47556.a91068"]]},{"id":"d5b47556.a91068","type":"function","z":"615cd8c9.e4e9f8","name":"collect","func":"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":810,"y":1120,"wires":[["759f9b74.fa99c4","b03c6ec9.f8f1a","cd462b1.e3fded8"]]},{"id":"caa76f09.c3031","type":"function","z":"615cd8c9.e4e9f8","name":"collect","func":"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":790,"y":1000,"wires":[["578f1368.2bb01c","333f17c7.92ea68","3b4c9615.c0f0fa"]]},{"id":"ed91b465.3c73a8","type":"function","z":"615cd8c9.e4e9f8","name":"init trigger","func":"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":280,"y":780,"wires":[["c305d4ee.dbd298","dc306ddc.1471c","4f863bed.435fb4","fbddc0e.5874a4"]]},{"id":"fbddc0e.5874a4","type":"function","z":"615cd8c9.e4e9f8","name":"","func":"msg.payload = [];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":480,"y":1180,"wires":[["fbafe9db.a72988"]]},{"id":"fbafe9db.a72988","type":"link out","z":"615cd8c9.e4e9f8","name":"chart reset send","links":["11e922bf.3224dd"],"x":615,"y":1180,"wires":[]},{"id":"11e922bf.3224dd","type":"link in","z":"dd11dd22.8a11a","name":"chart reset rec","links":["fbafe9db.a72988"],"x":355,"y":1080,"wires":[["9582a8e0.2fe298","55d4a0bf.415f4","db761842.bba938","66d0e119.c5edd"]]},{"id":"66d0e119.c5edd","type":"function","z":"dd11dd22.8a11a","name":"","func":"msg.payload = 0;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":540,"y":980,"wires":[["e7825d4f.39039","7e8144a3.3e1acc"]]},{"id":"7e8144a3.3e1acc","type":"ui_text","z":"dd11dd22.8a11a","group":"ceea8389.aebd9","order":3,"width":5,"height":1,"name":"","label":"Score","format":"{{msg.payload.toFixed(2)}}","layout":"row-spread","x":810,"y":1000,"wires":[]},{"id":"70620ecf.a249","type":"function","z":"615cd8c9.e4e9f8","name":"","func":"if(msg.payload.type == \"click\") {\n    node.send([msg, null]);\n}\n\nif(msg.payload.type == \"drop\") {\n    node.send([null, msg]);\n}\nreturn null;","outputs":2,"noerr":0,"initialize":"","finalize":"","x":680,"y":860,"wires":[["6fa5fead.3e661"],["71c47e79.0d6dc"]]},{"id":"6fa5fead.3e661","type":"function","z":"615cd8c9.e4e9f8","name":"handle clicked","func":"var records = flow.get(\"records\");\nvar record = records[msg.payload.recordid];\nmsg.payload = record;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":900,"y":840,"wires":[["70c2e235.7c714c","e15f28ed.d53ef8"]]},{"id":"c4634be7.094938","type":"ui_text","z":"615cd8c9.e4e9f8","group":"ceea8389.aebd9","order":15,"width":5,"height":1,"name":"","label":"Artist","format":"{{msg.payload.artist}}","layout":"row-spread","x":1390,"y":780,"wires":[]},{"id":"5165dc72.c2b704","type":"ui_text","z":"615cd8c9.e4e9f8","group":"ceea8389.aebd9","order":16,"width":5,"height":1,"name":"","label":"Song","format":"{{msg.payload.song}}","layout":"row-spread","x":1390,"y":820,"wires":[]},{"id":"b757fe44.eaee8","type":"ui_text","z":"615cd8c9.e4e9f8","group":"ceea8389.aebd9","order":18,"width":5,"height":1,"name":"","label":"Year","format":"{{msg.payload}}","layout":"row-spread","x":1390,"y":860,"wires":[]},{"id":"5308036b.219ccc","type":"ui_text","z":"615cd8c9.e4e9f8","group":"ceea8389.aebd9","order":20,"width":5,"height":1,"name":"","label":"Score","format":"{{msg.payload.score}}","layout":"row-spread","x":1390,"y":900,"wires":[]},{"id":"75c5bb23.bea2a4","type":"ui_text","z":"615cd8c9.e4e9f8","group":"ceea8389.aebd9","order":17,"width":5,"height":1,"name":"","label":"Genre","format":"{{msg.payload.genre}}","layout":"row-spread","x":1390,"y":940,"wires":[]},{"id":"7e67f6b1.d65308","type":"function","z":"615cd8c9.e4e9f8","name":"","func":"msg.payload = new Date(msg.payload.publishdate).getFullYear();\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1240,"y":860,"wires":[["b757fe44.eaee8"]]},{"id":"fd24809.d02e58","type":"ui_text","z":"615cd8c9.e4e9f8","group":"ceea8389.aebd9","order":19,"width":5,"height":1,"name":"","label":"Sold","format":"{{msg.payload.soldcopies}}","layout":"row-spread","x":1390,"y":980,"wires":[]},{"id":"3adfca97.99ba16","type":"function","z":"615cd8c9.e4e9f8","name":"","func":"var coverid = msg.payload.coverid;\nvar coverart = msg.payload.coverart;\n\n//var fn = \"/ragrug_mnt/uploads/\" + coverart;\nvar fn = \"http://10.0.0.2:8080/\" + coverart;\n\nmsg.payload = fn;\nmsg.payload.link = fn;\nmsg.link = fn;\nmsg.payload.file = fn;\nmsg.payload.filename = fn;\nmsg.file = fn;\nmsg.filename = fn;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1220,"y":1020,"wires":[["f9e2876.17c2978"]]},{"id":"f9e2876.17c2978","type":"ui_template","z":"615cd8c9.e4e9f8","group":"ceea8389.aebd9","name":"","order":11,"width":4,"height":3,"format":"<img src=\"{{msg.payload}}\" width=\"150px\" height=\"150px\"/>\n","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","x":1380,"y":1020,"wires":[[]]},{"id":"70c2e235.7c714c","type":"function","z":"615cd8c9.e4e9f8","name":"","func":"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1080,"y":840,"wires":[["c4634be7.094938","5165dc72.c2b704","7e67f6b1.d65308","5308036b.219ccc","75c5bb23.bea2a4","fd24809.d02e58","3adfca97.99ba16"]]},{"id":"e15f28ed.d53ef8","type":"debug","z":"615cd8c9.e4e9f8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1110,"y":780,"wires":[]},{"id":"8b8afd83.1ab15","type":"function","z":"615cd8c9.e4e9f8","name":"parse list input","func":"//input\n/*\nCONCAT(a.name, ' (', a.genre, ')') as title, \\\nb.name AS description, \\\nb.name AS artist, \\\na.name AS song, \\\na.coverid AS coverid, \\\na.coverart AS coverart, \\\na.published AS publishdate, \\\na.publisher AS publisher, \\\nb.score AS score, \\\na.soldcopies AS soldcopies, \\\na.genre AS genre \\\n*/\n//output\n/*\n[\n    {\n        \"title\": \"xx\",\n        \"description\": \"xx\",\n        \"artist\": \"xx\",\n        \"song\": \"xx\",\n        \"coverid\": \"1324353\",\n        \"coverart\": \"xx\",\n        \"pubishdate\": \"year-mm-ddT00:00:00.000Z\",\n        \"publisher\": \"xx\",\n        \"score\": 100,\n        \"soldcopies\": \"1,000,000\",\n        \"genre\":\"rock\"\n    }\n]\n*/\nvar hookwall = flow.get(\"hookwall\");\nvar records = flow.get(\"records\");\nvar hungRecords = [];\nfor(var wall in hookwall) {\n    for(var hn in hookwall[wall].hooks) {\n        var hook = hookwall[wall].hooks[hn];\n        if(hook.isOccupied) {\n            node.warn(hook.occupante);\n            var recordid = hook.occupante.TrackableName;\n            var record = records[recordid];\n            hungRecords.push(record);\n        }\n    }\n}\nmsg.payload = hungRecords;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1000,"y":640,"wires":[["3718c243.c41fde","244dfdff.932552"]]},{"id":"9a44a838.9f2618","type":"function","z":"923bd7d5.f34fa8","name":"setup scoreboard","func":"var chartId = flow.get(\"mopop_score_chart\");\nvar chart = MAIN.usercanvas.charts2[chartId];\n\nvar scBoard = chartId + \"_board\";\nflow.set(\"mopop_score_chart_board\", scBoard);\n\n\nvar html = '<div id=\"wrap\" style=\"font-size:20px;background-color:silver;color:black;border:solid 4px rgb(0,77,109);margin:5px;padding:5px;border-radius:4px;\">' + \n'<span style=\"margin-right:12%;\">Score multiplier:</span><span id=\"penalty\">1.0</span><span>x</span></br>' + \n'<span style=\"margin-right:20%;\">Group Bonus:     </span><span id=\"group\">1.0</span><span>x</span></br>' + \n'<span style=\"margin-right:11%;\">Timeline Bonus:  </span><span id=\"order\">1.0</span><span>x</span></br>' + \n\"</div>\";\n\nvar header = '<div id=\"title\" style=\"font-weight:bold;font-size:24px;background-color:rgb(0,77,109);color:silver;padding:5px;border-radius:4px;\">SCORE STATUS</div>';\nhtml = header + html;\n\nvar wuScBoard = RT.Unity.CreateWU(scBoard, html, false, 300, 200);\n\nRT.Unity.SetParent(wuScBoard, chart.chartGo);\nRT.Unity.SetLocalPose(wuScBoard,\n    [0.5, -0.8, 0], // T //z was 0.055\n    [0, 0, 0, 0], // R\n    [0.005, 0.005, 0.001] // S was null\n);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1040,"y":1740,"wires":[[]]}]